Here is the image describtion:
```
The image is a logo for Texas Instruments, a well-known technology company. The logo consists of two main elements: a graphic symbol and the company name.

1. **Graphic Symbol**: On the left side of the logo, there is a stylized representation of the state of Texas. Inside this outline, the letters "ti" are prominently displayed. The "t" is lowercase and the "i" is also lowercase, with the dot of the "i" positioned above the right arm of the "t".

2. **Company Name**: To the right of the graphic symbol, the words "TEXAS INSTRUMENTS" are written in a bold, uppercase font. The word "TEXAS" is positioned above the word "INSTRUMENTS", and both words are aligned to the left. The font is serif, giving it a classic and professional appearance.

The overall design is black and white, which gives it a clean and timeless look. The combination of the state outline and the "ti" letters effectively represents the company's identity and its roots in Texas.
```

#### - -

 

Here is the image describtion:
```
The image features the words "Design Reference" written in white text on a black background. The text is italicized, giving it a slanted appearance to the right. The font used is clean and sans-serif, which means it does not have the small projecting features called "serifs" at the end of strokes. The words are aligned in such a way that "Design" is positioned above "Reference," and both words are centered horizontally within the image. The overall design is simple and straightforward, with a high contrast between the white text and the black background, making the words easily readable.
```

**August 2002 Advanced Analog Products**

**SLOD006B**

#### **IMPORTANT NOTICE**

Texas Instruments Incorporated and its subsidiaries (TI) reserve the right to make corrections, modifications, enhancements, improvements, and other changes to its products and services at any time and to discontinue any product or service without notice. Customers should obtain the latest relevant information before placing orders and should verify that such information is current and complete. All products are sold subject to TI's terms and conditions of sale supplied at the time of order acknowledgment.

TI warrants performance of its hardware products to the specifications applicable at the time of sale in accordance with TI's standard warranty. Testing and other quality control techniques are used to the extent TI deems necessary to support this warranty. Except where mandated by government requirements, testing of all parameters of each product is not necessarily performed.

TI assumes no liability for applications assistance or customer product design. Customers are responsible for their products and applications using TI components. To minimize the risks associated with customer products and applications, customers should provide adequate design and operating safeguards.

TI does not warrant or represent that any license, either express or implied, is granted under any TI patent right, copyright, mask work right, or other TI intellectual property right relating to any combination, machine, or process in which TI products or services are used. Information published by TI regarding third party products or services does not constitute a license from TI to use such products or services or a warranty or endorsement thereof. Use of such information may require a license from a third party under the patents or other intellectual property of that third party, or a license from TI under the patents or other intellectual property of TI.

Reproduction of information in TI data books or data sheets is permissible only if reproduction is without alteration and is accompanied by all associated warranties, conditions, limitations, and notices. Reproduction of this information with alteration is an unfair and deceptive business practice. TI is not responsible or liable for such altered documentation.

Resale of TI products or services with statements different from or beyond the parameters stated by TI for that product or service voids all express and any implied warranties for the associated TI product or service and is an unfair and deceptive business practice. TI is not responsible or liable for any such statements.

Mailing Address:

Texas Instruments Post Office Box 655303 Dallas, Texas 75265

Copyright 2002, Texas Instruments Incorporated

# **Forward**

Everyone interested in analog electronics should find some value in this book, and an effort has been made to make the material understandable to the relative novice while not too boring for the practicing engineer. Special effort has been taken to ensure that each chapter can stand alone for the reader with the proper background. Of course, this causes redundancy that some people might find boring, but it's worth the price to enable the satisfaction of a diversified audience.

Start at Chapter 1 if you are a novice, and read through until completion of Chapter 9. After Chapter 9 is completed, the reader can jump to any chapter and be confident that they are prepared for the material. More experienced people such as electronic technicians, digital engineers, and non-electronic engineers can start at Chapter 3 and read through Chapter 9. Senior electronic technicians, electronic engineers, and fledgling analog engineers can start anywhere they feel comfortable and read through Chapter 9. Experienced analog engineers should jump to the subject that interests them. Analog gurus should send their additions, corrections, and complaints to me, and if they see something that looks familiar, they should feel complimented that others appreciate their contributions.

Chapter 1 is a history and story chapter. It is not required reading for anyone, but it defines the op amp's place in the world of analog electronics. Chapter 2 reviews some basic physics and develops the fundamental circuit equations that are used throughout the book. Similar equations have been developed in other books, but the presentation here emphasizes material required for speedy op amp design. The ideal op amp equations are developed in Chapter 3, and this chapter enables the reader to rapidly compute op amp transfer equations including ac response. The emphasis on single power supply systems forces the designer to bias circuits when the inputs are referenced to ground, and Chapter 4 gives a detailed procedure that quickly yields a working solution every time.

Op amps can't exist without feedback, and feedback has inherent stability problems, so feedback and stability are covered in Chapter 5. Chapters 6 and 7 develop the voltage feedback op amp equations, and they teach the concept of relative stability and compensation of potentially unstable op amps. Chapter 8 develops the current feedback op amp equations and discusses current feedback stability. Chapter 9 compares current feedback and voltage feedback op amps. The meat of this book is Chapters 12, 13, and 14 where the reader is shown how design the converter to transducer/actuator interface with the aid of op amps.

The remaining chapters give support material for Chapters 12, 13, and 14. Chapter 18 was a late addition. Portable applications are expanding rapidly and they emphasize the need for low-voltage/low-power design techniques. Chapter 18 defines some parameters in a new way so they lend themselves to low voltage design, and it takes the reader through several low voltage designs.

Thanks to editor James Karki for his contribution. We never gave him enough time to do detailed editing, so if you find errors or typos, direct them to my attention. Thanks to Ted Thomas, a marketing manager with courage enough to support a book, and big thanks for Alun Roberts who paid for this effort. Thomas Kugelstadt, applications manager, thanks for your support and help.

Also many thanks to the contributing authors, James Karki, Richard Palmer, Thomas Kugelstadt, Perry Miller, Bruce Carter, and Richard Cesari who gave generously of their time.

Regards,

Ron Mancini Chief Editor

# **Contents**

Contents

| 1 |                                                    | The Op Amp's Place In The World<br>.                  | 1-1  |  |  |  |
|---|----------------------------------------------------|-------------------------------------------------------|------|--|--|--|
| 2 | Review of Circuit Theory<br>.                      |                                                       |      |  |  |  |
|   | 2.1                                                | Introduction<br>.                                     | 2-1  |  |  |  |
|   | 2.2                                                | Laws of Physics<br>.                                  | 2-1  |  |  |  |
|   | 2.3                                                | Voltage Divider Rule<br>.                             | 2-3  |  |  |  |
|   | 2.4                                                | Current Divider Rule<br>.                             | 2-4  |  |  |  |
|   | 2.5                                                | Thevenin's Theorem<br>.                               | 2-5  |  |  |  |
|   | 2.6                                                | Superposition<br>.                                    | 2-8  |  |  |  |
|   | 2.7                                                | Calculation of a Saturated Transistor Circuit<br>.    | 2-9  |  |  |  |
|   | 2.8                                                | Transistor Amplifier<br>.                             | 2-10 |  |  |  |
| 3 |                                                    | Development of the Ideal Op Amp Equations<br>.<br>3-1 |      |  |  |  |
|   | 3.1                                                | Ideal Op Amp Assumptions<br>.                         | 3-1  |  |  |  |
|   | 3.2                                                | The Noninverting Op Amp<br>.                          | 3-3  |  |  |  |
|   | 3.3                                                | The Inverting Op Amp<br>.                             | 3-4  |  |  |  |
|   | 3.4                                                | The Adder<br>. 3-5                                    |      |  |  |  |
|   | 3.5                                                | The Differential Amplifier<br>.                       | 3-6  |  |  |  |
|   | 3.6                                                | Complex Feedback Networks<br>.                        | 3-7  |  |  |  |
|   | 3.7                                                | Video Amplifiers<br>.                                 | 3-9  |  |  |  |
|   | 3.8                                                | Capacitors<br>. 3-9                                   |      |  |  |  |
|   | 3.9                                                | Summary<br>. 3-11                                     |      |  |  |  |
| 4 | Single Supply Op Amp Design Techniques<br>.<br>4-1 |                                                       |      |  |  |  |
|   | 4.1                                                | Single Supply versus Dual Supply<br>.                 | 4-1  |  |  |  |
|   | 4.2                                                | Circuit Analysis<br>.                                 | 4-3  |  |  |  |
|   | 4.3                                                | Simultaneous Equations<br>.                           | 4-8  |  |  |  |
|   |                                                    | 4.3.1<br>Case 1: VOUT = +mVIN+b<br>.                  | 4-9  |  |  |  |
|   |                                                    | 4.3.2<br>Case 2: VOUT = +mVIN – b<br>.                | 4-13 |  |  |  |
|   |                                                    | 4.3.3<br>Case 3: VOUT = –mVIN + b<br>.                | 4-16 |  |  |  |
|   |                                                    | 4.3.4<br>Case 4: VOUT = –mVIN – b<br>.                | 4-19 |  |  |  |
|   | 4.4                                                | Summary<br>. 4-22                                     |      |  |  |  |
| 5 |                                                    | Feedback and Stability Theory<br>.                    | 5-1  |  |  |  |
|   | 5.1                                                | Why Study Feedback Theory?<br>.                       | 5-1  |  |  |  |
|   | 5.2                                                | Block Diagram Math and Manipulations<br>.             | 5-1  |  |  |  |
|   | 5.3                                                | Feedback Equation and Stability<br>.                  | 5-6  |  |  |  |

#### Contents

|   | 5.4                                                  | Bode Analysis of Feedback Circuits<br>.                          | 5-7  |  |
|---|------------------------------------------------------|------------------------------------------------------------------|------|--|
|   | 5.5                                                  | Loop Gain Plots are the Key to Understanding Stability<br>.      | 5-12 |  |
|   | 5.6                                                  | The Second Order Equation and Ringing/Overshoot Predictions<br>. | 5-15 |  |
|   | 5.7                                                  | References<br>. 5-16                                             |      |  |
| 6 |                                                      | Development of the Non Ideal Op Amp Equations<br>.               | 6-1  |  |
|   | 6.1                                                  | Introduction<br>.                                                | 6-1  |  |
|   | 6.2                                                  | Review of the Canonical Equations<br>.                           | 6-2  |  |
|   | 6.3                                                  | Noninverting Op Amps<br>.                                        | 6-5  |  |
|   | 6.4                                                  | Inverting Op Amps<br>.                                           | 6-6  |  |
|   | 6.5                                                  | Differential Op Amps<br>.                                        | 6-8  |  |
| 7 |                                                      | Voltage-Feedback Op Amp Compensation<br>.                        | 7-1  |  |
|   | 7.1                                                  | Introduction<br>.                                                | 7-1  |  |
|   | 7.2                                                  | Internal Compensation<br>.                                       | 7-2  |  |
|   | 7.3                                                  | External Compensation, Stability, and Performance<br>.           | 7-8  |  |
|   | 7.4                                                  | Dominant-Pole Compensation<br>.                                  | 7-9  |  |
|   | 7.5                                                  | Gain Compensation<br>.                                           | 7-12 |  |
|   | 7.6                                                  | Lead Compensation<br>.                                           | 7-13 |  |
|   | 7.7                                                  | Compensated Attenuator Applied to Op Amp<br>.                    | 7-16 |  |
|   | 7.8                                                  | Lead-Lag Compensation<br>.                                       | 7-18 |  |
|   | 7.9                                                  | Comparison of Compensation Schemes<br>.                          | 7-20 |  |
|   | 7.10                                                 | Conclusions<br>. 7-21                                            |      |  |
| 8 | Current-Feedback Op Amp Analysis<br>.                |                                                                  |      |  |
|   | 8.1                                                  | Introduction<br>.                                                | 8-1  |  |
|   | 8.2                                                  | CFA Model<br>. 8-1                                               |      |  |
|   | 8.3                                                  | Development of the Stability Equation<br>.                       | 8-2  |  |
|   | 8.4                                                  | The Noninverting CFA<br>.                                        | 8-3  |  |
|   | 8.5                                                  | The Inverting CFA<br>.                                           | 8-5  |  |
|   | 8.6                                                  | Stability Analysis<br>.                                          | 8-7  |  |
|   | 8.7                                                  | Selection of the Feedback Resistor<br>.                          | 8-9  |  |
|   | 8.8                                                  | Stability and Input Capacitance<br>.                             | 8-11 |  |
|   | 8.9                                                  | Stability and Feedback Capacitance<br>.                          | 8-12 |  |
|   | 8.10                                                 | Compensation of CF and CG<br>.                                   | 8-13 |  |
|   | 8.11                                                 | Summary<br>. 8-14                                                |      |  |
| 9 | Voltage- and Current-Feedback Op Amp Comparison<br>. |                                                                  |      |  |
|   | 9.1                                                  | Introduction<br>.                                                | 9-1  |  |
|   | 9.2                                                  | Precision<br>. 9-2                                               |      |  |
|   | 9.3                                                  | Bandwidth<br>. 9-3                                               |      |  |
|   | 9.4                                                  | Stability<br>. 9-6                                               |      |  |
|   | 9.5                                                  | Impedance<br>.                                                   | 9-7  |  |
|   | 9.6                                                  | Equation Comparison<br>.                                         | 9-8  |  |

iv

| 10 | Op Amp Noise Theory and Applications<br>.<br>10-1 |                                                                |       |
|----|---------------------------------------------------|----------------------------------------------------------------|-------|
|    | 10.1                                              | Introduction<br>. 10-1                                         |       |
|    | 10.2                                              | Characterization<br>.                                          | 10-1  |
|    |                                                   | 10.2.1<br>rms versus P-P Noise<br>.                            | 10-1  |
|    |                                                   | 10.2.2<br>Noise Floor<br>.                                     | 10-3  |
|    |                                                   | 10.2.3<br>Signal-to-Noise Ratio<br>.                           | 10-3  |
|    |                                                   | 10.2.4<br>Multiple Noise Sources<br>.                          | 10-3  |
|    |                                                   | 10.2.5<br>Noise Units<br>.                                     | 10-4  |
|    | 10.3                                              | Types of Noise<br>.                                            | 10-4  |
|    |                                                   | 10.3.1<br>Shot Noise<br>.                                      | 10-5  |
|    |                                                   | 10.3.2<br>Thermal Noise<br>.                                   | 10-7  |
|    |                                                   | 10.3.3<br>Flicker Noise<br>.                                   | 10-8  |
|    |                                                   | 10.3.4<br>Burst Noise<br>.                                     | 10-9  |
|    |                                                   | 10.3.5<br>Avalanche Noise<br>.                                 | 10-9  |
|    | 10.4                                              | Noise Colors<br>.                                              | 10-10 |
|    |                                                   | 10.4.1<br>White Noise<br>.                                     | 10-11 |
|    |                                                   | 10.4.2<br>Pink Noise<br>.                                      | 10-11 |
|    |                                                   | 10.4.3<br>Red/Brown Noise<br>.                                 | 10-12 |
|    | 10.5                                              | Op Amp Noise<br>.                                              | 10-12 |
|    |                                                   | 10.5.1<br>The Noise Corner Frequency and Total Noise<br>.      | 10-12 |
|    |                                                   | 10.5.2<br>The Corner Frequency<br>.                            | 10-13 |
|    |                                                   | 10.5.3<br>Op Amp Circuit Noise Model<br>.                      | 10-14 |
|    |                                                   | 10.5.4<br>Inverting Op Amp Circuit Noise<br>.                  | 10-16 |
|    |                                                   | 10.5.5<br>Noninverting Op Amp Circuit Noise<br>.               | 10-17 |
|    |                                                   | 10.5.6<br>Differential Op Amp Circuit Noise<br>.               | 10-18 |
|    |                                                   | 10.5.7<br>Summary<br>.                                         | 10-18 |
|    | 10.6                                              | Putting It All Together<br>.                                   | 10-19 |
|    | 10.7                                              | References<br>.                                                | 10-23 |
| 11 |                                                   | Understanding Op Amp Parameters<br>.                           | 11-1  |
|    | 11.1                                              | Introduction<br>. 11-1                                         |       |
|    | 11.2                                              | Operational Amplifier Parameter Glossary<br>.                  | 11-2  |
|    | 11.3                                              | Additional Parameter Information<br>.                          | 11-8  |
|    |                                                   | 11.3.1<br>Input Offset Voltage<br>.                            | 11-8  |
|    |                                                   | 11.3.2<br>Input Current<br>.                                   | 11-10 |
|    |                                                   | 11.3.3<br>Input Common Mode Voltage Range<br>.                 | 11-11 |
|    |                                                   | 11.3.4<br>Differential Input Voltage Range<br>.                | 11-11 |
|    |                                                   | 11.3.5<br>Maximum Output Voltage Swing<br>.                    | 11-12 |
|    |                                                   | 11.3.6<br>Large Signal Differential Voltage Amplification<br>. | 11-13 |
|    |                                                   | 11.3.7<br>Input Parasitic Elements<br>.                        | 11-13 |
|    |                                                   | 11.3.8<br>Output Impedance<br>.                                | 11-14 |
|    |                                                   | 11.3.9<br>Common-Mode Rejection Ratio<br>.                     | 11-15 |
|    |                                                   | 11.3.10 Supply Voltage Rejection Ratio<br>.                    | 11-15 |
|    |                                                   | 11.3.11 Supply Current<br>.                                    | 11-16 |

Contents v

|    |            | 11.3.12 Slew Rate at Unity Gain<br>.                                 | 11-16 |
|----|------------|----------------------------------------------------------------------|-------|
|    |            | 11.3.13 Equivalent Input Noise<br>.                                  | 11-17 |
|    |            | 11.3.14 Total Harmonic Distortion Plus Noise<br>.                    | 11-18 |
|    |            | 11.3.15 Unity Gain Bandwidth and Phase Margin<br>.                   | 11-19 |
|    |            | 11.3.16 Settling Time<br>.                                           | 11-22 |
| 12 |            | Instrumentation: Sensors to A/D Converters<br>.                      | 12-1  |
|    | 12.1       | Introduction<br>. 12-1                                               |       |
|    | 12.2       | Transducer Types<br>.                                                | 12-6  |
|    | 12.3       | Design Procedure<br>.                                                | 12-11 |
|    | 12.4       | Review of the System Specifications<br>.                             | 12-12 |
|    | 12.5       | Reference Voltage Characterization<br>.                              | 12-12 |
|    | 12.6       | Transducer Characterization<br>.                                     | 12-13 |
|    | 12.7       | ADC Characterization<br>.                                            | 12-15 |
|    | 12.8       | Op Amp Selection<br>.                                                | 12-15 |
|    | 12.9       | Amplifier Circuit Design<br>.                                        | 12-16 |
|    | 12.10 Test | . 12-23                                                              |       |
|    |            | 12.11 Summary<br>.                                                   | 12-23 |
|    |            | 12.12 References<br>.                                                | 12-23 |
|    |            |                                                                      |       |
| 13 |            | Wireless Communication: Signal Conditioning for IF Sampling<br>.     | 13-1  |
|    | 13.1       | Introduction<br>. 13-1                                               |       |
|    | 13.2       | Wireless Systems<br>.                                                | 13-1  |
|    | 13.3       | Selection of ADCs/DACs<br>.                                          | 13-6  |
|    | 13.4       | Factors Influencing the Choice of Op Amps<br>.                       | 13-10 |
|    | 13.5       | Anti-Aliasing Filters<br>.                                           | 13-11 |
|    | 13.6       | Communication D/A Converter Reconstruction Filter<br>.               | 13-13 |
|    | 13.7       | External Vref Circuits for ADCs/DACs<br>.                            | 13-15 |
|    | 13.8       | High-Speed Analog Input Drive Circuits<br>.                          | 13-18 |
|    | 13.9       | References<br>.                                                      | 13-22 |
| 14 |            | Interfacing D/A Converters to Loads<br>.                             | 14-1  |
|    | 14.1       | Introduction<br>. 14-1                                               |       |
|    | 14.2       | Load Characteristics<br>.                                            | 14-1  |
|    |            | 14.2.1<br>DC Loads<br>.                                              | 14-1  |
|    |            | 14.2.2<br>AC Loads<br>.                                              | 14-2  |
|    | 14.3       | Understanding the D/A Converter and its Specifications<br>.          | 14-2  |
|    |            | 14.3.1<br>Types of D/A Converters — Understanding the Tradeoffs<br>. | 14-2  |
|    |            | 14.3.2<br>The Resistor Ladder D/A Converter<br>.                     | 14-2  |
|    |            | 14.3.3<br>The Weighted Resistor D/A Converter<br>.                   | 14-3  |
|    |            | 14.3.4<br>The R/2R D/A Converter<br>.                                | 14-4  |
|    |            | 14.3.5<br>The Sigma Delta D/A Converter<br>.                         | 14-5  |
|    | 14.4       | D/A Converter Error Budget<br>.                                      | 14-6  |
|    |            | 14.4.1<br>Accuracy versus Resolution<br>.                            | 14-7  |
|    |            | 14.4.2<br>DC Application Error Budget<br>.                           | 14-7  |
|    |            |                                                                      |       |

|    |      | 14.4.3                              | AC Application Error Budget<br>.                            | 14-8  |
|----|------|-------------------------------------|-------------------------------------------------------------|-------|
|    |      | 14.4.4                              | .<br>14-10                                                  |       |
|    | 14.5 | D/A Converter Errors and Parameters | .<br>14-10                                                  |       |
|    |      | 14.5.1                              | DC Errors and Parameters<br>.                               | 14-10 |
|    |      | 14.5.2                              | AC Application Errors and Parameters<br>.                   | 14-14 |
|    | 14.6 |                                     | Compensating For DAC Capacitance<br>.                       | 14-18 |
|    | 14.7 |                                     | Increasing Op Amp Buffer Amplifier Current and Voltage<br>. | 14-19 |
|    |      | 14.7.1                              | Current Boosters<br>.                                       | 14-20 |
|    |      | 14.7.2                              | Voltage Boosters<br>.                                       | 14-20 |
|    |      | 14.7.3                              | Power Boosters<br>.                                         | 14-22 |
|    |      | 14.7.4                              | Single-Supply Operation and DC Offsets<br>.                 | 14-22 |
| 15 |      |                                     | Sine Wave Oscillators<br>.                                  | 15-1  |
|    | 15.1 |                                     | What is a Sine Wave Oscillator?<br>.                        | 15-1  |
|    | 15.2 |                                     | Requirements for Oscillation<br>.                           | 15-1  |
|    | 15.3 |                                     | Phase Shift in the Oscillator<br>.                          | 15-3  |
|    | 15.4 |                                     | Gain in the Oscillator<br>.                                 | 15-4  |
|    | 15.5 |                                     | Active Element (Op Amp) Impact on the Oscillator<br>.       | 15-5  |
|    | 15.6 |                                     | Analysis of the Oscillator Operation (Circuit)<br>.         | 15-7  |
|    | 15.7 |                                     | Sine Wave Oscillator Circuits<br>.                          | 15-9  |
|    |      | 15.7.1                              | Wien Bridge Oscillator<br>.                                 | 15-9  |
|    |      | 15.7.2                              | Phase Shift Oscillator, Single Amplifier<br>.               | 15-14 |
|    |      | 15.7.3                              | Phase Shift Oscillator, Buffered<br>.                       | 15-15 |
|    |      | 15.7.4                              | Bubba Oscillator<br>.                                       | 15-17 |
|    |      | 15.7.5                              | Quadrature Oscillator<br>.                                  | 15-18 |
|    |      | 15.7.6                              | Conclusion<br>.                                             | 15-20 |
|    | 15.8 | References                          | .                                                           | 15-21 |
|    |      |                                     |                                                             |       |
| 16 |      |                                     | Active Filter Design Techniques<br>.                        | 16-1  |
|    | 16.1 | Introduction                        | . 16-1                                                      |       |
|    | 16.2 |                                     | Fundamentals of Low-Pass Filters<br>.                       | 16-2  |
|    |      | 16.2.1                              | Butterworth Low-Pass FIlters<br>.                           | 16-6  |
|    |      | 16.2.2                              | Tschebyscheff Low-Pass Filters<br>.                         | 16-7  |
|    |      | 16.2.3                              | Bessel Low-Pass Filters<br>.                                | 16-7  |
|    |      | 16.2.4                              | Quality Factor Q<br>.                                       | 16-9  |
|    |      | 16.2.5                              | Summary<br>.                                                | 16-10 |
|    | 16.3 |                                     | Low-Pass Filter Design<br>.                                 | 16-11 |
|    |      | 16.3.1                              | First-Order Low-Pass Filter<br>.                            | 16-12 |
|    |      | 16.3.2                              | Second-Order Low-Pass Filter<br>.                           | 16-14 |
|    |      | 16.3.3                              | Higher-Order Low-Pass Filters<br>.                          | 16-19 |
|    | 16.4 |                                     | High-Pass Filter Design<br>.                                | 16-21 |
|    |      | 16.4.1                              | First-Order High-Pass Filter<br>.                           | 16-23 |
|    |      | 16.4.2                              | Second-Order High-Pass Filter<br>.                          | 16-24 |
|    |      | 16.4.3                              | Higher-Order High-Pass Filter<br>.                          | 16-26 |

Contents vii

#### Contents

|    | 16.5 |                     | Band-Pass Filter Design<br>.                                  | 16-27        |
|----|------|---------------------|---------------------------------------------------------------|--------------|
|    |      | 16.5.1              | Second-Order Band-Pass Filter<br>.                            | 16-29        |
|    |      | 16.5.2              | Fourth-Order Band-Pass Filter (Staggered Tuning)<br>.         | 16-32        |
|    | 16.6 |                     | Band-Rejection Filter Design<br>.                             | 16-36        |
|    |      | 16.6.1              | Active Twin-T Filter<br>.                                     | 16-37        |
|    |      | 16.6.2              | Active Wien-Robinson Filter<br>.                              | 16-39        |
|    | 16.7 |                     | All-Pass Filter Design<br>.                                   | 16-41        |
|    |      | 16.7.1              | First-Order All-Pass Filter<br>.                              | 16-44        |
|    |      | 16.7.2              | Second-Order All-Pass Filter<br>.                             | 16-44        |
|    |      | 16.7.3              | Higher-Order All-Pass Filter<br>.                             | 16-45        |
|    | 16.8 |                     | Practical Design Hints<br>.                                   | 16-47        |
|    |      | 16.8.1              | Filter Circuit Biasing<br>.                                   | 16-47        |
|    |      | 16.8.2              | Capacitor Selection<br>.                                      | 16-50        |
|    |      | 16.8.3              | Component Values<br>.                                         | 16-52        |
|    |      | 16.8.4              | Op Amp Selection<br>.                                         | 16-53        |
|    | 16.9 |                     | Filter Coefficient Tables<br>.                                | 16-55        |
|    |      | 16.10 References    | .                                                             | 16-63        |
|    |      |                     |                                                               |              |
| 17 |      |                     | Circuit Board Layout Techniques<br>.                          | 17-1         |
|    | 17.1 |                     | General Considerations<br>.                                   | 17-1         |
|    |      | 17.1.1              | The PCB is a Component of the Op Amp Design<br>.              | 17-1         |
|    |      | 17.1.2              | Prototype, Prototype, PROTOTYPE!<br>.                         | 17-1         |
|    |      | 17.1.3              | Noise Sources<br>.                                            | 17-2         |
|    | 17.2 |                     | PCB Mechanical Construction<br>.                              | 17-3         |
|    |      | 17.2.1              | Materials — Choosing the Right One for the Application<br>.   | 17-3         |
|    |      | 17.2.2              | How Many Layers are Best?<br>.                                | 17-4         |
|    | 17.3 | 17.2.3<br>Grounding | Board Stack-Up — The Order of Layers<br>.<br>.                | 17-6<br>17-7 |
|    |      | 17.3.1              | The Most Important Rule: Keep Grounds Separate<br>.           | 17-7         |
|    |      | 17.3.2              | Other Ground Rules<br>.                                       | 17-7         |
|    |      | 17.3.3              | A Good Example<br>.                                           | 17-9         |
|    |      | 17.3.4              | A Notable Exception<br>.                                      | 17-10        |
|    | 17.4 |                     | The Frequency Characteristics of Passive Components<br>.      | 17-11        |
|    |      | 17.4.1              | Resistors<br>.                                                | 17-11        |
|    |      | 17.4.2              | Capacitors<br>.                                               | 17-12        |
|    |      | 17.4.3              | Inductors<br>.                                                | 17-13        |
|    |      | 17.4.4              | Unexpected PCB Passive Components<br>.                        | 17-14        |
|    | 17.5 | Decoupling          | .                                                             | 17-20        |
|    |      | 17.5.1              | Digital Circuitry — A Major Problem for Analog Circuitry<br>. | 17-20        |
|    |      | 17.5.2              | Choosing the Right Capacitor<br>.                             | 17-21        |
|    |      | 17.5.3              | Decoupling at the IC Level<br>.                               | 17-22        |
|    |      | 17.5.4              | Decoupling at the Board Level<br>.                            | 17-23        |
|    | 17.6 |                     | Input and Output Isolation<br>.                               | 17-23        |
|    |      |                     |                                                               |              |
|    | 17.7 | Packages            | .                                                             | 17-24        |

|    |      | 17.7.1           | Through-Hole Considerations<br>.                                                 | 17-26        |
|----|------|------------------|----------------------------------------------------------------------------------|--------------|
|    |      | 17.7.2           | Surface Mount<br>.                                                               | 17-27        |
|    |      | 17.7.3           | Unused Sections<br>.                                                             | 17-27        |
|    | 17.8 | Summary          | .                                                                                | 17-28        |
|    |      | 17.8.1           | General<br>.                                                                     | 17-28        |
|    |      | 17.8.2           | Board Structure<br>.                                                             | 17-28        |
|    |      | 17.8.3           | Components<br>.                                                                  | 17-28        |
|    |      | 17.8.4           | Routing<br>.                                                                     | 17-29        |
|    |      | 17.8.5           | Bypass<br>.                                                                      | 17-29        |
|    | 17.9 | References       | .                                                                                | 17-29        |
| 18 |      |                  | Designing Low-Voltage Op Amp Circuits<br>.                                       | 18-1         |
|    | 18.1 | Introduction     | . 18-1                                                                           |              |
|    | 18.2 |                  | Dynamic Range<br>.                                                               | 18-3         |
|    | 18.3 |                  | Signal-to-Noise Ratio<br>.                                                       | 18-5         |
|    | 18.4 |                  | Input Common-Mode Range<br>.                                                     | 18-6         |
|    | 18.5 |                  | Output Voltage Swing<br>.                                                        | 18-11        |
|    | 18.6 |                  | Shutdown and Low Current Drain<br>.                                              | 18-12        |
|    | 18.7 |                  | Single-Supply Circuit Design<br>.                                                | 18-13        |
|    | 18.8 |                  | Transducer to ADC Analog Interface<br>.                                          | 18-13        |
|    | 18.9 |                  | DAC to Actuator Analog Interface<br>.                                            | 18-16        |
|    |      |                  | 18.10 Comparison of Op Amps<br>.                                                 | 18-20        |
|    |      | 18.11 Summary    | .                                                                                | 18-22        |
|    |      |                  |                                                                                  |              |
| A  |      |                  | Single-Supply Circuit Collection<br>.                                            | A-1          |
|    | A.1  | Introduction     | .                                                                                | A-1          |
|    | A.2  |                  | Boundary Conditions<br>.                                                         | A-4          |
|    | A.3  | Amplifiers       | . A-5                                                                            |              |
|    |      | A.3.1            | Inverting Op Amp with Noninverting Positive Reference<br>.                       | A-5          |
|    |      | A.3.2            | Inverting Op Amp with Inverting Negative Reference<br>.                          | A-6          |
|    |      | A.3.3            | Inverting Op Amp with Noninverting Negative Reference<br>.                       | A-7          |
|    |      | A.3.4            | Inverting Op Amp with Inverting Positive Reference<br>.                          | A-8          |
|    |      | A.3.5            | Noninverting Op Amp with Inverting Positive Reference<br>.                       | A-9          |
|    |      | A.3.6            | Noninverting Op Amp with Noninverting Negative Reference                         | .<br>A-10    |
|    |      | A.3.7            | Noninverting Op Amp with Inverting Negative Reference<br>.                       | A-11         |
|    |      | A.3.8            | Noninverting Op Amp with Noninverting Positive Reference<br>.                    | A-12         |
|    |      | A.3.9            | Differential Amplifier<br>.                                                      | A-13         |
|    |      | A.3.10           | Differential Amplifier With Bias Correction<br>.                                 | A-14         |
|    |      | A.3.11           | High Input Impedance Differential Amplifier<br>.                                 | A-15         |
|    |      | A.3.12           | High Common-Mode Range Differential Amplifier<br>.                               | A-16         |
|    |      | A.3.13           | High-Precision Differential Amplifier<br>.                                       | A-17         |
|    |      | A.3.14           | Simplified High-Precision Differential Amplifier<br>.                            | A-18         |
|    |      | A.3.15<br>A.3.16 | Variable Gain Differential Amplifier<br>.<br>T Network in the Feedback Loop<br>. | A-19<br>A-20 |

Contents ix

#### Contents

|   |     | A.3.17      | Buffer<br>.<br>A-21                                               |
|---|-----|-------------|-------------------------------------------------------------------|
|   |     | A.3.18      | Inverting AC Amplifier<br>.<br>A-22                               |
|   |     | A.3.19      | Noninverting AC Amplifier<br>.<br>A-23                            |
|   | A.4 |             | Computing Circuits<br>.<br>A-24                                   |
|   |     | A.4.1       | Inverting Summer<br>.<br>A-24                                     |
|   |     | A.4.2       | Noninverting Summer<br>.<br>A-25                                  |
|   |     | A.4.3       | Noninverting Summer with Buffers<br>.<br>A-26                     |
|   |     | A.4.4       | Inverting Integrator<br>.<br>A-27                                 |
|   |     | A.4.5       | Inverting Integrator with Input Current Compensation<br>.<br>A-28 |
|   |     | A.4.6       | Inverting Integrator with Drift Compensation<br>.<br>A-29         |
|   |     | A.4.7       | Inverting Integrator with Mechanical Reset<br>.<br>A-30           |
|   |     | A.4.8       | Inverting Integrator with Electronic Reset<br>.<br>A-31           |
|   |     | A.4.9       | Inverting Integrator with Resistive Reset<br>.<br>A-32            |
|   |     | A.4.10      | Noninverting Integrator with Inverting Buffer<br>.<br>A-33        |
|   |     | A.4.11      | Noninverting Integrator Approximation<br>.<br>A-34                |
|   |     | A.4.12      | Inverting Differentiator<br>.<br>A-35                             |
|   |     | A.4.13      | Inverting Differentiator with Noise Filter<br>.<br>A-36           |
|   | A.5 | Oscillators | .<br>A-37                                                         |
|   |     | A.5.1       | Basic Wien Bridge Oscillator<br>.<br>A-37                         |
|   |     | A.5.2       | Wien Bridge Oscillator with Nonlinear Feedback<br>.<br>A-38       |
|   |     | A.5.3       | Wien Bridge Oscillator with AGC<br>.<br>A-39                      |
|   |     | A.5.4       | Quadrature Oscillator<br>.<br>A-40                                |
|   |     | A.5.5       | Classical Phase Shift Oscillator<br>.<br>A-41                     |
|   |     | A.5.6       | Buffered Phase Shift Oscillator<br>.<br>A-42                      |
|   |     | A.5.7       | Bubba Oscillator<br>.<br>A-43                                     |
|   |     | A.5.8       | Triangle Oscillator<br>.<br>A-44                                  |
| B |     |             | Single-Supply Op Amp Selection Guide<br>.<br>B-1                  |

x

Figures

| 2–1  | Ohm's Law Applied to the Total Circuit<br>.<br>2-2                   |
|------|----------------------------------------------------------------------|
| 2–2  | Ohm's Law Applied to a Component<br>.<br>2-2                         |
| 2–3  | Kirchoff's Voltage Law<br>.<br>2-2                                   |
| 2–4  | Kirchoff's Current Law<br>.<br>2-3                                   |
| 2–5  | Voltage Divider Rule<br>.<br>2-3                                     |
| 2–6  | Current Divider Rule<br>.<br>2-4                                     |
| 2–7  | Original Circuit<br>.<br>2-5                                         |
| 2–8  | Thevenin's Equivalent Circuit for Figure 2–7<br>.<br>2-5             |
| 2–9  | Example of Thevenin's Equivalent Circuit<br>.<br>2-6                 |
| 2–10 | Analysis Done the Hard Way<br>.<br>2-7                               |
| 2–11 | Superposition Example<br>.<br>2-8                                    |
| 2–12 | When V1 is Grounded<br>.<br>2-8                                      |
| 2–13 | When V2 is Grounded<br>.<br>2-8                                      |
| 2–14 | Saturated Transistor Circuit<br>.<br>2-9                             |
| 2–15 | Transistor Amplifier<br>.<br>2-10                                    |
| 2–16 | Thevenin Equivalent of the Base Circuit<br>.<br>2-11                 |
| 3–1  | The Ideal Op Amp<br>.<br>3-2                                         |
| 3–2  | The Noninverting Op Amp<br>.<br>3-3                                  |
| 3–3  | The Inverting Op Amp<br>.<br>3-4                                     |
| 3–4  | The Adder Circuit<br>.<br>3-5                                        |
| 3–5  | The Differential Amplifier<br>.<br>3-6                               |
| 3–6  | Differential Amplifier With Common-Mode Input Signal<br>.<br>3-7     |
| 3–7  | T Network in Feedback Loop<br>.<br>3-7                               |
| 3–8  | Thevenin's Theorem Applied to T Network<br>.<br>3-8                  |
| 3–9  | Video Amplifier<br>. 3-9                                             |
| 3–10 | Low-Pass Filter<br>.<br>3-10                                         |
| 3–11 | High-Pass Filter<br>.<br>3-10                                        |
| 4–1  | Split-Supply Op Amp Circuit<br>.<br>4-1                              |
| 4–2  | Split-Supply Op Amp Circuit With Reference Voltage Input<br>.<br>4-2 |
| 4–3  | Split-Supply Op Amp Circuit With Common-Mode Voltage<br>.<br>4-2     |
| 4–4  | Single-Supply Op Amp Circuit<br>.<br>4-3                             |
| 4–5  | Inverting Op Amp<br>.<br>4-4                                         |
| 4–6  | Inverting Op Amp With VCC Bias<br>.<br>4-5                           |
| 4–7  | Transfer Curve for Inverting Op Amp With VCC Bias<br>.<br>4-5        |
| 4–8  | Noninverting Op Amp<br>.<br>4-7                                      |

Contents xi

| 4–9<br>4–10 | Transfer Curve for Noninverting Op Amp<br>.<br>Schematic for Case1: VOUT = +mVIN + b<br>. | 4-7<br>4-9 |
|-------------|-------------------------------------------------------------------------------------------|------------|
| 4–11        | Case 1 Example Circuit<br>.                                                               | 4-12       |
|             |                                                                                           |            |
| 4–12        | Case 1 Example Circuit Measured Transfer Curve<br>.                                       | 4-12       |
| 4–13        | Schematic for Case 2: VOUT = +mVIN – b<br>.                                               | 4-13       |
| 4–14        | Case 2 Example Circuit<br>.                                                               | 4-15       |
| 4–15        | Case 2 Example Circuit Measured Transfer Curve<br>.                                       | 4-15       |
| 4–16        | Schematic for Case 3: VOUT = –mVIN + b<br>.                                               | 4-16       |
| 4–17        | Case 3 Example Circuit<br>.                                                               | 4-17       |
| 4–18        | Case 3 Example Circuit Measured Transfer Curve<br>.                                       | 4-18       |
| 4–19        | Schematic for Case 4: VOUT = –mVIN – b<br>.                                               | 4-19       |
| 4–20        | Case 4 Example Circuit<br>.                                                               | 4-20       |
| 4–21        | Case 4 Example Circuit Measured Transfer Curve<br>.                                       | 4-21       |
| 5–1         | Definition of Blocks<br>.                                                                 | 5-2        |
| 5–2         | Summary Points<br>.                                                                       | 5-3        |
| 5–3         | Definition of Control System Terms<br>.                                                   | 5-3        |
| 5–4         | Definition of an Electronic Feedback Circuit<br>.                                         | 5-3        |
| 5–5         | Multiloop Feedback System<br>.                                                            | 5-4        |
| 5–6         | Block Diagram Transforms<br>.                                                             | 5-5        |
| 5–7         | Comparison of Control and Electronic Canonical Feedback Systems<br>.                      | 5-6        |
| 5–8         | Low-Pass Filter<br>. 5-8                                                                  |            |
| 5–9         | Bode Plot of Low-Pass Filter Transfer Function<br>.                                       | 5-9        |
| 5–10        | Band Reject Filter<br>.                                                                   | 5-9        |
| 5–11        | Individual Pole Zero Plot of Band Reject Filter<br>.                                      | 5-10       |
|             |                                                                                           |            |
| 5–12        | Combined Pole Zero Plot of Band Reject Filter<br>.                                        | 5-10       |
| 5–13        | When No Pole Exists in Equation (5–12)<br>.                                               | 5-11       |
| 5–14        | When Equation 5–12 has a Single Pole<br>.                                                 | 5-11       |
| 5–15        | Magnitude and Phase Plot of Equation 5–14<br>.                                            | 5-13       |
| 5–16        | Magnitude and Phase Plot of the Loop Gain Increased to (K+C)<br>.                         | 5-14       |
| 5–17        | Magnitude and Phase Plot of the Loop Gain With Pole Spacing Reduced<br>.                  | 5-14       |
| 5–18        | Phase Margin and Overshoot vs Damping Ratio<br>.                                          | 5-16       |
| 6–1         | Feedback System Block Diagram<br>.                                                        | 6-2        |
| 6–2         | Feedback Loop Broken to Calculate Loop Gain<br>.                                          | 6-4        |
| 6–3         | Noninverting Op Amp<br>.                                                                  | 6-5        |
| 6–4         | Open Loop Noninverting Op Amp<br>.                                                        | 6-6        |
| 6–5         | Inverting Op Amp<br>.                                                                     | 6-6        |
| 6–6         | Inverting Op Amp: Feedback Loop Broken for Loop Gain Calculation<br>.                     | 6-7        |
| 6–7         | Differential Amplifier Circuit<br>.                                                       | 6-8        |
| 7–1         | Miller Effect Compensation<br>.                                                           | 7-2        |
| 7–2         | TL03X Frequency and Time Response Plots<br>.                                              | 7-3        |
| 7–3         | Phase Margin and Percent Overshoot Versus Damping Ratio<br>.                              | 7-4        |
| 7–4         | TL07X Frequency and Time Response Plots<br>.                                              | 7-5        |
|             |                                                                                           |            |

| 7–5   | TL08X Frequency and Time Response Plots<br>.                               | 7-6      |
|-------|----------------------------------------------------------------------------|----------|
| 7–6   | TLV277X Frequency Response Plots<br>.                                      | 7-7      |
| 7–7   | TLV227X Time Response Plots<br>.                                           | 7-7      |
| 7–8   | Capacitively-Loaded Op Amp<br>.                                            | 7-9      |
| 7–9   | Capacitively-Loaded Op Amp With Loop Broken for Loop Gain (Aβ) Calculation | .<br>7-9 |
| 7–10  | Possible Bode Plot of the Op Amp Described in Equation 7–7<br>.            | 7-11     |
| 7–11  | Dominant-Pole Compensation Plot<br>.                                       | 7-11     |
| 7–12  | Gain Compensation<br>.                                                     | 7-12     |
| 7–13  | Lead-Compensation Circuit<br>.                                             | 7-13     |
| 7–14  | Lead-Compensation Bode Plot<br>.                                           | 7-14     |
| 7–15  | Inverting Op Amp With Lead Compensation<br>.                               | 7-15     |
| 7–16  | Noninverting Op Amp With Lead Compensation<br>.                            | 7-16     |
| 7–17  | Op Amp With Stray Capacitance on the Inverting Input<br>.                  | 7-16     |
| 7–18  | Compensated Attenuator Circuit<br>.                                        | 7-17     |
| 7–19  | Compensated Attenuator Bode Plot<br>.                                      | 7-18     |
| 7–20  | Lead-Lag Compensated Op Amp<br>.                                           | 7-19     |
| 7–21  | Bode Plot of Lead-Lag Compensated Op Amp<br>.                              | 7-19     |
| 7–22  | Closed-Loop Plot of Lead-Lag Compensated Op Amp<br>.                       | 7-20     |
| 8–1   | Current-Feedback Amplifier Model<br>.                                      | 8-2      |
| 8–2   | Stability Analysis Circuit<br>.                                            | 8-2      |
| 8–3   | Stability Analysis Circuit<br>.                                            | 8-3      |
| 8–4   | Noninverting CFA<br>.                                                      | 8-4      |
| 8–5   | Inverting CFA<br>. 8-5                                                     |          |
| 8–6   | Bode Plot of Stability Equation<br>.                                       | 8-7      |
| 8–7   | Plot of CFA RF, G, and BW<br>.                                             | 8-10     |
| 8–8   | Effects of Stray Capacitance on CFAs<br>.                                  | 8-12     |
| 8–9   | Bode Plot with CF<br>.                                                     | 8-13     |
| 9–1   | Long-Tailed Pair<br>. 9-2                                                  |          |
| 9–2   | Ideal CFA<br>. 9-3                                                         |          |
| 9–3   | VFA Gain versus Frequency<br>.                                             | 9-4      |
| 9–4   | CFA Gain vs Frequency<br>.                                                 | 9-5      |
|       |                                                                            |          |
| 10–1  | Gaussian Distribution of Noise Energy<br>.                                 | 10-2     |
| 10–2  | Shot Noise Generation<br>.                                                 | 10-5     |
| 10–3  | Thermal Noise<br>. 10-7                                                    |          |
| 10–4  | Avalanche Noise<br>.                                                       | 10-10    |
| 10–5  | Noise Colors<br>. 10-11                                                    |          |
| 10–6  | TLV2772 Op Amp Noise Characteristics<br>.                                  | 10-13    |
| 10–7  | Op Amp Circuit Noise Model<br>.                                            | 10-15    |
| 10–8  | Equivalent Op Amp Circuit Noise Model<br>.                                 | 10-15    |
| 10–9  | Inverting Op Amp Circuit Noise Model<br>.                                  | 10-16    |
| 10–10 | Inverting Equivalent Op Amp Circuit Noise Model<br>.                       | 10-16    |
| 10–11 | Noninverting Equivalent Op Amp Circuit Noise Model<br>.                    | 10-17    |

Contents xiii

| 10–12<br>10–13<br>10–14<br>10–15<br>10–16                                                                         | Differential Equivalent Op Amp Circuit Noise Model<br>.<br>Split Supply Op Amp Circuit<br>.<br>TLC2201 Op Amp Noise Performance<br>.<br>TLC2201 Op Amp Circuit<br>.<br>Improved TLC2201 Op Amp Circuit<br>.                                                                                                                                                                                                                                                                                                                                                                                                   | 10-18<br>10-19<br>10-20<br>10-21<br>10-23                                                               |
|-------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------|
| 11–1<br>11–2<br>11–3<br>11–4<br>11–5<br>11–6<br>11–7<br>11–8<br>11–9<br>11–10                                     | Test Circuits for Input Offset Voltage<br>.<br>Offset Voltage Adjust<br>.<br>Test Circuit – IIB<br>.<br>VOM±<br>. 11-12<br>Input Parasitic Elements<br>.<br>Effect of Output Impedance<br>.<br>Figure 6. Slew Rate<br>.<br>Figure 7. Simplified Op Amp Schematic<br>.<br>Typical Op amp Input Noise Spectrum<br>.<br>Output Spectrum with THD + N = 1%<br>.                                                                                                                                                                                                                                                   | 11-9<br>11-9<br>11-10<br>11-13<br>11-14<br>11-16<br>11-17<br>11-18<br>11-19                             |
| 11–11<br>11–12                                                                                                    | Voltage Amplification and Phase Shift vs. Frequency<br>.<br>Settling Time<br>. 11-22                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | 11-21                                                                                                   |
| 12–1<br>12–2<br>12–3<br>12–4<br>12–5<br>12–6<br>12–7<br>12–8<br>12–9<br>12–10<br>12–11<br>12–12<br>12–13<br>12–14 | Block Diagram of a Transducer Measurement System<br>.<br>Significant Bits versus Binary Bits<br>.<br>Example of Spans That Require Correction<br>.<br>Voltage Divider Circuit for a Resistive Transducer<br>.<br>Current Source Excitation for a Resistive Transducer<br>.<br>Precision Current Source<br>.<br>Wheatstone Bridge Circuit<br>.<br>Photodiode Amplifier<br>.<br>Phototransistor Amplifier<br>.<br>Photovoltaic Cell Amplifier<br>.<br>Active Full-Wave Rectifier and Filter<br>.<br>Reference and Transducer Bias Circuit<br>.<br>AIA Circuit<br>. 12-17<br>Final Analog Interface Circuit<br>. | 12-1<br>12-2<br>12-4<br>12-6<br>12-7<br>12-7<br>12-8<br>12-8<br>12-9<br>12-9<br>12-10<br>12-13<br>12-21 |
| 13–1<br>13–2<br>13–3<br>13–4<br>13–5<br>13–6<br>13–7<br>13–8                                                      | A Typical GSM Cellular Base Station Receiver Block Diagram<br>.<br>An Implementation of a Software-Configurable Dual-IF Receiver<br>.<br>Basic W-CDMA Cellular Base Station Transmitter Block<br>.<br>Communication DAC with Interpolation and Reconstruction Filters<br>.<br>QPSK Power Spectral Density Without Raised Cosine Filter — W-CDMA<br>.<br>Reconstruction Filter Characteristics<br>.<br>A Single-Pole Reconstruction Filter<br>.<br>Voltage Reference Filter Circuit<br>.                                                                                                                       | 13-2<br>13-4<br>13-5<br>13-5<br>13-14<br>13-14<br>13-15<br>13-16                                        |
| 13–9<br>13–10<br>13–11                                                                                            | Voltage Follower Frequency Response Plot<br>.<br>External Voltage Reference Circuit for ADC/DAC.<br>.<br>Single-Ended to Differential Output Drive Circuit<br>.                                                                                                                                                                                                                                                                                                                                                                                                                                               | 13-17<br>13-17<br>13-18                                                                                 |

| 13–12 | Differential Amplifier Closed-Loop Response<br>.                            | 13-19 |
|-------|-----------------------------------------------------------------------------|-------|
| 13–13 | ADC Single-Ended Input Drive Circuit<br>.                                   | 13-20 |
| 13–14 | Gain vs Frequency Plot for THS3201<br>.                                     | 13-21 |
| 13–15 | Phase vs Frequency for THS3201<br>.                                         | 13-21 |
|       |                                                                             |       |
| 14–1  | Resistor Ladder D/A Converter<br>.                                          | 14-2  |
| 14–2  | Binary Weighted D/A Converter<br>.                                          | 14-3  |
| 14–3  | R/2R Resistor Array<br>.                                                    | 14-4  |
| 14–4  | R/2R D/A Converter<br>.                                                     | 14-5  |
| 14–5  | Sigma Delta D/A Converter<br>.                                              | 14-6  |
| 14–6  | Total Harmonic Distortion<br>.                                              | 14-9  |
| 14–7  | D/A Offset Error<br>.                                                       | 14-11 |
| 14–8  | D/A Gain Error<br>.                                                         | 14-12 |
| 14–9  | Differential Nonlinearity Error<br>.                                        | 14-13 |
| 14–10 | Integral Nonlinearity Error<br>.                                            | 14-13 |
| 14–11 | Spurious Free Dynamic Range<br>.                                            | 14-15 |
| 14–12 | Intermodulation Distortion<br>.                                             | 14-16 |
| 14–13 | D/A Settling Time<br>.                                                      | 14-17 |
| 14–14 | D/A Deglitch Circuit<br>.                                                   | 14-17 |
| 14–15 | Compensating for CMOS DAC Output Capacitance<br>.                           | 14-18 |
| 14–16 | D/A Output Current Booster<br>.                                             | 14-20 |
| 14–17 | Incorrect Method of Increasing Voltage Swing of D/A Converters<br>.         | 14-21 |
| 14–18 | Correct Method of Increasing Voltage Range<br>.                             | 14-22 |
| 14–19 | Single-Supply DAC Operation<br>.                                            | 14-23 |
|       |                                                                             |       |
| 15–1  | Canonical Form of a Feedback System with Positive or Negative Feedback<br>. | 15-2  |
| 15–2  | Phase Plot of RC Sections<br>.                                              | 15-3  |
| 15–3  | Op Amp Frequency Response<br>.                                              | 15-6  |
| 15–4  | Op Amp Bandwidth and Oscillator Output<br>.                                 | 15-7  |
| 15–5  | Block Diagram of an Oscillator with Positive Feedback<br>.                  | 15-8  |
| 15–6  | Amplifier with Positive and Negative Feedback<br>.                          | 15-8  |
| 15–7  | Wien Bridge Circuit Schematic<br>.                                          | 15-9  |
| 15–8  | Final Wien Bridge Oscillator Circuit<br>.                                   | 15-11 |
| 15–9  | Wien Bridge Output Waveforms<br>.                                           | 15-11 |
| 15–10 | Wien Bridge Oscillator with Nonlinear Feedback<br>.                         | 15-12 |
| 15–11 | Output of the Circuit in Figure 15–10<br>.                                  | 15-12 |
| 15–12 | Wien Bridge Oscillator with AGC<br>.                                        | 15-13 |
| 15–13 | Output of the Circuit in Figure 15–12<br>.                                  | 15-14 |
| 15–14 | Phase Shift Oscillator (Single Op Amp)<br>.                                 | 15-14 |
| 15–15 | Output of the Circuit in Figure 15–14<br>.                                  | 15-15 |
| 15–16 | Phase Shift Oscillator, Buffered<br>.                                       | 15-16 |
| 15–17 | Output of the Circuit Figure 15–16<br>.                                     | 15-16 |
| 15–18 | Bubba Oscillator<br>.                                                       | 15-17 |
| 15–19 | Output of the Circuit in Figure 15–18.<br>.                                 | 15-18 |

Contents xv

| 15–20<br>15–21 | Quadrature Oscillator<br>.<br>Output of the Circuit in Figure 15–20<br>.            | 15-19<br>15-20 |
|----------------|-------------------------------------------------------------------------------------|----------------|
| 16–1           | Second-Order Passive Low-Pass and Second-Order Active Low-Pass<br>.                 | 16-1           |
| 16–2           | First-Order Passive RC Low-Pass<br>.                                                | 16-2           |
| 16–3           | Fourth-Order Passive RC Low-Pass with Decoupling Amplifiers<br>.                    | 16-3           |
| 16–4           | Frequency and Phase Responses of a Fourth-Order Passive RC Low-Pass Filter<br>.     | 16-4           |
| 16–5           | Amplitude Responses of Butterworth Low-Pass Filters<br>.                            | 16-6           |
| 16–6           | Gain Responses of Tschebyscheff Low-Pass Filters<br>.                               | 16-7           |
| 16–7           | Comparison of Phase Responses of Fourth-Order Low-Pass Filters<br>.                 | 16-8           |
| 16–8           | Comparison of Normalized Group Delay (Tgr) of Fourth-Order Low-Pass Filters<br>.    | 16-8           |
| 16–9           | Comparison of Gain Responses of Fourth-Order Low-Pass Filters<br>.                  | 16-9           |
| 16–10          | Graphical Presentation of Quality Factor Q on a Tenth-Order                         |                |
|                | Tschebyscheff Low-Pass Filter with 3-dB Passband Ripple<br>.                        | 16-10          |
| 16–11          | Cascading Filter Stages for Higher-Order Filters<br>.                               | 16-12          |
| 16–12          | First-Order Noninverting Low-Pass Filter<br>.                                       | 16-12          |
| 16–13          | First-Order Inverting Low-Pass Filter<br>.                                          | 16-13          |
| 16–14          | First-Order Noninverting Low-Pass Filter with Unity Gain<br>.                       | 16-14          |
| 16–15          | General Sallen-Key Low-Pass Filter<br>.                                             | 16-15          |
| 16–16          | Unity-Gain Sallen-Key Low-Pass Filter<br>.                                          | 16-15          |
| 16–17          | Second-Order Unity-Gain Tschebyscheff Low-Pass with 3-dB Ripple<br>.                | 16-16          |
| 16–18          | Adjustable Second-Order Low-Pass Filter<br>.                                        | 16-17          |
| 16–19          | Second-Order MFB Low-Pass Filter<br>.                                               | 16-18          |
| 16–20          | First-Order Unity-Gain Low-Pass<br>.                                                | 16-19          |
| 16–21          | Second-Order Unity-Gain Sallen-Key Low-Pass Filter<br>.                             | 16-20          |
| 16–22          | Fifth-Order Unity-Gain Butterworth Low-Pass Filter<br>.                             | 16-21          |
| 16–23          | Low-Pass to High-Pass Transition Through Components Exchange<br>.                   | 16-21          |
| 16–24          | Developing The Gain Response of a High-Pass Filter<br>.                             | 16-22          |
| 16–25          | First-Order Noninverting High-Pass Filter<br>.                                      | 16-23          |
| 16–26          | First-Order Inverting High-Pass Filter<br>.                                         | 16-23          |
| 16–27          | General Sallen-Key High-Pass Filter<br>.                                            | 16-24          |
| 16–28          | Unity-Gain Sallen-Key High-Pass Filter<br>.                                         | 16-24          |
| 16–29          | Second-Order MFB High-Pass Filter<br>.                                              | 16-25          |
| 16–30          | Third-Order Unity-Gain Bessel High-Pass<br>.                                        | 16-27          |
| 16–31          | Low-Pass to Band-Pass Transition<br>.                                               | 16-28          |
| 16–32          | Gain Response of a Second-Order Band-Pass Filter<br>.                               | 16-29          |
| 16–33          | Sallen-Key Band-Pass<br>.                                                           | 16-30          |
| 16–34          | MFB Band-Pass<br>.                                                                  | 16-31          |
| 16–35          | Gain Responses of a Fourth-Order Butterworth Band-Pass and its Partial Filters<br>. | 16-36          |
| 16–36          | Low-Pass to Band-Rejection Transition<br>.                                          | 16-37          |
| 16–37          | Passive Twin-T Filter<br>.                                                          | 16-37          |
| 16–38          | Active Twin-T Filter<br>.                                                           | 16-38          |
| 16–39          | Passive Wien-Robinson Bridge<br>.                                                   | 16-39          |
| 16–40          | Active Wien-Robinson Filter<br>.                                                    | 16-39          |

| 16–41 | Comparison of Q Between Passive and Active Band-Rejection Filters<br>.                                | 16-41 |
|-------|-------------------------------------------------------------------------------------------------------|-------|
| 16–42 | Frequency Response of the Group Delay for the First 10 Filter Orders<br>.                             | 16-43 |
| 16–43 | First-Order All-Pass<br>.                                                                             | 16-44 |
| 16–44 | Second-Order All-Pass Filter<br>.                                                                     | 16-44 |
| 16–45 | Seventh-Order All-Pass Filter<br>.                                                                    | 16-46 |
| 16–46 | Dual-Supply Filter Circuit<br>.                                                                       | 16-47 |
| 16–47 | Single-Supply Filter Circuit<br>.                                                                     | 16-47 |
| 16–48 | Biasing a Sallen-Key Low-Pass<br>.                                                                    | 16-48 |
| 16–49 | Biasing a Second-Order MFB Low-Pass Filter<br>.                                                       | 16-49 |
| 16–50 | Biasing a Sallen-Key and an MFB High-Pass Filter<br>.                                                 | 16-50 |
| 16–51 | Differences in Q and fC in the Partial Filters of an Eighth-Order Butterworth<br>Low-Pass Filter<br>. | 16-51 |
| 16–52 | Modification of the Intended Butterworth Response to aTschebyscheff-Type                              |       |
|       | Characteristic<br>.                                                                                   | 16-51 |
| 16–53 | Open-Loop Gain (AOL) and Filter Response (A)<br>.                                                     | 16-53 |
| 17–1  | Op Amp Terminal Model<br>.                                                                            | 17-5  |
| 17–2  | Digital and Analog Plane Placement<br>.                                                               | 17-8  |
| 17–3  | Separate Grounds<br>.                                                                                 | 17-8  |
| 17–4  | Broadcasting From PCB Traces<br>.                                                                     | 17-9  |
| 17–5  | A Careful Board Layout<br>.                                                                           | 17-10 |
| 17–6  | Resistor High-Frequency Performance<br>.                                                              | 17-11 |
| 17–7  | Capacitor High-Frequency Performance<br>.                                                             | 17-12 |
| 17–8  | Inductor High-Frequency Performance<br>.                                                              | 17-13 |
| 17–9  | Loop and Slot Antenna Board Trace Layouts<br>.                                                        | 17-15 |
| 17–10 | PCB Trace Corners<br>.                                                                                | 17-16 |
| 17–11 | PCB Trace-to-Plane Capacitance Formula<br>.                                                           | 17-17 |
| 17–12 | Effect of 1-pF Capacitance on Op Amp Inverting Input<br>.                                             | 17-18 |
| 17–13 | Coupling Between Parallel Signal Traces<br>.                                                          | 17-19 |
| 17–14 | Via Inductance Measurements<br>.                                                                      | 17-19 |
| 17–15 | Logic Gate Output Structure<br>.                                                                      | 17-21 |
| 17–16 | Capacitor Self Resonance<br>.                                                                         | 17-22 |
| 17–17 | Common Op Amp Pinouts<br>.                                                                            | 17-24 |
| 17–18 | Trace Length for an Inverting Op Amp Stage<br>.                                                       | 17-25 |
| 17–19 | Mirror-Image Layout for Quad Op Amp Package<br>.                                                      | 17-25 |
| 17–20 | Quad Op Amp Package Layout with Half-Supply Generator<br>.                                            | 17-26 |
| 17–21 | Proper Termination of Unused Op Amp Sections<br>.                                                     | 17-28 |
| 18–1  | Op Amp Error Sources<br>.                                                                             | 18-4  |
| 18–2  | Noninverting Op Amp<br>.                                                                              | 18-7  |
| 18–3  | Input Circuit of a NonRRI Op Amp<br>.                                                                 | 18-8  |
| 18–4  | Input Circuit of an RRI Op Amp<br>.                                                                   | 18-8  |
| 18–5  | Input Bias Current Changes with Input Common-Mode Voltage<br>.                                        | 18-9  |
| 18–6  | Input Offset Voltage Changes with Input Common-Mode Voltage<br>.                                      | 18-10 |

Contents xvii

| 18–7  | RRO Output Stage<br>.                                            | 18-11 |
|-------|------------------------------------------------------------------|-------|
| 18–8  | Data Acquisition System<br>.                                     | 18-14 |
| 18–9  | Schematic for the Transducer to ADC Interface Circuit<br>.       | 18-15 |
| 18–10 | Final Schematic for the Transducer to ADC Interface Circuit<br>. | 18-16 |
| 18–11 | Digital Control System<br>.                                      | 18-16 |
| 18–12 | DAC Current Source to Actuator Interface Circuit<br>.            | 18-17 |
| 18–13 | DAC Current Sink to Actuator Interface Circuit<br>.              | 18-19 |
| A–1   | Split-Supply Op Amp Circuit<br>.                                 | A-1   |
| A–2   | Split-Supply Op Amp Circuit With Reference Voltage Input<br>.    | A-2   |
| A–3   | Split-Supply Op Amp Circuit With Common-Mode Voltage<br>.        | A-3   |
| A–4   | Single-Supply Op Amp Circuit<br>.                                | A-3   |
| A–5   | Inverting Op Amp with Noninverting Positive Reference<br>.       | A-5   |
| A–6   | Inverting Op Amp with Inverting Negative Reference<br>.          | A-6   |
| A–7   | Inverting Op Amp with Noninverting Negative Reference<br>.       | A-7   |
| A–8   | Inverting Op Amp with Inverting Positive Reference<br>.          | A-8   |
| A–9   | Noninverting Op Amp with Inverting Positive Reference<br>.       | A-9   |
| A–10  | Noninverting Op Amp with Noninverting Negative Reference<br>.    | A-10  |
| A–11  | Noninverting Op Amp with Inverting Positive Reference<br>.       | A-11  |
| A–12  | Noninverting Op Amp with Noninverting Positive Reference<br>.    | A-12  |
| A–13  | Differential Amplifier<br>.                                      | A-13  |
| A–14  | Differential Amplifier with Bias Correction<br>.                 | A-14  |
| A–15  | High Input Impedance Differential Amplifier<br>.                 | A-15  |
| A–16  | High Common-Mode Range Differential Amplifier<br>.               | A-16  |
| A–17  | High-Precision Differential Amplifier<br>.                       | A-17  |
| A–18  | Simplified High-Precision Differential Amplifier<br>.            | A-18  |
| A–19  | Variable Gain Differential Amplifier<br>.                        | A-19  |
| A–20  | T Network in the Feedback Loop<br>.                              | A-20  |
| A–21  | Buffer<br>. A-21                                                 |       |
| A–22  | Inverting AC Amplifier<br>.                                      | A-22  |
| A–23  | Noninverting AC Amplifier<br>.                                   | A-23  |
| A–24  | Inverting Summer<br>.                                            | A-24  |
| A–25  | Noninverting Summer<br>.                                         | A-25  |
| A–26  | Noninverting Summer with Buffers<br>.                            | A-26  |
| A–27  | Inverting Integrator<br>.                                        | A-27  |
| A–28  | Inverting Integrator with Input Current Compensation<br>.        | A-28  |
| A–29  | Inverting Integrator with Drift Compensation<br>.                | A-29  |
| A–30  | Inverting Integrator with Mechanical Reset<br>.                  | A-30  |
| A–31  | Inverting Integrator with Electronic Reset<br>.                  | A-31  |
| A–32  | Inverting Integrator with Resistive Reset<br>.                   | A-32  |
| A–33  | Noninverting Integrator with Inverting Buffer<br>.               | A-33  |
| A–34  | Noninverting Integrator Approximation<br>.                       | A-34  |
| A–35  | Inverting Differentiator<br>.                                    | A-35  |
| A–36  | Inverting Differentiator with Noise Filter<br>.                  | A-36  |

| Figures |  |
|---------|--|
|---------|--|

| A–37 | Basic Wien Bridge Oscillator<br>.                   | A-37 |
|------|-----------------------------------------------------|------|
| A–38 | Wien Bridge Oscillator with Nonlinear Feedback<br>. | A-38 |
| A–39 | Wien Bridge Oscillator with AGC<br>.                | A-39 |
| A–40 | Quadrature Oscillator<br>.                          | A-40 |
| A–41 | Classical Phase Shift Oscillator<br>.               | A-41 |
| A–42 | Buffered Phase Shift Oscillator<br>.                | A-42 |
| A–43 | Bubba Oscillator<br>.                               | A-43 |
| A–44 | Triangle Oscillator<br>.                            | A-44 |
|      |                                                     |      |

# **Tables**

Tables

| 3–1                                                                           | Basic Ideal Op Amp Assumptions<br>.<br>3-2                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
|-------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 8–1                                                                           | Data Set for Curves in Figure 8–7<br>.<br>8-11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 9–1                                                                           | Tabulation of Pertinent VFA and CFA Equations<br>.<br>9-9                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 10–1                                                                          | Noise Colors<br>. 10-10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 11–1<br>11–2                                                                  | Op Amp Parameter GLossary<br>.<br>11-2<br>Cross-Reference of Op Amp Parameters<br>.<br>11-6                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 12–1<br>12–2<br>12–3<br>12–4<br>12–5                                          | Transducer Output Voltage<br>.<br>12-14<br>ADC Input Voltage<br>.<br>12-15<br>Op Amp Selection<br>.<br>12-16<br>AIA Input and Output Voltages<br>.<br>12-16<br>Offset and Gain Error Budget<br>.<br>12-19                                                                                                                                                                                                                                                                                                                                                                                                        |
| 13–1<br>13–2                                                                  | GSM Receiver Block System Budget<br>.<br>13-3<br>High-Speed Op Amp Requirements<br>.<br>13-11                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 14–1<br>14–2                                                                  | DC Step Size for D/A converters<br>.<br>14-7<br>Converter Bits, THD, and Dynamic Range<br>.<br>14-10                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 16–1<br>16–2<br>16–3<br>16–4<br>16–5<br>16–6<br>16–7<br>16–8<br>16–9<br>16–10 | Second-Order FIlter Coefficients<br>.<br>16-17<br>Values of α For Different Filter Types and Different Qs<br>.<br>16-33<br>Single-Supply Op Amp Selection Guide (TA = 25°C, VCC = 5 V)<br>.<br>16-54<br>Bessel Coefficients<br>.<br>16-56<br>Butterworth Coefficients<br>.<br>16-57<br>Tschebyscheff Coefficients for 0.5-dB Passband Ripple<br>.<br>16-58<br>Tschebyscheff Coefficients for 1-dB Passband Ripple<br>.<br>16-59<br>Tschebyscheff Coefficients for 2-dB Passband Ripple<br>.<br>16-60<br>Tschebyscheff Coefficients for 3-dB Passband Ripple<br>.<br>16-61<br>All-Pass Coefficients<br>.<br>16-62 |
| 17–1<br>17–2                                                                  | PCB Materials<br>. 17-3<br>Recommended Maximum Frequencies for Capacitors<br>.<br>17-21                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| 18–1<br>18–2                                                                  | Comparison of Op Amp Error Terms<br>.<br>18-5<br>Op Amp Parameters<br>.<br>18-21                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| A–1                                                                           | Ideal Op Amp Assumptions<br>.<br>A-4                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

# **Examples**

Examples

| 16–1 | First-Order Unity-Gain Low-Pass Filter<br>.                | 16-14 |
|------|------------------------------------------------------------|-------|
| 16–2 | Second-Order Unity-Gain Tschebyscheff Low-Pass Filter<br>. | 16-16 |
| 16–3 | Fifth-Order Filter<br>.                                    | 16-19 |
| 16–4 | Third-Order High-Pass Filter with fC = 1 kHz<br>.          | 16-26 |
| 16–5 | Second-Order MFB Band-Pass Filter with fm = 1 kHz<br>.     | 16-32 |
| 16–6 | Fourth-Order Butterworth Band-Pass Filter<br>.             | 16-34 |
| 16–7 | 2-ms Delay All-Pass Filter<br>.                            | 16-45 |

# **Chapter 1**

# **The Op Amp's Place In The World**

#### Ron Mancini

In 1934 Harry Black[1] commuted from his home in New York City to work at Bell Labs in New Jersey by way of a railroad/ferry. The ferry ride relaxed Harry enabling him to do some conceptual thinking. Harry had a tough problem to solve; when phone lines were extended long distances, they needed amplifiers, and undependable amplifiers limited phone service. First, initial tolerances on the gain were poor, but that problem was quickly solved with an adjustment. Second, even when an amplifier was adjusted correctly at the factory, the gain drifted so much during field operation that the volume was too low or the incoming speech was distorted.

Many attempts had been made to make a stable amplifier, but temperature changes and power supply voltage extremes experienced on phone lines caused uncontrollable gain drift. Passive components had much better drift characteristics than active components had, thus if an amplifier's gain could be made dependent on passive components, the problem would be solved. During one of his ferry trips, Harry's fertile brain conceived a novel solution for the amplifier problem, and he documented the solution while riding on the ferry.

The solution was to first build an amplifier that had more gain than the application required. Then some of the amplifier output signal was fed back to the input in a manner that makes the circuit gain (circuit is the amplifier and feedback components) dependent on the feedback circuit rather than the amplifier gain. Now the circuit gain is dependent on the passive feedback components rather than the active amplifier. This is called negative feedback, and it is the underlying operating principle for all modern day op amps. Harry had documented the first intentional feedback circuit during a ferry ride. I am sure unintentional feedback circuits had been built prior to that time, but the designers ignored the effect!

I can hear the squeals of anguish coming from the managers and amplifier designers. I imagine that they said something like this, "it is hard enough to achieve 30-kHz gain– bandwidth (GBW), and now this fool wants me to design an amplifier with 3-MHz GBW. But, he is still going to get a circuit gain GBW of 30 kHz". Well, time has proven Harry right, but there is a minor problem that Harry didn't discuss in detail, and that is the oscillation problem. It seems that circuits designed with large open loop gains sometimes oscillate when the loop is closed. A lot of people investigated the instability effect, and it was pretty well understood in the 1940s, but solving stability problems involved long, tedious, and intricate calculations. Years passed without anybody making the problem solution simpler or more understandable.

In 1945 H. W. Bode presented a system for analyzing the stability of feedback systems by using graphical methods. Until this time, feedback analysis was done by multiplication and division, so calculation of transfer functions was a time consuming and laborious task. Remember, engineers did not have calculators or computers until the '70s. Bode presented a log technique that transformed the intensely mathematical process of calculating a feedback system's stability into graphical analysis that was simple and perceptive. Feedback system design was still complicated, but it no longer was an art dominated by a few electrical engineers kept in a small dark room. Any electrical engineer could use Bode's methods to find the stability of a feedback circuit, so the application of feedback to machines began to grow. There really wasn't much call for electronic feedback design until computers and transducers become of age.

The first real-time computer was the analog computer! This computer used preprogrammed equations and input data to calculate control actions. The programming was hard wired with a series of circuits that performed math operations on the data, and the hard wiring limitation eventually caused the declining popularity of the analog computer. The heart of the analog computer was a device called an operational amplifier because it could be configured to perform many mathematical operations such as multiplication, addition, subtraction, division, integration, and differentiation on the input signals. The name was shortened to the familiar op amp, as we have come to know and love them. The op amp used an amplifier with a large open loop gain, and when the loop was closed, the amplifier performed the mathematical operations dictated by the external passive components. This amplifier was very large because it was built with vacuum tubes and it required a high-voltage power supply, but it was the heart of the analog computer, thus its large size and huge power requirements were accepted as the price of doing business. Many early op amps were designed for analog computers, and it was soon found out that op amps had other uses and were very handy to have around the physics lab.

At this time general-purpose analog computers were found in universities and large company laboratories because they were critical to the research work done there. There was a parallel requirement for transducer signal conditioning in lab experiments, and op amps found their way into signal conditioning applications. As the signal conditioning applications expanded, the demand for op amps grew beyond the analog computer requirements, and even when the analog computers lost favor to digital computers, the op amp survived because of its importance in universal analog applications. Eventually digital computers replaced the analog computers (a sad day for real-time measurements), but the demand for op amps increased as measurement applications increased.

The first signal conditioning op amps were constructed with vacuum tubes prior to the introduction of transistors, so they were large and bulky. During the '50s, miniature vacuum tubes that worked from lower voltage power supplies enabled the manufacture of op amps that shrunk to the size of a brick used in house construction, so the op amp modules were nicknamed bricks. Vacuum tube size and component size decreased until an op amp was shrunk to the size of a single octal vacuum tube. Transistors were commercially developed in the '60s, and they further reduced op amp size to several cubic inches, but the nickname brick still held on. Now the nickname brick is attached to any electronic module that uses potting compound or non-integrated circuit (IC) packaging methods. Most of these early op amps were made for specific applications, so they were not necessarily general purpose. The early op amps served a specific purpose, but each manufacturer had different specifications and packages; hence, there was little second sourcing among the early op amps.

ICs were developed during the late 1950s and early 1960s, but it wasn't till the middle 1960s that Fairchild released the µA709. This was the first commercially successful IC op amp, and Robert J. Widler designed it. The µA709 had its share of problems, but any competent analog engineer could use it, and it served in many different analog applications. The major drawback of the µA709 was stability; it required external compensation and a competent analog engineer to apply it. Also, the µA709 was quite sensitive because it had a habit of self destructing under any adverse condition. The self-destruction habit was so prevalent that one major military equipment manufacturer published a paper titled something like, The 12 Pearl Harbor Conditions of the µA709. The µA741 followed the µA709, and it is an internally compensated op amp that does not require external compensation if operated under data sheet conditions. Also, it is much more forgiving than the µA709. There has been a never-ending series of new op amps released each year since then, and their performance and reliability has improved to the point where present day op amps can be used for analog applications by anybody.

The IC op amp is here to stay; the latest generation op amps cover the frequency spectrum from 5-kHz GBW to beyond 1-GHz GBW. The supply voltage ranges from guaranteed operation at 0.9 V to absolute maximum voltage ratings of 1000 V. The input current and input offset voltage has fallen so low that customers have problems verifying the specifications during incoming inspection. The op amp has truly become the universal analog IC because it performs all analog tasks. It can function as a line driver, comparator (one bit A/D), amplifier, level shifter, oscillator, filter, signal conditioner, actuator driver, current source, voltage source, and many other applications. The designer's problem is how to rapidly select the correct circuit/op amp combination and then, how to calculate the passive component values that yield the desired transfer function in the circuit.

This book deals with op amp circuits — not with the innards of op amps. It treats the calculations from the circuit level, and it doesn't get bogged down in a myriad of detailed calculations. Rather, the reader can start at the level appropriate for them, and quickly move on to the advanced topics. If you are looking for material about the innards of op amps you are looking in the wrong place. The op amp is treated as a completed component in this book.

The op amp will continue to be a vital component of analog design because it is such a fundamental component. Each generation of electronics equipment integrates more functions on silicon and takes more of the analog circuitry inside the IC. Don't fear, as digital applications increase, analog applications also increase because the predominant supply of data and interface applications are in the real world, and the real world is an analog world. Thus, each new generation of electronics equipment creates requirements for new analog circuits; hence, new generations of op amps are required to fulfill these requirements. Analog design, and op amp design, is a fundamental skill that will be required far into the future.

# **References**

1 Black, H. S., Stabilized Feedback Amplifiers, BSTJ, Vol. 13, January 1934

# **Chapter 2**

# **Review of Circuit Theory**

#### Ron Mancini

# **2.1 Introduction**

Although this book minimizes math, some algebra is germane to the understanding of analog electronics. Math and physics are presented here in the manner in which they are used later, so no practice exercises are given. For example, after the voltage divider rule is explained, it is used several times in the development of other concepts, and this usage constitutes practice.

Circuits are a mix of passive and active components. The components are arranged in a manner that enables them to perform some desired function. The resulting arrangement of components is called a circuit or sometimes a circuit configuration. The art portion of analog design is developing the circuit configuration. There are many published circuit configurations for almost any circuit task, thus all circuit designers need not be artists.

When the design has progressed to the point that a circuit exists, equations must be written to predict and analyze circuit performance. Textbooks are filled with rigorous methods for equation writing, and this review of circuit theory does not supplant those textbooks. But, a few equations are used so often that they should be memorized, and these equations are considered here.

There are almost as many ways to analyze a circuit as there are electronic engineers, and if the equations are written correctly, all methods yield the same answer. There are some simple ways to analyze the circuit without completing unnecessary calculations, and these methods are illustrated here.

# **2.2 Laws of Physics**

Ohm's law is stated as V=IR, and it is fundamental to all electronics. Ohm's law can be applied to a single component, to any group of components, or to a complete circuit. When the current flowing through any portion of a circuit is known, the voltage dropped across that portion of the circuit is obtained by multiplying the current times the resistance (Equation 2–1).

$$\mathsf{V} = \mathsf{I}\mathsf{R} \tag{2-\mathsf{I}}$$

In Figure 2–1, Ohm's law is applied to the total circuit. The current, (I) flows through the total resistance (R), and the voltage (V) is dropped across R.

Here is the image describtion:
```
The image depicts a simple electrical circuit consisting of three main components: a voltage source, a resistor, and a connecting wire forming a closed loop.

1. **Voltage Source (V)**: On the left side of the circuit, there is a symbol representing a voltage source, which is typically depicted as a circle with a plus and minus sign or just a circle. This voltage source provides the electrical potential difference (voltage) that drives the current through the circuit.

2. **Resistor (R)**: On the right side of the circuit, there is a symbol representing a resistor. The resistor is depicted as a zigzag or jagged line. The resistor opposes the flow of electric current, and its resistance is denoted by the letter "R".

3. **Current (I)**: There is an arrow labeled "I" pointing to the right, indicating the direction of the conventional current flow through the circuit. The current flows from the positive terminal of the voltage source, through the resistor, and back to the negative terminal of the voltage source, completing the circuit.

4. **Connecting Wires**: The components are connected by straight lines representing the conducting wires. These wires form a closed loop, allowing the current to flow continuously through the circuit.

In summary, the image shows a basic series circuit with a voltage source driving a current through a resistor, with the direction of the current indicated by an arrow.
```

### Figure 2–1. Ohm's Law Applied to the Total Circuit

In Figure 2–2, Ohm's law is applied to a single component. The current (IR) flows through the resistor (R) and the voltage (VR) is dropped across R. Notice, the same formula is used to calculate the voltage drop across R even though it is only a part of the circuit.

Here is the image describtion:
```
The image depicts an electrical circuit diagram. Here is a detailed description:

1. **Voltage Source (V)**: On the left side of the diagram, there is a symbol representing a voltage source, denoted by the letter "V". This symbol typically consists of a circle with a plus and minus sign indicating the positive and negative terminals, respectively.

2. **Resistors**: The circuit contains three resistors. The resistors are represented by a zigzag line. Two resistors are connected in series with the voltage source, and one resistor is connected in parallel with the series combination of the voltage source and the two resistors.

3. **Current (IR)**: There is an arrow labeled "IR" pointing to the right, indicating the direction of the current flowing through the parallel resistor.

4. **Parallel Resistor (R)**: The resistor in parallel is labeled with the letter "R". This resistor is shown separately on the right side of the diagram with a dashed line indicating that it is part of the circuit.

5. **Voltage across Resistor (VR)**: The voltage across the parallel resistor "R" is denoted by "VR". This is indicated by an arrow pointing upwards next to the resistor "R".

In summary, the diagram shows a voltage source connected to a series combination of two resistors, with a third resistor connected in parallel to this series combination. The current through the parallel resistor is labeled "IR", and the voltage across it is labeled "VR".
```

#### Figure 2–2. Ohm's Law Applied to a Component

Kirchoff's voltage law states that the sum of the voltage drops in a series circuit equals the sum of the voltage sources. Otherwise, the source (or sources) voltage must be dropped across the passive components. When taking sums keep in mind that the sum is an algebraic quantity. Kirchoff's voltage law is illustrated in Figure 2–3 and Equations 2–2 and 2–3.

Here is the image describtion:
```
The image depicts a simple electrical circuit consisting of a voltage source, two resistors, and the corresponding voltage drops across each resistor. Here is a detailed description:

1. **Voltage Source (V)**: On the left side of the circuit, there is a voltage source labeled "V". This is the power supply for the circuit.

2. **Resistor R1**: Connected in series with the voltage source is a resistor labeled "R1". This resistor is positioned horizontally in the circuit.

3. **Voltage Drop Across R1 (V_R1)**: There is a voltage drop across resistor R1, indicated by "V_R1". The polarity of this voltage drop is shown with a positive sign on the left side and a negative sign on the right side of the resistor.

4. **Resistor R2**: Following R1, there is another resistor labeled "R2". This resistor is also connected in series and is positioned vertically in the circuit.

5. **Voltage Drop Across R2 (V_R2)**: There is a voltage drop across resistor R2, indicated by "V_R2". The polarity of this voltage drop is shown with a positive sign on the top and a negative sign on the bottom of the resistor.

6. **Circuit Configuration**: The circuit is a simple series circuit where the voltage source V provides the total voltage, which is divided between the two resistors R1 and R2. The current flows from the voltage source through R1, then through R2, and back to the voltage source.

The diagram effectively illustrates the basic components and voltage drops in a series resistor circuit.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 2-3. Kirchoff's Voltage Law." The text appears to be a caption or title for a figure in a document, likely related to electrical engineering or physics. The font is standard and the text is black on a white background. The label indicates that the figure is the third one in the second section or chapter of the document, and it pertains to Kirchhoff's Voltage Law, which is a fundamental principle in circuit theory.
```

$$
\sum \mathbb{V}\_{\mathsf{SOU} \mathsf{RCE} \mathsf{S}} = \sum \mathbb{V}\_{\mathsf{DROPS}} \tag{2-2}
$$

$$\mathbb{V} = \mathbb{V}\_{\mathbb{R}1} + \mathbb{V}\_{\mathbb{R}2} \tag{2-3}$$

Kirchoff's current law states: the sum of the currents entering a junction equals the sum of the currents leaving a junction. It makes no difference if a current flows from a current

Here is the image describtion:
```
The image depicts a junction in an electrical circuit where four resistors meet. Each resistor is connected to the junction and has a current flowing through it. The currents are labeled as I1, I2, I3, and I4, with arrows indicating the direction of the current flow.

- I1 is flowing into the junction from the bottom left.
- I2 is flowing out of the junction to the bottom right.
- I3 is flowing out of the junction to the top right.
- I4 is flowing into the junction from the top left.

The resistors are represented by the zigzag lines, which is the standard symbol for resistors in circuit diagrams. The junction is represented by a black dot where all four resistors meet. The directions of the currents suggest that I1 and I4 are entering the junction, while I2 and I3 are leaving the junction. This setup is typically used to apply Kirchhoff's Current Law (KCL), which states that the total current entering a junction must equal the total current leaving the junction.
```

source, through a component, or through a wire, because all currents are treated identically. Kirchoff's current law is illustrated in Figure 2–4 and Equations 2–4 and 2–5.

Here is the image describtion:
```
The image is a text label that reads "Figure 2-4. Kirchoff's Current Law." The text appears to be a caption or title for a figure in a document, likely related to electrical engineering or physics. The font is standard and the text is black on a white background. The label indicates that the figure is the fourth one in the second section or chapter of the document. The content of the figure itself is not shown in the image.
```

$$
\sum \mathbf{l\_{i\bullet}} = \sum \mathbf{l\_{o\bullet \bullet \bullet}} \tag{2-4}
$$

$$\mathbb{I}\_{\mathsf{I}} + \mathbb{I}\_{\mathsf{I}} = \mathbb{I}\_{\mathsf{3}} + \mathbb{I}\_{\mathsf{4}} \tag{2-5}$$

# **2.3 Voltage Divider Rule**

When the output of a circuit is not loaded, the voltage divider rule can be used to calculate the circuit's output voltage. Assume that the same current flows through all circuit elements (Figure 2–5). Equation 2–6 is written using Ohm's law as V = I (R1 + R2). Equation 2–7 is written as Ohm's law across the output resistor.

Here is the image describtion:
```
The image depicts a simple electrical circuit consisting of a voltage source, two resistors, and a current path. Here is a detailed description:

1. **Voltage Source (V)**: On the left side of the circuit, there is a voltage source labeled "V". This is the power supply for the circuit.

2. **Resistor R1**: Connected in series with the voltage source is a resistor labeled "R1". The current "I" flows through this resistor from the positive terminal of the voltage source.

3. **Current Direction**: The current "I" is indicated by an arrow pointing to the right, showing the direction of the current flow through the resistor R1.

4. **Node**: After passing through R1, the current reaches a node (a junction point) where the circuit splits.

5. **Resistor R2**: Connected in parallel with the voltage source is another resistor labeled "R2". The current "I" flows through this resistor as well.

6. **Output Voltage (V0)**: Across the resistor R2, there is a voltage labeled "V0". This is the output voltage of the circuit, measured across the terminals of R2.

7. **Ground**: The bottom of the circuit is connected to the ground, completing the circuit loop.

In summary, the circuit consists of a voltage source V, a series resistor R1, a parallel resistor R2, and an output voltage V0 measured across R2. The current I flows through both resistors, and the direction of the current is indicated by arrows.
```

Figure 2–5. Voltage Divider Rule

$$\mathbf{M} = \frac{\mathbf{V}}{\mathbf{R}\_1 + \mathbf{R}\_2} \tag{2-6}$$

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\mathsf{R}\_2 \tag{2-7}$$

Substituting Equation 2–6 into Equation 2–7, and using algebraic manipulation yields Equation 2–8.

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V} \frac{\mathbf{R\_2}}{\mathbf{R\_1} + \mathbf{R\_2}} \tag{2-8}$$

A simple way to remember the voltage divider rule is that the output resistor is divided by the total circuit resistance. This fraction is multiplied by the input voltage to obtain the out-

Review of Circuit Theory 2-3

put voltage. Remember that the voltage divider rule always assumes that the output resistor is not loaded; the equation is not valid when the output resistor is loaded by a parallel component. Fortunately, most circuits following a voltage divider are input circuits, and input circuits are usually high resistance circuits. When a fixed load is in parallel with the output resistor, the equivalent parallel value comprised of the output resistor and loading resistor can be used in the voltage divider calculations with no error. Many people ignore the load resistor if it is ten times greater than the output resistor value, but this calculation can lead to a 10% error.

# **2.4 Current Divider Rule**

When the output of a circuit is not loaded, the current divider rule can be used to calculate the current flow in the output branch circuit (R2). The currents I1 and I2 in Figure 2–6 are assumed to be flowing in the branch circuits. Equation 2–9 is written with the aid of Kirchoff's current law. The circuit voltage is written in Equation 2–10 with the aid of Ohm's law. Combining Equations 2–9 and 2–10 yields Equation 2–11.

Here is the image describtion:
```
The image depicts an electrical circuit diagram featuring a current source and two resistors arranged in parallel. Here is a detailed description of the components and their configuration:

1. **Current Source (I)**: On the left side of the diagram, there is a current source symbolized by a circle with a triangle inside it. This current source provides a constant current, denoted as \( I \), to the circuit.

2. **Parallel Resistors**: To the right of the current source, there are two resistors, \( R_1 \) and \( R_2 \), connected in parallel. This means that both resistors share the same two nodes, and the voltage across each resistor is the same.

3. **Currents through Resistors**: The current from the source splits into two currents, \( I_1 \) and \( I_2 \), which flow through resistors \( R_1 \) and \( R_2 \) respectively. The direction of these currents is indicated by arrows pointing downward through each resistor.

4. **Voltage (V)**: The voltage across the parallel combination of resistors is denoted as \( V \). This voltage is the same across both \( R_1 \) and \( R_2 \).

5. **Nodes and Connections**: The diagram shows four black dots representing the nodes where the components are connected. The top and bottom nodes connect the current source to the parallel resistors, completing the circuit.

In summary, the image illustrates a simple parallel circuit with a current source supplying current to two parallel resistors, with the current splitting into two paths and the voltage across the resistors being the same.
```

Figure 2–6. Current Divider Rule

$$\mathbb{I} = \mathbb{I}\_{\uparrow} + \mathbb{I}\_{2} \tag{2-9}$$

$$\mathsf{V} = \mathsf{l}\_{\mathsf{T}} \mathsf{R}\_{\mathsf{T}} = \mathsf{l}\_{2} \mathsf{R}\_{2} \tag{2-\mathsf{T}0}$$

$$|\mathbf{l}| = \mathbb{I}\_1 + \mathbb{I}\_2 = \mathbb{I}\_2 \frac{\mathbf{R}\_2}{\mathbf{R}\_1} + \mathbb{I}\_2 = \mathbb{I}\_2 \left(\frac{\mathbf{R}\_1 + \mathbf{R}\_2}{\mathbf{R}\_1}\right) \tag{2-11}$$

Rearranging the terms in Equation 2–11 yields Equation 2–12.

$$\|\mathbf{I}\_2 = \mathbb{I}\left(\frac{\mathbf{R}\_1}{\mathbf{R}\_1 + \mathbf{R}\_2}\right) \tag{2-\text{\textquotedblleft}l} \tag{2-\text{\textquotedblleft}l} \tag{2-\text{\textquotedblleft}l} \tag{2-\text{\textquotedblleft}l} \right)$$

The total circuit current divides into two parts, and the resistance (R1) divided by the total resistance determines how much current flows through R2. An easy method of remembering the current divider rule is to remember the voltage divider rule. Then modify the voltage divider rule such that the opposite resistor is divided by the total resistance, and the fraction is multiplied by the input current to get the branch current.

# **2.5 Thevenin's Theorem**

There are times when it is advantageous to isolate a part of the circuit to simplify the analysis of the isolated part of the circuit. Rather than write loop or node equations for the complete circuit, and solving them simultaneously, Thevenin's theorem enables us to isolate the part of the circuit we are interested in. We then replace the remaining circuit with a simple series equivalent circuit, thus Thevenin's theorem simplifies the analysis.

There are two theorems that do similar functions. The Thevenin theorem just described is the first, and the second is called Norton's theorem. Thevenin's theorem is used when the input source is a voltage source, and Norton's theorem is used when the input source is a current source. Norton's theorem is rarely used, so its explanation is left for the reader to dig out of a textbook if it is ever required.

The rules for Thevenin's theorem start with the component or part of the circuit being replaced. Referring to Figure 2–7, look back into the terminals (left from C and R3 toward point XX in the figure) of the circuit being replaced. Calculate the no load voltage (VTH) as seen from these terminals (use the voltage divider rule).

Here is the image describtion:
```
The image depicts an electrical circuit diagram consisting of the following components:

1. **Voltage Source (V)**: On the left side of the circuit, there is a voltage source represented by a circle with a plus and minus sign indicating the polarity.

2. **Resistor R1**: Connected in series with the voltage source, there is a resistor labeled R1.

3. **Resistor R2**: This resistor is connected in parallel with R1. The parallel connection is made at two nodes, one at the top and one at the bottom of R2.

4. **Resistor R3**: After the parallel combination of R1 and R2, there is another resistor labeled R3 connected in series.

5. **Capacitor (C)**: Following R3, there is a capacitor labeled C, which is also connected in series.

6. **Line of Symmetry (X-X)**: The circuit diagram includes a vertical dashed line labeled X-X, indicating a line of symmetry through the circuit. This line passes through the middle of the circuit, suggesting that the circuit can be analyzed or considered symmetrical about this line.

The circuit forms a combination of series and parallel components, with the voltage source driving the current through the resistors and the capacitor. The presence of the line of symmetry suggests that the circuit might have symmetrical properties that could simplify analysis.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 2-7. Original Circuit." This label likely refers to a specific figure in a document, such as a textbook or technical manual, which depicts an original circuit diagram. The figure number "2-7" suggests that it is the seventh figure in the second chapter or section of the document. The text is written in a standard, clear font, typically used for labeling figures in technical or educational materials.
```

Look into the terminals of the circuit being replaced, short independent voltage sources, and calculate the impedance between these terminals. The final step is to substitute the Thevenin equivalent circuit for the part you wanted to replace as shown in Figure 2–8.

Here is the image describtion:
```
The image depicts an electrical circuit diagram. Here is a detailed description of the components and their arrangement:

1. **Voltage Source (V_TH)**: On the left side of the circuit, there is a voltage source labeled \( V_{TH} \). This represents the Thevenin equivalent voltage source.

2. **Resistors (R_TH and R_3)**: 
   - The resistor labeled \( R_{TH} \) is connected in series with the voltage source \( V_{TH} \). This resistor represents the Thevenin equivalent resistance.
   - Another resistor labeled \( R_3 \) is connected in series with \( R_{TH} \).

3. **Capacitor (C)**: 
   - A capacitor labeled \( C \) is connected in series with the resistor \( R_3 \).

4. **Nodes (X-X)**: 
   - There is a vertical dashed line labeled \( X \) - \( X \) that intersects the circuit between \( R_{TH} \) and \( R_3 \). This line likely represents a point of interest or a reference for analysis, such as a point where the circuit might be split for Thevenin or Norton equivalent analysis.

The overall configuration is a series circuit consisting of a voltage source \( V_{TH} \), a resistor \( R_{TH} \), another resistor \( R_3 \), and a capacitor \( C \). The dashed line \( X \) - \( X \) indicates a specific point in the circuit, possibly for analysis purposes.
```

Figure 2–8. Thevenin's Equivalent Circuit for Figure 2–7

The Thevenin equivalent circuit is a simple series circuit, thus further calculations are simplified. The simplification of circuit calculations is often sufficient reason to use Thevenin's theorem because it eliminates the need for solving several simultaneous equations. The detailed information about what happens in the circuit that was replaced is not available when using Thevenin's theorem, but that is no consequence because you had no interest in it.

As an example of Thevenin's theorem, let's calculate the output voltage (VOUT) shown in Figure 2–9A. The first step is to stand on the terminals X–Y with your back to the output circuit, and calculate the open circuit voltage seen (VTH). This is a perfect opportunity to use the voltage divider rule to obtain Equation 2–13.

Here is the image describtion:
```
The image consists of two circuit diagrams labeled (a) and (b).

(a) The Original Circuit:
- This circuit includes a voltage source labeled "V" on the left side.
- The voltage source is connected to a resistor labeled "R1".
- The other end of R1 is connected to a node labeled "X".
- From node X, there are two branches:
  1. One branch has a resistor labeled "R3" connected to another node labeled "Y".
  2. The other branch has a resistor labeled "R2" connected to the ground.
- From node Y, there is a resistor labeled "R4" connected to the ground.
- The output voltage, labeled "VOUT", is measured across resistor R4, from node Y to the ground.

(b) The Thevenin Equivalent Circuit:
- This circuit includes a Thevenin equivalent voltage source labeled "VTH" on the left side.
- The Thevenin voltage source is connected to a resistor labeled "RTH".
- The other end of RTH is connected to a node labeled "X".
- From node X, there are two branches:
  1. One branch has a resistor labeled "R3" connected to another node labeled "Y".
  2. The other branch has no resistor connected to the ground, indicating that R2 has been replaced by the Thevenin equivalent resistance.
- From node Y, there is a resistor labeled "R4" connected to the ground.
- The output voltage, labeled "VOUT", is measured across resistor R4, from node Y to the ground.

In summary, the image shows the transformation of the original circuit into its Thevenin equivalent form, simplifying the analysis of the circuit by reducing it to a single voltage source and a single resistor in series with the rest of the circuit.
```

# Figure 2–9. Example of Thevenin's Equivalent Circuit

$$\mathbb{V}\_{\mathsf{T}\mathsf{H}} = \mathbb{V}\frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \tag{2-\mathsf{13}}$$

Still standing on the terminals X-Y, step two is to calculate the impedance seen looking into these terminals (short the voltage sources). The Thevenin impedance is the parallel impedance of R1 and R2 as calculated in Equation 2–14. Now get off the terminals X-Y before you damage them with your big feet. Step three replaces the circuit to the left of X-Y with the Thevenin equivalent circuit VTH and RTH.

$$\mathbf{R}\_{\mathsf{T}\mathsf{H}} = \frac{\mathbf{R}\_{\mathsf{1}}\mathbf{R}\_{2}}{\mathbf{R}\_{1} + \mathbf{R}\_{2}} = \mathbf{R}\_{\mathsf{1}} \parallel \mathbf{R}\_{2} \tag{2-14}$$

#### **Note:**

Two parallel vertical bars ( || ) are used to indicate parallel components as shown in Equation 2–14.

The final step is to calculate the output voltage. Notice the voltage divider rule is used again. Equation 2–15 describes the output voltage, and it comes out naturally in the form of a series of voltage dividers, which makes sense. That's another advantage of the voltage divider rule; the answers normally come out in a recognizable form rather than a jumble of coefficients and parameters.

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V}\_{\text{TH}} \frac{\mathsf{R}\_4}{\mathsf{R}\_{\text{TH}} + \mathsf{R}\_3 + \mathsf{R}\_4} = \mathbb{V} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \frac{\mathsf{R}\_4}{\mathsf{R}\_1 \mathsf{R}\_2} + \mathsf{R}\_3 + \mathsf{R}\_4 \tag{2-15}$$

The circuit analysis is done the hard way in Figure 2–10, so you can see the advantage of using Thevenin's Theorem. Two loop currents, I1 and I2, are assigned to the circuit. Then the loop Equations 2–16 and 2–17 are written.

Here is the image describtion:
```
The image depicts an electrical circuit diagram consisting of a voltage source \( V \) and four resistors \( R_1 \), \( R_2 \), \( R_3 \), and \( R_4 \). The circuit is arranged in a combination of series and parallel configurations. Here is a detailed description:

1. **Voltage Source \( V \)**: The circuit starts with a voltage source labeled \( V \) on the left side.

2. **Resistor \( R_1 \)**: Connected in series with the voltage source \( V \) is a resistor labeled \( R_1 \).

3. **Node and Branches**: After \( R_1 \), the circuit splits into two parallel branches:
   - The first branch contains resistor \( R_2 \).
   - The second branch contains resistors \( R_3 \) and \( R_4 \) in series.

4. **Resistor \( R_2 \)**: In the first parallel branch, there is a single resistor labeled \( R_2 \).

5. **Resistors \( R_3 \) and \( R_4 \)**: In the second parallel branch, there are two resistors in series:
   - Resistor \( R_3 \) is connected first.
   - Resistor \( R_4 \) follows \( R_3 \).

6. **Currents \( I_1 \) and \( I_2 \)**: The diagram indicates the direction of currents in the branches:
   - \( I_1 \) flows through \( R_2 \).
   - \( I_2 \) flows through the series combination of \( R_3 \) and \( R_4 \).

7. **Output Voltage \( V_{OUT} \)**: The output voltage \( V_{OUT} \) is measured across resistor \( R_4 \). The points where \( V_{OUT} \) is measured are marked on the diagram.

8. **Ground Connection**: The bottom of the circuit is connected to the ground, providing a common reference point for the voltages in the circuit.

In summary, the circuit consists of a voltage source \( V \) feeding into a series resistor \( R_1 \), which then splits into two parallel branches: one with a single resistor \( R_2 \) and the other with two resistors \( R_3 \) and \( R_4 \) in series. The output voltage \( V_{OUT} \) is taken across \( R_4 \).
```

Figure 2–10. Analysis Done the Hard Way

$$\mathsf{V} = \mathsf{I}\_{\mathsf{f}}(\mathsf{R}\_{1} + \mathsf{R}\_{2}) - \mathsf{I}\_{2}\mathsf{R}\_{2} \tag{2-\mathsf{M}}$$

$$\mathbb{I}\_2(\mathsf{R}\_2 + \mathsf{R}\_3 + \mathsf{R}\_4) = \mathbb{I}\_1\mathsf{R}\_2\tag{2-17}$$

Equation 2–17 is rewritten as Equation 2–18 and substituted into Equation 2–16 to obtain Equation 2–19.

$$\mathbb{I}\_{1} = \mathbb{I}\_{2} \xrightarrow{\mathbf{R}\_{2} + \mathbf{R}\_{3} + \mathbf{R}\_{4}} \tag{2-18}$$

$$\mathbb{V} = \mathbb{I}\_2 \left( \frac{\mathsf{R}\_2 + \mathsf{R}\_3 + \mathsf{R}\_4}{\mathsf{R}\_2} \right) (\mathsf{R}\_1 + \mathsf{R}\_2) - \mathsf{I}\_2 \mathsf{R}\_2 \tag{2-19}$$

The terms are rearranged in Equation 2–20. Ohm's law is used to write Equation 2–21, and the final substitutions are made in Equation 2–22.

$$\mathbf{I}\_{2} = \frac{\mathbf{V}}{\frac{\mathbf{R}\_{2} + \mathbf{R}\_{3} + \mathbf{R}\_{4}}{\mathbf{R}\_{2}}(\mathbf{R}\_{1} + \mathbf{R}\_{2}) - \mathbf{R}\_{2}}\tag{2-20}$$

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\_{2}\mathsf{R}\_{4} \tag{2-2\uparrow}$$

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V} \frac{\mathsf{R}\_4}{\left(\mathsf{R}\_2 + \mathsf{R}\_3 + \mathsf{R}\_4\right) \left(\mathsf{R}\_1 + \mathsf{R}\_2\right)} - \mathsf{R}\_2$$

This is a lot of extra work for no gain. Also, the answer is not in a usable form because the voltage dividers are not recognizable, thus more algebra is required to get the answer into usable form.

Review of Circuit Theory 2-7

# **2.6 Superposition**

Superposition is a theorem that can be applied to any linear circuit. Essentially, when there are independent sources, the voltages and currents resulting from each source can be calculated separately, and the results are added algebraically. This simplifies the calculations because it eliminates the need to write a series of loop or node equations. An example is shown in Figure 2–11.

Here is the image describtion:
```
The image depicts an electrical circuit with two voltage sources, three resistors, and an output voltage point. Here is a detailed description of the circuit:

1. **Voltage Sources:**
   - There are two voltage sources labeled \( V_1 \) and \( V_2 \).
   - \( V_1 \) is connected to the leftmost part of the circuit and is grounded at its negative terminal.
   - \( V_2 \) is connected to the middle part of the circuit and is also grounded at its negative terminal.

2. **Resistors:**
   - There are three resistors labeled \( R_1 \), \( R_2 \), and \( R_3 \).
   - \( R_1 \) is connected in series with \( V_1 \). One end of \( R_1 \) is connected to the positive terminal of \( V_1 \), and the other end is connected to a node that also connects to one end of \( R_3 \).
   - \( R_3 \) is connected in parallel with \( V_2 \). One end of \( R_3 \) is connected to the node shared with \( R_1 \), and the other end is connected to the positive terminal of \( V_2 \).
   - \( R_2 \) is connected in series with the node shared by \( R_3 \) and \( V_2 \). One end of \( R_2 \) is connected to this node, and the other end is connected to another node that leads to the output voltage point \( V_{OUT} \).

3. **Output Voltage:**
   - The output voltage \( V_{OUT} \) is taken from the node that is connected to the other end of \( R_2 \). This node is grounded, indicating that \( V_{OUT} \) is measured with respect to ground.

4. **Ground Connections:**
   - The negative terminals of both voltage sources \( V_1 \) and \( V_2 \) are connected to the ground.
   - The output voltage \( V_{OUT} \) is also referenced to the ground.

In summary, the circuit consists of two voltage sources \( V_1 \) and \( V_2 \), three resistors \( R_1 \), \( R_2 \), and \( R_3 \), and an output voltage point \( V_{OUT} \) that is measured with respect to ground. The resistors are arranged such that \( R_1 \) is in series with \( V_1 \), \( R_3 \) is in parallel with \( V_2 \), and \( R_2 \) is in series with the node shared by \( R_3 \) and \( V_2 \).
```

Figure 2–11.Superposition Example

When V1 is grounded, V2 forms a voltage divider with R3 and the parallel combination of R2 and R1. The output voltage for this circuit (VOUT2) is calculated with the aid of the voltage divider equation (2–23). The circuit is shown in Figure 2–12. The voltage divider rule yields the answer quickly.

Here is the image describtion:
```
The image depicts an electrical circuit consisting of a voltage source, three resistors, and a ground connection. Here is a detailed description of the components and their arrangement:

1. **Voltage Source (V2)**: On the left side of the circuit, there is a voltage source labeled V2. This voltage source is connected to the ground on its negative terminal.

2. **Resistor R3**: The positive terminal of the voltage source V2 is connected to one end of a resistor labeled R3. The other end of R3 is connected to a node.

3. **Resistor R1**: From the node where R3 ends, there is a connection to one end of another resistor labeled R1. The other end of R1 is connected to the ground.

4. **Resistor R2**: Continuing from the node where R3 ends, there is a horizontal wire leading to another node. From this second node, there is a connection to one end of a resistor labeled R2. The other end of R2 is connected to the ground.

5. **Output Voltage (VOUT2)**: At the second node (where R2 is connected), there is an arrow pointing upwards labeled VOUT2. This indicates the output voltage at this point in the circuit.

6. **Ground Connections**: The circuit has multiple ground connections. The negative terminal of the voltage source V2, the other ends of resistors R1 and R2, and the point where VOUT2 is measured are all connected to the ground.

In summary, the circuit is a series-parallel combination of resistors with a voltage source. Resistor R3 is in series with the parallel combination of resistors R1 and R2. The output voltage VOUT2 is taken from the node between R3 and the parallel combination of R1 and R2.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 2-12. When V1 is Grounded." This suggests that it is a caption or title for a figure in a document, likely related to an electrical or electronic circuit diagram. The figure referenced (Figure 2-12) presumably illustrates a scenario where a voltage source or point labeled V1 is connected to the ground, meaning it is at zero volts or connected to a common reference point in the circuit. The text is in a standard font, with "Figure 2-12." in bold, indicating it is a figure number, and "When V1 is Grounded" in regular font, providing a brief description of the figure.
```

$$\mathbb{V}\_{\text{OUT2}} = \mathbb{V}\_2 \frac{\mathbf{R}\_1 \parallel \mathbf{R}\_2}{\mathbf{R}\_3 + \mathbf{R}\_1 \parallel \mathbf{R}\_2} \tag{2-23}$$

Likewise, when V2 is grounded (Figure 2–13), V1 forms a voltage divider with R1 and the parallel combination of R3 and R2, and the voltage divider theorem is applied again to calculate VOUT (Equation 2–24).

Here is the image describtion:
```
The image depicts a simple electrical circuit consisting of a voltage source and three resistors. Here is a detailed description of the circuit:

1. **Voltage Source (V1)**: On the left side of the circuit, there is a voltage source labeled \( V_1 \). This voltage source is connected to the ground, indicating that it provides a potential difference relative to the ground.

2. **Resistor \( R_1 \)**: The positive terminal of the voltage source \( V_1 \) is connected to one end of a resistor labeled \( R_1 \). The other end of \( R_1 \) is connected to a node that branches out to other components in the circuit.

3. **Resistor \( R_3 \)**: From the node where \( R_1 \) ends, there is a connection to another resistor labeled \( R_3 \). The other end of \( R_3 \) is connected to the ground.

4. **Resistor \( R_2 \)**: Continuing from the same node where \( R_1 \) ends, there is a connection to another resistor labeled \( R_2 \). The other end of \( R_2 \) is also connected to the ground.

5. **Output Voltage (\( V_{OUT1} \))**: The node between \( R_1 \) and the parallel combination of \( R_3 \) and \( R_2 \) is labeled as \( V_{OUT1} \). This indicates that the output voltage is measured at this point relative to the ground.

In summary, the circuit consists of a voltage source \( V_1 \) connected in series with a resistor \( R_1 \), and then the circuit branches into two parallel resistors \( R_3 \) and \( R_2 \). The output voltage \( V_{OUT1} \) is taken from the node between \( R_1 \) and the parallel combination of \( R_3 \) and \( R_2 \).
```

Figure 2–13. When V2 is Grounded

2-8

$$\mathbb{V}\_{\text{OUT1}} = \mathbb{V}\_1 \frac{\mathbf{R}\_2 \parallel \mathbf{R}\_3}{\mathbf{R}\_1 + \mathbf{R}\_2 \parallel \mathbf{R}\_3} \tag{2-24}$$

After the calculations for each source are made the components are added to obtain the final solution (Equation 2–25).

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V}\_1 \frac{\mathbf{R}\_2 \parallel \mathbf{R}\_3}{\mathbf{R}\_1 + \mathbf{R}\_2 \parallel \mathbf{R}\_3} + \mathbb{V}\_2 \frac{\mathbf{R}\_1 \parallel \mathbf{R}\_2}{\mathbf{R}\_3 + \mathbf{R}\_1 \parallel \mathbf{R}\_2} \tag{2-25}$$

The reader should analyze this circuit with loop or node equations to gain an appreciation for superposition. Again, the superposition results come out as a simple arrangement that is easy to understand. One looks at the final equation and it is obvious that if the sources are equal and opposite polarity, and when R1 = R3, then the output voltage is zero. Conclusions such as this are hard to make after the results of a loop or node analysis unless considerable effort is made to manipulate the final equation into symmetrical form.

# **2.7 Calculation of a Saturated Transistor Circuit**

The circuit specifications are: when VIN = 12 V, VOUT <0.4 V at ISINK<10 mA, and VIN <0.05 V, VOUT >10 V at IOUT = 1 mA. The circuit diagram is shown in Figure 2–14.

Here is the image describtion:
```
The image depicts a common-emitter NPN transistor amplifier circuit. Here is a detailed description of the components and their connections:

1. **Transistor**: The central component is an NPN bipolar junction transistor (BJT). It has three terminals: the base (B), the collector (C), and the emitter (E).

2. **Base (B)**: The base of the transistor is connected to an input voltage source \( V_{IN} \) through a base resistor \( R_B \). The current flowing into the base is denoted as \( I_B \).

3. **Collector (C)**: The collector is connected to a 12V power supply through a collector resistor \( R_C \). The current flowing through the collector is denoted as \( I_C \).

4. **Emitter (E)**: The emitter is connected directly to the ground.

5. **Output Voltage (\( V_{OUT} \))**: The output voltage is taken from the collector of the transistor and is measured with respect to the ground.

6. **Current Directions**: The arrows indicate the direction of the currents:
   - \( I_B \) flows into the base.
   - \( I_C \) flows from the collector to the emitter through \( R_C \).

In operation, the input voltage \( V_{IN} \) controls the base current \( I_B \), which in turn controls the collector current \( I_C \). The voltage drop across \( R_C \) affects the output voltage \( V_{OUT} \). This configuration is commonly used for amplifying signals.
```

#### Figure 2–14. Saturated Transistor Circuit

The collector resistor must be sized (Equation 2–26) when the transistor is off, because it has to be small enough to allow the output current to flow through it without dropping more than two volts to meet the specification for a 10-V output.

$$\mathsf{R}\_{\mathsf{C}} \leq \frac{\mathsf{V}\_{+\mathsf{t}\mathsf{L}} - \mathsf{V}\_{\mathsf{OUT}}}{\mathsf{I}\_{\mathsf{OUT}}} = \frac{\mathsf{I}\mathsf{2} - \mathsf{I}\mathsf{0}}{\mathsf{I}} = \mathsf{2} \,\mathsf{k} \tag{2-26}$$

When the transistor is off, 1 mA can be drawn out of the collector resistor without pulling the collector or output voltage to less than ten volts (Equation 2–27). When the transistor is on, the base resistor must be sized (Equation 2–28) to enable the input signal to drive enough base current into the transistor to saturate it. The transistor beta is 50.

$$\mathbb{I}\_{\mathsf{C}} = \left\lVert \mathsf{I}\_{\mathsf{B}} = \frac{\mathsf{V}\_{+\mathsf{t}\mathsf{1}2} - \mathsf{V}\_{\mathsf{C}\mathsf{E}}}{\mathsf{R}\_{\mathsf{C}}} + \mathsf{I}\_{\mathsf{L}} \approx \frac{\mathsf{V}\_{+\mathsf{t}\mathsf{1}2}}{\mathsf{R}\_{\mathsf{C}}} + \mathsf{I}\_{\mathsf{L}} \tag{2-27}$$

$$\mathcal{R}\_{\mathsf{B}} \le \frac{\mathsf{V}\_{\mathsf{IN}} - \mathsf{V}\_{\mathsf{BE}}}{\mathsf{I}\_{\mathsf{B}}} \tag{2-28}$$

Substituting Equation 2–27 into Equation 2–28 yields Equation 2–29.

$$\mathcal{R}\_{\mathsf{B}} \le \frac{(\mathsf{V}\_{\mathsf{IN}} - \mathsf{V}\_{\mathsf{BE}})\mathsf{\beta}}{\mathsf{I}\_{\mathsf{C}}} = \frac{(\mathsf{V}\mathsf{2} - \mathsf{0.6})\mathsf{5}\mathsf{0}\ \mathsf{V}}{\left[\frac{\mathsf{I}\mathsf{2}}{\mathsf{Z}} + \mathsf{(\mathsf{I}\mathsf{0})}\right]\mathsf{mA}} = \mathsf{35.6\ \mathsf{k}}\tag{2-29}$$

When the transistor goes on it sinks the load current, and it still goes into saturation. These calculations neglect some minor details, but they are in the 98% accuracy range.

# **2.8 Transistor Amplifier**

The amplifier is an analog circuit (Figure 2–15), and the calculations, plus the points that must be considered during the design, are more complicated than for a saturated circuit. This extra complication leads people to say that analog design is harder than digital design (the saturated transistor is digital i.e.; on or off). Analog design is harder than digital design because the designer must account for all states in analog, whereas in digital only two states must be accounted for. The specifications for the amplifier are an ac voltage gain of four and a peak-to-peak signal swing of 4 volts.

Here is the image describtion:
```
The image depicts a common-emitter amplifier circuit using a bipolar junction transistor (BJT). Here is a detailed description of the circuit components and their connections:

1. **Power Supply:**
   - The circuit is powered by a 12V DC supply, which is connected to the top of the circuit.

2. **Transistor:**
   - The transistor is an NPN type, indicated by the arrow pointing outwards on the emitter leg.

3. **Resistors:**
   - **R1**: Connected between the 12V supply and the base of the transistor.
   - **R2**: Connected between the base of the transistor and ground.
   - **RC**: Connected between the 12V supply and the collector of the transistor.
   - **RE1**: Connected between the emitter of the transistor and ground.
   - **RE2**: Connected in parallel with a capacitor (CE) between the emitter of the transistor and ground.

4. **Capacitors:**
   - **CIN**: Connected in series with the input signal (VIN) and the base of the transistor. This capacitor blocks any DC component of the input signal.
   - **CE**: Connected in parallel with RE2 between the emitter of the transistor and ground. This capacitor provides AC bypass for the emitter resistor, improving the gain of the amplifier.

5. **Input and Output:**
   - **VIN**: The input signal is applied to the base of the transistor through the coupling capacitor CIN.
   - **VOUT**: The output signal is taken from the collector of the transistor.

6. **Ground Connections:**
   - The ground symbol is used at multiple points in the circuit, indicating a common reference point for the circuit.

**Operation:**
- The resistors R1 and R2 form a voltage divider network that sets the base bias voltage for the transistor.
- The transistor amplifies the input signal (VIN) applied at the base, and the amplified output signal (VOUT) is taken from the collector.
- The capacitor CE bypasses the AC signal around RE2, which increases the AC gain of the amplifier while maintaining DC stability.

This configuration is commonly used in analog electronics to amplify small AC signals.
```

Figure 2–15. Transistor Amplifier

IC is selected as 10 mA because the transistor has a current gain (β) of 100 at that point. The collector voltage is arbitrarily set at 8 V; when the collector voltage swings positive 2 V (from 8 V to 10 V) there is still enough voltage dropped across RC to keep the transistor on. Set the collector-emitter voltage at 4 V; when the collector voltage swings negative 2 V (from 8 V to 6 V) the transistor still has 2 V across it, so it stays linear. This sets the emitter voltage (VE) at 4 V.

$$\mathcal{R}\_{\mathbb{C}} \le \frac{\mathbb{V}\_{+12} - \mathbb{V}\_{\mathbb{C}}}{\mathbb{I}\_{\mathbb{C}}} = \frac{\mathbb{1}\mathbb{2}\mathbb{V} - \mathbb{8}\mathbb{V}}{\mathbb{1}\mathbb{0}\,\mathrm{mA}} = \,\_{10}\mathbf{400}\,\Omega\tag{2-30}$$

$$\mathbf{R\_{E}} = \mathbf{R\_{E1}} + \mathbf{R\_{E2}} = \frac{\mathsf{V\_{E}}}{\mathsf{l\_{E}}} = \frac{\mathsf{V\_{E}}}{\mathsf{l\_{B}} + \mathsf{l\_{C}}} \cong \frac{\mathsf{V\_{E}}}{\mathsf{l\_{C}}} = \frac{\mathsf{4 \mathsf{y}}}{\mathsf{10 \mathsf{ mA}}} = \,\,\mathsf{400 } \,\mathsf{Q} \tag{2-34}$$

Use Thevenin's equivalent circuit to calculate R1 and R2 as shown in Figure 2–16.

Here is the image describtion:
```
The image depicts an electrical circuit diagram. Here is a detailed description of the components and their configuration:

1. **Voltage Source**: On the left side of the diagram, there is a voltage source with a value of \( 12 \frac{R_2}{R_1 + R_2} \) volts. This indicates that the voltage is dependent on the ratio of two resistors, \( R_1 \) and \( R_2 \).

2. **Resistors**: There are two resistors, \( R_1 \) and \( R_2 \), connected in parallel. This parallel combination is represented as \( R_1 \parallel R_2 \).

3. **Current**: The current flowing through the circuit is labeled as \( I_B \), and it is shown with an arrow pointing to the right, indicating the direction of the current flow.

4. **Battery**: On the right side of the diagram, there is a battery with a voltage of \( V_B = 4.6 \) volts. This battery is connected in series with the parallel combination of resistors and the voltage source.

5. **Ground Connections**: The circuit has multiple ground connections, indicating common reference points for the voltages in the circuit.

The overall configuration shows a voltage source dependent on the resistor ratio, a parallel resistor network, and a battery, all contributing to the current \( I_B \) flowing through the circuit.
```

Figure 2–16. Thevenin Equivalent of the Base Circuit

$$\mathbf{I\_B = \frac{|\mathbf{C}|}{\mathbf{C}} = \frac{\mathbf{M} \cdot \mathbf{m} \mathbf{A}}{\mathbf{100}}} = \mathbf{0.1 \text{ mA}}\tag{2-32}$$

$$\mathcal{N}\_{\mathsf{T}\mathsf{H}} = \frac{\mathsf{12R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \tag{2-33}$$

<sup>R</sup> (2–34) TH R1R2 R1 R2

We want the base voltage to be 4.6 V because the emitter voltage is then 4 V. Assume a voltage drop of 0.4 V across RTH, so Equation 2–35 can be written. The drop across RTH may not be exactly 0.4 V because of beta variations, but a few hundred mV does not matter is this design. Now, calculate the ratio of R1 and R2 using the voltage divider rule (the load current has been accounted for).

<sup>R</sup> (2–35) TH 0.4 0.1 <sup>k</sup> 4 k

$$\mathsf{V}\_{\mathsf{T}\mathsf{H}} = \mathsf{I}\_{\mathsf{B}} \mathsf{R}\_{\mathsf{T}\mathsf{h}} + \mathsf{V}\_{\mathsf{B}} = \mathsf{0}.\mathsf{4} + \mathsf{4}.\mathsf{6} = \mathsf{5} = \mathsf{12} \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \tag{2-36}$$

$$\mathcal{R}\_2 = \frac{7}{5}\,\text{\,\,R}\_1\tag{2-37}$$

R1 is almost equal to R2, thus selecting R1 as twice the Thevenin resistance yields approximately 4 K as shown in Equation 2–35. Hence, R1 = 11.2 k and R2 = 8 k. The ac gain is

Review of Circuit Theory 2-11

approximately RC/RE1 because CE shorts out RE2 at high frequencies, so we can write Equation 2–38.

$$\mathcal{R}\_{\text{ET}} = \frac{\mathcal{R}\_{\text{C}}}{\mathbf{G}} = \frac{400}{4} = \text{ 100 } \Omega \tag{2-38}$$

$$
\mathsf{R}\_{\mathsf{E2}} = \mathsf{R}\_{\mathsf{E}} - \mathsf{R}\_{\mathsf{E1}} = \mathsf{400} - \mathsf{400} = \mathsf{300} \,\Omega \tag{2-39}
$$

The capacitor selection depends on the frequency response required for the amplifier, but 10 µF for CIN and 1000 µF for CE suffice for a starting point.

# **Chapter 3**

# **Development of the Ideal Op Amp Equations**

Ron Mancini

# **3.1 Ideal Op Amp Assumptions**

The name Ideal Op Amp is applied to this and similar analysis because the salient parameters of the op amp are assumed to be perfect. There is no such thing as an ideal op amp, but present day op amps come so close to ideal that Ideal Op Amp analysis approaches actual analysis. Op amps depart from the ideal in two ways. First, dc parameters such as input offset voltage are large enough to cause departure from the ideal. The ideal assumes that input offset voltage is zero. Second, ac parameters such as gain are a function of frequency, so they go from large values at dc to small values at high frequencies.

This assumption simplifies the analysis, thus it clears the path for insight. It is so much easier to see the forest when the brush and huge trees are cleared away. Although the ideal op amp analysis makes use of perfect parameters, the analysis is often valid because some op amps approach perfection. In addition, when working at low frequencies, several kHz, the ideal op amp analysis produces accurate answers. Voltage feedback op amps are covered in this chapter, and current feedback op amps are covered in Chapter 8.

Several assumptions have to be made before the ideal op amp analysis can proceed. First, assume that the current flow into the input leads of the op amp is zero. This assumption is almost true in FET op amps where input currents can be less than a pA, but this is not always true in bipolar high-speed op amps where tens of µA input currents are found.

Second, the op amp gain is assumed to be infinite, hence it drives the output voltage to any value to satisfy the input conditions. This assumes that the op amp output voltage can achieve any value. In reality, saturation occurs when the output voltage comes close to a power supply rail, but reality does not negate the assumption, it only bounds it.

Also, implicit in the infinite gain assumption is the need for zero input signal. The gain drives the output voltage until the voltage between the input leads (the error voltage) is zero. This leads to the third assumption that the voltage between the input leads is zero. The implication of zero voltage between the input leads means that if one input is tied to a hard voltage source such as ground, then the other input is at the same potential. The current flow into the input leads is zero, so the input impedance of the op amp is infinite.

Fourth, the output impedance of the ideal op amp is zero. The ideal op amp can drive any load without an output impedance dropping voltage across it. The output impedance of most op amps is a fraction of an ohm for low current flows, so this assumption is valid in most cases. Fifth, the frequency response of the ideal op amp is flat; this means that the gain does not vary as frequency increases. By constraining the use of the op amp to the low frequencies, we make the frequency response assumption true.

Table 3–1 lists the basic ideal op amp assumptions and FIgure 3–1shows the ideal op amp.

Table 3–1. Basic Ideal Op Amp Assumptions

| PARAMETER NAME       | PARAMETERS SYMBOL | VALUE |
|----------------------|-------------------|-------|
| Input current        | IIN               | 0     |
| Input offset voltage | VOS               | 0     |
| Input impedance      | ZIN               | ∞     |
| Output impedance     | ZOUT              | 0     |
| Gain                 | a                 | ∞     |

Here is the image describtion:
```
The image depicts an ideal operational amplifier (op-amp) circuit. Here are the detailed features and characteristics shown in the image:

1. **Op-Amp Symbol**: The op-amp is represented by a triangular shape, which is the standard symbol for an operational amplifier in circuit diagrams.

2. **Input Terminals**:
   - **Inverting Input (-)**: The upper input terminal is marked with a minus sign (-).
   - **Non-Inverting Input (+)**: The lower input terminal is marked with a plus sign (+).

3. **Output Terminal**: The right side of the triangle has a single output terminal labeled as \( V_{OUT} \).

4. **Ideal Characteristics**:
   - **Input Bias Current (\( I_B \))**: Both input terminals have arrows indicating that the input bias current (\( I_B \)) is zero. This means no current flows into the input terminals.
   - **Input Voltage (\( V_E \))**: The voltage difference between the inverting and non-inverting inputs (\( V_E \)) is zero, indicating that the op-amp maintains the inputs at the same voltage in an ideal condition.
   - **Input Impedance (\( Z_i \))**: The input impedance is infinite (\( Z_i = \infty \)), meaning the op-amp draws no current from the input signal source.
   - **Output Impedance (\( Z_o \))**: The output impedance is zero (\( Z_o = 0 \)), indicating that the op-amp can drive any load without loss of signal.
   - **Open-Loop Gain (a)**: The open-loop gain is infinite (\( a = \infty \)), meaning the op-amp can amplify the difference between the input voltages to an extremely high level.

5. **Ground Symbol**: There is a ground symbol connected internally within the op-amp, indicating a reference point for the circuit.

Overall, the image represents an idealized model of an operational amplifier, highlighting its key characteristics such as infinite input impedance, zero output impedance, zero input bias current, and infinite open-loop gain.
```

Figure 3–1. The Ideal Op Amp

# **3.2 The Noninverting Op Amp**

The noninverting op amp has the input signal connected to its noninverting input (Figure 3–2), thus its input source sees an infinite impedance. There is no input offset voltage because VOS = VE = 0, hence the negative input must be at the same voltage as the positive input. The op amp output drives current into RF until the negative input is at the voltage, VIN. This action causes VIN to appear across RG.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) configuration. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the apex pointing to the right. The op-amp has two input terminals:
   - The non-inverting input (+) is at the top.
   - The inverting input (-) is at the bottom.

2. **Input Voltage (VIN)**: The input voltage, labeled as \( V_{IN} \), is applied to the non-inverting input (+) of the op-amp.

3. **Feedback Network**: The circuit includes a feedback network consisting of two resistors:
   - \( R_F \): The feedback resistor, connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input (-).
   - \( R_G \): The ground resistor, connected between the inverting input (-) and the ground.

4. **Output Voltage (VOUT)**: The output voltage, labeled as \( V_{OUT} \), is taken from the output terminal of the op-amp.

5. **Virtual Ground Concept**: The inverting input (-) is connected to a point labeled \( V_E \), which is the voltage at the inverting input. Due to the high gain of the op-amp and the negative feedback, \( V_E \) is virtually equal to \( V_{IN} \).

6. **Current Assumption (IB = 0)**: The current into the input terminals of the op-amp is assumed to be zero (\( I_B = 0 \)), which is a common assumption for ideal op-amps.

In summary, this is a non-inverting amplifier circuit where the input voltage \( V_{IN} \) is applied to the non-inverting input of the op-amp, and the output voltage \( V_{OUT} \) is fed back to the inverting input through a resistor network. The gain of the amplifier is determined by the ratio of the resistors \( R_F \) and \( R_G \).
```

Here is the image describtion:
```
The image is a snippet of text that reads "Figure 3–2. The Noninverting Op Amp." This text appears to be a caption or title for a figure in a document, likely a textbook or technical manual, that discusses the noninverting operational amplifier (op amp) configuration. The text is in a standard font and is likely positioned above or below a diagram or illustration of a noninverting op amp circuit.
```

The voltage divider rule is used to calculate VIN; VOUT is the input to the voltage divider, and VIN is the output of the voltage divider. Since no current can flow into either op amp lead, use of the voltage divider rule is allowed. Equation 3–1 is written with the aid of the voltage divider rule, and algebraic manipulation yields Equation 3–2 in the form of a gain parameter.

$$\mathsf{V}\_{\mathsf{IN}} = \mathsf{V}\_{\mathsf{OUT}} \frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{F}}} \tag{3-1}$$

$$\frac{\mathcal{N}\_{\text{OUT}}}{\mathcal{N}\_{\text{IN}}} = \frac{\mathcal{R}\_{\text{G}} + \mathcal{R}\_{\text{F}}}{\mathcal{R}\_{\text{G}}} = \mathcal{I} + \frac{\mathcal{R}\_{\text{F}}}{\mathcal{R}\_{\text{G}}} \tag{3-2}$$

When RG becomes very large with respect to RF, (RF/RG)⇒0 and Equation 3–2 reduces to Equation 3–3.

$$\mathsf{V}\_{\mathsf{OMT}} = \mathsf{I} \tag{3-3}$$

Under these conditions VOUT = 1 and the circuit becomes a unity gain buffer. RG is usually deleted to achieve the same results, and when RG is deleted, RF can also be deleted (RF must be shorted when it is deleted). When RF and RG are deleted, the op amp output is connected to its inverting input with a wire. Some op amps are self-destructive when RF is left out of the circuit, so RF is used in many buffer designs. When RF is included in a buffer circuit, its function is to protect the inverting input from an over voltage to limit the current through the input ESD (electro-static discharge) structure (typically < 1 mA), and it can have almost any value (20 k is often used). RF can never be left out of the circuit in a current feedback amplifier design because RF determines stability in current feedback amplifiers.

Notice that the gain is only a function of the feedback and gain resistors; therefore the feedback has accomplished its function of making the gain independent of the op amp parameters. The gain is adjusted by varying the ratio of the resistors. The actual resistor values are determined by the impedance levels that the designer wants to establish. If RF = 10 k and RG = 10 k the gain is two as shown in Equation 2, and if RF = 100 k and RG = 100 k the gain is still two. The impedance levels of 10 k or 100 k determine the current drain, the effect of stray capacitance, and a few other points. The impedance level does not set the gain; the ratio of RF/RG does.

# **3.3 The Inverting Op Amp**

The noninverting input of the inverting op amp circuit is grounded. One assumption made is that the input error voltage is zero, so the feedback keeps inverting the input of the op amp at a virtual ground (not actual ground but acting like ground). The current flow in the input leads is assumed to be zero, hence the current flowing through RG equals the current flowing through RF. Using Kirchoff's law, we write Equation 3–4; and the minus sign is inserted because this is the inverting input. Algebraic manipulation gives Equation 3–5.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) configuration. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the label 'a'. The op-amp has two input terminals: the inverting input (-) and the non-inverting input (+). The output is labeled as \( V_{OUT} \).

2. **Input Voltage (\( V_{IN} \))**: The input voltage is applied to the circuit at the left side, labeled as \( V_{IN} \).

3. **Resistors**:
   - **\( R_G \)**: This resistor is connected between the input voltage \( V_{IN} \) and the inverting input (-) of the op-amp. The current through this resistor is labeled as \( I_1 \).
   - **\( R_F \)**: This resistor is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input (-). The current through this resistor is labeled as \( I_2 \).

4. **Ground Connection**: The non-inverting input (+) of the op-amp is connected to the ground, indicating that the voltage at this point is zero.

5. **Currents and Voltages**:
   - **\( I_1 \)**: The current flowing through resistor \( R_G \) from \( V_{IN} \) to the inverting input (-) of the op-amp.
   - **\( I_2 \)**: The current flowing through resistor \( R_F \) from the inverting input (-) to the output \( V_{OUT} \).
   - **\( V_E \)**: The voltage at the inverting input (-) of the op-amp.
   - **\( I_B = 0 \)**: The input bias currents at both the inverting and non-inverting inputs of the op-amp are assumed to be zero, indicating an ideal op-amp with no input current.

6. **Feedback Loop**: The resistor \( R_F \) forms a feedback loop from the output \( V_{OUT} \) to the inverting input (-) of the op-amp, which is a characteristic of negative feedback in op-amp circuits.

In summary, this is a non-inverting op-amp configuration with feedback, where the input voltage \( V_{IN} \) is applied through a resistor \( R_G \) to the inverting input, and the output voltage \( V_{OUT} \) is fed back to the inverting input through a resistor \( R_F \). The non-inverting input is grounded, and the op-amp is assumed to have ideal characteristics with zero input bias currents.
```

Figure 3–3. The Inverting Op Amp

$$\mathfrak{l}\_{\mathfrak{l}} = \frac{\mathsf{V}\_{\mathsf{IN}}}{\mathsf{R}\_{\mathsf{G}}} = \ -\mathfrak{l}\_{\mathfrak{2}} = -\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{R}\_{\mathsf{F}}} \tag{3-4}$$

$$\frac{\mathcal{N}\_{\text{OUT}}}{\mathcal{N}\_{\text{IN}}} = -\frac{\mathcal{R}\_{\text{F}}}{\mathcal{R}\_{\text{G}}} \tag{3-5}$$

Notice that the gain is only a function of the feedback and gain resistors, so the feedback has accomplished its function of making the gain independent of the op amp parameters. The actual resistor values are determined by the impedance levels that the designer wants to establish. If RF = 10 k and RG = 10 k the gain is minus one as shown in Equation 3–5, and if RF = 100 k and RG = 100 k the gain is still minus one. The impedance levels of 10 k or 100 k determine the current drain, the effect of stray capacitance, and a few other points. The impedance level does not set the gain; the ratio of RF/RG does.

One final note; the output signal is the input signal amplified and inverted. The circuit input impedance is set by RG because the inverting input is held at a virtual ground.

# **3.4 The Adder**

An adder circuit can be made by connecting more inputs to the inverting op amp (Figure 3–4). The opposite end of the resistor connected to the inverting input is held at virtual ground by the feedback; therefore, adding new inputs does not affect the response of the existing inputs.

Here is the image describtion:
```
The image depicts a summing amplifier circuit using an operational amplifier (op-amp). Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an op-amp, represented by a triangle with the inverting input (-) and non-inverting input (+). The output of the op-amp is labeled as \( V_{OUT} \).

2. **Inputs**: There are three input voltages labeled \( V_1 \), \( V_2 \), and \( V_N \). Each input voltage is connected to the inverting input of the op-amp through a resistor.

3. **Resistors**:
   - \( R_1 \): This resistor is connected between the input voltage \( V_1 \) and the inverting input of the op-amp.
   - \( R_2 \): This resistor is connected between the input voltage \( V_2 \) and the inverting input of the op-amp.
   - \( R_N \): This resistor is connected between the input voltage \( V_N \) and the inverting input of the op-amp.
   - \( R_F \): This feedback resistor is connected between the output \( V_{OUT} \) and the inverting input of the op-amp.

4. **Ground Connection**: The non-inverting input (+) of the op-amp is connected to the ground.

5. **Summing Point**: The inverting input of the op-amp serves as the summing point where the currents from \( V_1 \), \( V_2 \), and \( V_N \) through \( R_1 \), \( R_2 \), and \( R_N \) respectively, are summed.

The circuit functions as a summing amplifier, where the output voltage \( V_{OUT} \) is a weighted sum of the input voltages \( V_1 \), \( V_2 \), and \( V_N \). The weights are determined by the values of the resistors \( R_1 \), \( R_2 \), \( R_N \), and \( R_F \). The relationship can be expressed as:

\[ V_{OUT} = -\left( \frac{R_F}{R_1} V_1 + \frac{R_F}{R_2} V_2 + \cdots + \frac{R_F}{R_N} V_N \right) \]

The negative sign indicates that the output is inverted relative to the input voltages.
```

Figure 3–4. The Adder Circuit

Superposition is used to calculate the output voltages resulting from each input, and the output voltages are added algebraically to obtain the total output voltage. Equation 3–6 is the output equation when V1 and V2 are grounded. Equations 3–7 and 3–8 are the other superposition equations, and the final result is given in Equation 3–9.

$$
\mathbb{V}\_{\text{OUTN}} = -\frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{\text{N}}} \mathsf{V}\_{\text{N}} \tag{3-6}
$$

$$
\mathbb{V}\_{\mathbf{OUT}} = -\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{1}}} \mathsf{V}\_{\mathsf{1}} \tag{3-7}
$$

$$\mathbb{V}\_{\text{OUT2}} = -\frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{2}} \mathsf{V}\_{2} \tag{3-8}$$

$$\mathbf{V}\_{\text{OUT}} = -\left(\frac{\mathbf{R}\_{\text{F}}}{\mathbf{R}\_{1}}\mathbf{V}\_{1} + \frac{\mathbf{R}\_{\text{F}}}{\mathbf{R}\_{2}}\mathbf{V}\_{2} + \frac{\mathbf{R}\_{\text{F}}}{\mathbf{R}\_{\text{N}}}\mathbf{V}\_{\text{N}}\right) \tag{3-9}$$

Development of the Ideal Op Amp Equations 3-5

# **3.5 The Differential Amplifier**

The differential amplifier circuit amplifies the difference between signals applied to the inputs (Figure 3–5). Superposition is used to calculate the output voltage resulting from each input voltage, and then the two output voltages are added to arrive at the final output voltage.

Here is the image describtion:
```
The image depicts a summing amplifier circuit using an operational amplifier (op-amp). Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the inverting input (-) and non-inverting input (+) marked. The output of the op-amp is labeled as \( V_{OUT} \).

2. **Voltage Sources**: There are two voltage sources, \( V_1 \) and \( V_2 \), each connected to the circuit through resistors.

3. **Resistors**:
   - **\( R_1 \)**: Connected between the voltage source \( V_1 \) and the non-inverting input (+) of the op-amp.
   - **\( R_2 \)**: Connected between the non-inverting input (+) of the op-amp and ground.
   - **\( R_3 \)**: Connected between the voltage source \( V_2 \) and the inverting input (-) of the op-amp.
   - **\( R_4 \)**: Connected between the inverting input (-) of the op-amp and the output \( V_{OUT} \).

4. **Connections**:
   - The non-inverting input (+) of the op-amp is connected to the junction of \( R_1 \) and \( R_2 \).
   - The inverting input (-) of the op-amp is connected to the junction of \( R_3 \) and \( R_4 \).
   - The output \( V_{OUT} \) is connected back to the inverting input (-) through \( R_4 \), forming a feedback loop.

5. **Ground Connections**: Both voltage sources \( V_1 \) and \( V_2 \) have their negative terminals connected to ground.

This configuration is typical for a summing amplifier, where the output voltage \( V_{OUT} \) is a weighted sum of the input voltages \( V_1 \) and \( V_2 \). The resistors \( R_1 \), \( R_2 \), \( R_3 \), and \( R_4 \) determine the gain and the contribution of each input voltage to the output.
```

### Figure 3–5. The Differential Amplifier

The op amp input voltage resulting from the input source, V1, is calculated in Equations 3–10 and 3–11. The voltage divider rule is used to calculate the voltage, V+, and the noninverting gain equation (Equation 3–2) is used to calculate the noninverting output voltage, VOUT1.

$$\mathbb{V}\_{+} = \mathbb{V}\_{1} \frac{\mathbf{R}\_{2}}{\mathbf{R}\_{1} + \mathbf{R}\_{2}} \tag{3-10}$$

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{+}(\mathsf{G}\_{+}) = \mathbb{V}\_{1} \frac{\mathsf{R}\_{2}}{\mathsf{R}\_{1} + \mathsf{R}\_{2}} \left(\frac{\mathsf{R}\_{3} + \mathsf{R}\_{4}}{\mathsf{R}\_{3}}\right) \tag{3-17}$$

The inverting gain equation (Equation 3–5) is used to calculate the stage gain for VOUT2 in Equation 3–12. These inverting and noninverting gains are added in Equation 3–13.

$$\mathbb{V}\_{\text{OUT2}} = \mathbb{V}\_2 \left( -\frac{\mathbf{R}\_4}{\mathbf{R}\_3} \right) \tag{3-12}$$

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V}\_1 \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \left( \frac{\mathsf{R}\_3 + \mathsf{R}\_4}{\mathsf{R}\_3} \right) - \mathbb{V}\_2 \frac{\mathsf{R}\_4}{\mathsf{R}\_3} \tag{3-13}$$

When R2 = R4 and R1 = R3, Equation 3–13 reduces to Equation 3–14.

$$\mathbf{V\_{OUT}} = (\mathbf{V\_1} - \mathbf{V\_2}) \frac{\mathbf{R\_4}}{\mathbf{R\_3}} \tag{3-14}$$

It is now obvious that the differential signal, (V1–V2), is multiplied by the stage gain, so the name differential amplifier suits the circuit. Because it only amplifies the differential portion of the input signal, it rejects the common-mode portion of the input signal. A common-mode signal is illustrated in Figure 3–6. Because the differential amplifier strips off or rejects the common-mode signal, this circuit configuration is often employed to strip dc or injected common-mode noise off a signal.

Here is the image describtion:
```
The image depicts a differential amplifier circuit using an operational amplifier (op-amp). Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal. The output terminal is on the right side of the triangle, labeled as \( V_{OUT} \).

2. **Input Voltages**: There are two input voltage sources, \( V_1 \) and \( V_2 \), connected to the circuit. \( V_1 \) is connected to the non-inverting input (+) of the op-amp through a resistor \( R_G \). \( V_2 \) is connected to the inverting input (-) of the op-amp through another resistor \( R_G \).

3. **Common Mode Voltage (V_{CM})**: There is a common mode voltage source \( V_{CM} \) connected to the ground. This voltage is shared between the two input voltage sources \( V_1 \) and \( V_2 \).

4. **Feedback Resistors**: There are two feedback resistors, \( R_F \), connected in the circuit. One \( R_F \) is connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp. The other \( R_F \) is connected between the inverting input (-) and the ground.

5. **Resistor Connections**: The resistors \( R_G \) and \( R_F \) form a network that determines the gain of the differential amplifier. The resistors \( R_G \) are connected in series with the input voltages \( V_1 \) and \( V_2 \), while the resistors \( R_F \) are part of the feedback loop.

6. **Ground Connections**: The common mode voltage \( V_{CM} \) and the feedback resistor \( R_F \) are connected to the ground.

The circuit is designed to amplify the difference between the input voltages \( V_1 \) and \( V_2 \) while rejecting any voltage that is common to both inputs (common-mode voltage \( V_{CM} \)). The output voltage \( V_{OUT} \) is a function of the difference between \( V_1 \) and \( V_2 \), scaled by the ratio of the resistors \( R_F \) and \( R_G \).
```

Figure 3–6. Differential Amplifier With Common-Mode Input Signal

The disadvantage of this circuit is that the two input impedances cannot be matched when it functions as a differential amplifier, thus there are two and three op amp versions of this circuit specially designed for high performance applications requiring matched input impedances.

# **3.6 Complex Feedback Networks**

When complex networks are put into the feedback loop, the circuits get harder to analyze because the simple gain equations cannot be used. The usual technique is to write and solve node or loop equations. There is only one input voltage, so superposition is not of any use, but Thevenin's theorem can be used as is shown in the example problem given below.

Sometimes it is desirable to have a low resistance path to ground in the feedback loop. Standard inverting op amps can not do this when the driving circuit sets the input resistor value, and the gain specification sets the feedback resistor value. Inserting a T network in the feedback loop (FIgure 3–7) yields a degree of freedom that enables both specifications to be met with a low dc resistance path in the feedback loop.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with several resistors connected in a specific configuration. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangular symbol labeled "a". It has two input terminals: the inverting input (-) and the non-inverting input (+). The non-inverting input is connected to the ground.

2. **Input Voltage (VIN)**: The input voltage, labeled as \( V_{IN} \), is applied to the left side of the circuit.

3. **Resistors**: There are four resistors in the circuit, labeled \( R_1 \), \( R_2 \), \( R_3 \), and \( R_4 \).
   - \( R_1 \) is connected between the input voltage \( V_{IN} \) and a node labeled "X".
   - \( R_2 \) is connected between node "X" and the inverting input (-) of the op-amp.
   - \( R_3 \) is connected between a node labeled "Y" and the output voltage \( V_{OUT} \).
   - \( R_4 \) is connected between node "Y" and the ground.

4. **Nodes**: There are two important nodes in the circuit:
   - Node "X" is the junction where \( R_1 \) and \( R_2 \) meet.
   - Node "Y" is the junction where \( R_3 \) and \( R_4 \) meet.

5. **Output Voltage (VOUT)**: The output voltage, labeled as \( V_{OUT} \), is taken from the right side of the circuit, at the output terminal of the op-amp.

6. **Ground Connections**: The non-inverting input (+) of the op-amp and one end of \( R_4 \) are connected to the ground.

In summary, the circuit is a configuration involving an op-amp with resistors arranged to form a specific feedback network. The input voltage \( V_{IN} \) is applied through \( R_1 \) and \( R_2 \) to the inverting input of the op-amp, while the output voltage \( V_{OUT} \) is taken from the op-amp's output terminal, with \( R_3 \) and \( R_4 \) forming part of the feedback loop.
```

Figure 3–7. T Network in Feedback Loop

Break the circuit at point X–Y, stand on the terminals looking into R4, and calculate the Thevenin equivalent voltage as shown in Equation 3–15. The Thevenin equivalent impedance is calculated in Equation 3–16.

$$\mathsf{V}\_{\mathsf{T}\mathsf{H}} = \mathsf{V}\_{\mathsf{OUT}} \frac{\mathsf{R}\_{4}}{\mathsf{R}\_{3} + \mathsf{R}\_{4}} \tag{3-15}$$

$$\mathsf{R}\_{\mathsf{T}\mathsf{H}} = \mathsf{R}\_{3} \parallel \mathsf{R}\_{4} \tag{3-16}$$

Replace the output circuit with the Thevenin equivalent circuit as shown in Figure 5–8, and calculate the gain with the aid of the inverting gain equation as shown in Equation 3–17.

Here is the image describtion:
```
The image depicts an electrical circuit that includes an operational amplifier (op-amp) and several resistors. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as \( V_{IN} \).

2. **Resistor R1**: The input voltage \( V_{IN} \) is connected to a resistor labeled \( R_1 \). This resistor is in series with the input voltage.

3. **Node**: After \( R_1 \), there is a node where the circuit splits into two paths.

4. **Resistor R2**: One path from the node goes through another resistor labeled \( R_2 \). This resistor is connected to the inverting input (marked with a minus sign) of the operational amplifier.

5. **Operational Amplifier (Op-Amp)**: The operational amplifier is depicted as a triangle with the inverting input (−) connected to \( R_2 \) and the non-inverting input (+) connected to the ground. The output of the op-amp is shown as a dashed line leading to a voltage source \( V_{TH} \).

6. **Resistor RTH**: The other path from the node goes through a resistor labeled \( R_{TH} \). This resistor is connected to the voltage source \( V_{TH} \).

7. **Voltage Source (VTH)**: The voltage source \( V_{TH} \) is connected to the ground.

8. **Ground Connections**: The non-inverting input of the op-amp and the voltage source \( V_{TH} \) are both connected to the ground.

In summary, the circuit consists of an input voltage \( V_{IN} \) that passes through \( R_1 \) and splits into two paths: one through \( R_2 \) to the inverting input of the op-amp, and the other through \( R_{TH} \) to the voltage source \( V_{TH} \). The non-inverting input of the op-amp is grounded, and the output of the op-amp is connected to \( V_{TH} \).
```

#### Figure 3–8. Thevenin's Theorem Applied to T Network

Substituting the Thevenin equivalents into Equation 3–17 yields Equation 3–18.

$$-\frac{\mathsf{V\_{TH}}}{\mathsf{V\_{IN}}} = \frac{\mathsf{R\_2} + \mathsf{R\_{TH}}}{\mathsf{R\_1}}\tag{3-17}$$

$$-\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{R}\_2 + \mathsf{R}\_{\mathsf{TH}}}{\mathsf{R}\_1} \left(\frac{\mathsf{R}\_3 + \mathsf{R}\_4}{\mathsf{R}\_4}\right) = \frac{\mathsf{R}\_2 + (\mathsf{R}\_3 \parallel \mathsf{R}\_4)}{\mathsf{R}\_1} \left(\frac{\mathsf{R}\_3 + \mathsf{R}\_4}{\mathsf{R}\_4}\right) \tag{3-18}$$

Algebraic manipulation yields Equation 3–19.

$$1 - \frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{R}\_2 + \mathsf{R}\_3 + \frac{\mathsf{R}\_2 \mathsf{R}\_3}{\mathsf{R}\_4}}{\mathsf{R}\_1} \tag{3-19}$$

Specifications for the circuit you are required to build are an inverting amplifier with an input resistance of 10 k (RG = 10 k), a gain of 100, and a feedback resistance of 20 K or less. The inverting op amp circuit can not meet these specifications because RF must equal 1000 k. Inserting a T network with R2 = R4 = 10 k and R3 = 485 k approximately meets the specifications.

# **3.7 Video Amplifiers**

Video signals contain high frequencies, and they use coaxial cable to transmit and receive signals. The cable connecting these circuits has a characteristic impedance of 75 Ω. To prevent reflections, which cause distortion and ghosting, the input and output circuit impedances must match the 75 Ω cable.

Matching the input impedance is simple for a noninverting amplifier because its input impedance is very high; just make RIN = 75 Ω. RF and RG can be selected as high values, in the hundreds of Ohms range, so that they have minimal affect on the impedance of the input or output circuit. A matching resistor, RM, is placed in series with the op amp output to raise its output impedance to 75 Ω; a terminating resistor, RT, is placed at the input of the next stage to match the cable (Figure 3–9).

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with several resistors and a transmission line. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the symbol 'a' inside it. The op-amp has two input terminals: the inverting input (-) and the non-inverting input (+).

2. **Input Voltage (VIN)**: The input voltage, labeled as VIN, is applied to the non-inverting input (+) of the op-amp through a resistor labeled RIN.

3. **Feedback Resistor (RF)**: A resistor labeled RF is connected between the output of the op-amp and the inverting input (-). This resistor is part of the feedback loop that determines the gain of the amplifier.

4. **Grounded Resistor (RG)**: A resistor labeled RG is connected between the inverting input (-) of the op-amp and the ground.

5. **Output Resistor (RM)**: The output of the op-amp is connected to a resistor labeled RM, which is in series with a transmission line.

6. **Transmission Line**: The transmission line is represented by a cylindrical shape and is connected in series with the resistor RM. This line carries the signal to the output.

7. **Output Voltage (VOUT)**: The output voltage, labeled as VOUT, is taken from the end of the transmission line. 

8. **Termination Resistor (RT)**: A resistor labeled RT is connected between the output voltage point (VOUT) and the ground. This resistor is used to terminate the transmission line to prevent signal reflections.

In summary, the circuit is an op-amp configuration with feedback and input resistors, a transmission line, and a termination resistor. The input voltage VIN is applied to the non-inverting input of the op-amp, and the output voltage VOUT is taken after the transmission line, with proper termination to ground.
```

Figure 3–9. Video Amplifier

The matching and terminating resistors are equal in value, and they form a voltage divider of 1/2 because RT is not loaded. Very often RF is selected equal to RG so that the op amp gain equals two. Then the system gain, which is the op amp gain multiplied by the divider gain, is equal to one (2 × 1/2 = 1).

# **3.8 Capacitors**

Capacitors are a key component in a circuit designer's tool kit, thus a short discussion on evaluating their affect on circuit performance is in order. Capacitors have an impedance of XC = 1/2πfC. Note that when the frequency is zero the capacitive impedance (also known as reactance) is infinite, and that when the frequency is infinite the capacitive impedance is zero. These end-points are derived from the final value theorem, and they are used to get a rough idea of the effect of a capacitor. When a capacitor is used with a resistor, they form what is called a break-point. Without going into complicated math, just accept that the break frequency occurs at f = 1/(2π RC) and the gain is –3 dB at the break frequency.

The low pass filter circuit shown in Figure 3–10 has a capacitor in parallel with the feedback resistor. The gain for the low pass filter is given in Equation 3–20.

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit configured as an inverting amplifier with a feedback network that includes both a resistor and a capacitor. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an op-amp, represented by a triangle with the label 'a'. The op-amp has two input terminals and one output terminal:
   - The inverting input (marked with a minus sign, -) is connected to the feedback network.
   - The non-inverting input (marked with a plus sign, +) is connected to the ground (0V reference point).
   - The output terminal is labeled as \( V_{OUT} \).

2. **Input Voltage (\( V_{IN} \))**: The input voltage is labeled as \( V_{IN} \) and is applied to the circuit through a resistor \( R_G \).

3. **Resistor \( R_G \)**: This resistor is connected between the input voltage \( V_{IN} \) and the inverting input of the op-amp. It is labeled as \( R_G \).

4. **Feedback Network**: The feedback network consists of a resistor \( R_F \) and a capacitor \( C_F \):
   - **Resistor \( R_F \)**: This resistor is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input of the op-amp.
   - **Capacitor \( C_F \)**: This capacitor is connected in parallel with the resistor \( R_F \), meaning one end of the capacitor is connected to the output of the op-amp (\( V_{OUT} \)) and the other end is connected to the inverting input of the op-amp.

The configuration shown is a typical inverting amplifier with a frequency-dependent feedback network. The resistor \( R_F \) and capacitor \( C_F \) together form a feedback loop that can affect the frequency response of the amplifier, potentially providing low-pass filtering characteristics. The overall gain and behavior of the circuit will depend on the values of \( R_G \), \( R_F \), and \( C_F \).
```

Figure 3–10. Low-Pass Filter

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = -\frac{\mathbf{X\_{C}} \parallel \mathbf{R\_{F}}}{\mathbf{R\_{G}}} \tag{3-20}$$

At very low frequencies XC ⇒ ∞, so RF dominates the parallel combination in Equation 20, and the capacitor has no effect. The gain at low frequencies is –RF/RG. At very high frequencies XC ⇒ 0, so the feedback resistor is shorted out, thus reducing the circuit gain to zero. At the frequency where XC = RF the gain is reduced by √2 because complex impedances in parallel equal half the vector sum of both impedances.

Connecting the capacitor in parallel with RG where it has the opposite effect makes a high pass filter (Figure 3–11). Equation 3–21 gives the equation for the high pass filter.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with a feedback network. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the apex pointing to the right. The op-amp has two input terminals:
   - The non-inverting input (+) is connected to the input voltage \( V_{IN} \).
   - The inverting input (-) is connected to a feedback network.

2. **Feedback Network**:
   - **Resistor \( R_F \)**: This resistor is connected between the output of the op-amp (labeled \( V_{OUT} \)) and the inverting input (-) of the op-amp.
   - **Resistor \( R_G \)**: This resistor is connected between the inverting input (-) of the op-amp and ground.
   - **Capacitor \( C_G \)**: This capacitor is connected in parallel with \( R_G \), meaning one end of the capacitor is connected to the inverting input (-) and the other end is connected to ground.

3. **Connections**:
   - The input voltage \( V_{IN} \) is applied to the non-inverting input (+) of the op-amp.
   - The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.
   - The feedback resistor \( R_F \) provides a path from the output back to the inverting input (-), creating a feedback loop.
   - The combination of \( R_G \) and \( C_G \) forms a parallel RC network connected between the inverting input (-) and ground.

This configuration suggests a non-inverting amplifier with a feedback network that includes both resistive and capacitive components, which can influence the frequency response of the circuit. The exact behavior of the circuit will depend on the values of \( R_F \), \( R_G \), and \( C_G \).
```

#### Figure 3–11.High-Pass Filter

$$\frac{\mathsf{V\_{OUT}}}{\mathsf{V\_{IN}}} = \mathsf{1} + \frac{\mathsf{R\_F}}{\mathsf{X\_C} \parallel \mathsf{R\_G}} \tag{3-21}$$

At very low frequencies XC ⇒ ∞, so RG dominates the parallel combination in Equation 3–21, and the capacitor has no effect. The gain at low frequencies is 1+RF/RG. At very high frequencies XC ⇒ 0, so the gain setting resistor is shorted out thus increasing the circuit gain to maximum.

This simple technique is used to predict the form of a circuit transfer function rapidly. Better analysis techniques are presented in later chapters for those applications requiring more precision.

# **3.9 Summary**

When the proper assumptions are made, the analysis of op amp circuits is straightforward. These assumptions, which include zero input current, zero input offset voltage, and infinite gain, are realistic assumptions because the new op amps make them true in most applications.

When the signal is comprised of low frequencies, the gain assumption is valid because op amps have very high gain at low frequencies. When CMOS op amps are used, the input current is in the femto amp range; close enough to zero for most applications. Laser trimmed input circuits reduce the input offset voltage to a few micro volts; close enough to zero for most applications. The ideal op amp is becoming real; especially for undemanding applications.

# **Chapter 4**

# **Single-Supply Op Amp Design Techniques**

Ron Mancini

# **4.1 Single Supply versus Dual Supply**

The previous chapter assumed that all op amps were powered from dual or split supplies, and this is not the case in today's world of portable, battery-powered equipment. When op amps are powered from dual supplies (see Figure 4–1), the supplies are normally equal in magnitude, opposing in polarity, and the center tap of the supplies is connected to ground. Any input sources connected to ground are automatically referenced to the center of the supply voltage, so the output voltage is automatically referenced to ground.

Here is the image describtion:
```
The image depicts a schematic diagram of an inverting operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Input Voltage Source (VIN)**: On the left side of the diagram, there is a voltage source labeled \( V_{IN} \). This is the input signal that will be amplified by the op-amp circuit.

2. **Resistor \( R_G \)**: The input voltage \( V_{IN} \) is connected to the inverting input (marked with a minus sign) of the op-amp through a resistor labeled \( R_G \). This resistor is part of the feedback network and helps determine the gain of the amplifier.

3. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an operational amplifier, represented by a triangle. The op-amp has two inputs:
   - The inverting input (−) is connected to the input voltage \( V_{IN} \) through \( R_G \).
   - The non-inverting input (+) is connected to the ground.

4. **Feedback Resistor \( R_F \)**: There is a resistor labeled \( R_F \) connected between the output of the op-amp and the inverting input. This resistor forms the feedback loop, which is crucial for setting the gain of the amplifier.

5. **Power Supply**: The op-amp is powered by a dual power supply, with \( +V \) connected to the positive power supply terminal and \( -V \) connected to the negative power supply terminal. These connections are necessary for the proper operation of the op-amp.

6. **Output Voltage (VOUT)**: The output of the op-amp is labeled \( V_{OUT} \). This is the amplified and inverted version of the input voltage \( V_{IN} \).

7. **Gain Equation**: The gain of the inverting amplifier is given by the equation \( V_{OUT} = -V_{IN} \frac{R_F}{R_G} \). This equation indicates that the output voltage is the input voltage multiplied by the ratio of the feedback resistor \( R_F \) to the input resistor \( R_G \), with a negative sign indicating that the output is inverted relative to the input.

In summary, the image shows an inverting op-amp configuration where the input signal is inverted and amplified based on the ratio of two resistors, \( R_F \) and \( R_G \).
```

#### Figure 4–1. Split-Supply Op Amp Circuit

Single-supply systems do not have the convenient ground reference that dual-supply systems have, thus biasing must be employed to ensure that the output voltage swings between the correct voltages. Input sources connected to ground are actually connected to a supply rail in single-supply systems. This is analogous to connecting a dual-supply input to the minus power rail. This requirement for biasing the op amp inputs to achieve the desired output voltage swing complicates single-supply designs.

When the signal source is not referenced to ground (see Figure 4–2), the voltage difference between ground and the reference voltage is amplified along with the signal. Unless the reference voltage was inserted as a bias voltage, and such is not the case when the input signal is connected to ground, the reference voltage must be stripped from the signal so that the op amp can provide maximum dynamic range.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit configured as an inverting amplifier with a reference voltage. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal. The output is at the point of the triangle.

2. **Power Supply**: The op-amp is powered by a dual power supply, with +V connected to the positive supply terminal and -V connected to the negative supply terminal.

3. **Input Voltage (VIN)**: The input voltage source, labeled VIN, is connected to the left side of the circuit.

4. **Reference Voltage (VREF)**: A reference voltage source, labeled VREF, is connected to the ground.

5. **Resistors**:
   - **RG**: A resistor labeled RG is connected between the input voltage source (VIN) and the inverting input (-) of the op-amp.
   - **RF**: Another resistor labeled RF is connected between the output of the op-amp and the inverting input (-) of the op-amp, forming a feedback loop.

6. **Non-Inverting Input**: The non-inverting input (+) of the op-amp is connected to the ground.

7. **Output Voltage (VOUT)**: The output voltage, labeled VOUT, is taken from the output terminal of the op-amp.

8. **Equation**: The output voltage is given by the equation:
   \[
   V_{OUT} = - (V_{IN} + V_{REF}) \frac{R_F}{R_G}
   \]
   This indicates that the output voltage is the inverted and amplified sum of the input voltage (VIN) and the reference voltage (VREF), scaled by the ratio of the feedback resistor (RF) to the input resistor (RG).

In summary, this circuit is an inverting amplifier with an added reference voltage, where the output voltage is a scaled and inverted sum of the input and reference voltages.
```

Figure 4–2. Split-Supply Op Amp Circuit With Reference Voltage Input

An input bias voltage is used to eliminate the reference voltage when it must not appear in the output voltage (see Figure 4–3). The voltage, VREF, is in both input circuits, hence it is named a common-mode voltage. Voltage feedback op amps reject common-mode voltages because their input circuit is constructed with a differential amplifier (chosen because it has natural common-mode voltage rejection capabilities).

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit configured as an inverting amplifier. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two inputs and one output. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+). The op-amp is powered by a dual power supply, with +V and -V connected to the appropriate power pins.

2. **Input Voltage (VIN)**: The input voltage source, labeled VIN, is connected to the left side of the circuit. It is connected to a resistor labeled RG.

3. **Resistors (RG and RF)**: 
   - RG: There are two resistors labeled RG. One is connected between the input voltage source (VIN) and the inverting input of the op-amp. The other RG is connected between the non-inverting input of the op-amp and a reference voltage (VREF).
   - RF: There are also two resistors labeled RF. One is connected between the output of the op-amp and the inverting input, forming a feedback loop. The other RF is connected between the non-inverting input of the op-amp and ground.

4. **Reference Voltage (VREF)**: The reference voltage source, labeled VREF, is connected to the non-inverting input of the op-amp through a resistor RG. Additionally, VREF is connected to ground.

5. **Output Voltage (VOUT)**: The output voltage, labeled VOUT, is taken from the output of the op-amp. The equation for the output voltage is given as VOUT = -VIN (RF/RG), indicating that the circuit is an inverting amplifier with a gain determined by the ratio of the feedback resistor (RF) to the input resistor (RG).

6. **Ground Connections**: The circuit has several ground connections, including the reference voltage source (VREF) and the resistor RF connected to the non-inverting input of the op-amp.

In summary, this is an inverting amplifier circuit with a gain determined by the ratio of the feedback resistor (RF) to the input resistor (RG). The reference voltage (VREF) is applied to the non-inverting input to set a reference point for the op-amp.
```

Figure 4–3. Split-Supply Op Amp Circuit With Common-Mode Voltage

When signal sources are referenced to ground, single-supply op amp circuits exhibit a large input common-mode voltage. Figure 4–4 shows a single-supply op amp circuit that has its input voltage referenced to ground. The input voltage is not referenced to the midpoint of the supplies like it would be in a split-supply application, rather it is referenced to the lower power supply rail. This circuit does not operate when the input voltage is positive because the output voltage would have to go to a negative voltage, hard to do with a positive supply. It operates marginally with small negative input voltages because most op amps do not function well when the inputs are connected to the supply rails.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Input Voltage Source (VIN)**: On the left side of the circuit, there is a voltage source labeled \( V_{IN} \). This is the input signal that will be amplified by the op-amp.

2. **Resistor \( R_G \)**: Connected in series with the input voltage source \( V_{IN} \), there is a resistor labeled \( R_G \). This resistor is part of the feedback network.

3. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an operational amplifier, represented by a triangle symbol. The op-amp has two input terminals:
   - The inverting input (marked with a minus sign, -) is connected to the junction between \( R_G \) and \( R_F \).
   - The non-inverting input (marked with a plus sign, +) is connected to the ground.

4. **Feedback Resistor \( R_F \)**: There is a resistor labeled \( R_F \) connected between the output of the op-amp and the inverting input. This resistor forms the feedback loop, which determines the gain of the amplifier.

5. **Output Voltage (VOUT)**: The output of the op-amp is labeled \( V_{OUT} \). This is the amplified signal.

6. **Power Supply**: The op-amp is powered by a positive voltage supply labeled \( +V \). The negative power supply is not shown, but it is implied that the op-amp is powered by a dual supply (positive and negative voltages).

7. **Ground Connections**: The circuit has several ground connections, including the input voltage source, the non-inverting input of the op-amp, and the power supply.

In summary, this is a non-inverting amplifier circuit where the input signal \( V_{IN} \) is applied to the non-inverting input of the op-amp. The gain of the amplifier is determined by the resistors \( R_G \) and \( R_F \). The output voltage \( V_{OUT} \) is a scaled version of the input voltage, depending on the values of \( R_G \) and \( R_F \).
```

Figure 4–4. Single-Supply Op Amp Circuit

The constant requirement to account for inputs connected to ground or different reference voltages makes it difficult to design single-supply op amp circuits. Unless otherwise specified, all op amp circuits discussed in this chapter are single-supply circuits. The singlesupply may be wired with the negative or positive lead connected to ground, but as long as the supply polarity is correct, the wiring does not affect circuit operation.

Use of a single-supply limits the polarity of the output voltage. When the supply voltage VCC = 10 V, the output voltage is limited to the range 0 ≤ Vout ≤ 10. This limitation precludes negative output voltages when the circuit has a positive supply voltage, but it does not preclude negative input voltages when the circuit has a positive supply voltage. As long as the voltage on the op amp input leads does not become negative, the circuit can handle negative input voltages.

Beware of working with negative (positive) input voltages when the op amp is powered from a positive (negative) supply because op amp inputs are highly susceptible to reverse voltage breakdown. Also, insure that all possible start-up conditions do not reverse bias the op amp inputs when the input and supply voltage are opposite polarity.

# **4.2 Circuit Analysis**

The complexities of single-supply op amp design are illustrated with the following example. Notice that the biasing requirement complicates the analysis by presenting several conditions that are not realizable. It is best to wade through this material to gain an understanding of the problem, especially since a cookbook solution is given later in this chapter. The previous chapter assumed that the op amps were ideal, and this chapter starts to deal with op amp deficiencies. The input and output voltage swing of many op amps are limited as shown in Figure 4–7, but if one designs with the selected rail-to-rail op amps, the input/ output swing problems are minimized. The inverting circuit shown in Figure 4–5 is analyzed first.

Here is the image describtion:
```
The image depicts a summing amplifier circuit using an operational amplifier (op-amp). Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal. The output is at the tip of the triangle.

2. **Power Supply**: The op-amp is powered by a positive voltage supply denoted as +V. The negative supply is typically connected to ground, although it is not explicitly shown in the image.

3. **Input Voltages**: There are two input voltages:
   - \( V_{REF} \): This is the reference voltage connected to the non-inverting input (+) of the op-amp through a resistor \( R_G \).
   - \( V_{IN} \): This is the input voltage connected to the inverting input (-) of the op-amp through another resistor \( R_G \).

4. **Feedback Resistors**: There are two feedback resistors \( R_F \) connected from the output of the op-amp back to the inverting input (-) and the non-inverting input (+).

5. **Load Resistor**: There is a load resistor \( R_L \) connected from the output of the op-amp to ground.

6. **Ground Connections**: The non-inverting input (+) is connected to ground through a resistor \( R_F \), and the inverting input (-) is connected to ground through another resistor \( R_F \).

7. **Output Voltage**: The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

In summary, this is a summing amplifier configuration where the output voltage \( V_{OUT} \) is a weighted sum of the input voltages \( V_{REF} \) and \( V_{IN} \). The resistors \( R_G \) and \( R_F \) determine the gain and the contribution of each input voltage to the output.
```

### Figure 4–5. Inverting Op Amp

Equation 4–1 is written with the aid of superposition, and simplified algebraically, to acquire Equation 4–2.

$$\mathbb{V}\_{\text{OUT}} = \mathbb{V}\_{\text{REF}} \left( \frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{\text{G}} + \mathsf{R}\_{\text{F}}} \right) \left( \frac{\mathsf{R}\_{\text{F}} + \mathsf{R}\_{\text{G}}}{\mathsf{R}\_{\text{G}}} \right) - \mathbb{V}\_{\text{IN}} \frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{\text{G}}} \tag{4-1}$$

$$
\mathbb{V}\_{\mathsf{OUT}} = (\mathbb{V}\_{\mathsf{REF}} - \mathbb{V}\_{\mathsf{IN}}) \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-2}
$$

As long as the load resistor, RL, is a large value, it does not enter into the circuit calculations, but it can introduce some second order effects such as limiting the output voltage swings. Equation 4–3 is obtained by setting VREF equal to VIN, and there is no output voltage from the circuit regardless of the input voltage. The author unintentionally designed a few of these circuits before he created an orderly method of op amp circuit design. Actually, a real circuit has a small output voltage equal to the lower transistor saturation voltage, which is about 150 mV for a TLC07X.

$$
\boldsymbol{\nabla}\_{\mathbf{OUT}} = (\boldsymbol{\nabla}\_{\mathbf{REF}} - \boldsymbol{\nabla}\_{\mathbb{IN}}) \frac{\mathbf{R}\_{\mathbb{F}}}{\mathbf{R}\_{\mathbb{G}}} = (\boldsymbol{\nabla}\_{\mathbb{IN}} - \boldsymbol{\nabla}\_{\mathbb{IN}}) \frac{\mathbf{R}\_{\mathbb{F}}}{\mathbf{R}\_{\mathbb{G}}} = \mathbf{0} \tag{4-3}
$$

When VREF = 0, VOUT = -VIN(RF/RG), there are two possible solutions to Equation 4–2. First, when VIN is any positive voltage, VOUT should be negative voltage. The circuit can not achieve a negative voltage with a positive supply, so the output saturates at the lower power supply rail. Second, when VIN is any negative voltage, the output spans the normal range according to Equation 4–5.

$$\mathbb{V}\_{\mathsf{IN}} \ge \mathbf{0}, \qquad \mathbb{V}\_{\mathsf{OUT}} = \mathbf{0} \tag{4-4}$$

$$\mathsf{V}\_{\mathsf{IN}} \leq \mathsf{0}, \qquad \mathsf{V}\_{\mathsf{OUT}} = |\mathsf{V}\_{\mathsf{IN}}| \, \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-5}$$

When VREF equals the supply voltage, VCC, we obtain Equation 4–6. In Equation 4–6, when VIN is negative, VOUT should exceed VCC; that is impossible, so the output saturates. When VIN is positive, the circuit acts as an inverting amplifier.

$$\mathbf{V\_{OUT}} = (\mathbf{V\_{CC}} - \mathbf{V\_{IN}}) \frac{\mathbf{R\_{F}}}{\mathbf{R\_{G}}} \tag{4-6}$$

The transfer curve for the circuit shown in Figure 4–6 (VCC = 5 V, RG = RF = 100 kΩ, RL = 10 kΩ) is shown in Figure 4–7.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Input Voltage Source (VIN)**: On the left side of the circuit, there is a voltage source labeled \( V_{IN} \). This is the input signal that will be amplified by the op-amp.

2. **Resistors (RG and RF)**: 
   - There are two resistors labeled \( R_G \) connected in series with the input voltage source \( V_{IN} \). One \( R_G \) is connected between \( V_{IN} \) and the non-inverting input (+) of the op-amp.
   - Another \( R_G \) is connected between the non-inverting input (+) and ground.
   - There are two feedback resistors labeled \( R_F \). One \( R_F \) is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input (-) of the op-amp.
   - Another \( R_F \) is connected between the inverting input (-) and ground.

3. **Operational Amplifier (Op-Amp)**: 
   - The op-amp is depicted as a triangle with the inverting input (-) and non-inverting input (+) on the left side and the output on the right side.
   - The non-inverting input (+) is connected to the junction of the two \( R_G \) resistors.
   - The inverting input (-) is connected to the junction of the two \( R_F \) resistors.

4. **Power Supply (VCC)**: 
   - The op-amp is powered by a voltage supply labeled \( V_{CC} \). This is connected to the positive power supply pin of the op-amp.
   - The ground symbol is connected to the negative power supply pin of the op-amp.

5. **Load Resistor (RL)**: 
   - There is a load resistor labeled \( R_L \) connected between the output of the op-amp (\( V_{OUT} \)) and ground.

6. **Output Voltage (VOUT)**: 
   - The output voltage \( V_{OUT} \) is taken from the output pin of the op-amp.

In summary, this is a non-inverting amplifier configuration where the input signal \( V_{IN} \) is applied to the non-inverting input of the op-amp through a resistor \( R_G \). The feedback network consists of resistors \( R_F \) and \( R_G \), which determine the gain of the amplifier. The output voltage \( V_{OUT} \) is taken from the output of the op-amp and is connected to a load resistor \( R_L \).
```

Figure 4–6. Inverting Op Amp With VCC Bias

Here is the image describtion:
```
The image is a graph that plots the input voltage (V_IN) against the output voltage (V_OUT) for several operational amplifiers (op-amps). The x-axis represents the output voltage (V_OUT) ranging from 0.0 to 5.0 volts, while the y-axis represents the input voltage (V_IN) ranging from 0.0 to 5.5 volts.

The graph includes curves for different op-amp models, specifically the TL072, TLV2472, LM358, and TLC272. Each curve shows how the input voltage varies with the output voltage for each op-amp.

- The TL072 curve is shown twice, once in the lower left quadrant and once in the upper right quadrant. In the lower left, it starts at (0,0) and rises steeply, while in the upper right, it starts around (4.5, 4.0) and rises sharply.
- The TLV2472 curve starts at (0,0) and rises steeply, similar to the TL072 in the lower left quadrant.
- The LM358 and TLC272 curves are very close to each other, starting at (0,0) and rising steeply, but they are slightly to the right of the TLV2472 curve.

The graph also includes a diagonal line that represents the ideal linear relationship between V_IN and V_OUT, where V_IN equals V_OUT. This line extends from the bottom left corner (0,0) to the top right corner (5.0, 5.0).

The curves for the op-amps show deviations from this ideal line, indicating the non-linear behavior of the op-amps at different voltage levels. The TL072, in particular, shows significant deviation at higher voltages, while the TLV2472, LM358, and TLC272 show less deviation and are closer to the ideal line.
```

Figure 4–7. Transfer Curve for Inverting Op Amp With VCC Bias

Four op amps were tested in the circuit configuration shown in Figure 4–6. Three of the old generation op amps, LM358, TL07X, and TLC272 had output voltage spans of 2.3 V to 3.75 V. This performance does not justify the ideal op amp assumption that was made in the previous chapter unless the output voltage swing is severely limited. Limited output or input voltage swing is one of the worst deficiencies a single-supply op amp can have because the limited voltage swing limits the circuit's dynamic range. Also, limited voltage swing frequently results in distortion of large signals. The fourth op amp tested was the newer TLV247X, which was designed for rail-to-rail operation in single-supply circuits. The TLV247X plotted a perfect curve (results limited by the instrumentation), and it amazed the author with a textbook performance that justifies the use of ideal assumptions. Some of the older op amps must limit their transfer equation as shown in Equation 4–7.

$$\mathsf{V}\_{\mathsf{OUT}} = (\mathsf{V}\_{\mathsf{CC}} - \mathsf{V}\_{\mathsf{IN}}) \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \quad \text{for} \quad \mathsf{V}\_{\mathsf{O}\mathsf{H}} \ge \mathsf{V}\_{\mathsf{OUT}} \ge \mathsf{V}\_{\mathsf{O}\mathsf{L}} \tag{4-7}$$

The noninverting op amp circuit is shown in Figure 4–8. Equation 4–8 is written with the aid of superposition, and simplified algebraically, to acquire Equation 4–9.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \left( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{F}}} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) - \mathsf{V}\_{\mathsf{R}\mathsf{EF}} \, \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-8}$$

$$
\mathbb{V}\_{\mathsf{OUT}} = \left(\mathbb{V}\_{\mathsf{IN}} - \mathbb{V}\_{\mathsf{REF}}\right) \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-9}
$$

When VREF = 0, VOUT VIN RF RG , there are two possible circuit solutions. First, when VIN is a negative voltage, VOUT must be a negative voltage. The circuit can not achieve a negative output voltage with a positive supply, so the output saturates at the lower power supply rail. Second, when VIN is a positive voltage, the output spans the normal range as shown by Equation 4–11.

$$\mathbb{V}\_{\mathsf{IN}} \le \mathsf{0}, \qquad \mathbb{V}\_{\mathsf{OUT}} = \mathsf{0} \tag{4-70}$$

$$\mathsf{V}\_{\mathsf{IN}} \geq \mathsf{0}, \qquad \mathsf{V}\_{\mathsf{OUT}} = \mathsf{V}\_{\mathsf{IN}} \tag{4-\mathsf{M}}$$

The noninverting op amp circuit is shown in Figure 4–8 with VCC = 5 V, RG = RF = 100 kΩ, and RL = 10 kΩ. The transfer curve for this circuit is shown in Figure 4–9; a TLV247X serves as the op amp.

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two input terminals and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+).

2. **Power Supply (Vcc)**: The op-amp is powered by a voltage source labeled Vcc, connected to the positive power supply pin of the op-amp. The negative power supply pin is connected to the ground.

3. **Resistors (RG and RF)**: There are four resistors in the circuit, labeled RG and RF. Two RG resistors are connected to the inverting and non-inverting inputs of the op-amp, and two RF resistors are part of the feedback network.

4. **Voltage Sources (VREF and VIN)**: 
   - VREF is a reference voltage source connected to the inverting input of the op-amp through an RG resistor.
   - VIN is the input voltage connected to the non-inverting input of the op-amp through another RG resistor.

5. **Feedback Network**: 
   - One RF resistor is connected between the output of the op-amp and the inverting input.
   - Another RF resistor is connected from the inverting input to the ground.

6. **Output (VOUT)**: The output voltage of the op-amp is labeled VOUT, which is taken from the output terminal of the op-amp.

7. **Ground Connections**: The circuit has several ground connections, including the negative terminal of the voltage sources, the negative power supply pin of the op-amp, and the bottom ends of the resistors connected to the inverting input.

This configuration suggests a differential amplifier setup, where the output voltage (VOUT) is a function of the difference between the input voltages (VIN and VREF), scaled by the resistor network.
```

Figure 4–8. Noninverting Op Amp

Here is the image describtion:
```
The image is a graph that plots the input voltage (V_IN) against the output voltage (V_OUT) for a specific electronic component, the TLV2472. The graph has a linear relationship, indicating that the input voltage is directly proportional to the output voltage. 

Here are the details of the graph:

- The x-axis represents the output voltage (V_OUT) in volts, ranging from 0 to 5 volts.
- The y-axis represents the input voltage (V_IN) in volts, also ranging from 0 to 5 volts.
- The graph features a straight line that passes through the origin (0,0) and extends to the point (5,5), indicating a 1:1 ratio between the input and output voltages.
- The line is labeled with "TLV2472," which is the model number of the component being characterized.
- The line is perfectly diagonal, suggesting that for every 1-volt increase in the output voltage, there is a corresponding 1-volt increase in the input voltage.

The graph is likely used to demonstrate the linearity and performance of the TLV2472 component in terms of its voltage transfer characteristics.
```

Figure 4–9. Transfer Curve for Noninverting Op Amp

There are many possible variations of inverting and noninverting circuits. At this point many designers analyze these variations hoping to stumble upon the one that solves the circuit problem. Rather than analyze each circuit, it is better to learn how to employ simultaneous equations to render specified data into equation form. When the form of the desired equation is known, a circuit that fits the equation is chosen to solve the problem. The resulting equation must be a straight line, thus there are only four possible solutions.

# **4.3 Simultaneous Equations**

Taking an orderly path to developing a circuit that works the first time starts here; follow these steps until the equation of the op amp is determined. Use the specifications given for the circuit coupled with simultaneous equations to determine what form the op amp equation must have. Go to the section that illustrates that equation form (called a case), solve the equation to determine the resistor values, and you have a working solution.

A linear op amp transfer function is limited to the equation of a straight line (Equation 4–12).

$$
\mathbf{y} = \pm \text{ иx} \pm \text{ b} \tag{4-12}
$$

The equation of a straight line has four possible solutions depending upon the sign of m, the slope, and b, the intercept; thus simultaneous equations yield solutions in four forms. Four circuits must be developed; one for each form of the equation of a straight line. The four equations, cases, or forms of a straight line are given in Equations 4–13 through 4–16, where electronic terminology has been substituted for math terminology.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{ + } \mathsf{mV}\_{\mathsf{N}} + \mathsf{b} \tag{4-13}$$

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{\mathsf{I}} + \mathsf{mV}\_{\mathsf{IN}} - \mathsf{b} \tag{4-14}$$

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{mV}\_{\mathsf{IN}} + \mathsf{b} \tag{4-15}$$

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{mV}\_{\mathsf{IN}} - \mathsf{b} \tag{4-16}$$

Given a set of two data points for VOUT and VIN, simultaneous equations are solved to determine m and b for the equation that satisfies the given data. The sign of m and b determines the type of circuit required to implement the solution. The given data is derived from the specifications; i. e., a sensor output signal ranging from 0.1 V to 0.2 V must be interfaced into an analog-to-digital converter that has an input voltage range of 1 V to 4 V. These data points (VOUT = 1 V @ VIN = 0.1 V, VOUT = 4 V @ VIN = 0.2 V) are inserted into Equation 4–13, as shown in Equations 4–17 and 4–18, to obtain m and b for the specifications.

$$\mathsf{T} = \mathsf{m}(\mathsf{O}.\mathsf{t}) + \mathsf{b} \tag{4-17}$$

$$\mathbf{4} = \mathfrak{m}\langle \mathbf{0}.\mathbf{2}\rangle + \mathfrak{b} \tag{4-48}$$

Multiply Equation 4–17 by 2 and subtract it from Equation 4–18.

$$\mathbf{2} = \mathfrak{m}\langle \mathbf{0}, \mathbf{2} \rangle + \mathbf{2}\mathfrak{b} \tag{4-\mathfrak{l}\mathfrak{g}}$$

$$\mathbf{b} = -\mathbf{2} \tag{4-20}$$

After algebraic manipulation of Equation 4–17, substitute Equation 4–20 into Equation 4–17 to obtain Equation 4–21.

$$\mathbf{m} = \frac{\mathbf{2} + \mathbf{1}}{\mathbf{0} \mathbf{1}} = \mathbf{30} \tag{4-21}$$

Now m and b are substituted back into Equation 4–13 yielding Equation 4–22.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{30V}\_{\mathsf{N}} - \mathsf{2} \tag{4-22}$$

Notice, although Equation 4–13 was the starting point, the form of Equation 4–22 is identical to the format of Equation 4–14. The specifications or given data determine the sign of m and b, and starting with Equation 4–13, the final equation form is discovered after m and b are calculated. The next step required to complete the problem solution is to develop a circuit that has an m = 30 and b = –2. Circuits were developed for Equations 4–13 through 4–16, and they are given under the headings Case 1 through Case 4 respectively. There are different circuits that will yield the same equations, but these circuits were selected because they do not require negative references.

# **4.3.1 Case 1: VOUT = +mVIN+b**

The circuit configuration that yields a solution for Case 1 is shown in Figure 4–10. The figure includes two 0.01-µF capacitors. These capacitors are called decoupling capacitors, and they are included to reduce noise and provide increased noise immunity. Sometimes two 0.01-µF capacitors serve this purpose, sometimes more extensive filtering is needed, and sometimes one capacitor serves this purpose. Special attention must be paid to the regulation and noise content of VCC when VCC is used as a reference because some portion of the noise content of VCC will be multiplied by the circuit gain.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with various components connected to it. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal. The output is at the point of the triangle.

2. **Power Supply**: The op-amp is powered by a voltage source labeled \( V_{CC} \). A 0.01 µF capacitor is connected between \( V_{CC} \) and ground to filter out noise and stabilize the power supply.

3. **Input Voltage (\( V_{IN} \))**: The input voltage source \( V_{IN} \) is connected to the left side of the circuit. A 0.01 µF capacitor is connected in series with \( V_{IN} \) to block any DC component and allow only AC signals to pass through.

4. **Resistors \( R_1 \) and \( R_2 \)**: The input signal \( V_{IN} \) passes through resistor \( R_1 \) and then connects to a node that is also connected to resistor \( R_2 \). The other end of \( R_2 \) is connected to the inverting input (-) of the op-amp.

5. **Reference Voltage (\( V_{REF} \))**: A reference voltage source \( V_{REF} \) is connected to the same node where \( R_1 \) and \( R_2 \) meet. This reference voltage sets a baseline for the input signal.

6. **Feedback Network**: The feedback network consists of two resistors, \( R_F \) and \( R_G \). \( R_F \) is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input (-). \( R_G \) is connected between the inverting input (-) and ground.

7. **Load Resistor (\( R_L \))**: The output of the op-amp (\( V_{OUT} \)) is connected to a load resistor \( R_L \), which is connected to ground.

The circuit appears to be a configuration for an inverting amplifier with a reference voltage. The input signal \( V_{IN} \) is processed by the op-amp, and the output \( V_{OUT} \) is influenced by the feedback network and the reference voltage \( V_{REF} \). The capacitors in the circuit are used for filtering purposes to ensure stable operation and to block DC components where necessary.
```

Figure 4–10. Schematic for Case1: VOUT = +mVIN + b

The circuit equation is written using the voltage divider rule and superposition.

Single-Supply Op Amp Design Techniques 4-9

$$\mathbb{V}\_{\rm OUT} = \mathbb{V}\_{\rm IN} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) + \mathbb{V}\_{\rm REF} \left( \frac{\mathsf{R}\_1}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) \tag{4-23}$$

The equation of a straight line (case 1) is repeated in Equation 4–24 below so comparisons can be made between it and Equation 4–23.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{mV}\_{\mathsf{IN}} + \mathsf{b} \tag{4-24}$$

Equating coefficients yields Equations 4–25 and 4–26.

$$\mathbf{m} = \left(\frac{\mathbf{R\_2}}{\mathbf{R\_1} + \mathbf{R\_2}}\right) \left(\frac{\mathbf{R\_F} + \mathbf{R\_G}}{\mathbf{R\_G}}\right) \tag{4-25}$$

$$\mathbf{b} = \mathbb{V}\_{\mathsf{REF}} \left( \frac{\mathsf{R}\_1}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) \tag{4-26}$$

Example; the circuit specifications are VOUT = 1 V at VIN = 0.01 V, VOUT = 4.5 V at VIN = 1 V, RL = 10 k, five percent resistor tolerances, and VCC = 5 V. No reference voltage is available, thus VCC is used for the reference input, and VREF = 5 V. A reference voltage source is left out of the design as a space and cost savings measure, and it sacrifices noise performance, accuracy, and stability performance. Cost is an important specification, but the VCC supply must be specified well enough to do the job. Each step in the subsequent design procedure is included in this analysis to ease learning and increase boredom. Many steps are skipped when subsequent cases are analyzed.

The data is substituted into simultaneous equations.

$$\mathbf{M} = \mathbf{m}(\mathbf{0.04}) + \mathbf{b} \tag{4-27}$$

$$\mathbf{4.5} = \mathbf{m(4.0)} + \mathbf{b} \tag{4-28}$$

Equation 4–27 is multiplied by 100 (Equation 4–29) and Equation 4–28 is subtracted from Equation 4–29 to obtain Equation 4–30.

$$\mathbf{\dot{}}\mathbf{\bullet}\mathbf{0} = \mathbf{m}(\mathbf{\bullet}, \mathbf{0}) + \mathbf{\dot{}}\mathbf{\bullet}\mathbf{0}\mathbf{b} \tag{4-29}$$

$$\mathbf{b} = \frac{\mathbf{95.5}}{\mathbf{99}} = \mathbf{0.9646} \tag{4-30}$$

The slope of the transfer function, m, is obtained by substituting b into Equation 4–27.

$$\mathbf{m} = \frac{\mathbf{1} \mathbf{-b}}{\mathbf{0}.04} = \frac{\mathbf{1} \mathbf{-0}.9646}{\mathbf{0}.04} = \mathbf{3}.535\tag{4-34}$$

Now that b and m are calculated, the resistor values can be calculated. Equations 4–25 and 4–26 are solved for the quantity (RF + RG)/RG, and then they are set equal in Equation 4–32 thus yielding Equation 4–33.

$$\frac{\mathbf{R\_{F}} + \mathbf{R\_{G}}}{\mathbf{R\_{G}}} = \mathbf{m} \left( \frac{\mathbf{R\_{1}} + \mathbf{R\_{2}}}{\mathbf{R\_{2}}} \right) = \frac{\mathbf{b}}{\mathbf{V\_{CC}}} \left( \frac{\mathbf{R\_{1}} + \mathbf{R\_{2}}}{\mathbf{R\_{1}}} \right) \tag{4-32}$$

$$\mathbf{R}\_2 = \frac{\mathbf{3.535}}{\mathbf{0.9646}} \mathbf{R}\_1 = \mathbf{18.316R}\_1 \tag{4-33}$$

Five percent tolerance resistors are specified for this design, so we choose R1 = 10 kΩ, and that sets the value of R2 = 183.16 kΩ. The closest 5% resistor value to 183.16 kΩ is 180 kΩ; therefore, select R1 = 10 kΩ and R2 = 180 kΩ. Being forced to yield to reality by choosing standard resistor values means that there is an error in the circuit transfer function because m and b are not exactly the same as calculated. The real world constantly forces compromises into circuit design, but the good circuit designer accepts the challenge and throws money or brains at the challenge. Resistor values closer to the calculated values could be selected by using 1% or 0.5% resistors, but that selection increases cost and violates the design specification. The cost increase is hard to justify except in precision circuits. Using ten-cent resistors with a ten-cent op amp usually is false economy.

The left half of Equation 4–32 is used to calculate RF and RG.

$$\frac{\mathbf{R\_{F}} + \mathbf{R\_{G}}}{\mathbf{R\_{G}}} = \mathbf{m} \left( \frac{\mathbf{R\_{1}} + \mathbf{R\_{2}}}{\mathbf{R\_{2}}} \right) = 3.535 \left( \frac{180 + 10}{180} \right) = 3.73 \tag{4-34}$$

$$\mathsf{R}\_{\mathsf{F}} = \mathsf{2.73R}\_{\mathsf{G}} \tag{4-35}$$

The resulting circuit equation is given below.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{3.5V}\_{\mathsf{IN}} + \mathsf{0.97} \tag{4-36}$$

The gain setting resistor, RG, is selected as 10 kΩ, and 27 kΩ, the closest 5% standard value is selected for the feedback resistor, RF. Again, there is a slight error involved with standard resistor values. This circuit must have an output voltage swing from 1 V to 4.5 V. The older op amps can not be used in this circuit because they lack dynamic range, so the TLV247X family of op amps is selected. The data shown in Figure 4–7 confirms the op amp selection because there is little error. The circuit with the selected component values is shown in Figure 4–11. The circuit was built with the specified components, and the transfer curve is shown in Figure 4–12.

Single-Supply Op Amp Design Techniques 4-11

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit designed to amplify an input voltage (VIN) ranging from 0.01 V to 1 V. The circuit includes various resistors, capacitors, and a power supply to achieve the desired output voltage (VOUT) range of 1.0 V to 4.5 V. Here is a detailed description of the components and their connections:

1. **Input Voltage (VIN)**: The input voltage source is labeled as VIN, which varies from 0.01 V to 1 V. This source is connected to the left side of the circuit.

2. **Capacitor (0.01 µF)**: A 0.01 µF capacitor is connected between the input voltage source and ground, likely serving as a decoupling capacitor to filter out noise.

3. **Resistor (R1)**: A 10 kΩ resistor (R1) is connected in series with the input voltage source.

4. **Voltage Divider Network**:
   - **Resistor (R2)**: An 180 kΩ resistor (R2) is connected between the junction of R1 and the non-inverting input (+) of the op-amp and a +5V power supply.
   - **Capacitor (0.01 µF)**: Another 0.01 µF capacitor is connected between the junction of R2 and the +5V power supply and ground.

5. **Operational Amplifier (Op-Amp)**: The op-amp has its non-inverting input (+) connected to the junction of R1 and R2. The inverting input (-) is connected to a feedback network.

6. **Feedback Network**:
   - **Resistor (RF)**: A 27 kΩ resistor (RF) is connected between the output of the op-amp and the inverting input (-).
   - **Resistor (RG)**: A 10 kΩ resistor (RG) is connected between the inverting input (-) and ground.

7. **Load Resistor (RL)**: A 10 kΩ resistor (RL) is connected between the output of the op-amp and ground.

8. **Power Supply**: The op-amp is powered by a +5V supply, with a 0.01 µF capacitor connected between the +5V supply and ground to filter out any noise.

9. **Output Voltage (VOUT)**: The output voltage (VOUT) is taken from the output of the op-amp and ranges from 1.0 V to 4.5 V.

In summary, the circuit is a non-inverting amplifier with a specific gain set by the resistors in the feedback network (RF and RG). The input voltage is filtered and amplified to produce an output voltage within the specified range. The capacitors in the circuit help to stabilize the voltage and filter out noise.
```

Figure 4–11.Case 1 Example Circuit

Here is the image describtion:
```
The image is a graph that plots the relationship between input voltage (V_IN) and output voltage (V_OUT) for a device labeled TLV247x. The x-axis represents the output voltage (V_OUT) in volts, ranging from 0 to 5 volts. The y-axis represents the input voltage (V_IN) in volts, ranging from 0 to 1 volt.

The graph features a single, straight line that starts at the origin (0,0) and extends diagonally upwards to the right, indicating a linear relationship between the input and output voltages. The line passes through the points (1, 0.2), (2, 0.4), (3, 0.6), and (4, 0.8), suggesting that for every 1-volt increase in output voltage, the input voltage increases by 0.2 volts. 

An arrow labeled "TLV247x" points to the line, indicating that this linear relationship is characteristic of the TLV247x device. The graph is divided into a grid with both axes marked at intervals of 0.1 volts for the y-axis and 1 volt for the x-axis, providing a clear and detailed representation of the voltage relationship.
```

Figure 4–12. Case 1 Example Circuit Measured Transfer Curve

The transfer curve shown is a straight line, and that means that the circuit is linear. The VOUT intercept is about 0.98 V rather than 1 V as specified, and this is excellent performance considering that the components were selected randomly from bins of resistors. Different sets of components would have slightly different slopes because of the resistor tolerances. The TLV247X has input bias currents and input offset voltages, but the effect of these errors is hard to measure on the scale of the output voltage. The output voltage measured 4.53 V when the input voltage was 1 V. Considering the low and high input voltage errors, it is safe to conclude that the resistor tolerances have skewed the gain slightly, but this is still excellent performance for 5% components. Often lab data similar to that shown here is more accurate than the 5% resistor tolerance, but do not fall into the trap of expecting this performance, because you will be disappointed if you do.

The resistors were selected in the k-Ω range arbitrarily. The gain and offset specifications determine the resistor ratios, but supply current, frequency response, and op amp drive capability determine their absolute values. The resistor value selection in this design is high because modern op amps do not have input current offset problems, and they yield reasonable frequency response. If higher frequency response is demanded, the resistor values must decrease, and resistor value decreases reduce input current errors, while supply current increases. When the resistor values get low enough, it becomes hard for another circuit, or possibly the op amp, to drive the resistors.

# **4.3.2 Case 2: VOUT = +mVIN – b**

The circuit shown in Figure 4–13 yields a solution for Case 2. The circuit equation is obtained by taking the Thevenin equivalent circuit looking into the junction of R1 and R2. After the R1, R2 circuit is replaced with the Thevenin equivalent circuit, the gain is calculated with the ideal gain equation (Equation 4–37).

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit with a voltage reference and input voltage sources. Here is a detailed description of the circuit components and their connections:

1. **Voltage Sources:**
   - **V_REF:** This is a voltage reference source connected to the non-inverting input (+) of the op-amp through a resistor R1.
   - **V_IN:** This is the input voltage source connected to the non-inverting input (+) of the op-amp.

2. **Resistors:**
   - **R1:** Connected between V_REF and the node where R2 and R_G meet.
   - **R2:** Connected between the node where R1 and R_G meet and ground.
   - **R_G:** Connected between the node where R1 and R2 meet and the non-inverting input (+) of the op-amp.
   - **R_F:** Connected between the output (V_OUT) and the inverting input (-) of the op-amp.
   - **R_L:** Connected between the output (V_OUT) and ground.

3. **Capacitor:**
   - A 0.01 µF capacitor is connected between the power supply (V_CC) and ground.

4. **Operational Amplifier (Op-Amp):**
   - The op-amp has its non-inverting input (+) connected to the node where R_G, R1, and R2 meet.
   - The inverting input (-) is connected to the feedback resistor R_F.
   - The output of the op-amp is labeled as V_OUT.
   - The op-amp is powered by a supply voltage V_CC.

5. **Connections:**
   - The non-inverting input (+) of the op-amp receives a combined voltage from V_REF and V_IN through the resistors R1, R2, and R_G.
   - The inverting input (-) of the op-amp is connected to the output (V_OUT) through the feedback resistor R_F.
   - The output (V_OUT) is also connected to ground through the load resistor R_L.

This configuration suggests a non-inverting amplifier setup where the output voltage (V_OUT) is a function of the input voltage (V_IN) and the reference voltage (V_REF), with the gain determined by the resistors R_F, R1, R2, and R_G.
```

Figure 4–13. Schematic for Case 2: VOUT = +mVIN – <sup>b</sup>

$$\mathbb{V}\_{\rm OUT} = \mathbb{V}\_{\rm IN} \left( \frac{\mathsf{R}\_{\rm F} + \mathsf{R}\_{\rm G} + \mathsf{R}\_{\rm 1} \parallel \mathsf{R}\_{\rm 2}}{\mathsf{R}\_{\rm G} + \mathsf{R}\_{\rm 1} \parallel \mathsf{R}\_{\rm 2}} \right) - \mathbb{V}\_{\rm REF} \left( \frac{\mathsf{R}\_{\rm 2}}{\mathsf{R}\_{\rm 1} + \mathsf{R}\_{\rm 2}} \right) \left( \frac{\mathsf{R}\_{\rm F}}{\mathsf{R}\_{\rm G} + \mathsf{R}\_{\rm 1} \parallel \mathsf{R}\_{\rm 2}} \right) \tag{4-37}$$

Comparing terms in Equations 4–37 and 4–14 enables the extraction of m and b.

$$\mathfrak{m} = \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{I}} \parallel \mathsf{R}\_{\mathsf{2}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{I}} \parallel \mathsf{R}\_{\mathsf{2}}} \tag{4-38}$$

$$\left|\mathbf{b}\right| = \mathbb{V}\_{\mathsf{REF}} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_F}{\mathsf{R}\_G + \mathsf{R}\_1 \parallel \mathsf{R}\_2} \right) \tag{4-39}$$

The specifications for an example design are: VOUT = 1.5 V @ VIN = 0.2 V, VOUT = 4.5 V @ VIN = 0.5 V, VREF = VCC = 5 V, RL = 10 kΩ, and 5% resistor tolerances. The simultaneous equations, (Equations 4–40 and 4–41), are written below.

$$\mathbf{M} \mathbf{.} \mathbf{5} = \mathbf{0}.2\mathbf{m} + \mathbf{b} \tag{4-40}$$

$$\mathbf{4.5} = \mathbf{0.5m} + \mathbf{b} \tag{4-4\uparrow}$$

From these equations we find that b = -0.5 and m = 10. Making the assumption that R1||R2<<RG simplifies the calculations of the resistor values.

$$\mathbf{m} = \mathbf{10} = \frac{\mathbf{R\_{\tilde{F}}} + \mathbf{R\_{G}}}{\mathbf{R\_{G}}} \tag{4-42}$$

$$
\mathfrak{R}\_{\mathbb{F}} = \mathfrak{GR}\_{\mathbb{G}} \tag{4-43}
$$

Let RG = 20 kΩ, and then RF = 180 kΩ.

$$\mathbf{b} = \mathbb{V}\_{\text{CC}} \begin{pmatrix} \mathbf{R}\_{\text{F}} \\ \mathbf{R}\_{\text{G}} \end{pmatrix} \begin{pmatrix} \mathbf{R}\_{2} \\ \mathbf{R}\_{1} + \mathbf{R}\_{2} \end{pmatrix} = \mathbf{5} \begin{pmatrix} \mathbf{180} \\ \mathbf{20} \end{pmatrix} \begin{pmatrix} \mathbf{R}\_{2} \\ \mathbf{R}\_{1} + \mathbf{R}\_{2} \end{pmatrix} \tag{4-44}$$

$$\mathbf{R}\_1 = \frac{\mathbf{1} \mathbf{-0.01111}}{\mathbf{0.011111}} \mathbf{R}\_2 = \mathbf{89R}\_2 \tag{4-45}$$

Select R2 = 0.82 kΩ and R1 equals 72.98 kΩ. Since 72.98 kΩ is not a standard 5% resistor value, R1 is selected as 75 kΩ. The difference between the selected and calculated value of R1 has about a 3% effect on b, and this error shows up in the transfer function as an intercept rather than a slope error. The parallel resistance of R1 and R2 is approximately 0.82 kΩ and this is much less than RG, which is 20 kΩ, thus the earlier assumption that RG >> R1||R2 is justified. R2 could have been selected as a smaller value, but the smaller values yielded poor standard 5% values for R1. The final circuit is shown in Figure 4–14 and the measured transfer curve for this circuit is shown in Figure 4–15.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a non-inverting configuration. Here is a detailed description of the components and their connections:

1. **Power Supply:**
   - The circuit is powered by a +5V supply.

2. **Resistors:**
   - **R1:** 75 kΩ resistor connected between the +5V supply and the junction of RG and a capacitor.
   - **R2:** 820 Ω resistor connected between the input voltage source (VIN) and ground.
   - **RG:** 20 kΩ resistor connected between the junction of R1 and the non-inverting input (+) of the op-amp.
   - **RF:** 180 kΩ resistor connected between the output (VOUT) and the inverting input (-) of the op-amp.
   - **RL:** 10 kΩ resistor connected between the output (VOUT) and ground.

3. **Capacitors:**
   - **0.01 μF capacitor:** Connected between the junction of R1 and RG to ground.
   - **0.01 μF capacitor:** Connected between the +5V supply and the non-inverting input (+) of the op-amp.

4. **Operational Amplifier (Op-Amp):**
   - The op-amp has its non-inverting input (+) connected to the junction of RG and the capacitor.
   - The inverting input (-) is connected to the junction of RF and the output (VOUT).
   - The output (VOUT) is connected to RF and RL.

5. **Voltage Source:**
   - **VIN:** The input voltage source is connected to the junction of R2 and ground.

6. **Connections:**
   - The non-inverting input (+) of the op-amp receives the signal through RG.
   - The inverting input (-) of the op-amp is part of the feedback loop through RF.
   - The output (VOUT) is taken from the op-amp and connected to RL and RF.

This circuit is designed to amplify the input signal (VIN) with the op-amp providing a gain determined by the resistors RF and RG. The capacitors are likely used for filtering or stabilizing the circuit.
```

Figure 4–14. Case 2 Example Circuit

Here is the image describtion:
```
The image is a graph with a grid layout, showing the relationship between input voltage (V_IN) and output voltage (V_OUT). The x-axis represents the output voltage (V_OUT) ranging from 0 to 5 volts, while the y-axis represents the input voltage (V_IN) ranging from 0.1 to 0.5 volts. 

A diagonal line labeled "TLV247x" runs from the bottom left to the top right of the graph, indicating a linear relationship between the input and output voltages. The line starts at approximately (0.5, 0.2) and ends at approximately (4.5, 0.5). The slope of the line suggests that as the output voltage increases, the input voltage also increases proportionally. 

The graph is divided into smaller squares by grid lines, which help in estimating the values of the input and output voltages at different points along the line. The label "TLV247x" likely refers to a specific model or series of electronic components, such as an operational amplifier or voltage regulator, which exhibits this particular voltage relationship.
```

Figure 4–15. Case 2 Example Circuit Measured Transfer Curve

The TLV247X was used to build the test circuit because of its wide dynamic range. The transfer curve plots very close to the theoretical curve; the direct result of using a high performance op amp.

# **4.3.3 Case 3: VOUT = –mVIN + b**

The circuit shown in Figure 4–16 yields the transfer function desired for Case 3.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit with a voltage reference input. Here is a detailed description of the circuit components and their connections:

1. **Voltage Sources:**
   - **VIN:** This is the input voltage source connected to the non-inverting input (+) of the op-amp through a resistor RG.
   - **VREF:** This is a reference voltage source connected to the inverting input (-) of the op-amp through a resistor R2.

2. **Resistors:**
   - **RG:** This resistor is connected between the input voltage source VIN and the non-inverting input (+) of the op-amp.
   - **RF:** This feedback resistor is connected between the output of the op-amp (VOUT) and the inverting input (-) of the op-amp.
   - **R1:** This resistor is connected between the inverting input (-) of the op-amp and ground.
   - **R2:** This resistor is connected between the reference voltage source VREF and the inverting input (-) of the op-amp.
   - **RL:** This load resistor is connected between the output of the op-amp (VOUT) and ground.

3. **Operational Amplifier (Op-Amp):**
   - The op-amp has two inputs: the non-inverting input (+) and the inverting input (-).
   - The op-amp is powered by a supply voltage VCC.
   - The output of the op-amp is labeled as VOUT.

4. **Connections:**
   - The non-inverting input (+) of the op-amp is connected to the input voltage source VIN through the resistor RG.
   - The inverting input (-) of the op-amp is connected to the reference voltage source VREF through the resistor R2 and to the output VOUT through the feedback resistor RF.
   - The inverting input (-) is also connected to ground through the resistor R1.
   - The output of the op-amp (VOUT) is connected to the load resistor RL, which is grounded.

This configuration is typically used to create a precise voltage output based on the input voltage VIN and the reference voltage VREF, with the gain determined by the resistors RG, RF, R1, and R2.
```

Figure 4–16. Schematic for Case 3: VOUT = –mVIN + b

The circuit equation is obtained with superposition.

$$\mathbb{V}\_{\rm OUT} = -\mathbb{V}\_{\rm IN} \left( \frac{\mathsf{R}\_{\rm F}}{\mathsf{R}\_{\rm G}} \right) + \mathbb{V}\_{\rm REF} \left( \frac{\mathsf{R}\_{\uparrow}}{\mathsf{R}\_{\uparrow} + \mathsf{R}\_{2}} \right) \left( \frac{\mathsf{R}\_{\rm F} + \mathsf{R}\_{\rm G}}{\mathsf{R}\_{\rm G}} \right) \tag{4-46}$$

Comparing terms between Equations 4–45 and 4–15 enables the extraction of m and b.

$$|\mathfrak{M}| = \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-47}$$

$$\mathbf{b} = \mathbb{V}\_{\mathsf{REF}} \left( \frac{\mathsf{R}\_{\mathsf{I}}}{\mathsf{R}\_{\mathsf{I}} + \mathsf{R}\_{\mathsf{I}}} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) \tag{4-48}$$

The design specifications for an example circuit are: VOUT = 1 V @ VIN = -0.1 V, VOUT = 6 V @ VIN = -1 V, VREF = VCC = 10 V, RL = 100 Ω, and 5% resistor tolerances. The supply voltage available for this circuit is 10 V, and this exceeds the maximum allowable supply voltage for the TLV247X. Also, this circuit must drive a back-terminated cable that looks like two 50-Ω resistors connected in series, thus the op amp must be able to drive 6/100 = 60 mA. The stringent op amp selection criteria limits the choice to relatively new op amps if ideal op amp equations are going to be used. The TLC07X has excellent singlesupply input performance coupled with high output current drive capability, so it is selected for this circuit. The simultaneous equations (Equations 4–49 and 4–50), are written below.

$$\mathbf{M} = \langle \mathbf{-0.1} \rangle \mathbf{m} + \mathbf{b} \tag{4-49}$$

$$\mathbf{g} = (-4)\mathbf{m} + \mathbf{p} \tag{4-50}$$

From these equations we find that b = 0.444 and m = –5.6.

$$|\mathfrak{M}| = \mathfrak{E}.\mathfrak{56} = \frac{\mathfrak{R}\_{\mathsf{F}}}{\mathfrak{R}\_{\mathsf{G}}} \tag{4-57}$$

$$
\mathsf{R}\_{\mathsf{F}} = \mathsf{5.56}\mathsf{R}\_{\mathsf{G}}\tag{4-52}
$$

Let RG = 10 kΩ, and then RF = 56.6 kΩ, which is not a standard 5% value, hence RF is selected as 56 kΩ.

$$\mathbf{p} = \mathsf{V}\_{\text{CC}} \left( \frac{\mathsf{R}\_{\text{F}} + \mathsf{R}\_{\text{G}}}{\mathsf{R}\_{\text{G}}} \right) \left( \frac{\mathsf{R}\_{\text{1}}}{\mathsf{R}\_{\text{1}} + \mathsf{R}\_{\text{2}}} \right) = \mathsf{V} \mathbf{0} \left( \frac{\mathsf{56} + \mathsf{10}}{\mathsf{10}} \right) \left( \frac{\mathsf{R}\_{\text{1}}}{\mathsf{R}\_{\text{1}} + \mathsf{R}\_{\text{2}}} \right) \quad \text{(4-53)}$$

$$
\mathbf{R}\_2 = \frac{\mathbf{66} \mathbf{-} \mathbf{0}.44444}{\mathbf{0}.4444} \mathbf{R}\_1 = \mathbf{147}.\mathbf{64} \mathbf{R}\_1 \tag{4-54}
$$

The final equation for the example is given below

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{5.56}\mathsf{V}\_{\mathsf{IN}} + \mathsf{0.444} \tag{4-55}$$

Select R1 = 2 kΩ and R2 = 295.28 kΩ. Since 295.28 kΩ is not a standard 5% resistor value, R1 is selected as 300 kΩ. The difference between the selected and calculated value of R1 has a nearly insignificant effect on b. The final circuit is shown in Figure 4–17, and the measured transfer curve for this circuit is shown in Figure 4–18.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a configuration that appears to be a non-inverting amplifier with additional components for biasing and stabilization. Here is a detailed description of the circuit:

1. **Input Source (VIN)**: The circuit has an input voltage source labeled VIN, which is connected to the non-inverting input (+) of the op-amp through a resistor RG (10 kΩ).

2. **Diode (D1)**: There is a diode (D1) connected between the non-inverting input of the op-amp and ground. The anode of the diode is connected to ground, and the cathode is connected to the non-inverting input.

3. **Biasing Network**: 
   - A voltage source VCC = 10 V is connected to a voltage divider network consisting of resistors R2 (2 kΩ) and R1 (300 kΩ). 
   - The junction of R2 and R1 is connected to the non-inverting input of the op-amp, providing a bias voltage.

4. **Operational Amplifier (Op-Amp)**: The op-amp has its non-inverting input connected to the biasing network and the input signal through RG. The inverting input (-) is connected to the feedback network.

5. **Feedback Network**:
   - A feedback resistor RF (56 kΩ) is connected between the output (VOUT) and the inverting input of the op-amp.
   - A capacitor (0.01 µF) is connected in parallel with RF, providing frequency compensation or stabilization.

6. **Power Supply**: The op-amp is powered by a VCC = 10 V supply, with decoupling capacitors (0.01 µF) connected between the power supply pins and ground to filter out noise.

7. **Load Resistor (RL)**: The output of the op-amp (VOUT) is connected to a load resistor RL (10 kΩ) which is connected to ground.

8. **Capacitors**: There are two capacitors (0.01 µF each) connected to the power supply lines of the op-amp for decoupling purposes, ensuring stable operation by filtering out any high-frequency noise.

In summary, this circuit is a non-inverting amplifier with a biasing network, feedback for gain control, and decoupling capacitors for stability. The diode D1 might be used for protection or clamping purposes, ensuring the input voltage does not exceed certain limits.
```

Figure 4–17. Case 3 Example Circuit

Here is the image describtion:
```
The image is a graph with a grid background, displaying a linear relationship between two variables: input voltage (V_IN) and output voltage (V_OUT). The x-axis represents the output voltage (V_OUT) in volts (V), ranging from 0 to 7 volts. The y-axis represents the input voltage (V_IN) in volts (V), ranging from -1.0 to 0 volts.

The graph features a single straight line that slopes downward from left to right, indicating a negative linear relationship between the input and output voltages. The line starts at the point (0, -0.1) on the graph and ends at the point (6, -1.0). This suggests that as the output voltage increases, the input voltage decreases linearly.

The grid lines on the graph are evenly spaced, providing a clear reference for reading the values of V_IN and V_OUT at various points along the line. The labels on the axes are clearly marked, with the x-axis labeled "V_OUT – Output Voltage – V" and the y-axis labeled "V_IN – Input Voltage – V".
```

Figure 4–18. Case 3 Example Circuit Measured Transfer Curve

As long as the circuit works normally, there are no problems handling the negative voltage input to the circuit, because the inverting lead of the TLC07X is at a positive voltage. The positive op amp input lead is at a voltage of approximately 65 mV, and normal op amp operation keeps the inverting op amp input lead at the same voltage because of the assumption that the error voltage is zero. When VCC is powered down while there is a negative voltage on the input circuit, most of the negative voltage appears on the inverting op amp input lead.

The most prudent solution is to connect the diode, D1, with its cathode on the inverting op amp input lead and its anode at ground. If a negative voltage gets on the inverting op amp input lead, it is clamped to ground by the diode. Select the diode type as germanium or Schottky so the voltage drop across the diode is about 200 mV; this small voltage does not harm most op amp inputs. As a further precaution, RG can be split into two resistors with the diode inserted at the junction of the two resistors. This places a current limiting resistor between the diode and the inverting op amp input lead.

# **4.3.4 Case 4: VOUT = –mVIN – b**

The circuit shown in Figure 4–19 yields a solution for Case 4. The circuit equation is obtained by using superposition to calculate the response to each input. The individual responses to VIN and VREF are added to obtain Equation 4–56.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit with a feedback network. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal. The positive terminal is connected to a reference voltage (V_REF), and the negative terminal is connected to the input voltage (V_IN) through a resistor (R_G1).

2. **Input Voltage (V_IN)**: This is the signal input to the circuit, connected to the negative terminal of the op-amp through resistor R_G1.

3. **Reference Voltage (V_REF)**: This is a reference voltage connected directly to the positive terminal of the op-amp.

4. **Resistors (R_G1, R_G2, R_F, R_L)**:
   - **R_G1**: Connected between the input voltage (V_IN) and the negative terminal of the op-amp.
   - **R_G2**: Connected between the negative terminal of the op-amp and ground.
   - **R_F**: Connected between the output of the op-amp (V_OUT) and the negative terminal of the op-amp, forming a feedback loop.
   - **R_L**: Connected between the output of the op-amp (V_OUT) and ground, representing the load resistor.

5. **Capacitor (0.01 µF)**: A capacitor is connected in parallel with the load resistor (R_L) between the output of the op-amp (V_OUT) and ground. This capacitor is likely used for filtering or stability purposes.

6. **Power Supply (V_CC)**: The op-amp is powered by a supply voltage (V_CC), connected to the appropriate power pin of the op-amp.

7. **Output Voltage (V_OUT)**: The output voltage of the circuit is taken from the output terminal of the op-amp.

In summary, this is a non-inverting op-amp configuration with a feedback network consisting of resistors and a capacitor. The input signal (V_IN) is applied to the negative terminal through R_G1, while the positive terminal is held at a reference voltage (V_REF). The feedback resistor (R_F) and the resistor to ground (R_G2) set the gain of the amplifier. The capacitor provides additional filtering or stability to the circuit.
```

Figure 4–19. Schematic for Case 4: VOUT = –mVIN – b

$$
\mathbb{V}\_{\mathsf{OUT}} = -\mathsf{V}\_{\mathsf{IN}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}}} - \mathsf{V}\_{\mathsf{R}\mathsf{EF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G2}}} \tag{4-56}
$$

Comparing terms in Equations 4–56 and 4–16 enables the extraction of m and b.

$$|\mathfrak{M}| = \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}\mathsf{L}}} \tag{4-57}$$

$$|\mathbf{b}| = \mathsf{V}\_{\mathsf{REF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}2}} \tag{4-58}$$

The design specifications for an example circuit are: VOUT = 1 V @ VIN = –0.1 V, VOUT = 5 V @ VIN =– 0.3 V, VREF = VCC = 5 V, RL = 10 kΩ, and 5% resistor tolerances. The simultaneous Equations 4–59 and 4–60, are written below.

$$\mathbf{M} = (-0.1)\mathbf{m} + \mathbf{b} \tag{4-59}$$

$$\mathbf{5} = \langle \text{-0.3} \rangle \mathbf{m} + \mathbf{b} \tag{4-60}$$

From these equations we find that b = –1 and m = –20. Setting the magnitude of m equal to Equation 4–57 yields Equation 4–61.

$$|\mathfrak{m}| = \mathfrak{20} = \frac{\mathsf{R\_F}}{\mathsf{R\_{G1}}} \tag{4-61}$$

$$\mathsf{R}\_{\mathsf{F}} = \mathsf{20R}\_{\mathsf{G}\mathsf{T}} \tag{4-62}$$

Let RG1 = 1 kΩ, and then RF = 20 kΩ.

Single-Supply Op Amp Design Techniques 4-19

$$|\mathbf{b}| = \mathsf{V}\_{\mathsf{CC}} \left( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}\mathsf{T}}} \right) = \mathsf{S} \left( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}\mathsf{2}}} \right) = \mathsf{T} \tag{4-63}$$

$$\mathcal{R}\_{\mathbb{G}2} = \frac{\mathcal{R}\_{\mathbb{F}}}{\mathbb{O}.2} = \frac{\mathbb{20}}{\mathbb{O}.2} = \text{ 100 k}\Omega \tag{4-64}$$

The final equation for this example is given in Equation 4–63.

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{20V}\_{\mathsf{IN}} - \mathsf{1} \tag{4-65}$$

The final circuit is shown in Figure 4–20 and the measured transfer curve for this circuit is shown in Figure 4–21.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Input Source (VIN)**: The circuit starts with an input voltage source labeled VIN, which is connected to the leftmost part of the diagram.

2. **Resistor RG1**: The input voltage VIN is connected to a resistor labeled RG1 with a resistance of 1 kΩ. This resistor is in series with the input voltage.

3. **Voltage Divider Network**: 
   - After RG1, the circuit splits into two paths. One path goes through a resistor labeled RG2A with a resistance of 51 kΩ, which is connected to a +5V power supply.
   - The other path goes through another resistor labeled RG2B, also with a resistance of 51 kΩ, which is connected to a diode labeled D1. The diode is oriented with its anode connected to the resistor and its cathode connected to ground.

4. **Capacitor**: There is a capacitor with a capacitance of 0.01 µF connected between the junction of RG2A and RG2B and ground.

5. **Operational Amplifier (Op-Amp)**: 
   - The non-inverting input (+) of the op-amp is connected to ground.
   - The inverting input (-) of the op-amp is connected to the junction of RG1, RG2A, and RG2B.

6. **Feedback Network**:
   - A resistor labeled RF with a resistance of 20 kΩ is connected between the output of the op-amp (VOUT) and the inverting input (-) of the op-amp, forming a feedback loop.
   - A capacitor with a capacitance of 0.01 µF is connected in parallel with RF, also between the output and the inverting input of the op-amp.

7. **Load Resistor (RL)**: The output of the op-amp (VOUT) is connected to a load resistor labeled RL with a resistance of 10 kΩ, which is connected to ground.

8. **Power Supply**: The op-amp is powered by a +5V supply, as indicated by the connections to the positive power rail.

In summary, the circuit is a feedback amplifier configuration with an op-amp, where the input signal VIN is processed through a network of resistors and capacitors, and the output VOUT is fed back to the inverting input through a feedback network. The diode D1 and the capacitors are likely used for stabilization and filtering purposes.
```

Figure 4–20. Case 4 Example Circuit

Here is the image describtion:
```
The image is a graph that plots the relationship between input voltage (V_IN) and output voltage (V_OUT). The graph has the following characteristics:

- The x-axis represents the output voltage (V_OUT) in volts (V), ranging from 0 to 6 volts.
- The y-axis represents the input voltage (V_IN) in volts (V), ranging from -0.35 to -0.10 volts.
- The graph features a single, straight line that slopes downward from left to right, indicating a negative correlation between V_IN and V_OUT.
- The line starts at approximately (0, -0.10) and ends at approximately (5, -0.30).
- The grid lines on the graph create a clear, evenly spaced grid, which helps in reading the values accurately.

Overall, the graph shows that as the output voltage (V_OUT) increases, the input voltage (V_IN) decreases linearly.
```

Figure 4–21. Case 4 Example Circuit Measured Transfer Curve

The TLV247X was used to build the test circuit because of its wide dynamic range. The transfer curve plots very close to the theoretical curve, and this results from using a high performance op amp.

As long as the circuit works normally there are no problems handling the negative voltage input to the circuit because the inverting lead of the TLV247X is at a positive voltage. The positive op amp input lead is grounded, and normal op amp operation keeps the inverting op amp input lead at ground because of the assumption that the error voltage is zero. When VCC is powered down while there is a negative voltage on the inverting op amp input lead.

The most prudent solution is to connect the diode, D1, with its cathode on the inverting op amp input lead and its anode at ground. If a negative voltage gets on the inverting op amp input lead it is clamped to ground by the diode. Select the diode type as germanium or Schottky so the voltage drop across the diode is about 200 mV; this small voltage does not harm most op amp inputs. RG2 is split into two resistors (RG2A = RG2B = 51 kΩ) with a capacitor inserted at the junction of the two resistors. This places a power supply filter in series with VCC.

# **4.4 Summary**

Single-supply op amp design is more complicated than split-supply op amp design, but with a logical design approach excellent results are achieved. Single-supply design used to be considered technically limiting because older op amps had limited capability. The new op amps, such as the TLC247X, TLC07X, and TLC08X have excellent single-supply parameters; thus when used in the correct applications these op amps yield rail-to-rail performance equal to their split-supply counterparts.

Single-supply op amp design usually involves some form of biasing, and this requires more thought, so single-supply op amp design needs discipline and a procedure. The recommended design procedure for single-supply op amp design is:

- Substitute the specification data into simultaneous equations to obtain m and b (the slope and intercept of a straight line).
- Let m and b determine the form of the circuit.
- Choose the circuit configuration that fits the form.
- Using the circuit equations for the circuit configuration selected, calculate the resistor values.
- Build the circuit, take data, and verify performance.
- Test the circuit for nonstandard operating conditions (circuit power off while interface power is on, over/under range inputs, etc.).
- Add protection components as required.
- Retest.

When this procedure is followed, good results follow. As single-supply circuit designers expand their horizon, new challenges require new solutions. Remember, the only equation a linear op amp can produce is the equation of a straight line. That equation only has four forms. The new challenges may consist of multiple inputs, common-mode voltage rejection, or something different, but this method can be expanded to meet these challenges.

**Chapter 5**

# **Feedback and Stability Theory**

Ron Mancini

# **5.1 Why Study Feedback Theory?**

The gain of all op amps decreases as frequency increases, and the decreasing gain results in decreasing accuracy as the ideal op amp assumption (a ⇒ ∝) breaks down. In most real op amps the open loop gain starts to decrease before 10 Hz, so an understanding of feedback is required to predict the closed loop performance of the op amp. The real world application of op amps is feedback controlled, and depends on op amp open loop gain at a given frequency. A designer must know theory to be able to predict the circuit response regardless of frequency or open loop gain.

Analysis tools have something in common with medicine because they both can be distasteful but necessary. Medicine often tastes bad or has undesirable side effects, and analysis tools involve lots of hard learning work before they can be applied to yield results. Medicine assists the body in fighting an illness; analysis tools assist the brain in learning/ designing feedback circuits.

The analysis tools given here are a synopsis of salient points; thus they are detailed enough to get you where you are going without any extras. The references, along with thousands of their counterparts, must be consulted when making an in-depth study of the field. Aspirin, home remedies, and good health practice handle the majority of health problems, and these analysis tools solve the majority of circuit problems.

Ideal op amp circuits can be designed without knowledge of feedback analysis tools, but these circuits are limited to low frequencies. Also, an understanding of feedback analysis tools is required to understand AC effects like ringing and oscillations.

# **5.2 Block Diagram Math and Manipulations**

Electronic systems and circuits are often represented by block diagrams, and block diagrams have a unique algebra and set of transformations[1]. Block diagrams are used because they are a shorthand pictorial representation of the cause-and-effect relationship between the input and output in a real system. They are a convenient method for characterizing the functional relationships between components. It is not necessary to understand the functional details of a block to manipulate a block diagram.

The input impedance of each block is assumed to be infinite to preclude loading. Also, the output impedance of each block is assumed to be zero to enable high fan-out. The systems designer sets the actual impedance levels, but the fan-out assumption is valid because the block designers adhere to the system designer's specifications. All blocks multiply the input times the block quantity (see Figure 5–1) unless otherwise specified within the block. The quantity within the block can be a constant as shown in Figure 5–1(c), or it can be a complex math function involving Laplace transforms. The blocks can perform time-based operations such as differentiation and integration.

Here is the image describtion:
```
The image consists of four distinct diagrams labeled (a) through (d), each illustrating different concepts related to signal processing and block diagrams.

(a) Input/Output Impedance:
- This diagram shows a simple electrical circuit with an input and output terminal.
- The input terminal is labeled "INPUT" and the output terminal is labeled "OUTPUT."
- Inside the box, there is a symbol representing an output voltage source, labeled "Vo," connected to the ground.
- This diagram represents the concept of input and output impedance in an electrical circuit.

(b) Signal Flow Arrows:
- This diagram depicts a block with an input labeled "A" and an output labeled "B."
- The block is labeled "Block Description."
- Arrows indicate the direction of signal flow from the input (A) to the output (B).
- This diagram illustrates the concept of signal flow in a block diagram.

(c) Block Multiplication:
- This diagram shows a block with an input labeled "A" and an output labeled "B."
- The block is labeled "K."
- The output "B" is defined as the product of the input "A" and the block "K," represented by the equation "B = AK."
- This diagram represents the concept of block multiplication in signal processing.

(d) Blocks Perform Functions as Indicated:
- This diagram shows a block with an input labeled "VI" and an output labeled "Vo."
- The block is labeled with the derivative operator "d/dt."
- The output "Vo" is defined as the derivative of the input "VI" with respect to time, represented by the equation "Vo = dVI/dt."
- This diagram illustrates the concept of blocks performing specific mathematical functions, in this case, differentiation.

Overall, the image provides a visual representation of various concepts related to signal processing, block diagrams, and mathematical operations performed by blocks.
```

Figure 5–1. Definition of Blocks

Adding and subtracting are done in special blocks called summing points. Figure 5–2 gives several examples of summing points. Summing points can have unlimited inputs, can add or subtract, and can have mixed signs yielding addition and subtraction within a single summing point. Figure 5–3 defines the terms in a typical control system, and Figure 5–4 defines the terms in a typical electronic feedback system. Multiloop feedback systems (Figure 5–5) are intimidating, but they can be reduced to a single loop feedback system, as shown in the figure, by writing equations and solving for VOUT/VIN. An easier method for reducing multiloop feedback systems to single loop feedback systems is to follow the rules and use the transforms given in Figure 5–6.

Here is the image describtion:
```
The image consists of three diagrams labeled (a), (b), and (c), each representing different types of summary points used in signal processing or control systems.

(a) Additive Summary Point:
- This diagram shows two input signals, A and B, entering a circular summing point.
- Both inputs have a plus sign (+) next to them, indicating that they are to be added together.
- The output of the summing point is labeled A + B, representing the sum of the two input signals.

(b) Subtractive Summary Point:
- This diagram shows two input signals, A and B, entering a circular summing point.
- The input signal A has a plus sign (+) next to it, indicating it is to be added.
- The input signal B has a minus sign (-) next to it, indicating it is to be subtracted.
- The output of the summing point is labeled A - B, representing the difference between the two input signals.

(c) Multiple Input Summary Points:
- This diagram shows three input signals, A, B, and C, entering a circular summing point.
- The input signals A and B have plus signs (+) next to them, indicating they are to be added.
- The input signal C has a minus sign (-) next to it, indicating it is to be subtracted.
- The output of the summing point is labeled A + B - C, representing the sum of A and B minus C.

Each diagram uses arrows to indicate the direction of the signals entering and exiting the summing points. The circular summing points are used to visually represent the mathematical operations performed on the input signals.
```

Figure 5–2. Summary Points

Here is the image describtion:
```
The image depicts a block diagram of a closed-loop control system. Here is a detailed description of each component and their interconnections:

1. **Reference Input (R)**: This is the desired value or setpoint that the system aims to achieve.

2. **Summing Junction (Σ)**: This is where the reference input (R) and the primary feedback signal (B) are compared. The summing junction calculates the actuating signal (E) by either adding or subtracting the feedback signal from the reference input, represented as \( E = R \pm B \).

3. **Actuating Signal (E)**: This is the result of the summing junction and represents the error or difference between the reference input and the feedback signal.

4. **Control Elements (G1)**: This block represents the controller, which processes the actuating signal (E) to produce the manipulated variable (M). The controller's function is to reduce the error by adjusting the manipulated variable.

5. **Manipulated Variable (M)**: This is the output of the control elements and serves as the input to the plant.

6. **Plant (G1)**: This block represents the system or process being controlled. The plant receives the manipulated variable (M) and produces the controlled output (C).

7. **Disturbance (U)**: This is an external factor that can affect the plant and, consequently, the controlled output. It is an unwanted input that the control system must compensate for to maintain the desired output.

8. **Controlled Output (C)**: This is the actual output of the plant, which the control system aims to keep at the desired value set by the reference input.

9. **Feedback Path**: This path carries the controlled output (C) back to the summing junction through the feedback elements.

10. **Feedback Elements (H)**: This block represents the components that process the controlled output to generate the primary feedback signal (B). The feedback elements can include sensors, transducers, and other devices that measure the controlled output and convert it into a feedback signal.

11. **Primary Feedback Signal (B)**: This is the processed signal from the feedback elements that is fed back to the summing junction for comparison with the reference input.

The overall system is designed to adjust the manipulated variable in response to the actuating signal, thereby minimizing the error and ensuring that the controlled output matches the reference input despite any disturbances.
```

Figure 5–3. Definition of Control System Terms

Here is the image describtion:
```
The image depicts a block diagram of a feedback control system. Here is a detailed description of the components and their connections:

1. **Summing Junction (Σ)**: This is represented by a circle with a summation symbol (Σ) inside it. It has two inputs and one output. The inputs are:
   - \( V_{IN} \): The reference input signal, which is fed into the summing junction from the left.
   - The feedback signal, which is fed into the summing junction from the bottom.

   The output of the summing junction is labeled as "ERROR" or "E". This output represents the difference between the reference input signal and the feedback signal.

2. **Amplifier (A)**: This is represented by a rectangular block labeled "A". The input to this block is the "ERROR" signal from the summing junction. The output of the amplifier is connected to the output of the system, labeled \( V_{OUT} \).

3. **Feedback Path (β)**: This is represented by another rectangular block labeled "β". The input to this block is the output of the system, \( V_{OUT} \). The output of the feedback block is fed back into the summing junction.

4. **Connections**:
   - The reference input signal \( V_{IN} \) enters the summing junction from the left.
   - The feedback signal, which is the output of the feedback block "β", enters the summing junction from the bottom.
   - The output of the summing junction, labeled "ERROR" or "E", is fed into the amplifier block "A".
   - The output of the amplifier block "A" is the system output \( V_{OUT} \).
   - The system output \( V_{OUT} \) is fed into the feedback block "β".
   - The output of the feedback block "β" is fed back into the summing junction.

This diagram represents a typical negative feedback control system where the feedback signal is subtracted from the reference input signal to produce an error signal, which is then amplified to control the system output.
```

Figure 5–4. Definition of an Electronic Feedback Circuit

Here is the image describtion:
```
The image consists of two block diagrams representing control systems. The top diagram is a more complex system with multiple feedback loops and transfer functions, while the bottom diagram is a simplified equivalent representation of the top system.

### Top Diagram:
1. **Input (R)**: The system starts with an input signal labeled "R".
2. **Summing Junctions**: 
   - The first summing junction adds the input signal "R" and a feedback signal (negative feedback).
   - The second summing junction adds the output of the first summing junction and another feedback signal (positive feedback).
3. **Blocks**:
   - **G1**: The output of the first summing junction passes through a block labeled "G1".
   - **G4**: The output of "G1" then passes through another block labeled "G4".
   - **G3**: The output of "G4" splits, with one path going through a block labeled "G3".
   - **G2**: The output of "G3" then passes through a block labeled "G2".
4. **Summing Junction**: The outputs of "G2" and the direct path from "G4" are summed together at a summing junction.
5. **Output (C)**: The result of the summing junction is the output signal labeled "C".
6. **Feedback Loops**:
   - **H1**: A feedback loop from the output of "G4" goes through a block labeled "H1" and feeds back into the second summing junction.
   - **H2**: Another feedback loop from the output "C" goes through a block labeled "H2" and feeds back into the first summing junction.

### Bottom Diagram:
1. **Input (R)**: The system starts with the same input signal labeled "R".
2. **Summing Junction**: There is a single summing junction that adds the input signal "R" and a feedback signal (negative feedback).
3. **Block**: The output of the summing junction passes through a single block with a transfer function given by:
   \[
   \frac{G_1 G_4 (G_2 + G_3)}{1 - G_1 G_4 H_1}
   \]
4. **Output (C)**: The output of this block is the output signal labeled "C".
5. **Feedback Loop (H2)**: A feedback loop from the output "C" goes through a block labeled "H2" and feeds back into the summing junction.

### Summary:
The top diagram represents a detailed control system with multiple components and feedback loops, while the bottom diagram is a simplified equivalent representation of the same system, showing how the complex system can be reduced to a single transfer function with a feedback loop.
```

Figure 5–5. Multiloop Feedback System

Block diagram reduction rules:

- Combine cascade blocks.
- Combine parallel blocks.
- Eliminate interior feedback loops.
- Shift summing points to the left.
- Shift takeoff points to the right.
- Repeat until canonical form is obtained.

Figure 5–6 gives the block diagram transforms. The idea is to reduce the diagram to its canonical form because the canonical feedback loop is the simplest form of a feedback loop, and its analysis is well documented. All feedback systems can be reduced to the canonical form, so all feedback systems can be analyzed with the same math. A canonical loop exists for each input to a feedback system; although the stability dynamics are independent of the input, the output results are input dependent. The response of each input of a multiple input feedback system can be analyzed separately and added through superposition.

Here is the image describtion:
```
The image is a comparison of different block diagram transformations used in control systems. It is divided into two main columns: "Before Transformation" and "After Transformation." Each row represents a specific type of transformation applied to the block diagrams.

1. **Combine Cascade Blocks:**
   - **Before Transformation:** Two blocks, K1 and K2, are connected in series (cascade). Input A goes through K1 and then K2 to produce output B.
   - **After Transformation:** The two blocks are combined into a single block with the product of their gains, K1 * K2. Input A goes through this combined block to produce output B.

2. **Combine Parallel Blocks:**
   - **Before Transformation:** Two blocks, K1 and K2, are connected in parallel. Input A is split into two paths, each going through K1 and K2 respectively, and then summed to produce output B.
   - **After Transformation:** The two blocks are combined into a single block with the sum of their gains, K1 ± K2. Input A goes through this combined block to produce output B.

3. **Eliminate a Feedback Loop:**
   - **Before Transformation:** A feedback loop is present with a summing junction, K1, and K2. Input A goes through the summing junction, then K1, and the output is fed back through K2 to the summing junction.
   - **After Transformation:** The feedback loop is eliminated, and the system is represented by a single block with the gain K1 / (1 ± K1 * K2). Input A goes through this block to produce output B.

4. **Move Summer In Front of a Block:**
   - **Before Transformation:** A block K is followed by a summing junction. Input A goes through K, and then the output is summed with B to produce output C.
   - **After Transformation:** The summing junction is moved in front of the block K. Input A and B are summed first, and then the result goes through K to produce output C. Additionally, the block K is replaced with 1/K.

5. **Move Summer Behind a Block:**
   - **Before Transformation:** A summing junction is followed by a block K. Input A and B are summed first, and then the result goes through K to produce output C.
   - **After Transformation:** The summing junction is moved behind the block K. Input A goes through K first, and then the output is summed with B to produce output C. Additionally, the block K is duplicated.

6. **Move Pickoff In Front of a Block:**
   - **Before Transformation:** A block K is followed by a pickoff point. Input A goes through K to produce output B, which is then fed back to the pickoff point.
   - **After Transformation:** The pickoff point is moved in front of the block K. Input A is split into two paths, one going through K to produce output B, and the other directly to the pickoff point.

7. **Move Pickoff Behind a Block:**
   - **Before Transformation:** A pickoff point is followed by a block K. Input A is split into two paths, one directly to the pickoff point, and the other going through K to produce output B.
   - **After Transformation:** The pickoff point is moved behind the block K. Input A goes through K first, and then the output is split into two paths, one directly to the pickoff point, and the other through 1/K.

Each transformation simplifies or rearranges the block diagram to make the system analysis easier.
```

Figure 5–6. Block Diagram Transforms

# **5.3 Feedback Equation and Stability**

Figure 5–7 shows the canonical form of a feedback loop with control system and electronic system terms. The terms make no difference except that they have meaning to the system engineers, but the math does have meaning, and it is identical for both types of terms. The electronic terms and negative feedback sign are used in this analysis, because subsequent chapters deal with electronic applications. The output equation is written in Equation 5–1.

Here is the image describtion:
```
The image consists of three diagrams, each representing a feedback control system but using different terminologies and configurations. Let's break down each part in detail:

### Diagram (a): Control System Terminology
- **Components:**
  - **R:** Input reference signal.
  - **Σ (Summing Junction):** Combines the input reference signal (R) and the feedback signal.
  - **E:** Error signal, which is the difference between R and the feedback signal.
  - **G:** Forward path gain or transfer function.
  - **C:** Output signal.
  - **H:** Feedback path gain or transfer function.
- **Connections:**
  - The input reference signal (R) enters the summing junction.
  - The summing junction outputs the error signal (E), which is the difference between R and the feedback signal.
  - The error signal (E) is fed into the forward path gain (G), producing the output signal (C).
  - The output signal (C) is fed back through the feedback path gain (H) to the summing junction.
- **Equations:**
  - The closed-loop transfer function is given by \( \frac{C}{R} = \frac{G}{1 + GH} \).
  - The error signal is given by \( E = \frac{R}{1 + GH} \).

### Diagram (b): Electronics Terminology
- **Components:**
  - **VIN:** Input voltage signal.
  - **Σ (Summing Junction):** Combines the input voltage signal (VIN) and the feedback signal.
  - **E:** Error signal, which is the difference between VIN and the feedback signal.
  - **A:** Forward path gain or amplifier.
  - **VOUT:** Output voltage signal.
  - **β:** Feedback path gain or feedback factor.
- **Connections:**
  - The input voltage signal (VIN) enters the summing junction.
  - The summing junction outputs the error signal (E), which is the difference between VIN and the feedback signal.
  - The error signal (E) is fed into the forward path gain (A), producing the output voltage signal (VOUT).
  - The output voltage signal (VOUT) is fed back through the feedback path gain (β) to the summing junction.
- **Equations:**
  - The closed-loop transfer function is given by \( \frac{VOUT}{VIN} = \frac{A}{1 + Aβ} \).
  - The error signal is given by \( E = \frac{VIN}{1 + Aβ} \).

### Diagram (c): Feedback Loop is Broken to Calculate the Loop Gain
- **Components:**
  - **Σ (Summing Junction):** Combines the input signal and the feedback signal.
  - **E:** Error signal.
  - **A:** Forward path gain or amplifier.
  - **β:** Feedback path gain or feedback factor.
  - **X:** Point where the feedback loop is broken.
- **Connections:**
  - The summing junction outputs the error signal (E).
  - The error signal (E) is fed into the forward path gain (A).
  - The output of the forward path gain (A) is fed back through the feedback path gain (β) to the summing junction.
  - The feedback loop is broken at point X to calculate the loop gain.

### Summary
- Diagram (a) uses control system terminology with variables R, E, G, C, and H.
- Diagram (b) uses electronics terminology with variables VIN, E, A, VOUT, and β.
- Diagram (c) shows the method to calculate the loop gain by breaking the feedback loop at a specific point.

Each diagram illustrates the concept of feedback in control systems and electronics, highlighting the similarities and differences in terminology and representation.
```

Figure 5–7. Comparison of Control and Electronic Canonical Feedback Systems

$$\mathsf{V}\_{\mathsf{O}\upharpoonright} = \mathsf{E}\mathsf{A} \tag{5-4}$$

The error equation is written in Equation 5–2.

$$\mathsf{E} = \mathsf{V}\_{\mathsf{IN}} - \mathsf{\beta}\mathsf{V}\_{\mathsf{OUL}} \tag{5-2}$$

Combining Equations 5–1 and 5–2 yields Equation 5–3.

$$\frac{\mathsf{V\_{\mathsf{OUT}}}}{\mathsf{A}} = \mathsf{V\_{\mathsf{IN}}} - \beta \mathsf{V\_{\mathsf{OUT}}} \tag{5-3}$$

Collecting terms yields Equation 5–4.

$$
\mathsf{V}\_{\mathsf{OUT}} \left( \frac{\mathsf{I}}{\mathsf{A}} + \mathsf{8} \right) = \mathsf{V}\_{\mathsf{IN}} \tag{5-4}
$$

Rearranging terms yields the classic form of the feedback Equation 5–5.

$$\frac{\mathsf{A}\_{\mathsf{OUT}}}{\mathsf{A}\_{\mathsf{IN}}} = \frac{\mathsf{A}}{\mathsf{1} + \mathsf{A}\mathsf{A}}\tag{5-5}$$

When the quantity Aβ in Equation 5–5 becomes very large with respect to one, the one can be neglected, and Equation 5–5 reduces to Equation 5–6, which is the ideal feedback equation. Under the conditions that Aβ >>1, the system gain is determined by the feedback factor β. Stable passive circuit components are used to implement the feedback factor, thus in the ideal situation, the closed loop gain is predictable and stable because β is predictable and stable.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = \frac{1}{\beta} \tag{5-6}$$

The quantity Aβ is so important that it has been given a special name: loop gain. In Figure 5–7, when the voltage inputs are grounded (current inputs are opened) and the loop is broken, the calculated gain is the loop gain, Aβ. Now, keep in mind that we are using complex numbers, which have magnitude and direction. When the loop gain approaches minus one, or to express it mathematically 1∠–180°, Equation 5–5 approaches 1/0 ⇒ ∝. The circuit output heads for infinity as fast as it can using the equation of a straight line. If the output were not energy limited, the circuit would explode the world, but happily, it is energy limited, so somewhere it comes up against the limit.

Active devices in electronic circuits exhibit nonlinear phenomena when their output approaches a power supply rail, and the nonlinearity reduces the gain to the point where the loop gain no longer equals 1∠–180°. Now the circuit can do two things: first it can become stable at the power supply limit, or second, it can reverse direction (because stored charge keeps the output voltage changing) and head for the negative power supply rail.

The first state where the circuit becomes stable at a power supply limit is named lockup; the circuit will remain in the locked up state until power is removed and reapplied. The second state where the circuit bounces between power supply limits is named oscillatory. Remember, the loop gain, Aβ, is the sole factor determining stability of the circuit or system. Inputs are grounded or disconnected, so they have no bearing on stability.

Equations 5–1 and 5–2 are combined and rearranged to yield Equation 5–7, which is the system or circuit error equation.

$$\Xi = \begin{array}{c} \mathsf{V}\_{\mathsf{IN}} \\ \mathsf{I} + \mathsf{A}\mathfrak{E} \end{array} \tag{5-7}$$

First, notice that the error is proportional to the input signal. This is the expected result because a bigger input signal results in a bigger output signal, and bigger output signals require more drive voltage. As the loop gain increases, the error decreases, thus large loop gains are attractive for minimizing errors.

# **5.4 Bode Analysis of Feedback Circuits**

H. W. Bode developed a quick, accurate, and easy method of analyzing feedback amplifiers, and he published a book about his techniques in 1945.[2] Operational amplifiers had not been developed when Bode published his book, but they fall under the general classification of feedback amplifiers, so they are easily analyzed with Bode techniques. The mathematical manipulations required to analyze a feedback circuit are complicated because they involve multiplication and division. Bode developed the Bode plot, which simplifies the analysis through the use of graphical techniques.

The Bode equations are log equations that take the form 20LOG(F(t)) = 20LOG(|F(t)|) + phase angle. Terms that are normally multiplied and divided can now be added and subtracted because they are log equations. The addition and subtraction is done graphically, thus easing the calculations and giving the designer a pictorial representation of circuit performance. Equation 5–8 is written for the low pass filter shown in Figure 5–8.

Here is the image describtion:
```
The image depicts a simple RC (resistor-capacitor) low-pass filter circuit. Here is a detailed description of the components and their connections:

1. **Components**:
   - **Resistor (R)**: This is represented by the zigzag line.
   - **Capacitor (C)**: This is represented by two parallel lines, one of which is curved, indicating a capacitor.

2. **Connections**:
   - **Input Voltage (V_I)**: This is the voltage source connected to the left end of the resistor.
   - **Resistor (R)**: One end of the resistor is connected to the input voltage (V_I), and the other end is connected to a node.
   - **Node**: This is the point where the resistor, capacitor, and output voltage meet.
   - **Capacitor (C)**: One end of the capacitor is connected to the node, and the other end is connected to the ground (indicated by the three horizontal lines).
   - **Output Voltage (V_O)**: This is taken from the node where the resistor and capacitor meet.

3. **Ground**: The ground symbol (three horizontal lines) indicates the reference point in the circuit, typically considered as 0 volts.

In summary, the input voltage (V_I) is applied across the series combination of the resistor (R) and the capacitor (C). The output voltage (V_O) is taken across the capacitor. This configuration allows the circuit to pass low-frequency signals while attenuating high-frequency signals, hence functioning as a low-pass filter.
```

Figure 5–8. Low-Pass Filter

$$\begin{aligned} \frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} &= \frac{\frac{\mathbf{\mathcal{I}}}{\mathbf{C} \cdot \mathbf{s}}}{\mathbf{R} + \frac{\mathbf{\mathcal{I}}}{\mathbf{C} \cdot \mathbf{s}}} = \frac{\mathbf{\mathcal{I}}}{\mathbf{\mathcal{I}} + \mathbf{R} \mathbf{C} \mathbf{s}} = \frac{\mathbf{\mathcal{I}}}{\mathbf{\mathcal{I}} + \mathbf{\tau} \mathbf{s}} \\ \text{Where:} \quad \mathbf{s} = \mathbf{j} \boldsymbol{\alpha}, \ \mathbf{j} &= \sqrt{(-\mathbf{\mathcal{I}})}, \text{ and } \mathbf{R} \mathbf{C} = \boldsymbol{\tau} \end{aligned} \tag{5-8}$$

The magnitude of this transfer function is |VOUTVIN| <sup>1</sup> <sup>12</sup> () <sup>2</sup> . This magnitude, |VOUT/VIN| ≅ 1 when ω = 0.1/τ, it equals 0.707 when ω = 1/τ, and it is approximately = 0.1 when ω = 10/τ. These points are plotted in Figure 5–9 using straight line approximations. The negative slope is –20 dB/decade or –6 dB/octave. The magnitude curve is plotted as a horizontal line until it intersects the breakpoint where ω = 1/τ. The negative slope begins at the breakpoint because the magnitude starts decreasing at that point. The gain is equal to 1 or 0 dB at very low frequencies, equal to 0.707 or –3 dB at the break frequency, and it keeps falling with a –20 dB/decade slope for higher frequencies.

The phase shift for the low pass filter or any other transfer function is calculated with the aid of Equation 5–9.

$$\boldsymbol{\phi} = \begin{array}{c} \texttt{tangent}^{-1} \left( \frac{\texttt{Recall}}{\texttt{lmaginary}} \right) = \; - \; \texttt{tangent}^{-1} \left( \frac{\texttt{off}}{\texttt{l}} \right) \end{array} \tag{5-9}$$

The phase shift is much harder to approximate because the tangent function is nonlinear. Normally the phase information is only required around the 0 dB intercept point for an active circuit, so the calculations are minimized. The phase is shown in Figure 5–9, and it is approximated by remembering that the tangent of 90° is 1, the tangent of 60° is √3 , and the tangent of 30° is √3/3.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a linear, time-invariant system transfer function. It consists of two plots: the magnitude plot (in decibels) and the phase plot (in degrees) as functions of frequency (in radians per second).

1. **Magnitude Plot (Top Plot):**
   - The vertical axis represents the magnitude in decibels (dB), specifically 20 times the logarithm of the output voltage (VO) over the input voltage (VI).
   - The horizontal axis represents the frequency in terms of ω (radians per second), scaled by the time constant τ. The frequency points are marked as ω = 0.1/τ, ω = 1/τ, and ω = 10/τ.
   - At low frequencies (ω = 0.1/τ), the magnitude is 0 dB, indicating no attenuation.
   - As the frequency increases to ω = 1/τ, the magnitude decreases to -3 dB, which is the cutoff frequency where the output is reduced by 3 dB.
   - Beyond the cutoff frequency (ω > 1/τ), the magnitude decreases linearly at a rate of -20 dB per decade, as indicated by the dashed line.

2. **Phase Plot (Bottom Plot):**
   - The vertical axis represents the phase shift in degrees.
   - The horizontal axis is the same as in the magnitude plot, representing the frequency in terms of ω scaled by τ.
   - At low frequencies (ω = 0.1/τ), the phase shift is 0 degrees, indicating no phase difference between the input and output.
   - As the frequency increases to ω = 1/τ, the phase shift decreases to -45 degrees.
   - At high frequencies (ω = 10/τ), the phase shift approaches -90 degrees, indicating a significant lag between the input and output.

Overall, the Bode plot shows the frequency response of a first-order low-pass filter, characterized by a -3 dB point at the cutoff frequency and a phase shift that transitions from 0 degrees to -90 degrees as the frequency increases.
```

Figure 5–9. Bode Plot of Low-Pass Filter Transfer Function

A breakpoint occurring in the denominator is called a pole, and it slopes down. Conversely, a breakpoint occurring in the numerator is called a zero, and it slopes up. When the transfer function has multiple poles and zeros, each pole or zero is plotted independently, and the individual poles/zeros are added graphically. If multiple poles, zeros, or a pole/ zero combination have the same breakpoint, they are plotted on top of each other. Multiple poles or zeros cause the slope to change by multiples of 20 dB/decade.

An example of a transfer function with multiple poles and zeros is a band reject filter (see Figure 5–10). The transfer function of the band reject filter is given in Equation 5–10.

Here is the image describtion:
```
The image depicts an electronic circuit diagram of a two-stage RC (resistor-capacitor) low-pass filter. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as V_IN on the left side.

2. **First Stage**:
   - **Resistor (R)**: The input voltage V_IN is connected to a resistor labeled R.
   - **Capacitor (C)**: After the resistor, the circuit splits into two branches. One branch continues horizontally, while the other branch goes vertically downwards through a capacitor labeled C.
   - **Ground Connection**: The vertical branch with the capacitor C is connected to the ground.

3. **Second Stage**:
   - **Resistor (R)**: The horizontal branch from the first stage continues to another resistor labeled R.
   - **Capacitor (C)**: After the second resistor, the circuit again splits into two branches. One branch continues horizontally, while the other branch goes vertically downwards through another capacitor labeled C.
   - **Ground Connection**: The vertical branch with the second capacitor C is connected to the ground.

4. **Output Voltage (V_OUT)**: The horizontal branch from the second stage continues to the right and is labeled as V_OUT, representing the output voltage of the circuit.

5. **Time Constant (τ)**: The image includes a notation "RC = τ" indicating that the product of the resistance (R) and capacitance (C) is equal to the time constant (τ) of the RC circuit.

In summary, the circuit consists of two RC low-pass filter stages connected in series, with each stage comprising a resistor and a capacitor. The capacitors are connected to the ground, and the resistors are connected in series with the input and output voltages. The time constant τ is a key parameter that determines the filtering characteristics of the circuit.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 5-10. Band Reject Filter." This suggests that it is a label for a figure in a document, likely a technical or educational text, that illustrates or explains a band reject filter. A band reject filter, also known as a notch filter, is an electronic filter that blocks or attenuates frequencies within a certain range and allows frequencies outside that range to pass through. The figure itself is not shown in the image, only the caption is visible.
```

$$\mathbf{G} = \frac{\sqrt{\mathbf{U} \mathbf{1}}}{\sqrt{\mathbf{U} \mathbf{N}}} = \frac{(\mathbf{1} + \mathbf{r}\mathbf{s})(\mathbf{1} + \mathbf{r}\mathbf{s})}{2\left(\mathbf{1} + \frac{\mathbf{r}\mathbf{s}}{\mathbf{0} \mathbf{A} \mathbf{4}}\right)\left(\mathbf{1} + \frac{\mathbf{r}\mathbf{s}}{\mathbf{4} \mathbf{56}}\right)}\tag{5-10}$$

The pole zero plot for each individual pole and zero is shown in Figure 5–11, and the combined pole zero plot is shown in Figure 5–12.

Feedback and Stability Theory 5-9

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the amplitude (in decibels, dB) versus the logarithm of the frequency (ω).

Key features of the plot include:

1. **Amplitude Axis (Vertical Axis)**: This axis is labeled "Amplitude" and measures in decibels (dB). It ranges from -6 dB to 0 dB.

2. **Frequency Axis (Horizontal Axis)**: This axis is labeled "LOG (ω)" and represents the logarithm of the frequency. Specific frequencies are marked on this axis.

3. **Segments of the Plot**:
   - **Flat Segment**: From the leftmost part of the plot to ω = 1/τ, the amplitude remains constant at 0 dB.
   - **Increasing Segment**: At ω = 1/τ, the plot starts to rise with a slope of 40 dB/decade.
   - **Decreasing Segment**: At ω = 0.44/τ, the plot begins to decrease with a slope of -20 dB/decade.
   - **Another Decreasing Segment**: At ω = 4.56/τ, the plot again decreases with a slope of -20 dB/decade.

4. **Critical Frequencies**:
   - **ω = 1/τ**: This frequency marks the transition from the flat segment to the increasing segment.
   - **ω = 0.44/τ**: This frequency marks the transition from the increasing segment to the first decreasing segment.
   - **ω = 4.56/τ**: This frequency marks the transition from the first decreasing segment to the second decreasing segment.

The plot visually represents how the amplitude of the system's response changes with frequency, highlighting key transitions and slopes.
```

Figure 5–11.Individual Pole Zero Plot of Band Reject Filter

Here is the image describtion:
```
The image is a Bode plot, which is used in control systems and signal processing to represent the frequency response of a system. The plot consists of two graphs: one for amplitude (in decibels, dB) and one for phase shift (in degrees), both plotted against the logarithm of the frequency (ω).

1. **Amplitude Plot (Top Graph):**
   - The y-axis represents the amplitude in decibels (dB).
   - The x-axis represents the logarithm of the frequency (LOG(ω)).
   - The amplitude starts at 0 dB for low frequencies.
   - At ω = 0.44/τ, the amplitude drops to -6 dB.
   - At ω = 1/τ, the amplitude reaches a minimum of -6 dB.
   - After ω = 1/τ, the amplitude increases back to 0 dB at ω = 4.56/τ and remains constant at 0 dB for higher frequencies.

2. **Phase Shift Plot (Bottom Graph):**
   - The y-axis represents the phase shift in degrees.
   - The x-axis is the same as the amplitude plot, representing the logarithm of the frequency (LOG(ω)).
   - The phase shift starts at 0 degrees for low frequencies.
   - It decreases slightly to around -5 degrees before ω = 0.44/τ.
   - The phase shift then increases, reaching approximately 12 degrees at ω = 1/τ.
   - It continues to increase, peaking at around 25 degrees before decreasing back to 0 degrees as the frequency increases beyond ω = 4.56/τ.

The plot shows the typical behavior of a system with a resonant frequency, where the amplitude dips and the phase shift peaks around the resonant frequency. The specific frequencies are marked on the x-axis as ω = 0.44/τ, ω = 1/τ, and ω = 4.56/τ.
```

Figure 5–12. Combined Pole Zero Plot of Band Reject Filter

The individual pole zero plots show the dc gain of 1/2 plotting as a straight line from the –6 dB intercept. The two zeros occur at the same break frequency, thus they add to a 40-dB/decade slope. The two poles are plotted at their breakpoints of ω = 0.44/τ and ω = 4.56/τ. The combined amplitude plot intercepts the amplitude axis at –6 dB because of the dc gain, and then breaks down at the first pole. When the amplitude function gets to the double zero, the first zero cancels out the first pole, and the second zero breaks up. The upward slope continues until the second pole cancels out the second zero, and the amplitude is flat from that point out in frequency.

When the separation between all the poles and zeros is great, a decade or more in frequency, it is easy to draw the Bode plot. As the poles and zeros get closer together, the plot gets harder to make. The phase is especially hard to plot because of the tangent function, but picking a few salient points and sketching them in first gets a pretty good approximation.[3] The Bode plot enables the designer to get a good idea of pole zero placement, and it is valuable for fast evaluation of possible compensation techniques. When the situation gets critical, accurate calculations must be made and plotted to get an accurate result. Consider Equation 5–11.

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{A}}{\mathsf{I} + \mathsf{A}\mathsf{A}}\tag{5-\mathsf{T}\mathsf{I}}$$

Taking the log of Equation 5–11 yields Equation 5–12.

$$20\mathsf{Log}\left(\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}}\right) = 20\mathsf{Log}(\mathsf{A}) - 20\mathsf{Log}(\mathsf{1} + \mathsf{A}\beta) \tag{5-12}$$

If A and β do not contain any poles or zeros there will be no break points. Then the Bode plot of Equation 5–12 looks like that shown in Figure 5–13, and because there are no poles to contribute negative phase shift, the circuit cannot oscillate.

Here is the image describtion:
```
The image is a graphical representation of the amplitude response of a feedback amplifier system in decibels (dB) as a function of the logarithm of the frequency (LOG(ω)). The vertical axis represents the amplitude in decibels (dB), while the horizontal axis represents the logarithm of the frequency (LOG(ω)).

Key elements of the graph include:

1. **Amplitude Axis (Vertical Axis)**: 
   - The vertical axis is labeled "Amplitude" and is measured in decibels (dB).
   - It has specific points marked, such as 0 dB at the bottom, 20 LOG(A) at the top, and 20 LOG(V_OUT/V_IN) in the middle.

2. **Frequency Axis (Horizontal Axis)**:
   - The horizontal axis is labeled "LOG(ω)", representing the logarithm of the frequency.

3. **Gain Representation**:
   - The top horizontal line represents the open-loop gain of the amplifier, denoted as 20 LOG(A).
   - The middle horizontal line represents the closed-loop gain of the amplifier, denoted as 20 LOG(V_OUT/V_IN).
   - The difference between the open-loop gain and the closed-loop gain is represented by the term 20 LOG(1 + Aβ), where A is the open-loop gain and β is the feedback factor.

4. **Arrows and Labels**:
   - There are vertical arrows indicating the difference between the open-loop gain (20 LOG(A)) and the closed-loop gain (20 LOG(V_OUT/V_IN)), labeled as 20 LOG(1 + Aβ).

The graph illustrates how feedback affects the gain of an amplifier, showing that the closed-loop gain is reduced compared to the open-loop gain by a factor of 20 LOG(1 + Aβ).
```

Figure 5–13. When No Pole Exists in Equation (5–12)

All real amplifiers have many poles, but they are normally internally compensated so that they appear to have a single pole. Such an amplifier would have an equation similar to that given in Equation 5–13.

$$\mathbf{A} = \frac{\mathbf{a}}{\mathbf{1} + \mathbf{j}\frac{00}{00}}\tag{5-13}$$

The plot for the single pole amplifier is shown in Figure 5–14.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the relationship between the amplitude (in decibels, dB) and the logarithm of the frequency (LOG(ω)).

Here are the key features of the plot:

1. **Axes**:
   - The vertical axis represents the amplitude in decibels (dB).
   - The horizontal axis represents the logarithm of the frequency (LOG(ω)).

2. **Amplitude Levels**:
   - The plot starts at a high amplitude level of 20 LOG(A) dB.
   - There is a horizontal line at 20 LOG(V_OUT/V_IN) dB, which is the gain of the system.

3. **Frequency Points**:
   - There are two specific frequencies marked on the horizontal axis: ω = ω_a and another unspecified frequency ω.

4. **Gain Reduction**:
   - The plot shows a drop in amplitude from 20 LOG(A) dB to 20 LOG(1 + Aβ) dB. This drop is indicated by a vertical arrow.
   - After the frequency ω_a, the plot shows a downward slope, indicating a decrease in gain with increasing frequency.

5. **Slope**:
   - The slope of the line after ω_a is negative, indicating that the gain decreases as the frequency increases.

6. **Label "x"**:
   - There is a point marked with "x" on the plot, which is on the downward slope after the frequency ω_a.

In summary, the Bode plot illustrates how the gain of a system changes with frequency, showing a high gain at low frequencies and a decreasing gain at higher frequencies. The specific points and slopes provide detailed information about the system's frequency response characteristics.
```

Figure 5–14. When Equation 5–12 has a Single Pole

Feedback and Stability Theory 5-11

The amplifier gain, A, intercepts the amplitude axis at 20Log(A), and it breaks down at a slope of –20 dB/decade at ω = ωa. The negative slope continues for all frequencies greater than the breakpoint, ω = ωa. The closed loop circuit gain intercepts the amplitude axis at 20Log(VOUT/VIN), and because β does not have any poles or zeros, it is constant until its projection intersects the amplifier gain at point X. After intersection with the amplifier gain curve, the closed loop gain follows the amplifier gain because the amplifier is the controlling factor.

Actually, the closed loop gain starts to roll off earlier, and it is down 3 dB at point X. At point X the difference between the closed loop gain and the amplifier gain is –3 dB, thus according to Equation 5–12 the term –20Log(1+Aβ) = –3 dB. The magnitude of 3 dB is √2 , hence

<sup>1</sup> (A) <sup>2</sup> 2 , and elimination of the radicals shows that Aβ = 1. There is a method [4] of relating phase shift and stability to the slope of the closed loop gain curves, but only the Bode method is covered here. An excellent discussion of poles, zeros, and their interaction is given by M. E Van Valkenberg,[5] and he also includes some excellent prose to liven the discussion.

# **5.5 Loop Gain Plots are the Key to Understanding Stability**

Stability is determined by the loop gain, and when Aβ = –1 = |1| ∠–180° instability or oscillation occurs. If the magnitude of the gain exceeds one, it is usually reduced to one by circuit nonlinearities, so oscillation generally results for situations where the gain magnitude exceeds one.

Consider oscillator design, which depends on nonlinearities to decrease the gain magnitude; if the engineer designed for a gain magnitude of one at nominal circuit conditions, the gain magnitude would fall below one under worst case circuit conditions causing oscillation to cease. Thus, the prudent engineer designs for a gain magnitude of one under worst case conditions knowing that the gain magnitude is much more than one under optimistic conditions. The prudent engineer depends on circuit nonlinearities to reduce the gain magnitude to the appropriate value, but this same engineer pays a price of poorer distortion performance. Sometimes a design compromise is reached by putting a nonlinear component, such as a lamp, in the feedback loop to control the gain without introducing distortion.

Some high gain control systems always have a gain magnitude greater than one, but they avoid oscillation by manipulating the phase shift. The amplifier designer who pushes the amplifier for superior frequency performance has to be careful not to let the loop gain phase shift accumulate to 180°. Problems with overshoot and ringing pop up before the loop gain reaches 180° phase shift, thus the amplifier designer must keep a close eye on loop dynamics. Ringing and overshoot are handled in the next section, so preventing oscillation is emphasized in this section. Equation 5–14 has the form of many loop gain transfer functions or circuits, so it is analyzed in detail.

Here is the image describtion:
```
The image consists of two main parts: a mathematical expression and a Bode plot.

1. **Mathematical Expression:**
   - The expression at the top of the image is given as:
     \[
     (A)\beta = \frac{K}{(1 + \tau_1(s))(1 + \tau_2(s))}
     \]
   - This represents a transfer function in the Laplace domain, where \( K \) is a constant gain, \( \tau_1 \) and \( \tau_2 \) are time constants, and \( s \) is the complex frequency variable in the Laplace transform.

2. **Bode Plot:**
   - The Bode plot is a graphical representation of the transfer function's frequency response, showing both amplitude and phase as functions of frequency.
   - The vertical axis on the left side is labeled "Amplitude (Aβ)" in decibels (dB).
   - The vertical axis on the right side is labeled "Phase (Aβ)" in degrees.
   - The horizontal axis is labeled "LOG(f)" indicating the logarithm of the frequency.

   **Amplitude Plot:**
   - The amplitude plot starts at a value of \( 20 \log(K) \) dB.
   - It remains constant until the frequency reaches \( 1/\tau_1 \), where it begins to decrease at a rate of -20 dB/decade.
   - At the frequency \( 1/\tau_2 \), the slope of the amplitude plot changes to -40 dB/decade.

   **Phase Plot:**
   - The phase plot starts at 0 degrees.
   - At the frequency \( 1/\tau_1 \), the phase begins to decrease, reaching -45 degrees.
   - The phase continues to decrease, reaching -135 degrees at the frequency \( 1/\tau_2 \).
   - Eventually, the phase approaches -180 degrees.

   **Additional Annotations:**
   - "GM" indicates the Gain Margin, which is the difference in dB between the amplitude plot and 0 dB at the phase crossover frequency (where the phase is -180 degrees).
   - "φ_M" indicates the Phase Margin, which is the difference in degrees between the phase plot and -180 degrees at the gain crossover frequency (where the amplitude is 0 dB).

Overall, the image provides a detailed representation of a second-order system's frequency response, including key parameters such as gain margin and phase margin.
```

Figure 5–15. Magnitude and Phase Plot of Equation 5–14

The quantity, K, is the dc gain, and it plots as a straight line with an intercept of 20Log(K). The Bode plot of Equation 5–14 is shown in Figure 5–15. The two break points, ω = ω<sup>1</sup> = 1/τ<sup>1</sup> and ω = ω2 = 1/τ2, are plotted in the Bode plot. Each breakpoint adds –20 dB/decade slope to the plot, and 45° phase shift accumulates at each breakpoint. This transfer function is referred to as a two slope because of the two breakpoints. The slope of the curve when it crosses the 0 dB intercept indicates phase shift and the ability to oscillate. Notice that a one slope can only accumulate 90° phase shift, so when a transfer function passes through 0 dB with a one slope, it cannot oscillate. Furthermore, a two-slope system can accumulate 180° phase shift, therefore a transfer function with a two or greater slope is capable of oscillation.

A one slope crossing the 0 dB intercept is stable, whereas a two or greater slope crossing the 0 dB intercept may be stable or unstable depending upon the accumulated phase shift. Figure 5–15 defines two stability terms; the phase margin, φM, and the gain margin, GM. Of these two terms the phase margin is much more important because phase shift is critical for stability. Phase margin is a measure of the difference in the actual phase shift and the theoretical 180° required for oscillation, and the phase margin measurement or calculation is made at the 0 dB crossover point. The gain margin is measured or calculated at the 180° phase crossover point. Phase margin is expressed mathematically in Equation 5–15.

$$
\boldsymbol{\phi}\_{\mathbf{M}} = \mathsf{T}\mathsf{80} - \mathsf{tangent}^{-\mathsf{T}}(\mathsf{A}\boldsymbol{\beta})\tag{5-15}
$$

Feedback and Stability Theory 5-13

The phase margin in Figure 5–15 is very small, 20°, so it is hard to measure or predict from the Bode plot. A designer probably doesn't want a 20° phase margin because the system overshoots and rings badly, but this case points out the need to calculate small phase margins carefully. The circuit is stable, and it does not oscillate because the phase margin is positive. Also, the circuit with the smallest phase margin has the highest frequency response and bandwidth.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one for amplitude (or gain) and one for phase, both plotted against the logarithm of frequency (LOG(f)).

1. **Amplitude Plot (Top Plot):**
   - The vertical axis represents the amplitude in decibels (dB), specifically 20 LOG(Aβ).
   - The horizontal axis represents the logarithm of frequency (LOG(f)).
   - There are two curves shown:
     - The dashed line represents 20 LOG(K), which is a constant gain.
     - The solid line represents 20 LOG(K + C), which shows a gain that changes with frequency.
   - The plot shows two breakpoints at frequencies 1/τ1 and 1/τ2, where the slope of the amplitude curve changes.
   - Initially, the amplitude is constant at 20 LOG(K). After the first breakpoint (1/τ1), the amplitude starts to decrease at a certain rate. After the second breakpoint (1/τ2), the amplitude decreases at a steeper rate.

2. **Phase Plot (Bottom Plot):**
   - The vertical axis represents the phase in degrees.
   - The horizontal axis is the same as the amplitude plot, representing the logarithm of frequency (LOG(f)).
   - The phase starts at 0 degrees and decreases as the frequency increases.
   - The phase plot shows two significant points corresponding to the breakpoints in the amplitude plot (1/τ1 and 1/τ2).
   - At the first breakpoint (1/τ1), the phase starts to decrease more rapidly.
   - At the second breakpoint (1/τ2), the phase continues to decrease, reaching -180 degrees eventually.
   - The phase margin (φM) is indicated to be 0 degrees at the end of the plot.

Overall, the Bode plot provides a comprehensive view of how the amplitude and phase of a system's output respond to different input frequencies.
```

Figure 5–16. Magnitude and Phase Plot of the Loop Gain Increased to (K+C)

Increasing the loop gain to (K+C) as shown in Figure 5–16 shifts the magnitude plot up. If the pole locations are kept constant, the phase margin reduces to zero as shown, and the circuit will oscillate. The circuit is not good for much in this condition because production tolerances and worst case conditions ensure that the circuit will oscillate when you want it to amplify, and vice versa.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one for amplitude (or gain) and one for phase, both plotted against the logarithm of frequency (LOG(f)).

1. **Amplitude Plot (Top Plot):**
   - The vertical axis represents the amplitude in decibels (dB).
   - The horizontal axis represents the logarithm of frequency (LOG(f)).
   - The amplitude starts at a value of 20 LOG(K) and remains constant until a certain frequency.
   - At the frequency 1/τ1, the amplitude begins to decrease at a rate of -20 dB/decade.
   - The dashed line represents 20 LOG(Aβ), which also starts at 20 LOG(K) but decreases at a different rate after 1/τ1.

2. **Phase Plot (Bottom Plot):**
   - The vertical axis represents the phase in degrees.
   - The horizontal axis represents the logarithm of frequency (LOG(f)).
   - The phase starts at 0 degrees and begins to decrease as the frequency increases.
   - At the frequency 1/τ2, the phase decreases more rapidly.
   - The phase decreases to -45 degrees and continues to decrease, passing through -135 degrees, and approaches -180 degrees as the frequency increases further.

3. **Key Points:**
   - The plot shows two critical frequencies, 1/τ1 and 1/τ2, where changes in the slope of the amplitude and phase occur.
   - The phase margin (ϕ_M) is indicated to be 0 degrees at the far right of the phase plot.
   - The amplitude plot shows a break point at 1/τ1, where the slope changes.
   - The phase plot shows a break point at 1/τ2, where the phase starts to decrease more rapidly.

Overall, the Bode plot provides a visual representation of how the amplitude and phase of a system's output respond to different input frequencies.
```

Figure 5–17. Magnitude and Phase Plot of the Loop Gain With Pole Spacing Reduced

The circuit poles are spaced closer in Figure 5–17, and this results in a faster accumulation of phase shift. The phase margin is zero because the loop gain phase shift reaches 180° before the magnitude passes through 0 dB. This circuit oscillates, but it is not a very stable oscillator because the transition to 180° phase shift is very slow. Stable oscillators have a very sharp transition through 180°.

When the closed loop gain is increased the feedback factor, β, is decreased because VOUT/VIN = 1/β for the ideal case. This in turn decreases the loop gain, Aβ, thus the stability increases. In other words, increasing the closed loop gain makes the circuit more stable. Stability is not important except to oscillator designers because overshoot and ringing become intolerable to linear amplifiers long before oscillation occurs. The overshoot and ringing situation is investigated next.

# **5.6 The Second Order Equation and Ringing/Overshoot Predictions**

The second order equation is a common approximation used for feedback system analysis because it describes a two-pole circuit, which is the most common approximation used. All real circuits are more complex than two poles, but except for a small fraction, they can be represented by a two-pole equivalent. The second order equation is extensively described in electronic and control literature [ 6] .

$$\left(\mathsf{T} + \mathsf{A}\mathsf{B}\right) = \mathsf{T} + \frac{\mathsf{K}}{\left(\mathsf{T} + \mathsf{r}\_1\mathsf{S}\right)\left(\mathsf{T} + \mathsf{r}\_2\mathsf{S}\right)}\tag{5-16}$$

After algebraic manipulation Equation 5–16 is presented in the form of Equation 5–17.

$$\mathbf{s}^2 + \mathbf{S}\frac{\mathbf{r}\_1 + \mathbf{r}\_2}{\mathbf{r}\_1\,\mathbf{r}\_2} + \frac{\mathbf{r}\_1 + \mathbf{K}}{\mathbf{r}\_1\,\mathbf{r}\_2} = \mathbf{0} \tag{5-17}$$

Equation 5–17 is compared to the second order control Equation 5–18, and the damping ratio, ζ, and natural frequency, wN are obtained through like term comparisons.

$$\mathbf{s}^2 + 2\xi\boldsymbol{\alpha}\_{\mathsf{N}}\mathbf{s} + \boldsymbol{\alpha}\_{\mathsf{N}}^2 \tag{5-18}$$

Comparing these equations yields formulas for the phase margin and per cent overshoot as a function of damping ratio.

$$\alpha\_{\mathsf{N}} = \sqrt{\frac{\mathsf{T} + \mathsf{K}}{\mathsf{T}\_{\mathsf{1}}\mathsf{T}\_{\mathsf{2}}}} \tag{5-19}$$

$$\hat{\xi} = \frac{\mathsf{r}\_{1} + \mathsf{r}\_{2}}{2\mathsf{u}\_{N}\mathsf{r}\_{1}\mathsf{r}\_{2}}\tag{5-20}$$

When the two poles are well separated, Equation 5–21 is valid.

Feedback and Stability Theory 5-15

$$
\boldsymbol{\phi\_M} = \mathbf{tangent}^{-\uparrow}(\mathbf{2\bar{\xi}}) \tag{5-21}
$$

The salient equations are plotted in Figure 5–18, which enables a designer to determine the phase margin and overshoot when the gain and pole locations are known.

Here is the image describtion:
```
The image is a graph that plots the relationship between the damping ratio (ζ) on the vertical axis and two different parameters on the horizontal axis: Percent Maximum Overshoot and Phase Margin (ϕ_M). 

- The vertical axis is labeled "Damping Ratio, ζ" and ranges from 0 to 1.
- The horizontal axis is labeled with two different parameters: "Percent Maximum Overshoot" and "Phase Margin, ϕ_M". The range for both parameters on the horizontal axis is from 0 to 80.

There are two curves on the graph:
1. The first curve represents the Percent Maximum Overshoot. It starts at the top left corner (high damping ratio, low percent overshoot) and curves downward to the bottom right corner (low damping ratio, high percent overshoot). This curve shows that as the damping ratio decreases, the percent maximum overshoot increases.
2. The second curve represents the Phase Margin. It starts at the bottom left corner (low damping ratio, low phase margin) and curves upward to the top right corner (high damping ratio, high phase margin). This curve shows that as the damping ratio increases, the phase margin also increases.

The two curves intersect at a point where the damping ratio is approximately 0.4. This intersection indicates a balance point between the percent maximum overshoot and the phase margin.

The graph is overlaid with a grid to help read the values more accurately. The grid lines are evenly spaced, providing a clear reference for both the vertical and horizontal axes.
```

Figure 5–18. Phase Margin and Overshoot vs Damping Ratio

Enter Figure 5–18 at the calculated damping ratio, say 0.4, and read the overshoot at 25% and the phase margin at 42°. If a designer had a circuit specification of 5% maximum overshoot, then the damping ratio must be 0.78 with a phase margin of 62°.

# **5.7 References**

- 1. DiStefano, Stubberud, and Williams, Theory and Problems of Feedback and Control Systems, Schaum's Outline Series, Mc Graw Hill Book Company, 1967
- 2. Bode, H. W., Network Analysis And Feedback Amplifier Design, D. Van Nostrand, Inc., 1945
- 3. Frederickson, Thomas, Intuitive Operational Amplifiers, McGraw Hill Book Company, 1988
- 4. Bower, J. L. and Schultheis, P. M., Introduction To The Design Of Servomechanisms, Wiley, 1961
- 5. Van Valkenberg, M. E., Network Analysis, Prentice-Hall, 1964
- 6. Del Toro, V., and Parker, S., Principles of Control Systems Engineering, McGraw–Hill, 1960.

# **Chapter 6**

# **Development of the Non Ideal Op Amp Equations**

Ron Mancini

# **6.1 Introduction**

There are two types of error sources in op amps, and they fall under the general classification of dc and ac errors. Examples of dc errors are input offset voltage and input bias current. The dc errors stay constant over the usable op amp frequency range; therefore, the input bias current is 10 pA at 1 kHz and it is 10 pA at 10 kHz. Because of their constant and controlled behavior, dc errors are not considered until later chapters.

AC errors are flighty, so we address them here by developing a set of nonideal equations that account for ac errors. The ac errors may show up under dc conditions, but they get worse as the operating frequency increases. A good example of an ac error is common– mode rejection ration (CMRR). Most op amps have a guaranteed CMRR specification, but this specification is only valid at dc or very low frequencies. Further inspection of the data sheet reveals that CMRR decreases as operating frequency increases. Several other specifications that fall into the category of ac specifications are output impedance, power-supply rejection-ratio, peak-to-peak output voltage, differential gain, differential phase, and phase margin.

Differential gain is the most important ac specification because the other ac specifications are derived from the differential gain. Until now, differential gain has been called op amp gain or op amp open loop gain, and we shall continue with that terminology. Let the data sheet call it differential gain.

As shown in prior chapters, when frequency increases, the op amp gain decreases and errors increase. This chapter develops the equations that illustrate the effects of the gain changes. We start with a review of the basic canonical feedback system stability because the op amp equations are developed using the same techniques.

Amplifiers are built with active components such as transistors. Pertinent transistor parameters like transistor gain are subject to drift and initial inaccuracies from many sources, so amplifiers being built from these components are subject to drift and inaccuracies. The drift and inaccuracy is minimized or eliminated by using negative feedback. The op amp circuit configuration employs feedback to make the transfer equation of the circuit independent of the amplifier parameters (well almost), and while doing this, the circuit transfer function is made dependent on external passive components. The external passive components can be purchased to meet almost any drift or accuracy specification; only the cost and size of the passive components limit their use.

Once feedback is applied to the op amp it is possible for the op amp circuit to become unstable. Certain amplifiers belong to a family called internally compensated op amps; they contain internal capacitors that are sometimes advertised as precluding instabilities. Although internally compensated op amps should not oscillate when operated under specified conditions, many have relative stability problems that manifest themselves as poor phase response, ringing, and overshoot. The only absolutely stable internally compensated op amp is the one lying on the workbench without power applied! All other internally compensated op amps oscillate under some external circuit conditions.

Noninternally compensated or externally compensated op amps are unstable without the addition of external stabilizing components. This situation is a disadvantage in many cases because they require additional components, but the lack of internal compensation enables the top-drawer circuit designer to squeeze the last drop of performance from the op amp. You have two options: op amps internally compensated by the IC manufacturer, or op amps externally compensated by you. Compensation, except that done by the op amp manufacturer, must be done external to the IC. Surprisingly enough, internally compensated op amps require external compensation for demanding applications.

Compensation is achieved by adding external components that modify the circuit transfer function so that it becomes unconditionally stable. There are several different methods of compensating an op amp, and as you might suspect, there are pros and cons associated with each method of compensation. After the op amp circuit is compensated, it must be analyzed to determine the effects of compensation. The modifications that compensation have on the closed loop transfer function often determine which compensation scheme is most profitably employed.

# **6.2 Review of the Canonical Equations**

A block diagram for a generalized feedback system is repeated in Figure 6–1. This simple block diagram is sufficient to determine the stability of any system.

Here is the image describtion:
```
The image depicts a block diagram of a feedback control system. Here is a detailed description of the components and their connections:

1. **Input Signal (V_IN)**: The system starts with an input signal labeled as V_IN, which is fed into the system.

2. **Summing Junction (Σ)**: The input signal V_IN enters a summing junction, represented by a circle with a summation symbol (Σ) inside it. This junction has two inputs: one positive (from V_IN) and one negative (from the feedback loop). The output of this summing junction is labeled as E, which represents the error signal. The error signal E is the difference between the input signal V_IN and the feedback signal.

3. **Forward Path (A)**: The error signal E is then fed into a block labeled A, which represents the forward path gain or transfer function of the system. The output of this block is the system's output signal, labeled as V_OUT.

4. **Output Signal (V_OUT)**: The output signal V_OUT is the result of the forward path processing and is the final output of the system.

5. **Feedback Path (β)**: The output signal V_OUT is also fed back into the system through a feedback path. This path includes a block labeled β, which represents the feedback gain or transfer function. The output of this block is the feedback signal.

6. **Feedback Loop**: The feedback signal from the block β is fed back into the summing junction (Σ) at the negative input, completing the feedback loop.

In summary, the diagram illustrates a classic negative feedback control system where the output is fed back and subtracted from the input to generate an error signal, which is then processed to produce the system's output. The feedback helps in stabilizing and controlling the system's behavior.
```

Figure 6–1. Feedback System Block Diagram

The output and error equation development is repeated below.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{E}\mathsf{A} \tag{6-4}$$

$$\mathsf{E} = \mathsf{V}\_{\mathsf{IN}} - \beta \mathsf{V}\_{\mathsf{OUT}} \tag{6-2}$$

Combining Equations 6–1 and 6–2 yields Equation 6–3:

$$\frac{\mathsf{V\_{\mathsf{OUT}}}}{\mathsf{A}} = \mathsf{V\_{\mathsf{IN}}} - \beta \mathsf{V\_{\mathsf{OUT}}} \tag{6-3}$$

Collecting terms yields Equation 6–4:

$$\mathsf{V}\_{\mathsf{OUL}}\left(\frac{\mathsf{T}}{\mathsf{A}} + \mathsf{\beta}\right) = \mathsf{V}\_{\mathsf{IN}}\tag{6-4}$$

Rearranging terms yields the classic form of the feedback equation.

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{A}}{\mathsf{I} + \mathsf{A}\mathsf{\beta}}\tag{6-5}$$

Notice that Equation 6–5 reduces to Equation 6–6 when the quantity Aβ in Equation 6–5 becomes very large with respect to one. Equation 6–6 is called the ideal feedback equation because it depends on the assumption that Aβ >> 1, and it finds extensive use when amplifiers are assumed to have ideal qualities. Under the conditions that Aβ >>1, the system gain is determined by the feedback factor β. Stable passive circuit components are used to implement the feedback factor, thus the ideal closed loop gain is predictable and stable because β is predictable and stable.

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{1}{\mathsf{\mathcal{B}}} \tag{6-6}$$

The quantity Aβ is so important that it has been given a special name, loop gain. Consider Figure 6–2; when the voltage inputs are grounded (current inputs are opened) and the loop is broken, the calculated gain is the loop gain, Aβ. Now, keep in mind that this is a mathematics of complex numbers, which have magnitude and direction. When the loop gain approaches minus one, or to express it mathematically 1 ∠ –180°, Equation 6–5 approaches infinity because 1/0 ⇒ ∞. The circuit output heads for infinity as fast as it can

**A** β <sup>Σ</sup> **<sup>+</sup> – AVTEST VTEST VRETURN VTEST VRETURN = A**<sup>β</sup>

using the equation of a straight line. If the output were not energy limited the circuit would explode the world, but it is energy limited by the power supplies so the world stays intact.

Here is the image describtion:
```
The image is a snippet of text that appears to be a caption for a figure in a document, likely a technical or engineering manual. The text reads: "Figure 6–2. Feedback Loop Broken to Calculate Loop Gain." This suggests that the figure referenced (Figure 6-2) illustrates a feedback loop that has been interrupted or "broken" in order to analyze or calculate the loop gain, which is a measure of the amplification of the feedback loop in a control system. The text is in a standard, serif font and is likely part of a larger document that includes multiple figures and explanations related to feedback loops and control systems.
```

Active devices in electronic circuits exhibit nonlinear behavior when their output approaches a power supply rail, and the nonlinearity reduces the amplifier gain until the loop gain no longer equals 1∠ –180°. Now the circuit can do two things: first, it could become stable at the power supply limit, or second, it can reverse direction (because stored charge keeps the output voltage changing) and head for the negative power supply rail.

The first state where the circuit becomes stable at a power supply limit is named lockup; the circuit will remain in the locked up state until power is removed. The second state where the circuit bounces between power supply limits is named oscillatory. Remember, the loop gain, Aβ, is the sole factor that determines stability for a circuit or system. Inputs are grounded or disconnected when the loop gain is calculated, so they have no effect on stability. The loop gain criteria is analyzed in depth later.

Equations 6–1 and 6–2 are combined and rearranged to yield Equation 6–7, which gives an indication of system or circuit error.

$$\mathsf{E} = \frac{\mathsf{V}\_{\mathsf{IN}}}{\mathsf{1} + \mathsf{A}\mathsf{\beta}} \tag{6-7}$$

First, notice that the error is proportional to the input signal. This is the expected result because a bigger input signal results in a bigger output signal, and bigger output signals require more drive voltage. Second, the loop gain is inversely proportional to the error. As the loop gain increases the error decreases, thus large loop gains are attractive for minimizing errors. Large loop gains also decrease stability, thus there is always a tradeoff between error and stability.

# **6.3 Noninverting Op Amps**

A noninverting op amp is shown in Figure 6–3. The dummy variable, VB, is inserted to make the calculations easier and a is the op amp gain.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit in a non-inverting configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the following labels:
   - The non-inverting input (+) is connected to the input voltage source \( V_{IN} \).
   - The inverting input (-) is connected to a node that is part of a feedback network.
   - The output of the op-amp is labeled \( V_{OUT} \).

2. **Input Voltage Source (\( V_{IN} \))**: This is depicted as a circle with a line extending to the non-inverting input of the op-amp. The other side of the voltage source is connected to the ground.

3. **Feedback Network**: This consists of two impedances:
   - \( Z_F \): This impedance is connected between the output of the op-amp and the inverting input (-).
   - \( Z_G \): This impedance is connected between the inverting input (-) and a node labeled \( V_B \).

4. **Ground Connections**: The circuit has several ground connections:
   - The negative terminal of the input voltage source \( V_{IN} \) is connected to the ground.
   - The node labeled \( V_B \) is connected to the ground.
   - The bottom terminal of \( Z_G \) is connected to the ground.

5. **Node \( V_B \)**: This node is connected to the ground and serves as a reference point for the impedance \( Z_G \).

In summary, the circuit is a non-inverting amplifier configuration where the input voltage \( V_{IN} \) is applied to the non-inverting input of the op-amp. The feedback network, consisting of \( Z_F \) and \( Z_G \), determines the gain of the amplifier. The output voltage \( V_{OUT} \) is taken from the output of the op-amp.
```

Figure 6–3. Noninverting Op Amp

Equation 6–8 is the amplifier transfer equation.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{a} \left( \mathsf{V}\_{\mathsf{IN}} - \mathsf{V}\_{\mathsf{B}} \right) \tag{6-8}$$

The output equation is developed with the aid of the voltage divider rule. Using the voltage divider rule assumes that the op amp impedance is low.

$$\mathsf{V}\_{\mathsf{B}} = \frac{\mathsf{V}\_{\mathsf{OUT}} \mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}}} \text{ for } \mathsf{l}\_{\mathsf{B}} = \mathsf{0} \tag{6-9}$$

Combining Equations 6–8 and 6–9 yields Equation 6–10.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{a}\mathsf{V}\_{\mathsf{IN}} - \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}} \tag{6-10}$$

Rearranging terms in Equation 6–10 yields Equation 6–11, which describes the transfer function of the circuit.

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{a}}{\mathsf{1} + \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}}} \tag{6-11}$$

Equation 6–5 is repeated as Equation 6–12 to make a term by term comparison of the equations easy.

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{A}}{\mathsf{I} + \mathsf{A}\mathsf{B}}\tag{6-12}$$

By virtue of the comparison we get Equation 6–13, which is the loop-gain equation for the noninverting op amp. The loop-gain equation determines the stability of the circuit. The

Development of the Non Ideal Op Amp Equations 6-5

comparison also shows that the open loop gain, A, is equal to the op amp open loop gain, a, for the noninverting circuit.

$$\mathsf{A}\emptyset = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}} \tag{\mathsf{6-13}}$$

Equation 6–13 is also derived with the aid of Figure 6–4, which shows the open loop noninverting op amp.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the label 'a' inside it, indicating the open-loop gain of the amplifier. The triangle has three terminals:
   - The non-inverting input (+) is connected to ground.
   - The inverting input (-) is connected to a node where two components meet.
   - The output is labeled as 'aV_TEST'.

2. **Feedback Network**:
   - There is a feedback resistor labeled 'Z_F' connected between the output of the op-amp and the inverting input (-).
   - Another resistor labeled 'Z_G' is connected between the inverting input (-) and ground.

3. **Input Connections**:
   - The input voltage 'V_TEST' is applied through a switch to the inverting input (-) of the op-amp.
   - There is another switch connected to the inverting input (-) that can connect it to 'V_RETURN', which is also grounded.

4. **Ground Connections**:
   - The non-inverting input (+) of the op-amp is directly connected to ground.
   - The bottom end of the resistor 'Z_G' is connected to ground.
   - 'V_RETURN' is connected to ground.

In summary, this is a typical inverting amplifier configuration where the input voltage 'V_TEST' is applied to the inverting input through a switch, and the feedback network consists of resistors 'Z_F' and 'Z_G'. The non-inverting input is grounded, and the output voltage is a scaled and inverted version of the input voltage, determined by the ratio of the feedback resistors.
```

### Figure 6–4. Open Loop Noninverting Op Amp

The test voltage, VTEST, is multiplied by the op amp open loop gain to obtain the op amp output voltage, aVTEST. The voltage divider rule is used to calculate Equation 6–15, which is identical to Equation 6–14 after some algebraic manipulation.

$$\mathbf{V}\_{\mathsf{RETURN}} = \frac{\mathbf{a} \mathbf{V}\_{\mathsf{TEST}} \mathbf{Z}\_{\mathsf{G}}}{\mathbf{Z}\_{\mathsf{F}} + \mathbf{Z}\_{\mathsf{G}}} \tag{6-14}$$

$$\frac{\mathsf{V}\_{\mathsf{RETURN}}}{\mathsf{V}\_{\mathsf{TESTI}}} = \mathsf{A}\mathfrak{F} = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}}} \tag{6-\mathsf{15}}$$

# **6.4 Inverting Op Amps**

The inverting op amp circuit is shown in Figure 6–5. The dummy variable (VA) is inserted to make the calculations easier, and a is the op amp open loop gain.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the apex pointing to the right. It has two input terminals and one output terminal. The positive input terminal is marked with a "+" sign, and the negative input terminal is marked with a "-" sign. The output terminal is at the rightmost point of the triangle.

2. **Input Voltage Source (VIN)**: On the left side of the image, there is a voltage source labeled VIN. This source is connected to the ground on its negative side.

3. **Input Resistor (ZG)**: The positive side of the voltage source VIN is connected to a resistor labeled ZG. This resistor is connected in series between the voltage source and the inverting input terminal of the op-amp.

4. **Feedback Resistor (ZF)**: There is another resistor labeled ZF connected between the output terminal of the op-amp and the inverting input terminal. This resistor forms a feedback loop.

5. **Non-Inverting Input**: The non-inverting input terminal of the op-amp is connected directly to the ground.

6. **Output Voltage (VOUT)**: The output terminal of the op-amp is labeled VOUT, which represents the output voltage of the circuit.

7. **Bias Current (IB)**: There is an arrow labeled IB pointing towards the inverting input terminal of the op-amp, indicating the bias current flowing into the inverting input.

8. **Virtual Ground (VA)**: The node where the resistors ZG and ZF meet is labeled VA. This point is often referred to as a virtual ground in the context of op-amp circuits because, ideally, the voltage at this point is zero due to the high gain of the op-amp.

In summary, this is a non-inverting op-amp configuration with an input voltage source VIN, input resistor ZG, feedback resistor ZF, and an output voltage VOUT. The non-inverting input is grounded, and the inverting input is connected to the junction of ZG and ZF, forming a feedback loop. The bias current IB flows into the inverting input terminal.
```

Figure 6–5. Inverting Op Amp

6-6

The transfer equation is given in Equation 6–16:

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{aV}\_{\mathsf{A}}\tag{6-\mathsf{M}}$$

The node voltage (Equation 6–17) is obtained with the aid of superposition and the voltage divider rule. Equation 6–18 is obtained by combining Equations 6–16 and 6–17.

$$\mathbb{V}\_{\mathsf{A}} = \frac{\mathbb{V}\_{\mathsf{IN}} \mathbb{Z}\_{\mathsf{F}}}{\mathbb{Z}\_{\mathsf{G}} + \mathbb{Z}\_{\mathsf{F}}} + \frac{\mathbb{V}\_{\mathsf{O}\mathsf{OUT}} \mathbb{Z}\_{\mathsf{G}}}{\mathbb{Z}\_{\mathsf{G}} + \mathbb{Z}\_{\mathsf{F}}} \text{ for } \mathsf{I}\_{\mathsf{B}} = \mathsf{0} \tag{6-17}$$

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\frac{-\mathsf{a}\mathsf{Z}\_{\mathsf{F}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}}}{1 + \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}}}\tag{6-18}$$

Equation 6–16 is the transfer function of the inverting op amp. By virtue of the comparison between Equations 6–18 and 6–14, we get Equation 6–15 again, which is also the loop gain equation for the inverting op amp circuit. The comparison also shows that the open loop gain (A) is different from the op amp open loop gain (a) for the noninverting circuit.

The inverting op amp with the feedback loop broken is shown in Figure 6–6, and this circuit is used to calculate the loop-gain given in Equation 6–19.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) with a feedback network. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangle with the symbol 'a' inside it, indicating its gain.
   - The inverting input (marked with a minus sign) is connected to a node where two impedances, \( Z_F \) and \( Z_G \), meet.
   - The non-inverting input (marked with a plus sign) is connected to the ground.

2. **Impedances**:
   - \( Z_F \): This impedance is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input.
   - \( Z_G \): This impedance is connected between the inverting input and the ground.

3. **Voltage Sources**:
   - \( V_{TEST} \): This voltage source is connected to a switch that can connect to the inverting input of the op-amp.
   - \( V_{RETURN} \): This voltage source is connected to another switch that can connect to the inverting input of the op-amp.

4. **Ground Connections**:
   - The non-inverting input of the op-amp is connected to the ground.
   - The bottom end of \( Z_G \) is also connected to the ground.
   - Both \( V_{TEST} \) and \( V_{RETURN} \) have their negative terminals connected to the ground.

5. **Equation**:
   - The image includes an equation that relates the voltages \( V_{RETURN} \) and \( V_{TEST} \) to the impedances \( Z_F \) and \( Z_G \) and the gain 'a' of the op-amp:
     \[
     \frac{V_{RETURN}}{V_{TEST}} = a \frac{Z_G}{Z_F + Z_G}
     \]

This equation suggests a relationship between the input and output voltages in terms of the impedances and the gain of the op-amp. The circuit appears to be a feedback network where the output voltage is fed back to the inverting input through \( Z_F \), and the input voltage is applied through \( Z_G \).
```

Figure 6–6. Inverting Op Amp: Feedback Loop Broken for Loop Gain Calculation

$$\frac{\mathsf{V}\_{\mathsf{RETURN}}}{\mathsf{V}\_{\mathsf{TESST}}} = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}} = \mathsf{A}\mathsf{B} \tag{6-19}$$

Several things must be mentioned at this point in the analysis. First, the transfer functions for the noninverting and inverting Equations, 6–13 and 6–18, are different. For a common set of ZG and ZF values, the magnitude and polarity of the gains are different. Second, the loop gain of both circuits, as given by Equations 6–15 and 6–19, is identical. Thus, the stability performance of both circuits is identical although their transfer equations are different. This makes the important point that stability is not dependent on the circuit inputs. Third, the A gain block shown in Figure 6–1 is different for each op amp circuit. By comparison of Equations 6–5, 6–11, and 6–18 we see that ANON–INV = a and AINV = aZF ÷ (ZG + ZF).

# **6.5 Differential Op Amps**

The differential amplifier circuit is shown in Figure 6–7. The dummy variable, VE, is inserted to make the calculations easier, and a is the open loop gain.

Here is the image describtion:
```
The image depicts a differential amplifier circuit using an operational amplifier (op-amp). Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with a positive (+) and negative (-) input terminal and an output terminal. The positive input is labeled as \( V_+ \) and the negative input as \( V_- \). The output terminal is labeled as \( V_{OUT} \).

2. **Input Voltages**: There are two input voltages, \( V_1 \) and \( V_2 \), applied to the circuit.
   - \( V_1 \) is connected to the inverting input (-) of the op-amp through an impedance \( Z_G \).
   - \( V_2 \) is connected to the non-inverting input (+) of the op-amp through an identical impedance \( Z_G \).

3. **Feedback Network**: The circuit includes a feedback network to stabilize and set the gain of the amplifier.
   - A feedback impedance \( Z_F \) is connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
   - Another feedback impedance \( Z_F \) is connected between the non-inverting input (+) and the ground.

4. **Voltage Nodes**:
   - \( V_- \) is the voltage at the inverting input of the op-amp.
   - \( V_+ \) is the voltage at the non-inverting input of the op-amp.
   - \( V_E \) is the voltage difference between the inverting and non-inverting inputs of the op-amp.

5. **Connections**:
   - The input voltage \( V_1 \) is connected through \( Z_G \) to the node \( V_- \).
   - The input voltage \( V_2 \) is connected through \( Z_G \) to the node \( V_+ \).
   - The node \( V_- \) is connected to the output \( V_{OUT} \) through \( Z_F \).
   - The node \( V_+ \) is connected to the ground through \( Z_F \).

This configuration is typical for a differential amplifier, which amplifies the difference between the two input voltages \( V_1 \) and \( V_2 \). The gain of the amplifier is determined by the ratio of the feedback impedance \( Z_F \) to the input impedance \( Z_G \).
```

#### Figure 6–7. Differential Amplifier Circuit

Equation 6–20 is the circuit transfer equation.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{a}\,\mathsf{V}\_{\mathsf{E}} = \mathsf{V}\_{+} - \mathsf{V}\_{-} \tag{6-20}$$

The positive input voltage, V+, is written in Equation 6–21 with the aid of superposition and the voltage divider rule.

$$\mathbb{V}\_{+} = \mathbb{V}\_{2} \frac{\mathbb{Z}\_{\mathsf{F}}}{\mathbb{Z}\_{\mathsf{F}} + \mathbb{Z}\_{\mathsf{G}}} \tag{6-21}$$

The negative input voltage, V–, is written in Equation 6–22 with the aid of superposition and the voltage divider rule.

$$\mathbb{V}\_{-}=\mathbb{V}\_{\mathsf{I}}\ \frac{\mathsf{Z}\_{\mathsf{F}}}{\mathsf{Z}\_{\mathsf{F}}+\mathsf{Z}\_{\mathsf{G}}}-\ \mathbb{V}\_{\mathsf{OUT}}\ \frac{\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{F}}+\mathsf{Z}\_{\mathsf{G}}}\tag{6-22}$$

Combining Equations 6–20, 6–21, and 6–22 yields Equation 6–23.

$$\mathbb{V}\_{\text{OUT}} = \mathbf{a} \left[ \frac{\mathbb{V}\_2 \mathbb{Z}\_{\text{F}}}{\mathbb{Z}\_{\text{F}} + \mathbb{Z}\_{\text{G}}} - \frac{\mathbb{V}\_1 \mathbb{Z}\_{\text{F}}}{\mathbb{Z}\_{\text{F}} + \mathbb{Z}\_{\text{G}}} - \frac{\mathbb{V}\_{\text{OUT}} \mathbb{Z}\_{\text{G}}}{\mathbb{Z}\_{\text{F}} + \mathbb{Z}\_{\text{G}}} \right] \tag{6-23}$$

After algebraic manipulation, Equation 6–23 reduces to Equation 6–24.

$$\frac{\mathbb{V}\_{\text{OUT}}}{\mathbb{V}\_{\text{2}} - \mathbb{V}\_{\text{1}}} = \frac{\frac{\text{aZ}\_{\text{F}}}{\mathbb{Z}\_{\text{F}} + \mathbb{Z}\_{\text{G}}}}{\mathbb{1} + \frac{\text{aZ}\_{\text{G}}}{\mathbb{Z}\_{\text{F}} + \mathbb{Z}\_{\text{G}}}} \tag{6-24}$$

The comparison method reveals that the loop gain as shown in Equation 6–25 is identical to that shown in Equations 6–13 and 6–19.

$$\mathsf{A}\clubsuit = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}} \tag{\mathsf{6-25}}$$

Again, the loop gain, which determines stability, is only a function of the closed loop, and independent of the inputs.

# **Chapter 7**

# **Voltage-Feedback Op Amp Compensation**

#### Ron Mancini

# **7.1 Introduction**

Voltage-feedback amplifiers (VFA) have been with us for about 60 years, and they have been problems for circuit designers since the first day. You see, the feedback that makes them versatile and accurate also has a tendency to make them unstable. The operational amplifier (op amp) circuit configuration uses a high-gain amplifier whose parameters are determined by external feedback components. The amplifier gain is so high that without these external feedback components, the slightest input signal would saturate the amplifier output. The op amp is in common usage, so this configuration is examined in detail, but the results are applicable to many other voltage-feedback circuits. Current-feedback amplifiers (CFA) are similar to VFAs, but the differences are important enough to warrant CFAs being handled separately.

Stability as used in electronic circuit terminology is often defined as achieving a nonoscillatory state. This is a poor, inaccurate definition of the word. Stability is a relative term, and this situation makes people uneasy because relative judgments are exhaustive. It is easy to draw the line between a circuit that oscillates and one that does not oscillate, so we can understand why some people believe that oscillation is a natural boundary between stability and instability.

Feedback circuits exhibit poor phase response, overshoot, and ringing long before oscillation occurs, and these effects are considered undesirable by circuit designers. This chapter is not concerned with oscillators; thus, relative stability is defined in terms of performance. By definition, when designers decide what tradeoffs are acceptable, they determine what the relative stability of the circuit is. A relative stability measurement is the damping ratio (ζ) and the damping ratio is discussed in detail in Reference 1. The damping ratio is related to phase margin, hence phase margin is another measure of relative stability. The most stable circuits have the longest response times, lowest bandwidth, highest accuracy, and least overshoot. The least stable circuits have the fastest response times, highest bandwidth, lowest accuracy, and some overshoot.

Op Amps left in their native state oscillate without some form of compensation. The first IC op amps were very hard to stabilize, but there were a lot of good analog designers around in the '60s, so we used them. Internally compensated op amps were introduced in the late '60s in an attempt to make op amps easy for everyone to use. Unfortunately, internally compensated op amps sacrifice a lot of bandwidth and still oscillate under some conditions, so an understanding of compensation is required to apply op amps.

Internal compensation provides a worst-case trade-off between stability and performance. Uncompensated op amps require more attention, but they can do more work. Both are covered here.

Compensation is a process of applying a judicious patch in the form of an RC network to make up for a less than perfect op amp or circuit. There are many different problems that can introduce instability, thus there are many different compensation schemes.

# **7.2 Internal Compensation**

Op amps are internally compensated to save external components and to enable their use by less knowledgeable people. It takes some measure of analog knowledge to compensate an analog circuit. Internally compensated op amps normally are stable when they are used in accordance with the applications instructions. Internally compensated op amps are not unconditionally stable. They are multiple pole systems, but they are internally compensated such that they appear as a single pole system over much of the frequency range. Internal compensation severely decreases the possible closed-loop bandwidth of the op amp.

Internal compensation is accomplished in several ways, but the most common method is to connect a capacitor across the collector-base junction of a voltage gain transistor (see Figure 7–1). The Miller effect multiplies the capacitor value by an amount approximately equal to the stage gain, thus the Miller effect uses small value capacitors for compensation.

Here is the image describtion:
```
The image depicts a common-emitter transistor amplifier circuit. Here is a detailed description of the components and their connections:

1. **Transistor**: The central component is an NPN bipolar junction transistor (BJT). The transistor has three terminals: the base (B), the collector (C), and the emitter (E).

2. **Power Supply (Vcc)**: The circuit is powered by a DC voltage source labeled Vcc. This voltage source is connected to the collector of the transistor through a resistor (Rc).

3. **Collector Resistor (Rc)**: A resistor labeled Rc is connected between the collector of the transistor and the positive terminal of the power supply (Vcc). This resistor helps to control the current flowing through the collector.

4. **Base Resistor (Rb)**: A resistor labeled Rb is connected between the input voltage source (Vin) and the base of the transistor. This resistor limits the base current and helps to set the operating point of the transistor.

5. **Input Voltage (Vin)**: The input signal, labeled Vin, is applied to the base of the transistor through the base resistor (Rb). This input signal controls the transistor's operation.

6. **Capacitor (C)**: A capacitor labeled C is connected between the collector of the transistor and the output node. This capacitor is typically used for coupling the AC signal from the collector to the next stage or to the output while blocking any DC component.

7. **Ground**: The emitter of the transistor is connected to ground, which serves as the reference point for the circuit.

8. **Output**: The output of the amplifier is taken from the node where the capacitor (C) connects to the collector resistor (Rc).

In summary, this is a common-emitter amplifier circuit where the input signal (Vin) is applied to the base of the transistor, and the amplified output signal is taken from the collector through the coupling capacitor (C). The resistors (Rb and Rc) and the power supply (Vcc) help to set the operating point and stabilize the transistor's operation.
```

Figure 7–1. Miller Effect Compensation

Figure 7–2 shows the gain/phase diagram for an older op amp (TL03X). When the gain crosses the 0-dB axis (gain equal to one) the phase shift is approximately 108°, thus the op amp must be modeled as a second-order system because the phase shift is more than 90°.

Here is the image describtion:
```
The image consists of two graphs, each depicting different characteristics of an electronic component, likely an operational amplifier, under specific conditions.

### Left Graph: Large-Signal Differential Voltage Amplification and Phase Shift vs Frequency
- **Title**: LARGE-SIGNAL DIFFERENTIAL VOLTAGE AMPLIFICATION AND PHASE SHIFT vs FREQUENCY
- **Axes**:
  - **X-Axis**: Frequency (f) in Hertz (Hz), ranging from 10 Hz to 10 MHz (10^1 to 10^7 Hz) on a logarithmic scale.
  - **Y-Axis (Left)**: Large-Signal Differential Voltage Amplification (A_VD) in V/mV, ranging from 0.1 to 100k on a logarithmic scale.
  - **Y-Axis (Right)**: Phase Shift in degrees (°), ranging from 0° to 180°.
- **Curves**:
  - **A_VD Curve**: Shows the large-signal differential voltage amplification decreasing as frequency increases. It starts high at low frequencies and drops off steeply after around 1 kHz.
  - **Phase Shift Curve**: Indicates the phase shift increasing with frequency. It starts at 0° and approaches 180° as the frequency increases.
- **Conditions**:
  - V_CC = ±15 V
  - R_L = 10 kΩ
  - C_L = 25 pF
  - T_A = 25°C

### Right Graph: Voltage-Follower Small-Signal Pulse Response
- **Title**: VOLTAGE-FOLLOWER SMALL-SIGNAL PULSE RESPONSE
- **Axes**:
  - **X-Axis**: Time (t) in microseconds (µs), ranging from 0 to 1.4 µs.
  - **Y-Axis**: Output Voltage (V_O) in millivolts (mV), ranging from -16 mV to 16 mV.
- **Curve**: 
  - The curve shows the response of the voltage follower to a small-signal pulse. It starts at around -12 mV, rises sharply to about 12 mV, overshoots slightly, and then stabilizes before dropping back down, undershooting slightly, and stabilizing again.
- **Conditions**:
  - V_CC = ±15 V
  - R_L = 10 kΩ
  - C_L = 100 pF
  - T_A = 25°C

### Summary
The left graph illustrates how the amplification and phase shift of the component change with frequency, showing a decrease in amplification and an increase in phase shift as frequency increases. The right graph demonstrates the transient response of the component to a small-signal pulse, highlighting its behavior in terms of overshoot and settling time. Both graphs provide insights into the performance characteristics of the component under specified conditions.
```

Figure 7–2. TL03X Frequency and Time Response Plots

This yields a phase margin of φ = 180° – 108° = 72°, thus the circuit should be very stable. Referring to Figure 7–3, the damping ratio is one and the expected overshoot is zero. Figure 7–2 shows approximately 10% overshoot, which is unexpected, but inspecting Figure 7–2 further reveals that the loading capacitance for the two plots is different. The pulse response is loaded with 100 pF rather than 25 pF shown for the gain/phase plot, and this extra loading capacitance accounts for the loss of phase margin.

Here is the image describtion:
```
The image is a graph that plots the relationship between the damping ratio (ζ) on the y-axis and two different parameters on the x-axis: percent maximum overshoot and phase margin (ϕ_M). The y-axis ranges from 0 to 1, while the x-axis ranges from 0 to 80.

There are two curves on the graph:

1. The first curve represents the percent maximum overshoot. This curve starts at the top left corner of the graph (where the damping ratio is 1 and the percent maximum overshoot is 0) and decreases exponentially as it moves to the right, approaching zero as the damping ratio decreases.

2. The second curve represents the phase margin (ϕ_M). This curve starts at the bottom left corner of the graph (where the damping ratio is 0 and the phase margin is 0) and increases, reaching a peak around a damping ratio of 0.6, before decreasing again as it moves further to the right.

The two curves intersect at a point where the damping ratio is approximately 0.4. The graph is divided into a grid with both major and minor grid lines, providing a clear and detailed view of the relationship between the damping ratio, percent maximum overshoot, and phase margin. The labels for the percent maximum overshoot and phase margin are placed near their respective curves for easy identification.
```

Figure 7–3. Phase Margin and Percent Overshoot Versus Damping Ratio

Why does the loading capacitance make the op amp unstable? Look closely at the gain/ phase response between 1 MHz and 9 MHz, and observe that the gain curve changes slope drastically while the rate of phase change approaches 120°/decade. The radical gain/phase slope change proves that several poles are located in this area. The loading capacitance works with the op amp output impedance to form another pole, and the new pole reacts with the internal op amp poles. As the loading capacitor value is increased, its pole migrates down in frequency, causing more phase shift at the 0-dB crossover frequency. The proof of this is given in the TL03X data sheet where plots of ringing and oscillation versus loading capacitance are shown.

Figure 7–4 shows similar plots for the TL07X, which is the newer family of op amps. Notice that the phase shift is approximately 100 when the gain crosses the 0-dB axis. This yields a phase margin of 80-, which is close to unconditionally stable. The slope of the phase curve changes to 180-/decade about one decade from the 0-dB crossover point. The radical slope change causes suspicion about the 90° phase margin, furthermore the gain curve must be changing radically when the phase is changing radically. The gain/phase plot may not be totally false, but it sure is overly optimistic.

Here is the image describtion:
```
The image consists of two graphs, each depicting different characteristics of an electronic component, likely an operational amplifier or similar device.

### Left Graph: Large-Signal Differential Voltage Amplification and Phase Shift vs Frequency

**Title:** LARGE-SIGNAL DIFFERENTIAL VOLTAGE AMPLIFICATION AND PHASE SHIFT vs FREQUENCY

**Axes:**
- **Y-Axis (Left):** A_VD – Large-Signal Differential Voltage Amplification, on a logarithmic scale ranging from 1 to 10^6.
- **Y-Axis (Right):** Phase Shift in degrees, ranging from 0° to 180°.
- **X-Axis:** Frequency (f) in Hertz (Hz), on a logarithmic scale ranging from 1 Hz to 10 MHz (10^7 Hz).

**Curves:**
- **Differential Voltage Amplification:** This curve starts high at low frequencies (around 10^5) and decreases as the frequency increases, showing a significant drop-off as it approaches higher frequencies.
- **Phase Shift:** This curve starts at 0° at low frequencies and increases with frequency, reaching 180° at the highest frequencies.

**Conditions:**
- V_CC ± = 5 V to V_CC ± = 15 V
- R_L = 2 kΩ
- T_A = 25°C

### Right Graph: Output Voltage vs Elapsed Time

**Title:** OUTPUT VOLTAGE vs ELAPSED TIME

**Axes:**
- **Y-Axis:** V_O – Output Voltage in millivolts (mV), ranging from 0 to 28 mV.
- **X-Axis:** Elapsed Time (t) in microseconds (µs), ranging from 0 to 0.7 µs.

**Curve:**
- The curve shows a typical step response of an amplifier. It starts at 0 mV, rises quickly to about 20 mV (90% of the final value), overshoots to around 24 mV, and then settles back to 20 mV.
- The rise time (t_r) is marked as the time taken to go from 10% to 90% of the final value.
- The overshoot is the peak value above the final settled value.

**Conditions:**
- V_CC ± = 15 V
- R_L = 10 kΩ
- T_A = 25°C

### Summary
The left graph illustrates how the differential voltage amplification and phase shift of the device change with frequency, showing a decrease in amplification and an increase in phase shift as frequency increases. The right graph shows the transient response of the output voltage over time, highlighting the rise time and overshoot characteristics of the device. Both graphs provide important information for understanding the frequency response and transient behavior of the electronic component under specified conditions.
```

Figure 7–4. TL07X Frequency and Time Response Plots

The TL07X pulse response plot shows approximately 20% overshoot. There is no loading capacitance indicated on the plot to account for a seemingly unconditionally stable op amp exhibiting this large an overshoot. Something is wrong here: the analysis is wrong, the plots are wrong, or the parameters are wrong. Figure 7–5 shows the plots for the TL08X family of op amps, which are sisters to the TL07X family. The gain/phase curve and pulse response is virtually identical, but the pulse response lists a 100 pF loading capacitor. This little exercise illustrates three valuable points: first, if the data seems wrong it probably is wrong, second, even the factory people make mistakes, and third, the loading capacitor makes op amps ring, overshoot, or oscillate.

Here is the image describtion:
```
The image consists of two graphs, each depicting different characteristics of an electronic component, likely an operational amplifier, under specific conditions.

### Left Graph: Large-Signal Differential Voltage Amplification and Phase Shift vs Frequency
- **Title**: LARGE-SIGNAL DIFFERENTIAL VOLTAGE AMPLIFICATION AND PHASE SHIFT vs FREQUENCY
- **Axes**:
  - **X-axis**: Frequency (f) in Hertz (Hz), ranging from 1 Hz to 10 MHz (10^7 Hz) on a logarithmic scale.
  - **Left Y-axis**: Large-Signal Differential Voltage Amplification (AVD) in V/mV, ranging from 1 to 10^6 on a logarithmic scale.
  - **Right Y-axis**: Phase Shift in degrees (°), ranging from 0° to 180°.
- **Curves**:
  - **Differential Voltage Amplification**: This curve starts at around 10^5 V/mV at 1 Hz and gradually decreases as the frequency increases, reaching around 10^2 V/mV at 10 MHz.
  - **Phase Shift**: This curve starts at 0° at 1 Hz and increases with frequency, reaching around 180° at 10 MHz.
- **Conditions**:
  - Supply Voltage (V_CC): ±5 V to ±15 V
  - Load Resistance (R_L): 10 kΩ
  - Ambient Temperature (T_A): 25°C

### Right Graph: Output Voltage vs Elapsed Time
- **Title**: OUTPUT VOLTAGE vs ELAPSED TIME
- **Axes**:
  - **X-axis**: Elapsed Time (t) in microseconds (µs), ranging from 0 to 1.2 µs.
  - **Y-axis**: Output Voltage (V_O) in millivolts (mV), ranging from -4 mV to 28 mV.
- **Curve**: The output voltage starts at around 0 mV, rises sharply to approximately 24 mV at around 0.2 µs, then stabilizes with minor fluctuations until around 0.8 µs, after which it drops sharply to around -2 mV at 1 µs, and then returns to around 0 mV.
- **Conditions**:
  - Supply Voltage (V_CC): ±15 V
  - Load Resistance (R_L): 2 kΩ
  - Load Capacitance (C_L): 100 pF
  - Ambient Temperature (T_A): 25°C

### Summary
The left graph illustrates how the differential voltage amplification and phase shift of the component vary with frequency, showing a decrease in amplification and an increase in phase shift as frequency increases. The right graph shows the transient response of the output voltage over time, indicating how the output voltage changes in response to a step input under the specified conditions.
```

Figure 7–5. TL08X Frequency and Time Response Plots

The frequency and time-response plots for the TLV277X family of op amps is shown in Figures 7–6 and 7–7. First, notice that the information is more sophisticated because the phase response is given in degrees of phase margin; second, both gain/phase plots are done with substantial loading capacitors (600 pF), so they have some practical value; and third, the phase margin is a function of power supply voltage.

Here is the image describtion:
```
The image consists of two graphs side by side, each depicting the relationship between large-signal differential voltage amplification (AVD) and phase margin (Φm) versus frequency (f). Both graphs are titled "LARGE-SIGNAL DIFFERENTIAL VOLTAGE AMPLIFICATION AND PHASE MARGIN vs FREQUENCY."

### Left Graph:
- **Y-Axis (Left):** Large-Signal Differential Amplification (AVD) in decibels (dB), ranging from -40 dB to 100 dB.
- **Y-Axis (Right):** Phase Margin (Φm) in degrees, ranging from -90 degrees to 300 degrees.
- **X-Axis:** Frequency (f) in Hertz (Hz), ranging from 100 Hz to 10 MHz (10M).
- **Curves:**
  - The AVD curve starts at around 80 dB at 100 Hz and gradually decreases to around 0 dB at 10 MHz.
  - The Phase curve starts at around 60 degrees at 100 Hz, peaks slightly above 120 degrees around 1 kHz, and then decreases to around -60 degrees at 10 MHz.
- **Conditions:** 
  - \( V_{DD} = \pm 5V \)
  - \( R_L = 600 k\Omega \)
  - \( C_L = 600 pF \)
  - \( T_A = 25^\circ C \)

### Right Graph:
- **Y-Axis (Left):** Large-Signal Differential Amplification (AVD) in decibels (dB), ranging from -40 dB to 100 dB.
- **Y-Axis (Right):** Phase Margin (Φm) in degrees, ranging from -90 degrees to 300 degrees.
- **X-Axis:** Frequency (f) in Hertz (Hz), ranging from 100 Hz to 10 MHz (10M).
- **Curves:**
  - The AVD curve starts at around 80 dB at 100 Hz and gradually decreases to around 0 dB at 10 MHz.
  - The Phase curve starts at around 40 degrees at 100 Hz, peaks slightly above 100 degrees around 1 kHz, and then decreases to around -60 degrees at 10 MHz.
- **Conditions:** 
  - \( V_{DD} = \pm 2.7V \)
  - \( R_L = 600 k\Omega \)
  - \( C_L = 600 pF \)
  - \( T_A = 25^\circ C \)

### Observations:
- Both graphs show a similar trend where the AVD decreases with increasing frequency.
- The phase margin initially increases to a peak and then decreases as the frequency increases.
- The left graph, with \( V_{DD} = \pm 5V \), shows a higher initial phase margin compared to the right graph with \( V_{DD} = \pm 2.7V \).
```

Figure 7–6. TLV277X Frequency Response Plots

Here is the image describtion:
```
The image consists of two graphs side by side, each depicting the small-signal pulse response of an electronic circuit. 

**Left Graph:**
- Title: "VOLTAGE-FOLLOWER SMALL-SIGNAL PULSE RESPONSE"
- The vertical axis is labeled "VO - Output Voltage - mV" and ranges from -60 mV to 100 mV.
- The horizontal axis is labeled "t - Time - μs" and ranges from 0 to 5 microseconds.
- The graph shows a pulse response where the output voltage starts at 0 mV, rises to approximately 40 mV at around 1.5 μs, remains steady until about 3 μs, and then drops back to 0 mV.
- Below the graph, the conditions are specified: 
  - \( V_{DD} = 2.7 \, V \)
  - \( R_L = 600 \, k\Omega \)
  - \( C_L = 100 \, pF \)
  - \( T_A = 25^\circ C \)
  - \( A_V = 1 \)

**Right Graph:**
- Title: "INVERTING SMALL-SIGNAL PULSE RESPONSE"
- The vertical axis is labeled "VO - Output Voltage - mV" and ranges from -60 mV to 100 mV.
- The horizontal axis is labeled "t - Time - μs" and ranges from 0 to 5 microseconds.
- The graph shows a pulse response where the output voltage starts at 0 mV, rises to approximately 40 mV at around 1.5 μs, remains steady until about 3 μs, and then drops back to 0 mV.
- Below the graph, the conditions are specified: 
  - \( V_{DD} = 2.7 \, V \)
  - \( R_L = 600 \, k\Omega \)
  - \( C_L = 100 \, pF \)
  - \( T_A = 25^\circ C \)
  - \( A_V = -1 \)

Both graphs have similar pulse shapes, but the titles indicate different circuit configurations: one is a voltage-follower and the other is an inverting configuration. The conditions for both graphs are identical except for the gain \( A_V \), which is 1 for the voltage-follower and -1 for the inverting configuration.
```

Figure 7–7. TLV227X Time Response Plots

Voltage-Feedback Op Amp Compensation 7-7

At VCC = 5 V, the phase margin at the 0-dB crossover point is 60°, while it is 30° at VCC = 2.7 V. This translates into an expected overshoot of 18% at VCC = 5 V, and 28% at VCC = 2.7 V. Unfortunately the time response plots are done with 100-pF loading capacitance, hence we can not check our figures very well. The VCC = 2.7 V overshoot is approximately 2%, and it is almost impossible to figure out what the overshoot would have been with a 600 pF loading capacitor. The small-signal pulse response is done with mV-signals, and that is a more realistic measurement than using the full signal swing.

Internally compensated op amps are very desirable because they are easy to use, and they do not require external compensation components. Their drawback is that the bandwidth is limited by the internal compensation scheme. The op amp open-loop gain eventually (when it shows up in the loop gain) determines the error in an op amp circuit. In a noninverting buffer configuration, the TL277X is limited to 1% error at 50 kHz (VCC = 2.7 V) because the op amp gain is 40 dB at that point. Circuit designers can play tricks such as bypassing the op amp with a capacitor to emphasize the high-frequency gain, but the error is still 1%. Keep Equation 7–1 in mind because it defines the error. If the TLV277X were not internally compensated, it could be externally compensated for a lower error at 50 kHz because the gain would be much higher.

$$\Xi = \frac{\mathsf{V}\_{\mathsf{IN}}}{\mathsf{1} + \mathsf{A}\mathsf{\beta}} \tag{7-\mathsf{I}}$$

# **7.3 External Compensation, Stability, and Performance**

Nobody compensates an op amp just because it is there; they have a reason to compensate the op amp, and that reason is usually stability. They want the op amp to perform a function in a circuit where it is potentially unstable. Internally and noninternally compensated op amps are compensated externally because certain circuit configurations do cause oscillations. Several potentially unstable circuit configurations are analyzed in this section, and the reader can extend the external compensation techniques as required.

Other reasons for externally compensating op amps are noise reduction, flat amplitude response, and obtaining the highest bandwidth possible from an op amp. An op amp generates noise, and noise is generated by the system. The noise contains many frequency components, and when a high-pass filter is incorporated in the signal path, it reduces high frequency noise. Compensation can be employed to roll off the op amp's high frequency, closed-loop response, thus causing the op amp to act as a noise filter. Internally compensated op amps are modeled with a second order equation, and this means that the output voltage can overshoot in response to a step input. When this overshoot (or peaking) is undesirable, external compensation can increase the phase margin to 90° where there is no peaking. An uncompensated op amp has the highest bandwidth possible. External compensation is required to stabilize uncompensated op amps, but the compensation can be tailored to the specific circuit, thus yielding the highest possible bandwidth consistent with the pulse response requirements.

# **7.4 Dominant-Pole Compensation**

We saw that capacitive loading caused potential instabilities, thus an op amp loaded with an output capacitor is a circuit configuration that must be analyzed. This circuit is called dominant pole compensation because if the pole formed by the op amp output impedance and the loading capacitor is located close to the zero frequency axis, it becomes dominant. The op amp circuit is shown in Figure 7–8, and the open loop circuit used to calculate the loop gain (Aβ) is shown in Figure 7–9.

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit with feedback components. Here is a detailed description of the various elements and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is a triangular symbol representing the op-amp. It has two input terminals:
   - The non-inverting input (+) at the top.
   - The inverting input (-) at the bottom.

2. **Input Voltage (V_IN)**: The input voltage (V_IN) is applied to the non-inverting input (+) of the op-amp.

3. **Voltage Difference (ΔV)**: There is a voltage difference (ΔV) between the non-inverting (+) and inverting (-) inputs of the op-amp.

4. **Output Voltage (V_OUT)**: The output voltage (V_OUT) is taken from the output terminal of the op-amp, which is on the right side of the triangle.

5. **Internal Elements of the Op-Amp**:
   - **Voltage Source (ΔV_A)**: Inside the op-amp, there is a voltage source symbolized by ΔV_A.
   - **Output Impedance (Z_O)**: The output impedance of the op-amp is represented by a resistor labeled Z_O, connected in series with the voltage source ΔV_A.

6. **Feedback Network**:
   - **Feedback Impedance (Z_F)**: A feedback impedance Z_F is connected between the output terminal (V_OUT) and the inverting input (-) of the op-amp.
   - **Grounded Impedance (Z_G)**: Another impedance Z_G is connected from the inverting input (-) to the ground.

7. **Load Capacitance (C_L)**: A capacitor labeled C_L is connected from the output terminal (V_OUT) to the ground.

8. **Point X**: There is a point labeled "POINT X" which is the node where the inverting input (-) of the op-amp, the feedback impedance Z_F, and the grounded impedance Z_G meet.

In summary, the diagram shows an op-amp with a feedback network consisting of impedances Z_F and Z_G, and a load capacitance C_L connected to the output. The input voltage V_IN is applied to the non-inverting input, and the output voltage V_OUT is taken from the output terminal. The internal elements of the op-amp include a voltage source ΔV_A and an output impedance Z_O.
```

Figure 7–8. Capacitively-Loaded Op Amp

Here is the image describtion:
```
The image depicts an electrical circuit diagram. Here is a detailed description of the components and their connections:

1. **Voltage Source**: On the left side of the diagram, there is a voltage source labeled \( V(\text{Test}) = \Delta V_A \). This represents the input test voltage applied to the circuit.

2. **Series Resistor \( Z_O \)**: The voltage source is connected in series to a resistor labeled \( Z_O \). This resistor is connected to the next component in the circuit.

3. **Capacitor \( C_L \)**: After the resistor \( Z_O \), there is a capacitor labeled \( C_L \) connected to the ground. This capacitor is in parallel with the rest of the circuit.

4. **Node \( V_{\text{OUT}} \)**: The point where the resistor \( Z_O \) and the capacitor \( C_L \) meet is labeled as \( V_{\text{OUT}} \). This node represents the output voltage of the circuit.

5. **Series Resistor \( Z_F \)**: Continuing from the node \( V_{\text{OUT}} \), there is another resistor labeled \( Z_F \) connected in series.

6. **Node \( V_{\text{Return}} \)**: The point after the resistor \( Z_F \) is labeled as \( V_{\text{Return}} \). This node is connected to the next component in the circuit.

7. **Parallel Resistor \( Z_G \)**: Connected to the node \( V_{\text{Return}} \) is a resistor labeled \( Z_G \), which is connected to the ground.

In summary, the circuit consists of a voltage source \( V(\text{Test}) \) in series with two resistors \( Z_O \) and \( Z_F \), with a capacitor \( C_L \) connected to the ground at the node between \( Z_O \) and \( Z_F \), and another resistor \( Z_G \) connected to the ground at the node after \( Z_F \). The output voltage is taken at the node \( V_{\text{OUT}} \).
```

# Figure 7–9. Capacitively-Loaded Op Amp With Loop Broken for Loop Gain (Aβ) Calculation

The analysis starts by looking into the capacitor and taking the Thevenin equivalent circuit.

$$\mathsf{V}\_{\mathsf{T}\mathsf{H}} = \frac{\Delta \mathsf{V} \mathsf{a}}{\mathsf{Z}\_{\mathsf{O}} \mathsf{C}\_{\mathsf{L}} \mathsf{s} + \mathsf{T}} \tag{7-2}$$

$$\mathbf{Z\_{TH}} = \frac{\mathbf{Z\_{O}}}{\mathbf{Z\_{O}}\mathbf{C\_{L}}\mathbf{s} + \mathbf{1}} \tag{7-3}$$

Then the output equation is written.

Voltage-Feedback Op Amp Compensation 7-9

$$\mathbf{V}\_{\text{BETURN}} = \frac{\mathbf{V}\_{\text{TH}} \mathbf{Z}\_{\text{G}}}{\mathbf{Z}\_{\text{G}} + \mathbf{Z}\_{\text{F}} + \mathbf{Z}\_{\text{TH}}} = \frac{\Delta \text{Va}}{\mathbf{Z}\_{\text{O}} \mathbf{C}\_{\text{L}} \mathbf{s} + \boldsymbol{\tau}} \left\{ \frac{\mathbf{Z}\_{\text{G}}}{\mathbf{Z}\_{\text{F}} + \mathbf{Z}\_{\text{G}} + \frac{\mathbf{Z}\_{\text{O}}}{\mathbf{Z}\_{\text{O}} \mathbf{C}\_{\text{L}} \mathbf{s} + \boldsymbol{\tau}}} \right\} \quad (7-4)$$

Rearranging terms yields Equation 7–5.

$$\frac{\mathsf{V}\_{\mathsf{RETURN}}}{\mathsf{V}\_{\mathsf{TESST}}} = \mathsf{A}\mathfrak{\beta} = \frac{\frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{O}}}}{\frac{(\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}})\mathsf{Z}\_{\mathsf{O}}\mathsf{C}\_{\mathsf{L}}\mathsf{s}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{O}}}} + \mathfrak{1} \tag{7-5}$$

When the assumption is made that (ZF + ZG) >> ZO, Equation 7–5 reduces to Equation 7–6.

$$\mathsf{A}\clubsuit = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{G}}} \left(\frac{1}{\mathsf{Z}\_{\mathsf{O}}\mathsf{C}\_{\mathsf{L}}\mathsf{s} + \mathsf{I}}\right) \tag{7-6}$$

Equation 7–7 models the op amp as a second-order system. Hence, substituting the second-order model for a in Equation 7–6 yields Equation 7–8, which is the stability equation for the dominant-pole compensation circuit.

$$\mathbf{a} = \frac{\mathbf{K}}{(\mathbf{s} + \mathbf{r}\_1)(\mathbf{s} + \mathbf{r}\_2)} \tag{7-7}$$

$$\mathbf{A}\boldsymbol{\mathfrak{A}} = \frac{\mathbf{K}}{(\mathbf{s} + \mathbf{r}\_1)(\mathbf{s} + \mathbf{r}\_2)} \frac{\mathbf{Z}\_{\mathbf{G}}}{\mathbf{Z}\_{\mathbf{F}} + \mathbf{Z}\_{\mathbf{G}}} \frac{\mathbf{1}}{\mathbf{Z}\_{\mathbf{O}}\mathbf{C}\_{\mathbf{L}}\mathbf{s} + \mathbf{1}} \tag{7-8}$$

Several conclusions can be drawn from Equation 7–8 depending on the location of the poles. If the Bode plot of Equation 7–7, the op amp transfer function, looks like that shown in Figure 7–10, it only has 25° phase margin, and there is approximately 48% overshoot. When the pole introduced by ZO and CL moves towards the zero frequency axis it comes close to the τ2 pole, and it adds phase shift to the system. Increased phase shift increases peaking and decreases stability. In the real world, many loads, especially cables, are capacitive, and an op amp like the one pictured in Figure 7–10 would ring while driving a capacitive load. The load capacitance causes peaking and instability in internally compensated op amps when the op amps do not have enough phase margin to allow for the phase shift introduced by the load.

Here is the image describtion:
```
The image is a Bode plot, which is commonly used in control systems and signal processing to represent the frequency response of a system. The plot consists of two graphs: the magnitude plot (in decibels) and the phase plot (in degrees).

1. **Magnitude Plot (Top Graph):**
   - The vertical axis is labeled "20 Log (Aβ)" and is measured in decibels (dB), ranging from 0 dB to 100 dB.
   - The horizontal axis is labeled "Log F," representing the logarithm of the frequency.
   - The magnitude plot starts at 100 dB and decreases linearly with a slope, indicating a decrease in gain as frequency increases.
   - The point where the magnitude plot crosses the 0 dB line is marked as the "0-dB Frequency."

2. **Phase Plot (Bottom Graph):**
   - The vertical axis is labeled "Degrees Phase Shift" and ranges from 0° to -155°.
   - The phase plot shows how the phase shift of the system changes with frequency.
   - The phase shift starts at 0° and decreases as the frequency increases.
   - Two specific frequencies are marked on the phase plot: \( W = \tau_1 \) and \( W = \tau_2 \). These points indicate specific phase shifts at these frequencies.

3. **Key Points:**
   - The magnitude plot shows a linear decrease in gain with increasing frequency.
   - The phase plot shows a nonlinear decrease in phase shift with increasing frequency.
   - The 0-dB frequency is a critical point where the gain of the system is 1 (0 dB).
   - The points \( W = \tau_1 \) and \( W = \tau_2 \) on the phase plot correspond to specific phase shifts at those frequencies.

Overall, the Bode plot provides a comprehensive view of how the gain and phase of a system vary with frequency, which is essential for analyzing and designing control systems.
```

Figure 7–10. Possible Bode Plot of the Op Amp Described in Equation 7–7

Prior to compensation, the Bode plot of an uncompensated op amp looks like that shown in Figure 7–11. Notice that the break points are located close together thus accumulating about 180° of phase shift before the 0 dB crossover point; the op amp is not usable and probably unstable. Dominant pole compensation is often used to stabilize these op amps. If a dominant pole, in this case ωD, is properly placed it rolls off the gain so that τ<sup>1</sup> introduces 45 phase at the 0-dB crossover point. After the dominant pole is introduced the op amp is stable with 45° phase margin, but the op amp gain is drastically reduced for frequencies higher than ωD. This procedure works well for internally compensated op amps, but is seldom used for externally compensated op amps because inexpensive discrete capacitors are readily available.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. The plot specifically shows the magnitude response in decibels (dB) versus the logarithm of frequency (Log(f)).

Here are the key features of the plot:

1. **Axes**:
   - The vertical axis is labeled "20 Log(Aβ)" and is measured in decibels (dB).
   - The horizontal axis is labeled "Log(f)" indicating the logarithm of the frequency.

2. **Plot Characteristics**:
   - The plot starts at a high dB value on the left side and remains constant for a certain range of frequencies.
   - The first significant point on the frequency axis is labeled "Dominant Pole W_D".
   - After the dominant pole, the plot shows a downward slope, indicating a decrease in magnitude with increasing frequency.
   - The slope continues until it reaches a point labeled "1/τ1", where the plot levels off again, indicating a region of constant magnitude.
   - After this flat region, the plot again shows a downward slope starting at the point labeled "1/τ2".
   - The slope after "1/τ2" is steeper than the initial slope after the dominant pole.

3. **Slopes**:
   - The initial downward slope after the dominant pole W_D is less steep compared to the slope after "1/τ2".
   - The plot indicates two distinct breakpoints at "1/τ1" and "1/τ2", which are typical of systems with multiple poles.

4. **Dashed Lines**:
   - There are dashed vertical lines at the points "Dominant Pole W_D", "1/τ1", and "1/τ2" to highlight these critical frequencies.
   - There is also a dashed line indicating the slope of the plot after the dominant pole, which helps to visualize the rate of decrease in magnitude.

Overall, the Bode plot illustrates the frequency response of a system with a dominant pole and two additional poles, showing how the system's gain decreases with increasing frequency.
```

Figure 7–11.Dominant-Pole Compensation Plot

Assuming that ZO << ZF, the closed-loop transfer function is easy to calculate because CL is enclosed in the feedback loop. The ideal closed-loop transfer equation is the same as Equation 6–11 for the noninverting op amp, and is repeated below as Equation 7–9.

$$\frac{\mathcal{N}\_{\mathsf{OUT}}}{\mathcal{N}\_{\mathsf{IN}}} = \frac{\mathsf{a}}{\mathsf{1} + \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}}} \tag{7-9}$$

When a ⇒ ∞ Equation 7–9 reduces to Equation 7–10.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = \frac{\mathbf{Z\_{F}} + \mathbf{Z\_{G}}}{\mathbf{Z\_{G}}} \tag{7-10}$$

As long as the op amp has enough compliance and current to drive the capacitive load, and ZO is small, the circuit functions as though the capacitor was not there. When the capacitor becomes large enough, its pole interacts with the op amp pole causing instability. When the capacitor is huge, it completely kills the op amp's bandwidth, thus lowering the noise while retaining a large low-frequency gain.

# **7.5 Gain Compensation**

When the closed-loop gain of an op amp circuit is related to the loop gain, as it is in voltagefeedback op amps, the closed-loop gain can be used to stabilize the circuit. This type of compensation can not be used in current-feedback op amps because the mathematical relationship between the loop gain and ideal closed-loop gain does not exist. The loop gain equation is repeated as Equation 7–11. Notice that the closed-loop gain parameters ZG and ZF are contained in Equation 7–11, hence the stability can be controlled by manipulating the closed-loop gain parameters.

$$\mathsf{A}\emptyset = \frac{\mathsf{a}\mathsf{Z}\_{\mathsf{G}}}{\mathsf{Z}\_{\mathsf{G}} + \mathsf{Z}\_{\mathsf{F}}} \tag{7-\mathsf{M}}$$

The original loop gain curve for a closed-loop gain of one is shown in Figure 7–12, and it is or comes very close to being unstable. If the closed-loop noninverting gain is changed to 9, then K changes from K/2 to K/10. The loop gain intercept on the Bode plot (Figure 7–12) moves down 14 dB, and the circuit is stabilized.

Here is the image describtion:
```
The image depicts a Bode plot, which is a graphical representation of a system's frequency response. The plot is used to analyze the loop gain of a control system. Here is a detailed description of the image:

1. **Equation**: On the left side of the image, there is an equation in logarithmic form:
   \[
   20 \log \left( \frac{K Z_G}{Z_F + Z_G} \right)
   \]
   This equation represents the gain of the system in decibels (dB).

2. **Axes**: The plot has two axes:
   - The vertical axis represents the gain in decibels (dB).
   - The horizontal axis represents the frequency on a logarithmic scale (Log(f)).

3. **Gain Levels**: Two specific gain levels are marked on the vertical axis:
   - \( 20 \log \left( \frac{K}{2} \right) \)
   - \( 20 \log \left( \frac{K}{10} \right) \)

4. **Loop Gain Curve**: The solid line represents the loop gain curve of the system. It starts at a high gain level and decreases with increasing frequency. The curve has two distinct slopes:
   - The first slope starts at \( 20 \log \left( \frac{K}{2} \right) \) and decreases at a certain rate until it reaches the frequency \( 1/\tau_1 \).
   - After \( 1/\tau_1 \), the slope becomes steeper and continues to decrease until it reaches the frequency \( 1/\tau_2 \).

5. **Compensated Loop Gain Curve**: The dashed line represents the compensated loop gain curve. It starts at a lower gain level, specifically \( 20 \log \left( \frac{K}{10} \right) \), which is 14 dB lower than the initial gain level of the loop gain curve. The compensated curve follows a similar pattern to the loop gain curve but starts at a lower gain level and intersects the loop gain curve at higher frequencies.

6. **Frequency Points**: Two critical frequency points are marked on the horizontal axis:
   - \( 1/\tau_1 \)
   - \( 1/\tau_2 \)

These points indicate the frequencies at which the slope of the loop gain curve changes.

Overall, the image illustrates how the loop gain of a system changes with frequency and how compensation can be applied to modify the gain curve.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 7-12. Gain Compensation." The text appears to be a caption or title for a figure in a document, likely a technical or instructional manual. The figure number "7-12" suggests that it is the twelfth figure in the seventh chapter or section of the document. The term "Gain Compensation" indicates that the figure is related to a concept or process involving the adjustment or correction of gain, which is a measure of amplification in electronic systems. The text is in a standard, readable font.
```

Gain compensation works for inverting or noninverting op amp circuits because the loop gain equation contains the closed-loop gain parameters in both cases. When the closedloop gain is increased, the accuracy and the bandwidth decrease. As long as the application can stand the higher gain, gain compensation is the best type of compensation to use. Uncompensated versions of normally internally compensated op amps are offered for sale as stable op amps with minimum gain restrictions. As long as gain in the circuit you design exceeds the gain specified on the data sheet, this is economical and a safe mode of operation.

# **7.6 Lead Compensation**

Sometimes lead compensation is forced on the circuit designer because of the parasitic capacitance associated with packaging and wiring op amps. Figure 7–13 shows the circuit for lead compensation; notice the capacitor in parallel with RF. That capacitor is often made by parasitic wiring and the ground plane, and high frequency circuit designers go to great lengths to minimize or eliminate it. What is good in one sense is bad in another, because adding the parallel capacitor is a good way to stabilize the op amp and reduce noise. Let us analyze the stability first, and then we will analyze the closed-loop performance.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with the following labels:
   - The inverting input is marked with a minus sign (-).
   - The non-inverting input is marked with a plus sign (+).
   - The output is at the point of the triangle.

2. **Input Voltage Source (VIN)**: On the left side of the diagram, there is a voltage source labeled \( V_{IN} \). This source is connected to the ground on its negative side.

3. **Resistor (RG)**: The input voltage \( V_{IN} \) is connected to the inverting input of the op-amp through a resistor labeled \( R_G \).

4. **Feedback Network**: The feedback network consists of a resistor and a capacitor:
   - **Resistor (RF)**: There is a resistor labeled \( R_F \) connected between the output of the op-amp and the inverting input.
   - **Capacitor (C)**: A capacitor labeled \( C \) is connected in parallel with the resistor \( R_F \), also between the output and the inverting input of the op-amp.

5. **Non-Inverting Input**: The non-inverting input of the op-amp is connected to the ground.

6. **Output Voltage (VOUT)**: The output of the op-amp is labeled \( V_{OUT} \).

The configuration shown is a typical example of an inverting amplifier with a feedback network that includes both a resistor and a capacitor, which suggests it could be used for frequency-dependent applications such as filters or integrators. The feedback network determines the behavior of the circuit, influencing the gain and frequency response.
```

Figure 7–13. Lead-Compensation Circuit

The loop equation for the lead-compensation circuit is given by Equation 7–12.

$$\mathsf{A}\emptyset = \left(\frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{F}}}\right) \left(\frac{\mathsf{R}\_{\mathsf{F}}\mathsf{C}\mathsf{s} + \mathsf{1}}{\mathsf{R}\_{\mathsf{G}} \parallel \mathsf{R}\_{\mathsf{F}}\mathsf{C}\mathsf{s} + \mathsf{1}}\right) \left[\frac{\mathsf{K}}{(\mathsf{s} + \mathsf{r}\_{1})(\mathsf{s} + \mathsf{r}\_{2})}\right] \qquad \text{(7-12)}$$

The compensation capacitor introduces a pole and zero into the loop equation. The zero always occurs before the pole because RF >RF||RG. When the zero is properly placed it cancels out the τ2 pole along with its associated phase shift. The original transfer function is shown in Figure 7–14 drawn in solid lines. When the RFC zero is placed at ω = 1/τ2, it cancels out the τ2 pole causing the bode plot to continue on a slope of –20 dB/decade. When the frequency gets to ω = 1/(RF||RG)C, this pole changes the slope to –40 dB/decade. Properly placed, the capacitor aids stability, but what does it do to the closed-loop transfer function? The equation for the inverting op amp closed-loop gain is repeated below.

Here is the image describtion:
```
The image consists of two main parts: a mathematical equation and a graphical plot.

1. **Mathematical Equation**:
   - The equation at the top of the image represents the transfer function of an amplifier circuit. It is given by:
     \[
     \frac{V_{OUT}}{V_{IN}} = \frac{-aZ_F}{Z_G + Z_F} \cdot \frac{1}{1 + \frac{aZ_G}{Z_G + Z_F}}
     \]
   - Here, \( V_{OUT} \) is the output voltage, \( V_{IN} \) is the input voltage, \( a \) is the open-loop gain of the amplifier, \( Z_F \) is the impedance of the feedback network, and \( Z_G \) is the impedance of the input network.

2. **Graphical Plot**:
   - The plot is a Bode plot, which shows the frequency response of the amplifier circuit.
   - The vertical axis is labeled in decibels (dB) and represents the gain of the amplifier. It ranges from 0 dB to a higher value.
   - The horizontal axis is labeled as "Log(f)" and represents the logarithm of the frequency.
   - The plot shows two transfer functions: the "Original Transfer Function" and the "Modified Transfer Function".
   - The "Original Transfer Function" is represented by a solid line, which starts at a high gain value (20 Log(Aβ)) and then decreases with increasing frequency.
   - The "Modified Transfer Function" is represented by a dashed line, which also starts at the same high gain value but has a different slope and intersects the original transfer function at certain points.
   - Several vertical dashed lines are drawn at specific frequencies, labeled as \( 1/\tau_1 \), \( 1/\tau_2 \), \( 1/R_FC \), and \( 1/R_F \parallel R_G C \). These lines indicate the break frequencies where the slope of the transfer function changes.
   - The plot shows how the gain decreases with increasing frequency, indicating the bandwidth limitations of the amplifier.

Overall, the image provides a detailed representation of the frequency response of an amplifier circuit, highlighting the impact of different components and their impedances on the transfer function.
```

Figure 7–14. Lead-Compensation Bode Plot

When a approaches infinity, Equation 7–13 reduces to Equation 7–14.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = -\frac{\mathbf{Z\_{F}}}{\mathbf{Z\_{IN}}}\tag{7-14}$$

Substituting RF||C for ZF and RG for ZG in Equation 7–14 yields Equation 7–15, which is the ideal closed-loop gain equation for the lead compensation circuit.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = -\frac{\mathbf{R\_{F}}}{\mathbf{R\_{G}}} \left( \frac{1}{\mathbf{R\_{F}Cs + 1}} \right) \tag{7-15}$$

The forward gain for the inverting amplifier is given by Equation 7–16. Compare Equation 7–13 with Equation 6–5 to determine A.

$$\mathbf{A} = \frac{\mathbf{a}\mathbf{Z}\_{\mathsf{F}}}{\mathbf{Z}\_{\mathsf{G}} + \mathbf{A}\_{\mathsf{F}}} = \left(\frac{\mathbf{a}\mathbf{R}\_{\mathsf{F}}}{\mathbf{R}\_{\mathsf{G}} + \mathbf{R}\_{\mathsf{F}}}\right) \left(\frac{\mathfrak{l}}{\mathbf{R}\_{\mathsf{F}} \parallel \mathbf{R}\_{\mathsf{G}} \mathbf{C} \mathbf{s} + \mathfrak{l}}\right) \tag{7-16}$$

The op amp gain (a), the forward gain (A), and the ideal closed-loop gain are plotted in Figure 7–15. The op amp gain is plotted for reference only. The forward gain for the inverting op amp is not the op amp gain. Notice that the forward gain is reduced by the factor RF/(RG +RF), and it contains a high frequency pole. The ideal closed-loop gain follows the ideal curve until the 1/RFC breakpoint (same location as 1/τ2 breakpoint), and then it slopes down at –20 dB/decade. Lead compensation sacrifices the bandwidth between the 1/RFC breakpoint and the forward gain curve. The location of the 1/RFC pole determines the bandwidth sacrifice, and it can be much greater than shown here. The pole caused by RF, RG, and C does not appear until the op amp's gain has crossed the 0-dB axis, thus it does not affect the ideal closed-loop transfer function.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the gain (in decibels, dB) versus frequency (on a logarithmic scale). Here is a detailed description of the image:

1. **Axes**:
   - The vertical axis represents the gain in decibels (dB).
   - The horizontal axis represents the frequency, with specific points marked as \( \frac{1}{\tau_1} \), \( \frac{1}{\tau_2} \), and \( \frac{1}{R_FC} \).

2. **Gain Levels**:
   - The topmost horizontal line is labeled "20 Log a," representing the open-loop gain of the operational amplifier (Op Amp Gain).
   - The next horizontal line below it is labeled "20 Log \(\frac{aZ_F}{Z_G + Z_F}\)," which represents the gain considering the feedback network.
   - Another horizontal line is labeled "20 Log \(\frac{Z_F}{Z_G}\)," representing the ideal closed-loop gain.
   - The bottom horizontal line is labeled "0 dB," indicating the unity gain level.

3. **Frequency Points**:
   - The plot marks specific frequency points on the horizontal axis:
     - \( \frac{1}{\tau_1} \)
     - \( \frac{1}{\tau_2} \) and \( \frac{1}{R_FC} \)
     - \( \frac{1}{(R_C \parallel R_G)C} \)

4. **Gain Curves**:
   - The plot shows two main gain curves:
     - The upper curve represents the open-loop gain of the operational amplifier, which starts at "20 Log a" and decreases with increasing frequency.
     - The lower curve, labeled "A," represents the actual gain considering the feedback network. It starts at "20 Log \(\frac{aZ_F}{Z_G + Z_F}\)" and follows a similar decreasing trend as the open-loop gain but at a lower level.

5. **Slopes**:
   - The slopes of the gain curves change at the marked frequency points, indicating the presence of poles in the system's transfer function. These changes in slope correspond to the system's response to different frequency components.

6. **Annotations**:
   - The plot includes annotations indicating the different gain levels and the corresponding equations.
   - Arrows on the curves indicate the direction of the gain change with increasing frequency.

Overall, the image provides a detailed view of the frequency response of an operational amplifier with feedback, showing how the gain varies with frequency and highlighting the key points where the response changes.
```

Figure 7–15. Inverting Op Amp With Lead Compensation

The forward gain for the noninverting op amp is a; compare Equation 6–11 to Equation 6–5. The ideal closed-loop gain is given by Equation 7–17.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = \frac{\mathbf{Z\_{F}} + \mathbf{Z\_{G}}}{\mathbf{Z\_{G}}} = \left(\frac{\mathbf{R\_{F}} + \mathbf{R\_{G}}}{\mathbf{R\_{G}}}\right) \left(\frac{\mathbf{R\_{F}} \parallel \mathbf{R\_{G}} \mathbf{Cs} + \mathbf{1}}{\mathbf{R\_{F}} \mathbf{Cs} + \mathbf{1}}\right) \tag{7-17}$$

The plot of the noninverting op amp with lead compensation is shown in Figure 7–16. There is only one plot for both the op amp gain (a) and the forward gain (A), because they are identical in the noninverting circuit configuration. The ideal starts out as a flat line, but it slopes down because its closed-loop gain contains a pole and a zero. The pole always occurs closer to the low frequency axis because RF > RF||RG. The zero flattens the ideal closed-loop gain curve, but it never does any good because it cannot fall on the pole. The pole causes a loss in the closed-loop bandwidth by the amount separating the closed-loop and forward gain curves.

Voltage-Feedback Op Amp Compensation 7-15

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. The plot shows the gain (in decibels, dB) versus the logarithm of the frequency (Log(f)).

Here are the key features of the plot:

1. **Axes**:
   - The vertical axis represents the gain in decibels (dB).
   - The horizontal axis represents the logarithm of the frequency (Log(f)).

2. **Gain Levels**:
   - The plot starts at a high gain level of \(20 \log a\).
   - There is a middle gain level at \(20 \log \left(\frac{Z_F + Z_G}{Z_G}\right)\).
   - The 0 dB level is also marked on the plot.

3. **Breakpoints**:
   - The plot shows several breakpoints where the slope of the gain changes.
   - The first breakpoint occurs at \( \frac{1}{\tau_1} \).
   - The second breakpoint occurs at \( \frac{1}{\tau_2} \) and \( \frac{1}{R_F C} \).
   - The third breakpoint occurs at \( \frac{1}{(R_C \parallel R_G)C} \).

4. **Slopes**:
   - The gain starts at \(20 \log a\) and remains constant until the first breakpoint at \( \frac{1}{\tau_1} \).
   - After the first breakpoint, the gain decreases with a certain slope.
   - At the second breakpoint (\( \frac{1}{\tau_2} \) and \( \frac{1}{R_F C} \)), the slope changes again, indicating a further decrease in gain.
   - At the third breakpoint (\( \frac{1}{(R_C \parallel R_G)C} \)), the slope changes once more, showing a continued decrease in gain.

5. **Notations**:
   - \( Z_F \) and \( Z_G \) are impedances.
   - \( R_F \), \( R_C \), and \( R_G \) are resistances.
   - \( C \) is a capacitance.
   - \( \tau_1 \) and \( \tau_2 \) are time constants.

The plot provides a visual representation of how the gain of a system changes with frequency, highlighting the points where the gain starts to decrease and the rate of decrease changes.
```

Figure 7–16. Noninverting Op Amp With Lead Compensation

Although the forward gain is different in the inverting and noninverting circuits, the closedloop transfer functions take very similar shapes. This becomes truer as the closed-loop gain increases because the noninverting forward gain approaches the op amp gain. This relationship cannot be relied on in every situation, and each circuit must be checked to determine the closed-loop effects of the compensation scheme.

# **7.7 Compensated Attenuator Applied to Op Amp**

Stray capacitance on op amp inputs is a problem that circuit designers are always trying to get away from because it decreases stability and causes peaking. The circuit shown in Figure 7–17 has some stray capacitance (CG,) connected from the inverting input to ground. Equation 7–18 is the loop gain equation for the circuit with input capacitance.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the following labels:
   - The inverting input is marked with a minus sign (-).
   - The non-inverting input is marked with a plus sign (+).
   - The output is at the point of the triangle.

2. **Resistors**:
   - **RG**: This resistor is connected between the inverting input of the op-amp and a node that is also connected to the capacitor CG and the input voltage source VIN.
   - **RF**: This resistor is connected between the output of the op-amp and the inverting input of the op-amp, forming a feedback loop.

3. **Capacitor (CG)**: This capacitor is connected between the node shared by RG and the inverting input of the op-amp, and ground.

4. **Voltage Source (VIN)**: The input voltage source is connected to the node shared by RG and CG, with its other terminal connected to ground.

5. **Ground Connections**: The circuit has multiple ground connections:
   - The non-inverting input of the op-amp is connected to ground.
   - One terminal of the capacitor CG is connected to ground.
   - One terminal of the input voltage source VIN is connected to ground.

6. **Output (VOUT)**: The output of the op-amp is labeled as VOUT.

In summary, this circuit is a typical configuration of an op-amp with feedback, where the input signal VIN is applied through a resistor RG, and the feedback is provided through a resistor RF. The capacitor CG is connected to the inverting input, likely to influence the frequency response of the circuit. The non-inverting input is grounded, indicating that the op-amp is operating in an inverting configuration.
```

Figure 7–17. Op Amp With Stray Capacitance on the Inverting Input

$$\mathbf{A}\boldsymbol{\mathfrak{A}} = \left(\frac{\mathbf{R}\_{\mathbf{G}}}{\mathbf{R}\_{\mathbf{G}} + \mathbf{R}\_{\mathbf{F}}}\right) \left(\frac{\mathbf{r}}{\mathbf{R}\_{\mathbf{G}} \parallel \mathbf{R}\_{\mathbf{F}} \mathbf{C} \mathbf{s} + \boldsymbol{\tau}}\right) \left[\frac{\mathbf{k}}{(\mathbf{r}\_1 \mathbf{s} + \boldsymbol{\tau})(\mathbf{r}\_2 \mathbf{s} + \boldsymbol{\tau})}\right] \text{ (7-18)}$$

Op amps having high input and feedback resistors are subject to instability caused by stray capacitance on the inverting input. Referring to Equation 7–18, when the 1/(RF||RGCG) pole moves close to τ2 the stage is set for instability. Reasonable component values for a CMOS op amp are RF = 1 MΩ, RG = 1 MΩ, and CG = 10 pF. The resulting pole occurs at 318 kHz, and this frequency is lower than the breakpoint of τ<sup>2</sup> for many op amps. There is 90 of phase shift resulting from τ1, the 1/(RF||RGC) pole adds 45° phase shift at 318 kHz, and τ<sup>2</sup> starts to add another 45° phase shift at about 600 kHz. This circuit is unstable because of the stray input capacitance. The circuit is compensated by adding a feedback capacitor as shown in Figure 7–18.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the symbol 'a' inside it. The triangle has two input terminals and one output terminal. The non-inverting input (+) is connected to the ground, and the inverting input (-) is connected to the rest of the circuit.

2. **Input Voltage Source (VIN)**: On the left side of the diagram, there is a voltage source labeled VIN. This source is connected to the ground on one side and to a resistor RG on the other side.

3. **Resistor (RG)**: The resistor RG is connected between the input voltage source VIN and the inverting input (-) of the op-amp.

4. **Capacitor (CG)**: There is a capacitor CG connected in parallel with the resistor RG. One terminal of CG is connected to the junction between VIN and RG, and the other terminal is connected to the ground.

5. **Feedback Resistor (RF)**: The resistor RF is connected between the output of the op-amp (VOUT) and the inverting input (-) of the op-amp.

6. **Feedback Capacitor (CF)**: The capacitor CF is connected in parallel with the feedback resistor RF. One terminal of CF is connected to the junction between RF and the inverting input (-) of the op-amp, and the other terminal is connected to the output of the op-amp (VOUT).

7. **Output Voltage (VOUT)**: The output voltage VOUT is taken from the output terminal of the op-amp.

In summary, the circuit is a feedback configuration involving an op-amp, resistors, and capacitors. The input voltage VIN is applied through a resistor RG and a capacitor CG to the inverting input of the op-amp, while the feedback network consists of a resistor RF and a capacitor CF connected between the output and the inverting input of the op-amp. The non-inverting input of the op-amp is grounded.
```

Figure 7–18. Compensated Attenuator Circuit

The loop gain with CF added is given by Equation 7–19.

$$\mathsf{Av} = \left[ \frac{\frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}\mathsf{C}\_{\mathsf{G}}\mathsf{s}+\mathsf{I}} + \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{F}}\mathsf{C}\_{\mathsf{F}}\mathsf{s}+\mathsf{I}}} \right] \left[ \frac{\frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}\mathsf{C}\_{\mathsf{G}}\mathsf{s}+\mathsf{I}}}{\mathsf{R}\_{\mathsf{G}}\mathsf{C}\_{\mathsf{G}}\mathsf{s}+\mathsf{I}}} \right] \left( \frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}\mathsf{s}+\mathsf{I}} \right) \qquad (7-19)$$

If RGCG = RFCF Equation 7–19 reduces to Equation 7–20.

$$\mathbf{A}\boldsymbol{\mathfrak{A}} = \left(\frac{\mathbf{R}\_{\mathbf{G}}}{\mathbf{R}\_{\mathbf{G}} + \mathbf{R}\_{\mathbf{F}}}\right) \left[\frac{\mathbf{K}}{(\mathbf{r}\_1 \mathbf{s} + \mathbf{t})(\mathbf{r}\_2 \mathbf{s} + \mathbf{t})}\right] \tag{7-20}$$

The compensated attenuator Bode plot is shown in Figure 7–19. Adding the correct 1/RFCF breakpoint cancels out the 1/RGCG breakpoint; the loop gain is independent of the capacitors. Now is the time to take advantage of the stray capacitance. CF can be formed by running a wide copper strip from the output of the op amp over the ground plane under RF; do not connect the other end of this copper strip. The circuit is tuned by removing some copper (a razor works well) until all peaking is eliminated. Then measure the copper, and have an identical trace put on the printed-circuit board.

Voltage-Feedback Op Amp Compensation 7-17

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one for magnitude (in decibels, dB) and one for phase (in degrees).

1. **Magnitude Plot (Top Plot):**
   - The vertical axis is labeled "20 Log (Aβ)" and is measured in decibels (dB).
   - The horizontal axis is labeled "Log(f)" and represents the logarithm of frequency.
   - There are two curves shown: one labeled "Without CF" and another labeled "With CF".
   - The "Without CF" curve starts at a high magnitude and decreases in two distinct slopes as frequency increases.
   - The "With CF" curve also starts at a high magnitude but decreases more gradually compared to the "Without CF" curve.
   - The plot shows three critical frequencies: 1/τ1, 1/τ2, and 1/(RF||RGCG), where the slopes of the curves change.

2. **Phase Plot (Bottom Plot):**
   - The vertical axis is labeled "PHASE (Aβ)" and is measured in degrees (°).
   - The horizontal axis is the same as the magnitude plot, labeled "Log(f)".
   - There are two curves shown: one labeled "Without CF" and another labeled "With CF".
   - The "Without CF" curve starts at 0° and decreases, passing through -45°, -135°, and approaching -180° as frequency increases.
   - The "With CF" curve also starts at 0° but decreases more gradually compared to the "Without CF" curve.
   - The plot shows the same critical frequencies: 1/τ1, 1/τ2, and 1/(RF||RGCG), where the phase angles change.

3. **Critical Frequencies:**
   - 1/τ1: The first break frequency where the slope of the magnitude plot changes and the phase plot starts to decrease.
   - 1/τ2: The second break frequency where the slope of the magnitude plot changes again and the phase plot continues to decrease.
   - 1/(RF||RGCG): Another critical frequency where the slope of the magnitude plot changes and the phase plot continues to decrease.

4. **Annotations:**
   - The plot is annotated with arrows and labels indicating the behavior of the system "With CF" and "Without CF".
   - The dashed lines indicate the critical frequencies and the corresponding changes in magnitude and phase.

Overall, the Bode plot illustrates how the presence of a compensating factor (CF) affects the frequency response of the system, resulting in a more gradual decrease in both magnitude and phase compared to the system without CF.
```

Figure 7–19. Compensated Attenuator Bode Plot

The inverting and noninverting closed-loop gain equations are a function of frequency. Equation 7–21 is the closed-loop gain equation for the inverting op amp. When RFCF = RGCG, Equation 7–21 reduces to Equation 7–22, which is independent of the breakpoint. This also happens to the noninverting op amp circuit. This is one of the few occasions when the compensation does not affect the closed-loop gain frequency response.

$$\frac{\frac{\mathsf{R\_{F}}}{\mathsf{V\_{OUT}}}}{\frac{\mathsf{V\_{IN}}}{\mathsf{R\_{F}\mathsf{C\_{F}}}+\mathsf{I}}} = -\frac{\frac{\mathsf{R\_{F}}}{\mathsf{R\_{F}\mathsf{C\_{F}}}+\mathsf{I}}}{\frac{\mathsf{R\_{G}}{\mathsf{R\_{G}}}}{\mathsf{R\_{G}}+\mathsf{I}}}\tag{7-21}$$

$$\text{When } \mathsf{R\_F}\mathsf{C\_F} = \mathsf{R\_G}\mathsf{C\_G} \qquad \frac{\mathsf{V\_{OUT}}}{\mathsf{V\_{IN}}} = -\begin{pmatrix} \mathsf{R\_F} \\ \overline{\mathsf{R\_G}} \end{pmatrix} \tag{7-22}$$

# **7.8 Lead-Lag Compensation**

Lead-lag compensation stabilizes the circuit without sacrificing the closed-loop gain performance. It is often used with uncompensated op amps. This type of compensation provides excellent high-frequency performance. The circuit schematic is shown in Figure 7–20, and the loop gain is given by Equation 7–23.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a configuration that appears to be a differentiator circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with the point facing right. The inverting input is marked with a minus sign (-) and the non-inverting input is marked with a plus sign (+). The output of the op-amp is labeled as \( V_{OUT} \).

2. **Capacitor (C)**: The capacitor is connected to the inverting input of the op-amp. One terminal of the capacitor is connected to the input voltage source \( V_{IN} \), and the other terminal is connected to a resistor \( R \).

3. **Resistor (R)**: This resistor is connected in series with the capacitor \( C \). One end of the resistor is connected to the capacitor, and the other end is connected to the inverting input of the op-amp.

4. **Resistor (RG)**: This resistor is connected between the inverting input of the op-amp and the ground.

5. **Resistor (RF)**: This resistor is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input of the op-amp, forming a feedback loop.

6. **Voltage Source (VIN)**: The input voltage source \( V_{IN} \) is connected to the capacitor \( C \) and is grounded on the other side.

The non-inverting input of the op-amp is connected to the ground. The configuration suggests that the circuit is designed to differentiate the input signal \( V_{IN} \) with respect to time, producing an output voltage \( V_{OUT} \) that is proportional to the rate of change of the input voltage. The presence of the capacitor \( C \) and the resistor \( R \) in series at the input, along with the feedback resistor \( R_F \), supports this functionality.
```

Figure 7–20. Lead-Lag Compensated Op Amp

$$\mathbf{A}\otimes = \frac{\mathbf{K}}{(\mathbf{r}\_1\mathbf{s}+\mathbf{1})(\mathbf{r}\_2\mathbf{s}+\mathbf{1})} \frac{\mathbf{R}\_{\mathbf{G}}}{\mathbf{R}\_{\mathbf{G}}+\mathbf{R}\_{\mathbf{F}}} \frac{\mathbf{R}\mathbf{C}\mathbf{s}+\mathbf{1}}{(\mathbf{R}\mathbf{R}\_{\mathbf{G}}+\mathbf{R}\mathbf{R}\_{\mathbf{F}}+\mathbf{R}\_{\mathbf{G}}\mathbf{R}\_{\mathbf{F}})} \mathbf{C}\mathbf{s}+\mathbf{1}$$

Referring to Figure 7–21, a pole is introduced at ω = 1/RC, and this pole reduces the gain 3 dB at the breakpoint. When the zero occurs prior to the first op amp pole it cancels out the phase shift caused by the ω = 1/RC pole. The phase shift is completely canceled before the second op amp pole occurs, and the circuit reacts as if the pole was never introduced. Nevertheless, Aβ is reduced by 3 dB or more, so the loop gain crosses the 0-dB axis at a lower frequency. The beauty of lead lag compensation is that the closedloop ideal gain is not affected as is shown below. The Thevenin equivalent of the input circuit is calculated in Equation 7–24, the circuit gain in terms of Thevenin equivalents is calculated in Equation 7–25, and the ideal closed-loop gain is calculated in Equation 7–26.

Here is the image describtion:
```
The image is a graph that illustrates the frequency response of a system before and after compensation. The graph has a logarithmic scale on the x-axis labeled "Log(f)" representing the frequency, and the y-axis labeled "Amplitude" with a logarithmic scale as well.

The graph shows two curves: one before compensation (dashed line) and one after compensation (solid line). 

1. **Before Compensation (Dashed Line)**:
   - The curve starts at a high amplitude value labeled "20 Log (Aβ)".
   - It decreases linearly with a slope after a certain frequency point labeled "1/(RC)".
   - The slope continues to decrease until it reaches another frequency point labeled "1/τ1".
   - The curve then continues to decrease at a steeper slope until it reaches the frequency point labeled "1/τ2".

2. **After Compensation (Solid Line)**:
   - The curve starts at a lower amplitude value labeled "20 Log (aR_G/(R_F + R_G))".
   - It remains flat at 0dB for a certain range of frequencies.
   - After the frequency point labeled "1/(RC)", the curve starts to decrease linearly.
   - The slope changes at the frequency point labeled "1/τ1" and continues to decrease.
   - The curve then changes slope again at the frequency point labeled "1/τ2".

The graph also includes a label for the compensation network, indicating the mathematical expression for the compensated frequency response: "1/(RR_G + R_FR + R_FR_G)/(R_F + R_G)C".

Overall, the image demonstrates how the compensation network modifies the frequency response of the system, resulting in a flatter response at lower frequencies and a more controlled decrease at higher frequencies.
```

Figure 7–21. Bode Plot of Lead-Lag Compensated Op Amp

Voltage-Feedback Op Amp Compensation 7-19

$$\mathbb{V}\_{\mathsf{T}\mathsf{H}} = \mathbb{V}\_{\mathsf{IN}} \frac{\mathsf{R} + \frac{\mathsf{T}}{\mathsf{Cs}}}{\mathsf{R} + \mathsf{R}\_{\mathsf{G}} + \frac{\mathsf{T}}{\mathsf{Cs}}} \qquad\qquad\qquad\qquad\qquad\qquad\mathbb{R}\_{\mathsf{T}\mathsf{H}} = \frac{\mathsf{R}\_{\mathsf{G}} \left(\mathsf{R} + \frac{\mathsf{T}}{\mathsf{Cs}}\right)}{\mathsf{R} + \mathsf{R}\_{\mathsf{G}} + \frac{\mathsf{T}}{\mathsf{Cs}}}\tag{7-24}$$

$$
\lambda\_{\text{OUT}} = -\lambda\_{\text{TH}} \frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{\text{TH}}} \tag{7-25}
$$

$$\frac{\mathbf{V}\_{\text{OUT}}}{\mathbf{V}\_{\text{IN}}} = \frac{\mathbf{R} + \frac{\mathbf{I}}{\mathbf{C}\mathbf{s}}}{\mathbf{R} + \mathbf{R}\_{\text{G}} + \frac{\mathbf{I}}{\mathbf{C}\mathbf{s}}} \frac{\mathbf{R}\_{\text{F}}}{\mathbf{R}\_{\text{G}} (\mathbf{R} + \frac{\mathbf{I}}{\mathbf{C}\mathbf{s}})} = \frac{\mathbf{R}\_{\text{F}}}{\mathbf{R}\_{\text{G}}} \tag{7-26}$$

Equation 7–26 is intuitively obvious because the RC network is placed across a virtual ground. As long as the loop gain, Aβ, is large, the feedback will null out the closed-loop effect of RC, and the circuit will function as if it were not there. The closed-loop log plot of the lead-lag-compensated op amp is given in Figure 7–22. Notice that the pole and zero resulting from the compensation occur and are gone before the first amplifier poles come on the scene. This prevents interaction, but it is not required for stability.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the amplitude (in decibels, dB) versus the logarithm of the frequency (log(f)).

Here are the key features of the plot:

1. **Axes**:
   - The vertical axis represents the amplitude in decibels (dB).
   - The horizontal axis represents the logarithm of the frequency (log(f)).

2. **Amplitude Levels**:
   - The plot starts at a lower amplitude level, labeled as \(20 \log \left(\frac{R_F}{R_G}\right)\).
   - It then rises to a higher amplitude level, labeled as \(20 \log A\).

3. **Frequency Points**:
   - The plot shows several key frequency points marked by vertical dashed lines:
     - \( \frac{1}{(R_G + R)C} \)
     - \( \frac{1}{RC} \)
     - \( \frac{1}{\tau_1} \)
     - \( \frac{1}{\tau_2} \)

4. **Amplitude Changes**:
   - At the frequency \( \frac{1}{(R_G + R)C} \), the amplitude starts to increase.
   - The amplitude reaches a peak at the frequency \( \frac{1}{RC} \).
   - After this peak, the amplitude starts to decrease at the frequency \( \frac{1}{\tau_1} \).
   - The decrease continues more steeply after the frequency \( \frac{1}{\tau_2} \).

5. **Slope Changes**:
   - The plot shows different slopes in different frequency regions, indicating changes in the system's response at those frequencies.

Overall, the Bode plot provides a visual representation of how the amplitude of the system's output varies with frequency, highlighting key frequencies where significant changes occur.
```

Figure 7–22. Closed-Loop Plot of Lead-Lag Compensated Op Amp

# **7.9 Comparison of Compensation Schemes**

Internally compensated op amps can, and often do, oscillate under some circuit conditions. Internally compensated op amps need an external pole to get the oscillation or ringing started, and circuit stray capacitances often supply the phase shift required for instability. Loads, such as cables, often cause internally compensated op amps to ring severely.

Dominant pole compensation is often used in IC design because it is easy to implement. It rolls off the closed-loop gain early; thus, it is seldom used as an external form of compensation unless filtering is required. Load capacitance, depending on its pole location, usually causes the op amp to ring. Large load capacitance can stabilize the op amp because it acts as dominant pole compensation.

The simplest form of compensation is gain compensation. High closed-loop gains are reflected in lower loop gains, and in turn, lower loop gains increase stability. If an op amp circuit can be stabilized by increasing the closed-loop gain, do it.

Stray capacitance across the feedback resistor tends to stabilize the op amp because it is a form of lead compensation. This compensation scheme is useful for limiting the circuit bandwidth, but it decreases the closed-loop gain.

Stray capacitance on the inverting input works with the parallel combination of the feedback and gain setting resistors to form a pole in the Bode plot, and this pole decreases the circuit's stability. This effect is normally observed in high-impedance circuits built with CMOS op amps. Adding a feedback capacitor forms a compensated attenuator scheme that cancels out the input pole. The cancellation occurs when the input and feedback RC time constants are equal. Under the conditions of equal time constants, the op amp functions as though the stray input capacitance was not there. An excellent method of implementing a compensated attenuator is to build a stray feedback capacitor using the ground plane and a trace off the output node.

Lead-lag compensation stabilizes the op amp, and it yields the best closed-loop frequency performance. Contrary to some published opinions, no compensation scheme will increase the bandwidth beyond that of the op amp. Lead-lag compensation just gives the best bandwidth for the compensation.

# **7.10 Conclusions**

The stability criteria often is not oscillation, rather it is circuit performance as exhibited by peaking and ringing.

The circuit bandwidth can often be increased by connecting an external capacitor in parallel with the op amp. Some op amps have hooks that enable a parallel capacitor to be connected in parallel with a portion of the input stages. This increases bandwidth because it shunts high frequencies past the low bandwidth gm stages, but this method of compensation depends on the op amp type and manufacturer.

The compensation techniques given here are adequate for the majority of applications. When the new and challenging application presents itself, use the procedure outlined here to invent your own compensation technique.

# **Chapter 8**

# **Current-Feedback Op Amp Analysis**

#### Ron Mancini

# **8.1 Introduction**

Current-feedback amplifiers (CFA) do not have the traditional differential amplifier input structure, thus they sacrifice the parameter matching inherent to that structure. The CFA circuit configuration prevents them from obtaining the precision of voltage-feedback amplifiers (VFA), but the circuit configuration that sacrifices precision results in increased bandwidth and slew rate. The higher bandwidth is relatively independent of closed-loop gain, so the constant gain-bandwidth restriction applied to VFAs is removed for CFAs. The slew rate of CFAs is much improved from their counterpart VFAs because their structure enables the output stage to supply slewing current until the output reaches its final value. In general, VFAs are used for precision and general purpose applications, while CFAs are restricted to high frequency applications above 100 MHz.

Although CFAs do not have the precision of their VFA counterparts, they are precise enough to be dc-coupled in video applications where dynamic range requirements are not severe. CFAs, unlike previous generation high-frequency amplifiers, have eliminated the ac coupling requirement; they are usually dc-coupled while they operate in the GHz range. CFAs have much faster slew rates than VFAs, so they have faster rise/fall times and less intermodulation distortion.

# **8.2 CFA Model**

The CFA model is shown in Figure 8–1. The noninverting input of a CFA connects to the input of the input buffer, so it has very high impedance similar to that of a bipolar transistor noninverting VFA input. The inverting input connects to the input buffer's output, so the inverting input impedance is equivalent to a buffer's output impedance, which is very low. ZB models the input buffer's output impedance, and it is usually less than 50 Ω. The input buffer gain, GB, is as close to one as IC design methods can achieve, and it is small enough to neglect in the calculations.

Development of the Stability Equation

Here is the image describtion:
```
The image depicts a simplified internal model of an operational amplifier (op-amp). The op-amp is represented by a triangular symbol, which is a common way to illustrate op-amps in circuit diagrams. Here is a detailed description of the components and their connections within the op-amp:

1. **Inputs**:
   - **Noninverting Input (+)**: This is the positive input terminal of the op-amp.
   - **Inverting Input (-)**: This is the negative input terminal of the op-amp.

2. **Internal Components**:
   - **GB (Gain Block)**: This represents the internal gain stage of the op-amp. It amplifies the difference between the noninverting and inverting inputs.
   - **ZB (Impedance Block)**: This is a resistor connected to the inverting input, representing the input impedance of the op-amp.
   - **I (Current Source)**: This indicates the current flowing through the impedance block ZB.
   - **Z(I) (Impedance as a function of current)**: This represents the internal impedance that varies with the current.
   - **GOUT (Output Gain Block)**: This is another gain stage that amplifies the signal before it reaches the output.
   - **ZOUT (Output Impedance)**: This is a resistor connected to the output terminal, representing the output impedance of the op-amp.

3. **Output**:
   - **VOUT**: This is the output voltage of the op-amp.

The diagram shows the flow of the signal from the inputs through the internal components and finally to the output. The noninverting and inverting inputs feed into the gain block GB, which amplifies the differential signal. The amplified signal then passes through the impedance Z(I) and the output gain block GOUT before reaching the output terminal VOUT. The output impedance ZOUT is shown as a resistor connected to the output terminal, indicating that the op-amp has a finite output impedance.
```

# Figure 8–1. Current-Feedback Amplifier Model

The output buffer provides low output impedance for the amplifier. Again, the output buffer gain, GOUT, is very close to one, so it is neglected in the analysis. The output impedance of the output buffer is ignored during the calculations. This parameter may influence the circuit performance when driving very low impedance or capacitive loads, but this is usually not the case. The input buffer's output impedance can't be ignored because affects stability at high frequencies.

The current-controlled current source, Z, is a transimpedance. The transimpedance in a CFA serves the same function as gain in a VFA; it is the parameter that makes the performance of the op amp dependent only on the passive parameter values. Usually the transimpedance is very high, in the MΩ range, so the CFA gains accuracy by closing a feedback loop in the same manner that the VFA does.

# **8.3 Development of the Stability Equation**

The stability equation is developed with the aid of Figure 8–2. Remember, stability is independent of the input, and stability depends solely on the loop gain, Aβ. Breaking the loop at point X, inserting a test signal, VTI, and calculating the return signal VTO develops the stability equation.

Here is the image describtion:
```
The image depicts a circuit diagram featuring a current feedback amplifier (CFA). The CFA has a non-inverting input connected to the ground. The inverting input is connected to a node that links two impedances, Z_G and Z_F. Z_G is connected to the ground, while Z_F is connected to the output of the CFA.

The output of the CFA is labeled as V_OUT, which is also designated as V_TO, indicating it is the test signal output. There is a break in the feedback loop between the output of the CFA and the inverting input, where a test signal (V_TI) can be applied. This break is indicated by two arrows pointing towards each other, suggesting the point where the loop can be interrupted for testing purposes.

In summary, the diagram illustrates a feedback loop in a CFA circuit, with specific points marked for breaking the loop and applying a test signal to analyze the circuit's behavior.
```

Figure 8–2. Stability Analysis Circuit

The circuit used for stability calculations is shown in Figure 8–3 where the model of Figure 8–1 is substituted for the CFA symbol. The input and output buffer gain, and output buffer output impedance have been deleted from the circuit to simplify calculations. This approximation is valid for almost all applications.

Here is the image describtion:
```
The image depicts two electrical circuits. 

The first circuit on the left consists of the following components:
1. A voltage source labeled \( V_{TI} \) with its positive terminal connected to the rest of the circuit and its negative terminal grounded.
2. A resistor labeled \( Z_F \) connected in series with the voltage source. The current flowing through this resistor is labeled \( I_2 \) and is shown with an arrow indicating the direction of the current flow from the voltage source through \( Z_F \).
3. A node where three components meet: the resistor \( Z_F \), another resistor labeled \( Z_G \), and a current source labeled \( I_1 \).
4. The resistor \( Z_G \) is connected from the node to the ground.
5. The current source \( I_1 \) is connected from the node to another resistor labeled \( Z_B \), which is grounded.

The second circuit on the right consists of:
1. A current source labeled \( I_1 Z \) with its negative terminal grounded.
2. The output voltage \( V_{OUT} \) is labeled as \( V_{TO} \) and is taken from the positive terminal of the current source.

In summary, the left circuit shows a combination of resistors and a current source connected to a voltage source, while the right circuit shows a current source with an output voltage labeled \( V_{TO} \).
```

Figure 8–3. Stability Analysis Circuit

The transfer equation is given in Equation 8–1, and the Kirchoff"s law is used to write Equations 8–2 and 8–3.

$$\mathsf{V}\_{\mathsf{T}\mathsf{O}} = \mathsf{I}\_{\mathsf{T}} \mathsf{Z} \tag{8-4}$$

$$\mathbb{V}\_{\mathsf{T}\parallel} = \mathbb{I}\_2(\mathbb{Z}\_{\mathsf{F}} + \mathbb{Z}\_{\mathsf{G}} \parallel \mathbb{Z}\_{\mathsf{B}}) \tag{8-2}$$

$$\mathbb{I}\_2(\mathbb{Z}\_\mathbb{G} \parallel \mathbb{Z}\_\mathbb{B}) = \mathbb{I}\_\uparrow \mathbb{Z}\_\mathbb{B} \tag{8-3}$$

Equations 8–2 and 8–3 are combined to yield Equation 8–4.

$$\mathbb{V}\_{\rm Tl} = \mathbb{I}\_{\rm l} (\mathbb{Z}\_{\rm F} + \mathbb{Z}\_{\rm G} \parallel \mathbb{Z}\_{\rm B}) \left( \mathbb{1} + \frac{\mathbb{Z}\_{\rm B}}{\mathbb{Z}\_{\rm G}} \right) = \mathbb{I}\_{\rm l} \mathbb{Z}\_{\rm F} \left( \mathbb{1} + \frac{\mathbb{Z}\_{\rm B}}{\mathbb{Z}\_{\rm F} \parallel \mathbb{Z}\_{\rm G}} \right) \tag{8-4}$$

Dividing Equation 8–1 by Equation 8–4 yields Equation 8–5, and this is the open loop transfer equation. This equation is commonly known as the loop gain.

$$\mathsf{A}\emptyset = \frac{\mathsf{V}\_{\mathsf{T}\mathsf{O}}}{\mathsf{V}\_{\mathsf{T}}} = \frac{\mathsf{Z}}{\left(\mathsf{Z}\_{\mathsf{F}}\left(\mathsf{1} + \frac{\mathsf{Z}\_{\mathsf{B}}}{\mathsf{Z}\_{\mathsf{F}}\|\mathsf{Z}\_{\mathsf{G}}}\right)\right)}\tag{8-5}$$

# **8.4 The Noninverting CFA**

The closed-loop gain equation for the noninverting CFA is developed with the aid of Figure 8–4, where external gain setting resistors have been added to the circuit. The buffers are shown in Figure 8–4, but because their gains equal one and they are included within the feedback loop, the buffer gain does not enter into the calculations.

Current-Feedback Op Amp Analysis 8-3

Here is the image describtion:
```
The image depicts a circuit diagram of an operational amplifier (op-amp) configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The main component is an op-amp, represented by a large triangle. The op-amp has two inputs and one output.
   - The non-inverting input (+) is connected to the input voltage \( V_{IN} \).
   - The inverting input (-) is connected to a node that is connected to other components in the circuit.

2. **Feedback Network**:
   - There is a feedback resistor \( Z_F \) connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
   - The inverting input (-) is also connected to a node where a resistor \( Z_G \) is connected to the ground.

3. **Additional Components**:
   - There is a voltage source \( V_A \) connected to the node between \( Z_G \) and the inverting input (-).
   - A current \( I \) flows through a resistor \( Z_B \) which is connected to the inverting input (-) and the output of a voltage-controlled current source (VCCS) with a gain of 1.
   - The VCCS is represented by a diamond shape with a gain of 1, indicating that the current \( I \) is controlled by the voltage at the inverting input (-).

4. **Internal Configuration**:
   - Inside the op-amp, there is a voltage-controlled voltage source (VCVS) with a gain of 1, connected to the output of the op-amp.
   - The VCCS is connected to the inverting input (-) and the ground, indicating that the current \( I \) is proportional to the voltage difference across \( Z_B \).

5. **Output**:
   - The output voltage \( V_{OUT} \) is taken from the output of the op-amp.

In summary, the circuit is a complex op-amp configuration with feedback and additional components that influence the behavior of the op-amp. The feedback resistor \( Z_F \), the resistor \( Z_G \), and the voltage source \( V_A \) play crucial roles in determining the output voltage \( V_{OUT} \). The internal VCCS and VCVS with gains of 1 indicate that the op-amp is designed to maintain specific relationships between the input and output voltages and currents.
```

Figure 8–4. Noninverting CFA

Equation 8–6 is the transfer equation, Equation 8–7 is the current equation at the inverting node, and Equation 8–8 is the input loop equation. These equations are combined to yield the closed-loop gain equation, Equation 8–9.

$$\mathsf{V}\_{\mathsf{OMT}} = \mathsf{l}\mathsf{Z} \tag{8-6}$$

$$\mathbf{M} = \begin{pmatrix} \mathbf{V\_A} \\ \frac{\mathbf{Z\_G}}{\mathbf{Z\_G}} \end{pmatrix} \begin{pmatrix} \mathbf{V\_{OUT}} - \mathbf{V\_A} \\ \frac{\mathbf{Z\_F}}{\mathbf{Z\_F}} \end{pmatrix} \tag{8-7}$$

$$\mathsf{V}\_{\mathsf{A}} = \mathsf{V}\_{\mathsf{IN}} \mathsf{I} \mathsf{Z}\_{\mathsf{B}} \tag{8-8}$$

$$\frac{\mathbb{Z}\left(\mathbb{1} + \frac{\mathbb{Z}\_{\mathbb{F}}}{\mathbb{Z}\_{\mathbb{G}}}\right)}{\mathbb{V}\_{\text{UN}}} = \frac{\mathbb{Z}\left(\mathbb{1} + \frac{\mathbb{Z}\_{\mathbb{B}}}{\mathbb{Z}\_{\mathbb{F}} \| \mathbb{Z}\_{\mathbb{G}}}\right)}{\mathbb{1} + \frac{\mathbb{Z}}{\mathbb{Z}\_{\mathbb{F}}\left(\mathbb{1} + \frac{\mathbb{Z}\_{\mathbb{B}}}{\mathbb{Z}\_{\mathbb{F}} \| \mathbb{Z}\_{\mathbb{G}}}\right)}}\tag{8-9}$$

When the input buffer output impedance, ZB, approaches zero, Equation 8–9 reduces to Equation 8–10.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = \frac{\frac{\mathbf{Z}\left(\mathbf{1} + \frac{\mathbf{Z\_{F}}}{\mathbf{Z\_{G}}}\right)}{\mathbf{Z\_{F}}}}{\mathbf{1} + \frac{\mathbf{Z}}{\mathbf{Z\_{F}}}} = \frac{\mathbf{1} + \frac{\mathbf{Z\_{F}}}{\mathbf{Z\_{G}}}}{\mathbf{1} + \frac{\mathbf{Z\_{F}}}{\mathbf{Z}}}\tag{8-10}$$

When the transimpedance, Z, is very high, the term ZF/Z in Equation 8–10 approaches zero, and Equation 8–10 reduces to Equation 8–11; the ideal closed-loop gain equation for the CFA. The ideal closed-loop gain equations for the CFA and VFA are identical, and the degree to which they depart from ideal is dependent on the validity of the assumptions. The VFA has one assumption that the direct gain is very high, while the CFA has two assumptions, that the transimpedance is very high and that the input buffer output impedance is very low. As would be expected, two assumptions are much harder to meet than one, thus the CFA departs from the ideal more than the VFA does.

$$\frac{\mathsf{V\_{OUT}}}{\mathsf{V\_{IN}}} = \mathsf{1} + \frac{\mathsf{Z\_{E}}}{\mathsf{Z\_{G}}} \tag{8-\mathsf{11}}$$

# **8.5 The Inverting CFA**

The inverting CFA configuration is seldom used because the inverting input impedance is very low (ZB||ZF +ZG). When ZG is made dominant by selecting it as a high resistance value it overrides the effect of ZB. ZF must also be selected as a high value to achieve at least unity gain, and high values for ZF result in poor bandwidth performance, as we will see in the next section. If ZG is selected as a low value the frequency sensitive ZB causes the gain to increase as frequency increases. These limitations restrict inverting applications of the inverting CFA.

Here is the image describtion:
```
The image depicts a circuit diagram of an operational amplifier (op-amp) configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with two inputs and one output.
   - The non-inverting input (+) is connected to the ground.
   - The inverting input (-) is connected to a node where three components converge.

2. **Resistors and Impedances**:
   - **Z_G**: This impedance is connected between the input voltage \( V_{IN} \) and the node at the inverting input of the op-amp.
   - **Z_F**: This impedance is connected between the output voltage \( V_{OUT} \) and the same node at the inverting input of the op-amp.
   - **Z_B**: This impedance is inside the op-amp, connected between the inverting input and a ground symbol within the op-amp.

3. **Voltage Sources**:
   - **V_A**: This voltage source is connected to the node at the inverting input of the op-amp and is grounded.

4. **Current and Gain**:
   - **I**: The current flowing through \( Z_B \) is labeled as \( I \).
   - **G = 1**: The op-amp has a gain of 1, indicated twice within the op-amp symbol.

5. **Output**:
   - The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

6. **Additional Components**:
   - There is a circle labeled \( I_Z \) inside the op-amp, which might represent a current source or another internal component.

The circuit appears to be a feedback configuration, where the output \( V_{OUT} \) is fed back to the inverting input through \( Z_F \). The input voltage \( V_{IN} \) is applied through \( Z_G \). The configuration suggests a form of a differential amplifier or a specific op-amp application with internal feedback mechanisms.
```

Figure 8–5. Inverting CFA

The current equation for the input node is written as Equation 8–12. Equation 8–13 defines the dummy variable, VA, and Equation 8–14 is the transfer equation for the CFA. These equations are combined and simplified leading to Equation 8–15, which is the closed-loop gain equation for the inverting CFA.

$$\mathbf{M} + \frac{\mathsf{V}\_{\mathsf{IN}} - \mathsf{V}\_{\mathsf{A}}}{\mathsf{Z}\_{\mathsf{G}}} = \frac{\mathsf{V}\_{\mathsf{A}} - \mathsf{V}\_{\mathsf{OUT}}}{\mathsf{Z}\_{\mathsf{F}}} \tag{8-12}$$

$$
\Delta \mathbb{Z}\_{\mathbb{B}} = -\mathbb{V}\_{\mathbb{A}} \tag{8-13}
$$

$$
\Delta = \mathsf{V}\_{\mathsf{OUT}} \tag{8-14}
$$

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = -\frac{\mathsf{Z}\_{\mathsf{c}} \left(\mathsf{1} + \frac{\mathsf{Z}\_{\mathsf{B}}}{\mathsf{Z}\_{\mathsf{F}} \| \mathsf{Z}\_{\mathsf{G}}}\right)}{\mathsf{1} + \frac{\mathsf{Z}}{\mathsf{Z}\_{\mathsf{F}} \left(\mathsf{1} + \frac{\mathsf{Z}\_{\mathsf{B}}}{\mathsf{Z}\_{\mathsf{F}} \| \mathsf{Z}\_{\mathsf{G}}}\right)}}\tag{8-15}$$

When ZB approaches zero, Equation 8–15 reduces to Equation 8–16.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = -\frac{\frac{\mathbf{\mathcal{I}}}{\mathbf{Z\_{G}}}}{\frac{\mathbf{\mathcal{I}}}{\mathbf{Z}} + \frac{\mathbf{\mathcal{I}}}{\mathbf{Z\_{F}}}} \tag{8-16}$$

When Z is very large, Equation 8–16 becomes Equation 8–17, which is the ideal closedloop gain equation for the inverting CFA.

$$\frac{\mathbf{V\_{OUT}}}{\mathbf{V\_{IN}}} = -\frac{\mathbf{Z\_{F}}}{\mathbf{Z\_{G}}} \tag{8-17}$$

The ideal closed-loop gain equation for the inverting VFA and CFA op amps are identical. Both configurations have lower input impedance than the noninverting configuration has, but the VFA has one assumption while the CFA has two assumptions. Again, as was the case with the noninverting counterparts, the CFA is less ideal than the VFA because of the two assumptions. The zero ZB assumption always breaks down in bipolar junction transistors as is shown later. The CFA is almost never used in the differential amplifier configuration because of the CFA's gross input impedance mismatch.

# **8.6 Stability Analysis**

The stability equation is repeated as Equation 8–18.

$$\mathsf{Av} = \frac{\mathsf{V}\_{\mathsf{T}\mathsf{O}}}{\mathsf{V}\_{\mathsf{T}\mathsf{I}}} = \frac{\mathsf{Z}}{\left(\mathsf{Z}\_{\mathsf{F}} \left(\mathsf{I} + \frac{\mathsf{Z}\_{\mathsf{B}}}{\mathsf{Z}\_{\mathsf{F}} \| \mathsf{Z}\_{\mathsf{G}}}\right)\right)}\tag{8-18}$$

Comparing Equations 8–9 and 8–15 to Equation 8–18 reveals that the inverting and noninverting CFA op amps have identical stability equations. This is the expected result because stability of any feedback circuit is a function of the loop gain, and the input signals have no affect on stability. The two op amp parameters affecting stability are the transimpedance, Z, and the input buffer's output impedance, ZB. The external components affecting stability are ZG and ZF. The designer controls the external impedance, although stray capacitance that is a part of the external impedance sometimes seems to be uncontrollable. Stray capacitance is the primary cause of ringing and overshoot in CFAs. Z and ZB are CFA op amp parameters that can't be controlled by the circuit designer, so he has to live with them.

Prior to determining stability with a Bode plot, we take the log of Equation 8–18, and plot the logs (Equations 8–19 and 8–20) in Figure 8–6.

$$20\text{ LOG}\left|\text{A\#}\right| = 20\text{ LOG}\left|\text{Z}\right| - 20\text{ LOG}\left|\text{Z}\_{\text{F}}\left(\mathbb{1} + \frac{\mathbb{Z}\_{\text{B}}}{\mathbb{Z}\_{\text{F}}\left\|\text{Z}\_{\text{B}}\right\|}\right)\right| \quad \text{(8-19)}$$

$$\boldsymbol{\phi} = \mathsf{TANGEST}^{-1} \left( \mathsf{A} \boldsymbol{\upbeta} \right) \tag{\mathsf{6-20}}$$

This enables the designer to add and subtract components of the stability equation graphically.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one for amplitude (in decibels, dB) and one for phase (in degrees), both plotted against the logarithm of frequency (LOG(f)).

### Amplitude Plot:
- The vertical axis represents amplitude in decibels (dB Ω).
- The horizontal axis represents the logarithm of frequency (LOG(f)).
- There are three main curves in the amplitude plot:
  1. **20LOG|ZI|**: This curve starts at 120 dB and decreases linearly with a slope.
  2. **20LOG|ZF(1 + ZB/ZF||ZG)|**: This curve starts at 61.1 dB and also decreases linearly but at a different rate.
  3. **Composite Curve**: This is a dashed line that starts at 58.9 dB and follows a different path, intersecting the other curves at certain points.

### Phase Plot:
- The vertical axis represents phase in degrees.
- The horizontal axis is the same as the amplitude plot, representing the logarithm of frequency (LOG(f)).
- The phase plot shows a curve that starts at 0 degrees, decreases to -60 degrees, and continues to decrease, passing through -120 degrees and approaching -180 degrees.
- Key points on the phase plot include:
  - **1/τ1**: A specific frequency where the phase starts to drop more steeply.
  - **1/τ2**: Another specific frequency where the phase continues to drop.
  - **φM = 60°**: A marked phase margin of 60 degrees.

### Additional Details:
- The plot includes vertical dashed lines indicating the frequencies 1/τ1 and 1/τ2.
- The phase margin (φM) is highlighted as 60 degrees, indicating the difference between the phase at a certain frequency and -180 degrees.

Overall, the Bode plot provides a detailed view of how the amplitude and phase of a system's output vary with frequency, which is crucial for understanding the system's stability and performance.
```

Figure 8–6. Bode Plot of Stability Equation

Current-Feedback Op Amp Analysis 8-7

The plot in Figure 8–6 assumes typical values for the parameters:

$$\mathbf{Z} = \frac{\mathbf{1}\mathbf{M}\mathbf{\Omega}}{(\mathbf{1} + \mathbf{r}\_1\mathbf{S})(\mathbf{1} + \mathbf{r}\_2\mathbf{S})} \tag{\text{\textquotedbl{}b\textquotedbl{}}} \tag{\text{\textquotedbl{}b\textquotedbl{}}}$$

$$
\mathsf{Z}\_{\mathsf{B}} = 70 \mathsf{Q} \tag{\text{\textquotedbl{}}}
$$

$$
\mathbb{Z}\_{\mathbb{G}} = \mathbb{Z}\_{\mathbb{F}} = \mathbb{M}\mathbb{Q} \tag{6-23}
$$

The transimpedance has two poles and the plot shows that the op amp will be unstable without the addition of external components because 20 LOG|Z| crosses the 0-dB axis after the phase shift is 180°. ZF, ZB, and ZG reduce the loop gain 61.1 dB, so the circuit is stable because it has 60°-phase margin. ZF is the component that stabilizes the circuit. The parallel combination of ZF and ZG contribute little to the phase margin because ZB is very small, so ZB and ZG have little effect on stability.

The manufacturer determines the optimum value of RF during the characterization of the IC. Referring to Figure 8–6, it is seen that when RF exceeds the optimum value recommended by the IC manufacturer, stability increases. The increased stability has a price called decreased bandwidth. Conversely, when RF is less than the optimum value recommended by the IC manufacturer, stability decreases, and the circuit response to step inputs is overshoot or possibly ringing. Sometimes the overshoot associated with less than optimum RF is tolerated because the bandwidth increases as RF decreases. The peaked response associated with less than optimum values of RF can be used to compensate for cable droop caused by cable capacitance.

When ZB = 0 Ω and ZF = RF the loop gain equation is; Aβ = Z/RF. Under these conditions Z and RF determine stability, and a value of RF can always be found to stabilize the circuit. The transimpedance and feedback resistor have a major impact on stability, and the input buffer's output impedance has a minor effect on stability. Since ZB increases with an increase in frequency, it tends to increase stability at higher frequencies. Equation 8–18 is rewritten as Equation 8–24, but it has been manipulated so that the ideal closed-loop gain is readily apparent.

$$\mathsf{A}\emptyset = \frac{\mathsf{Z}}{\mathsf{Z}\_{\mathsf{F}} + \mathsf{Z}\_{\mathsf{B}} \left(\mathsf{1} + \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}}\right)}\tag{\mathsf{8-24}}$$

The closed-loop ideal gain equation (inverting and noninverting) shows up in the denominator of Equation 8–24, so the closed-loop gain influences the stability of the op amp. When ZB approaches zero, the closed-loop gain term also approaches zero, and the op amp becomes independent of the ideal closed-loop gain. Under these conditions RF determines stability, and the bandwidth is independent of the closed-loop gain. Many people claim that the CFA bandwidth is independent of the gain, and that claim's validity is dependent on the ratios ZB/ZF being very low.

ZB is important enough to warrant further investigation, so the equation for ZB is given below.

$$\mathbf{Z\_{B}} \equiv \mathfrak{h}\_{\mathrm{lb}} + \frac{\mathsf{R\_{B}}}{\mathfrak{\beta\_{0}} + \mathsf{I}} \left[ \frac{\mathfrak{I} + \frac{\mathsf{S}\beta\_{0}}{\mathfrak{O}\_{\mathsf{T}}}}{\mathfrak{I} + \frac{\mathsf{S}\beta\_{0}}{(\mathfrak{P}\_{0} + \mathsf{I})\mathsf{o}\_{\mathsf{T}}}} \right] \tag{8-25}$$

At low frequencies hib = 50 Ω and RB/(β0+1) = 25 Ω, so ZB = 75 Ω. ZB varies in accordance with Equation 8–25 at high frequencies. Also, the transistor parameters in Equation 8–25 vary with transistor type; they are different for NPN and PNP transistors. Because ZB is dependent on the output transistors being used, and this is a function of the quadrant the output signal is in, ZB has an extremely wide variation. ZB is a small factor in the equation, but it adds a lot of variability to the current-feedback op amp.

# **8.7 Selection of the Feedback Resistor**

The feedback resistor determines stability, and it affects closed-loop bandwidth, so it must be selected very carefully. Most CFA IC manufacturers employ applications and product engineers who spend a great deal of time and effort selecting RF. They measure each noninverting gain with several different feedback resistors to gather data. Then they pick a compromise value of RF that yields stable operation with acceptable peaking, and that value of RF is recommended on the data sheet for that specific gain. This procedure is repeated for several different gains in anticipation of the various gains their customer applications require (often G = 1, 2, or 5). When the value of RF or the gain is changed from the values recommended on the data sheet, bandwidth and/or stability is affected.

When the circuit designer must select a different RF value from that recommended on the data sheet he gets into stability or low bandwidth problems. Lowering RF decreases stability, and increasing RF decreases bandwidth. What happens when the designer needs to operate at a gain not specified on the data sheet? The designer must select a new value of RF for the new gain, but there is no guarantee that new value of RF is an optimum value. One solution to the RF selection problem is to assume that the loop gain, Aβ, is a linear function. Then the assumption can be made that (Aβ)1 for a gain of one equals (Aβ)N for a gain of N, and that this is a linear relationship between stability and gain. Equations 8–26 and 8–27 are based on the linearity assumption.

$$\frac{\mathbb{Z}}{\mathbb{Z}\_{\mathbb{F}\mathbb{1}} + \mathbb{Z}\_{\mathbb{B}} \left(\mathbb{1} + \frac{\mathbb{Z}\_{\mathbb{F}\mathbb{1}}}{\mathbb{Z}\_{\mathbb{G}\mathbb{1}}}\right)} = \frac{\mathbb{Z}}{\mathbb{Z}\_{\mathbb{FN}} + \mathbb{Z}\_{\mathbb{B}} \left(\mathbb{1} + \frac{\mathbb{Z}\_{\mathbb{FN}}}{\mathbb{Z}\_{\mathbb{GN}}}\right)}\tag{8-26}$$

$$\mathbb{Z}\_{\mathsf{FN}} = \mathbb{Z}\_{\mathsf{F1}} + \mathbb{Z}\_{\mathsf{B}} \left( \left( \mathbb{1} + \frac{\mathbb{Z}\_{\mathsf{F1}}}{\mathbb{Z}\_{\mathsf{G1}}} \right) - \left( \mathbb{1} + \frac{\mathbb{Z}\_{\mathsf{FN}}}{\mathbb{Z}\_{\mathsf{GN}}} \right) \right) \tag{8-27}$$

Equation 8–27 leads one to believe that a new value for ZF can easily be chosen for each new gain. This is not the case in the real world; the assumptions don't hold up well enough to rely on them. When you change to a new gain not specified on the data sheet, Equation 8–27, at best, supplies a starting point for RF, but you must test to determine the final value of RF.

When the RF value recommended on the data sheet can't be used, an alternate method of selecting a starting value for RF is to use graphical techniques. The graph shown in Figure 8–7 is a plot of the typical 300-MHz CFA data given in Table 8–1.

Here is the image describtion:
```
The image is a graph that illustrates the relationship between gain, bandwidth, and feedback resistor values. The x-axis represents the feedback resistor in ohms (Ω), ranging from 0 to 1kΩ. The left y-axis represents the gain, ranging from 1 to 10. The right y-axis represents the bandwidth in megahertz (MHz), ranging from 40 to 130 MHz.

Two curves are plotted on the graph:

1. **Gain vs. Feedback Resistance**: This curve starts at a high gain value of 10 when the feedback resistor is 0Ω and decreases as the feedback resistor value increases. The gain drops to around 2 when the feedback resistor is at 1kΩ. The curve is steep at the beginning and gradually flattens out as the feedback resistor value increases.

2. **Bandwidth vs. Feedback Resistance**: This curve starts at a low bandwidth value of 40 MHz when the feedback resistor is 0Ω and increases as the feedback resistor value increases. The bandwidth reaches around 130 MHz when the feedback resistor is at 1kΩ. The curve is steep at the beginning and gradually flattens out as the feedback resistor value increases.

There are also two dashed horizontal lines:
- One at a gain value of 6, indicating a specific gain level.
- One at a bandwidth value of 80 MHz, indicating a specific bandwidth level.

Additionally, there is a vertical dashed line at a feedback resistor value of approximately 500Ω, which intersects both the gain and bandwidth curves. This intersection suggests a feedback resistor value where the gain is around 6 and the bandwidth is around 80 MHz.
```

Figure 8–7. Plot of CFA RF, G, and BW

8-10

| Table 8–1. | Data Set for Curves in Figure 8–7 |  |  |
|------------|-----------------------------------|--|--|
|            |                                   |  |  |

| GAIN (ACL) | RF<br>(Ω) | BANDWIDTH (MHz) |
|------------|-----------|-----------------|
| + 1        | 1000      | 125             |
| + 2        | 681       | 95              |
| + 10       | 383       | 65              |

Enter the graph at the new gain, say ACL = 6, and move horizontally until you reach the intersection of the gain versus feedback resistance curve. Then drop vertically to the resistance axis and read the new value of RF (500 Ω in this example). Enter the graph at the new value of RF, and travel vertically until you intersect the bandwidth versus feedback resistance curve. Now move to the bandwidth axis to read the new bandwidth (75 MHz in this example). As a starting point you should expect to get approximately 75 MHz BW with a gain of 6 and RF = 500 Ω. Although this technique yields more reliable solutions than Equation 8–27 does, op amp peculiarities, circuit board stray capacitances, and wiring make extensive testing mandatory. The circuit must be tested for performance and stability at each new operating point.

# **8.8 Stability and Input Capacitance**

When designer lets the circuit board introduce stray capacitance on the inverting input node to ground, it causes the impedance ZG to become reactive. The new impedance, ZG, is given in Equation 8–28, and Equation 8–29 is the stability equation that describes the situation.

$$\mathbf{Z\_{G}} = \frac{\mathbf{R\_{G}}}{1 + \mathbf{R\_{G}}\mathbf{C\_{G}}\mathbf{s}} \tag{8-28}$$

$$\mathsf{A}\emptyset = \frac{\mathsf{Z}}{\mathsf{Z}\_{\mathsf{B}} + \frac{\mathsf{Z}\_{\mathsf{F}}}{\mathsf{Z}\_{\mathsf{G}}^{2} + \mathsf{Z}\_{\mathsf{B}}\mathsf{Z}\_{\mathsf{G}}}} \tag{8-29}$$

$$\mathsf{A}\emptyset = \frac{\mathsf{Z}}{\mathsf{R}\_{\mathsf{F}} \left(\mathfrak{I} + \frac{\mathsf{R}\_{\mathsf{B}}}{\mathsf{R}\_{\mathsf{F}} \|\mathsf{R}\_{\mathsf{G}}}\right) \mathfrak{I} + \mathsf{R}\_{\mathsf{B}} \|\mathsf{R}\_{\mathsf{F}}\| \,\mathsf{R}\_{\mathsf{G}} \mathsf{C}\_{\mathsf{G}} \mathbf{s}\right)}\tag{\mathsf{6-30}}$$

Equation 8–29 is the stability equation when ZG consists of a resistor in parallel with stray capacitance between the inverting input node and ground. The stray capacitance, CG, is a fixed value because it is dependent on the circuit layout. The pole created by the stray capacitance is dependent on RB because it dominates RF and RG. RB fluctuates with manufacturing tolerances, so the RBCG pole placement is subject to IC manufacturing tolerances. As the RBCG combination becomes larger, the pole moves towards the zero fre-

Current-Feedback Op Amp Analysis 8-11

quency axis, lowering the circuit stability. Eventually it interacts with the pole contained in Z, 1/τ2, and instability results.

The effects of stray capacitance on CFA closed-loop performance are shown in Figure 8–8.

Here is the image describtion:
```
The image is a graph that plots amplitude versus frequency. The x-axis represents frequency in megahertz (MHz) on a logarithmic scale, ranging from 1 MHz to 100 MHz. The y-axis represents amplitude in decibels per division (3 dB/div).

The graph shows three different curves, each representing different conditions of stray capacitance:
1. The first curve is labeled "No Stray Capacitance" and shows a relatively flat response across the frequency range, with a slight dip and then a gradual roll-off at higher frequencies.
2. The second curve is labeled "C_F = 2 pF" and shows a similar flat response at lower frequencies, but with a more pronounced peak around 100 MHz before rolling off sharply.
3. The third curve is labeled "C_IN = 2 pF" and also shows a flat response at lower frequencies, with a peak around 100 MHz, but the peak is slightly higher than the "C_F = 2 pF" curve before rolling off.

The graph indicates how the presence of stray capacitance (either at the feedback capacitor C_F or the input capacitor C_IN) affects the amplitude response of the system, particularly at higher frequencies. The presence of stray capacitance causes a peak in the amplitude response near 100 MHz, which is more pronounced with the input capacitance (C_IN) than with the feedback capacitance (C_F).
```

Figure 8–8. Effects of Stray Capacitance on CFAs

Notice that the introduction of CG causes more than 3 dB peaking in the CFA frequency response plot, and it increases the bandwidth about 18 MHz. Two picofarads are not a lot of capacitance because a sloppy layout can easily add 4 or more picofarads to the circuit.

# **8.9 Stability and Feedback Capacitance**

When a stray capacitor is formed across the feedback resistor, the feedback impedance is given by Equation 8–31. Equation 8–32 gives the loop gain when a feedback capacitor has been added to the circuit.

$$\mathbf{Z\_{F}} = \frac{\mathbf{R\_{F}}}{\mathbf{1} + \mathbf{R\_{F}}\mathbf{C\_{F}}\mathbf{s}} \tag{8-34}$$

$$\mathsf{A}\otimes = \frac{\mathsf{Z}(\mathsf{1} + \mathsf{R}\_{\mathsf{F}}\mathsf{C}\_{\mathsf{F}}\mathsf{s})}{\mathsf{R}\_{\mathsf{F}}(\mathsf{1} + \frac{\mathsf{R}\_{\mathsf{B}}}{\mathsf{R}\_{\mathsf{F}}\|\mathsf{R}\_{\mathsf{G}}})(\mathsf{1} + \mathsf{R}\_{\mathsf{B}}\,\|\,\mathsf{R}\_{\mathsf{F}}\|\,\mathsf{R}\_{\mathsf{G}}\mathsf{C}\_{\mathsf{F}}\mathsf{s})}\,\tag{\mathsf{B}-\mathsf{32}})$$

This loop gain transfer function contains a pole and zero, thus, depending on the pole/zero placement, oscillation can result. The Bode plot for this case is shown in Figure 8–9. The original and composite curves cross the 0-dB axis with a slope of –40 dB/decade, so either curve can indicate instability. The composite curve crosses the 0-dB axis at a higher frequency than the original curve, hence the stray capacitance has added more phase shift to the system. The composite curve is surely less stable than the original curve. Adding capacitance to the inverting input node or across the feedback resistor usually results in instability. RB largely influences the location of the pole introduced by CF, thus here is another case where stray capacitance leads to instability.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the amplitude (in decibels, dB) versus the logarithm of frequency (LOG(f)). The plot includes several key features and annotations:

1. **Axes**:
   - The vertical axis represents the amplitude in decibels (dB Ω).
   - The horizontal axis represents the logarithm of frequency (LOG(f)).

2. **Curves**:
   - **20LOGIZI – 20LOGIZF(1 + ZB/ZF||ZG)I**: This is a specific curve labeled at the top left of the plot. It starts at a high amplitude and remains constant until it reaches a certain frequency.
   - **POLE/ZERO Curve**: This curve is labeled in the middle of the plot. It starts at a certain amplitude, decreases at a certain slope, and then levels off.
   - **Composite Curve**: This is a dashed line that combines the effects of the other curves. It starts at a high amplitude, decreases at a certain slope, and then continues to decrease at a different slope after intersecting with the POLE/ZERO curve.

3. **Key Frequencies**:
   - **fZ**: This is a specific frequency marked on the plot with a vertical dashed line. It represents the frequency at which the first significant change in the amplitude occurs.
   - **fP**: This is another specific frequency marked with a vertical dashed line. It represents the frequency at which another significant change in the amplitude occurs.

4. **Annotations**:
   - The plot includes arrows pointing to different parts of the curves, indicating the names of the curves and the significant points (fZ and fP).

Overall, the image illustrates how the amplitude of a system's response changes with frequency, highlighting the effects of poles and zeros in the system's transfer function.
```

Figure 8–9. Bode Plot with CF

Figure 8–8 shows that CF = 2 pF adds about 4 dB of peaking to the frequency response plot. The bandwidth increases about 10 MHz because of the peaking. CF and CG are the major causes of overshoot, ringing, and oscillation in CFAs, and the circuit board layout must be carefully done to eliminate these stray capacitances.

# **8.10 Compensation of CF and CG**

When CF and CG both are present in the circuit they may be adjusted to cancel each other out. The stability equation for a circuit with CF and CG is Equation 8–33.

$$\mathsf{Av} = \frac{\mathsf{Z}(\mathsf{1} + \mathsf{R}\_{\mathsf{F}} \mathsf{C}\_{\mathsf{F}} \mathsf{s})}{\mathsf{R}\_{\mathsf{F}} \left(\mathsf{1} + \frac{\mathsf{R}\_{\mathsf{B}}}{\mathsf{R}\_{\mathsf{F}} \| \mathsf{R}\_{\mathsf{G}}}\right) \left(\mathsf{R}\_{\mathsf{B}} \parallel \mathsf{R}\_{\mathsf{F}} \parallel \mathsf{R}\_{\mathsf{G}} \left(\mathsf{C}\_{\mathsf{F}} + \mathsf{C}\_{\mathsf{G}}\right) \mathsf{s} + \mathsf{T}\right)} \qquad\qquad\text{(\mathsf{B}-33)}$$

If the zero and pole in Equation 8–33 are made to cancel each other, the only poles remaining are in Z. Setting the pole and zero in Equation 8–33 equal yields Equation 8–34 after some algebraic manipulation.

$$\mathsf{R}\_{\mathsf{F}}\mathsf{C}\_{\mathsf{F}} = \mathsf{C}\_{\mathsf{G}}(\mathsf{R}\_{\mathsf{G}} \parallel \mathsf{R}\_{\mathsf{B}}) \tag{8-34}$$

RB dominates the parallel combination of RB and RG, so Equation 8–34 is reduced to Equation 8–35.

$$\mathsf{R}\_{\mathsf{F}}\mathsf{C}\_{\mathsf{F}} = \mathsf{R}\_{\mathsf{B}}\mathsf{C}\_{\mathsf{G}} \tag{8-35}$$

RB is an IC parameter, so it is dependent on the IC process. RB it is an important IC parameter, but it is not important enough to be monitored as a control variable during the manufacturing process. RB has widely spread, unspecified parameters, thus depending on RB for compensation is risky. Rather, the prudent design engineer assures that the circuit will be stable for any reasonable value of RB, and that the resulting frequency response peaking is acceptable.

# **8.11 Summary**

Constant gain-bandwidth is not a limiting criterion for the CFA, so the feedback resistor is adjusted for maximum performance. Stability is dependent on the feedback resistor; as RF is decreased, stability is decreased, and when RF goes to zero the circuit becomes unstable. As RF is increased stability increases, but the bandwidth decreases.

The inverting input impedance is very high, but the noninverting input impedance is very low. This situation precludes CFAs from operation in the differential amplifier configuration. Stray capacitance on the inverting input node or across the feedback resistor always leads to peaking, usually to ringing, and sometimes to oscillations. A prudent circuit designer scans the PC board layout for stray capacitances, and he eliminates them. Breadboarding and lab testing are a must with CFAs. The CFA performance can be improved immeasurably with a good layout, good decoupling capacitors, and low inductance components.

# **Chapter 9**

# **Voltage- and Current-Feedback Op Amp Comparison**

Ron Mancini and James Karki

# **9.1 Introduction**

The name, operational amplifier, was given to voltage-feedback amplifiers (VFA) when they were the only op amps in existence. These new (they were new in the late '40s) amplifiers could be programmed with external components to perform various math operations on a signal; thus, they were nicknamed op amps. Current-feedback amplifiers (CFA) have been around approximately twenty years, but their popularity has only increased in the last several years. Two factors limiting the popularity of CFAs is their application difficulty and lack of precision.

The VFA is familiar component, and there are several variations of internally compensated VFAs that can be used with little applications work. Because of its long history, the VFA comes in many varieties and packages, so there are VFAs applicable to almost any job. VFA bandwidth is limited, so it can't function as well at high signal frequencies as the CFA can. For now, the signal frequency and precision separates the applications of the two op amp configurations.

The VFA has some other redeeming virtues, such as excellent precision, that makes it the desirable amplifier in low frequency applications. Many functions other than signal amplification are accomplished at low frequencies, and functions like level-shifting a signal require precision. Fortunately, precision is not required in most high frequency applications where amplification or filtering of a signal is predominant, so CFAs are suitable to high frequency applications. The lack of precision coupled with the application difficulties prevents the CFA from replacing the VFA.

# **9.2 Precision**

The long-tailed pair input structure gives the VFA its precision; the long-tailed pair is shown in Figure 9–1

Here is the image describtion:
```
The image depicts a differential amplifier circuit using bipolar junction transistors (BJTs). Here is a detailed description of the circuit:

1. **Transistors**: The circuit consists of two NPN transistors. The left transistor has its base connected to an input voltage \( V_1 \), and the right transistor has its base connected to another input voltage \( V_2 \).

2. **Collector Resistors**: Each transistor has a collector resistor \( R_C \) connected between its collector and the positive supply voltage \( V_{CC} \). The left transistor's collector is labeled \( V_{O1} \), and the right transistor's collector is labeled \( V_{O2} \).

3. **Current Source**: The emitters of both transistors are connected together and then to a current source \( I \) that is connected to a negative supply voltage \( -V_{EE} \). This current source ensures a constant current through the emitters of the transistors.

4. **Power Supplies**: The circuit uses two power supplies: a positive supply voltage \( V_{CC} \) and a negative supply voltage \( -V_{EE} \).

5. **Input and Output Voltages**: The input voltages are \( V_1 \) and \( V_2 \), applied to the bases of the left and right transistors, respectively. The output voltages are taken from the collectors of the transistors, labeled \( V_{O1} \) and \( V_{O2} \).

6. **Operation**: This differential amplifier amplifies the difference between the input voltages \( V_1 \) and \( V_2 \). The current source \( I \) ensures that the total current through both transistors remains constant, which helps in achieving high common-mode rejection ratio (CMRR).

In summary, the image shows a differential amplifier circuit with two NPN transistors, collector resistors, a current source, and power supplies, designed to amplify the difference between two input signals.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 9-1. Long-Tailed Pair." This suggests that it is a label for a figure or illustration in a document, likely a technical or academic text. The figure is presumably the first one in Chapter 9 and is titled "Long-Tailed Pair," which might refer to a specific concept, diagram, or example related to the content of the chapter. The text is in a standard font, typically used for figure captions in documents.
```

The transistors, Q1 and Q2, are very carefully matched for initial and drift tolerances. Careful attention is paid to detail in the transistor design to insure that parameters like current gain, β, and base-emitter voltage, VBE, are matched between the input transistors, Q1 and Q2. When VB1 = VB2, the current, I, splits equally between the transistors, and VO1 = VO2. As long as the transistor parameters are matched, the collector currents stay equal. The slightest change of VB1 with respect to VB2 causes a mismatch in the collector currents and a differential output voltage |VB1–VB2|.

When temperature or other outside influences change transistor parameters like current gain or base-emitter voltage, as long as the change is equal, it causes no change in the differential output voltage. IC designers go to great lengths to ensure that transistor parameter changes due to external influences do not cause a differential output voltage change. Now, the slightest change in either base voltage causes a differential output voltage change, and gross changes in external conditions do not cause a differential output voltage change. This is the formula for a precision amplifier because it can amplify small input changes while ignoring changes in the parameters or ambient conditions.

This is a simplified explanation, and there are many different techniques used to ensure transistor matching. Some of the techniques used to match input transistors are parameter trimming, special layout techniques, thermal balancing, and symmetrical layouts. The long-tailed pair is an excellent circuit configuration for obtaining precision in the input circuit, but the output circuit has one fault. The output circuit collector impedance has to be high to achieve high gain in the first stage. High impedance coupled with the Miller capacitance discussed in Chapter 7 forms a quasidominant pole compensation circuit that has poor high frequency response.

The noninverting input of the CFA (see Figure 9–2) connects to a buffer input inside the op amp. The inverting input of the CFA connects to a buffer output inside the CFA. Buffer inputs and outputs have dramatically different impedance levels, so any matching becomes a moot point. The buffer can't reject common-mode voltages introduced by parameter drifts because it has no common-mode rejection capability. The input current causes a voltage drop across the input buffer's output impedance, RB, and there is no way that this voltage drop can be distinguished from an input signal.

Here is the image describtion:
```
The image depicts the internal structure of an operational amplifier (op-amp) with a focus on its input and output stages. Here is a detailed description:

1. **Inputs:**
   - There are two input terminals labeled as "NONINVERTING INPUT" and "INVERTING INPUT."
   - The noninverting input is marked with a plus sign (+), indicating that a positive voltage applied here will result in a positive output voltage.
   - The inverting input is marked with a minus sign (-), indicating that a positive voltage applied here will result in a negative output voltage.

2. **Internal Components:**
   - Inside the op-amp, there is a differential amplifier stage represented by a triangle with a gain of G = 1.
   - The noninverting input is connected to the positive terminal of this differential amplifier.
   - The inverting input is connected to the negative terminal of this differential amplifier.
   - A resistor labeled \( R_B \) is connected to the output of the differential amplifier, with a current \( I \) flowing through it.
   - This current \( I \) is then directed towards a ground symbol, indicating a connection to the common reference point in the circuit.

3. **Output Stage:**
   - The current \( I \) is also shown flowing through another resistor labeled \( Z \), which is connected to the ground.
   - The voltage across this resistor \( Z \) is then fed into a buffer amplifier, represented by another triangle.
   - The output of this buffer amplifier is connected to the "OUTPUT" terminal of the op-amp.

4. **Connections:**
   - The noninverting input is directly connected to the positive terminal of the differential amplifier.
   - The inverting input is directly connected to the negative terminal of the differential amplifier.
   - The output of the differential amplifier is connected to the resistor \( R_B \) and then to the ground.
   - The voltage across the resistor \( Z \) is fed into the buffer amplifier, which then provides the final output.

Overall, the image illustrates the basic internal configuration of an operational amplifier, highlighting the differential input stage, the current flow through internal resistors, and the final output stage.
```

Figure 9–2. Ideal CFA

The CFA circuit configuration was selected for high frequency amplification because it has current-controlled gain and a current-dominant input. Being a current device, the CFA does not have the Miller-effect problem that the VFA has. The input structure of the CFA sacrifices precision for bandwidth, but CFAs achieve usable bandwidths ten times the usable VFA bandwidth.

# **9.3 Bandwidth**

The bandwidth of a circuit is defined by high frequency errors. When the gain falls off at high frequencies unequal frequency amplification causes the signal to become distorted. The signal loses its high frequency components; an example of high frequency signal degradation is a square wave with sharp corners that is amplified and turned into slump cornered semi sine wave. The error equation for any feedback circuit is repeated in Equation 9–1.

$$\Xi = \frac{\mathsf{V}\_{\mathsf{N}}}{\mathsf{1} + \mathsf{A}\mathsf{S}} \tag{9-\mathsf{I}}$$

This equation is valid for any feedback circuit, so it applies equally to a VFA or a CFA. The loop gain equation for any VFA is repeated as Equation 9–2.

$$\mathsf{A}\emptyset = \frac{\mathsf{a}\mathsf{R}\_{\mathbb{G}}}{\mathsf{R}\_{\mathbb{F}} + \mathsf{R}\_{\mathbb{G}}} \tag{9-2}$$

Equation 9–2 is rewritten below as Equations 9–3 and 9–4 for the noninverting and inverting circuits respectively. In each case, the symbol GCLNI and GCLI represent the closed loop gain for the noninverting and inverting circuits respectively.

$$\mathsf{A}\emptyset = \frac{\mathbf{a}}{\frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}}} = \frac{\mathbf{a}}{\mathsf{G}\_{\mathsf{CLM}}} \tag{9-3}$$

$$\mathbf{A}\boldsymbol{\beta} = \frac{\mathbf{a}}{\frac{\mathbf{R}\_{\text{F}} + \mathbf{R}\_{\text{G}}}{\mathbf{R}\_{\text{G}}}} = \frac{\mathbf{a}}{\mathbf{G}\_{\text{CLI}} + \mathbf{1}}\tag{9-4}$$

In both cases the loop gain decreases as the closed loop gain increases, thus all VFA errors increase as the closed loop gain increases. The error increase is mathematically coupled to the closed loop gain equation, so there is no working around this fact. For the VFA, effective bandwidth decreases as the closed loop gain increases because the loop gain decreases as the closed loop gain increases.

A plot of the VFA loop gain, closed loop gain, and error is given in Figure 9–3. Referring to Figure 9–3, the direct gain, A, is the op amp open loop gain, a, for a noninverting op amp. The direct gain for an inverting op amp is (a(ZF/(ZG + ZF))). The Miller effect causes the direct gain to fall off at high frequencies, thus error increases as frequency increases because the effective loop gain decreases. At a given frequency, the error also increases when the closed loop gain is increased.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the gain in decibels (dB) on the vertical axis and the logarithm of frequency (LOG f) on the horizontal axis. The plot consists of two main lines: the direct gain and the closed-loop gain.

1. **Direct Gain Line**:
   - The direct gain line starts at a high value on the left side of the plot, labeled as "20 LOG A".
   - This line slopes downward as the frequency increases, indicating that the gain decreases with increasing frequency.
   - The slope of this line is typically -20 dB/decade, which is characteristic of a single-pole system.

2. **Closed Loop Gain Line**:
   - The closed-loop gain line is a horizontal line, indicating that the gain remains constant across different frequencies.
   - This line is labeled as "20 LOG(G_CL)", where G_CL represents the closed-loop gain.
   - The closed-loop gain is lower than the initial direct gain, and the difference between the two is labeled as "20 LOG (1 + Aβ)", where A is the open-loop gain and β is the feedback factor.

3. **Annotations**:
   - The plot includes annotations to highlight the difference between the direct gain and the closed-loop gain.
   - The vertical distance between the direct gain line and the closed-loop gain line is marked as "20 LOG (1 + Aβ)".
   - The horizontal axis is labeled as "LOG f", indicating that the frequency is plotted on a logarithmic scale.

Overall, the image illustrates how feedback in a control system affects the gain across different frequencies, showing that the closed-loop gain remains constant while the direct gain decreases with increasing frequency.
```

Figure 9–3. VFA Gain versus Frequency

The CFA is a current operated device; hence, it not nearly as subject to the Miller effect resulting from stray capacitance as the VFA is. The absence of the Miller effect enables the CFA's frequency response to hold up far better than the VFA's does. A plot of the CFA loop gain, transimpedance, and error is given in Figure 9–4. Notice that the transimpedance stays at the large low frequency intercept value until much higher frequencies than the VFA does.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the gain in decibels (dB) on the vertical axis and the frequency on a logarithmic scale on the horizontal axis. The plot is divided into three main regions:

1. **Low-Frequency Region**: At low frequencies, the gain is constant and is represented by the term "20 LOG Z". This region is labeled as "TRANSIMPEDANCE".

2. **Mid-Frequency Region**: In this region, the gain drops by a factor of "20 LOG (1 + Aβ)". This drop is shown as a vertical distance between the high-frequency gain and the low-frequency gain. The gain in this region is labeled as "CLOSED LOOP GAIN" and is represented by the term "20 LOG(G_CL)".

3. **High-Frequency Region**: At high frequencies, the gain decreases at a certain rate, which is typically determined by the system's bandwidth and stability characteristics.

The plot illustrates how the gain of a system changes with frequency, highlighting the difference between the open-loop gain (transimpedance) and the closed-loop gain. The closed-loop gain is lower than the open-loop gain by a factor of "20 LOG (1 + Aβ)", where A is the open-loop gain and β is the feedback factor.
```

Figure 9–4. CFA Gain vs Frequency

The loop gain equation for the CFA is repeated here as Equation 9–5.

$$\mathsf{A}\emptyset = \frac{\mathsf{Z}}{\mathsf{R}\_{\mathsf{F}} \left( \mathsf{1} + \frac{\mathsf{R}\_{\mathsf{B}}}{\mathsf{R}\_{\mathsf{F}} \| \mathsf{R}\_{\mathsf{G}}} \right)} \tag{9-5}$$

When the input buffer output resistance approaches zero, Equation 9–5 reduces to Equation 9–6.

$$\mathsf{A}\clubsuit\,=\frac{\mathsf{Z}}{\mathsf{R}\_{\mathsf{F}}}\tag{9-6}$$

Equation 9–6 shows that the closed-loop gain has no effect on the loop gain when RB = 0, so under ideal conditions one would expect the transimpedance to fall off with a zero slope. Figure 9–4 shows that there is a finite slope, but much less than that of a VFA, and the slope is caused by RB not being equal to zero. For example, RB is usually 50 Ω when RF = 1000 Ω at ACL = 1. If we let RF = RG, then RF||RG = 500 Ω, and RB/RF||RG = 50/500 = 0.1.

Substituting this value into Equation 9–6 yields Equation 9–7, and Equation 9–7 is almost identical to Equation 9–6. RB does cause some interaction between the loop gain and the transimpedance, but because the interaction is secondary the CFA gain falls off with a faster slope.

$$\mathsf{A}\clubsuit = \frac{\mathsf{Z}}{\mathsf{1}.\mathsf{1}.\mathsf{R}\_{\mathsf{F}}} \tag{9-7}$$

The direct gain of a VFA starts falling off early, often at 10 Hz or 100 Hz, but the transimpedance of a CFA does not start falling off until much higher frequencies. The VFA is constrained by the gain-bandwidth limitation imposed by the closed loop gain being incorporated within the loop gain. The CFA, with the exception of the effects of RB, does not have this constraint. This adds up to the CFA being the superior high frequency amplifier.

# **9.4 Stability**

Stability in a feedback system is defined by the loop gain, and no other factor, including the inputs or type of inputs, affects stability. The loop gain for a VFA is given in Equation 9–2. Examining Equation 9–2 we see that the stability of a VFA is depends on two items; the op amp transfer function, a, and the gain setting components, ZF/ZG.

The op amp contains many poles, and if it is not internally compensated, it requires external compensation. The op amp always has at least one dominant pole, and the most phase margin that an op amp has is 45°. Phase margins beyond 60° are a waste of op amp bandwidth. When poles and zeros are contained in ZF and ZG, they can compensate for the op amp phase shift or add to its instability. In any case, the gain setting components always affect stability. When the closed-loop gain is high, the loop gain is low, and low loop gain circuits are more stable than high loop gain circuits.

Wiring the op amp to a printed circuit board always introduces components formed from stray capacitance and inductance. Stray inductance becomes dominant at very high frequencies, hence, in VFAs, it does not interfere with stability as much as it does with signal handling properties. Stray capacitance causes stability to increase or decrease depending on its location. Stray capacitance from the input or output lead to ground induces instability, while the same stray capacitance in parallel with the feedback resistor increases stability.

The loop gain for a CFA with no input buffer output impedance, RB, is given in Equation 9–6. Examining Equation 9–6 we see that the stability of a CFA depends on two items: the op amp transfer function, Z, and the gain setting component, ZF. The op amp contains many poles, thus they require external compensation. Fortunately, the external compensation for a CFA is done with ZF. The factory applications engineer does extensive testing to determine the optimum value of RF for a given gain. This value should be used in all applications at that gain, but increased stability and less peaking can be obtained by increasing RF. Essentially this is sacrificing bandwidth for lower frequency performance, but in applications not requiring the full bandwidth, it is a wise tradeoff.

The CFA stability is not constrained by the closed-loop gain, thus a stable operating point can be found for any gain, and the CFA is not limited by the gain-bandwidth constraint. If the optimum feedback resistor value is not given for a specific gain, one must test to find the optimum feedback resistor value.

Stray capacitance from any node to ground adversely affects the CFA performance. Stray capacitance of just a couple of pico Farads from any node to ground causes 3 dB or more of peaking in the frequency response. Stray capacitance across the CFA feedback resistor, quite unlike that across the VFA feedback resistor, always causes some form of instability. CFAs are applied at very high frequencies, so the printed circuit board inductance associated with the trace length and pins adds another variable to the stability equation. Inductance cancels out capacitance at some frequency, but this usually seems to happen in an adverse manner. The wiring of VFAs is critical, but the wiring of CFAs is a science. Stay with the layout recommended by the manufacturer whenever possible.

# **9.5 Impedance**

The input impedance of a VFA and CFA differ dramatically because their circuit configurations are very different. The VFA input circuit is a long-tailed pair, and this configuration gives the advantages that both input impedances match. Also, the input signal looks into an emitter-follower circuit that has high input impedance. The emitter-follower input impedance is β(re + RE) where RE is a discrete emitter resistor. At low input currents, RE is very high and the input impedance is very high. If a higher input impedance is required, the op amp uses a Darlington circuit that has an input impedance of β2(re + RE).

So far, the implicit assumption is that the VFA is made with a bipolar semiconductor process. Applications requiring very high input impedances often use a FET process. Both BIFET and CMOS processes offer very high input impedance in any long-tailed pair configuration. It is easy to get matched and high input impedances at the amplifier inputs. Do not confuse the matched input impedance at the op amp leads with the overall circuit input impedance. The input impedance looking into the inverting input is RG, and the impedance looking into the noninverting input is the input impedance of the op amp. While these are two different impedances, they are mismatched because of the circuit not the op amp.

The CFA has a radically different input structure that causes it to have mismatched input impedances. The noninverting input lead of the CFA is the input of a buffer that has very high input impedance. The inverting input lead is the output of a buffer that has very low impedance. There is no possibility that these two input impedances can be matched.

Again, because of the circuit, the inverting circuit input impedance is RG. Once the circuit gain is fixed, the only way to increase RG is to increase RF. But, RF is determined by a tradeoff between stability and bandwidth. The circuit gain and bandwidth requirements fix RF, hence there is no room to further adjust RF to raise the resistance of RG. If the manufacturer's data sheet says that RF = 100 Ω when the closed-loop gain is two, then RG = 100 Ω or 50 Ω depending on the circuit configuration. This sets the circuit input impedance at 100 Ω. This analysis is not entirely accurate because RB adds to the input impedance, but this addition is very small and dependent on IC parameters. CFA op amp circuits are usually limited to noninverting voltage applications, but they serve very well in inverting applications that are current-driven.

The CFA is limited to the bipolar process because that process offers the highest speed. The option of changing process to BIFET or CMOS to gain increased input impedance is not attractive today. Although this seems like a limiting factor, it is not because CFAs are often used in low impedance where the inputs are terminated in 50 Ω or 75 Ω. Also, most very high-speed applications require low impedances.

# **9.6 Equation Comparison**

The pertinent VFA and CFA equations are repeated in Table 9–1. Notice that the ideal closed-loop gain equations for the inverting and noninverting circuits are identical. The ideal equations for the VFA depend on the op amp gain, a, being very large thus making Aβ large compared to one. The CFA needs two assumptions to be valid to obtain the ideal equations. First, the ideal equations for the CFA depend on the op amp transimpedance, Z, being very large thus making Aβ large compared to one. Second, RB must be very small compared to ZF||ZG.

The ideal gain equations are identical, but the applications are very different because the VFA is best applied to lower frequency precision jobs while the CFA applications are in the very high frequency realm. The transimpedance in a CFA acts much like the gain does in a VFA. In each case, transimpedance or gain, it is the parameter that enables the use of feedback.

| CIRCUIT<br>CONFIGURATION   | CURRENT<br>FEEDBACK AMPLIFIER                                                                                          | VOLTAGE<br>FEEDBACK AMPLIFIER       |  |  |
|----------------------------|------------------------------------------------------------------------------------------------------------------------|-------------------------------------|--|--|
|                            | NONINVERTING                                                                                                           |                                     |  |  |
| Forward or direct<br>gain  | Z1<br>ZFZG<br>1<br>ZG<br>ZF<br>ZBZF                                                                                    | a                                   |  |  |
| Actual closed loop<br>gain | 1<br><br>ZB<br>ZF<br>ZG<br>1<br><br>ZB<br>ZF<br><br>ZFZG<br>Z<br>1<br>ZB<br><br><br>1ZB<br>ZF<br>1<br><br>ZFZG<br><br> | a<br>aZG<br>1<br><br>ZFZG           |  |  |
| Closed loop gain           | 1  ZFZG                                                                                                                | 1  ZFZG                             |  |  |
|                            | INVERTING                                                                                                              |                                     |  |  |
| Forward or direct<br>gain  | Z<br>ZG1<br>ZG<br>ZBZF                                                                                                 | aZFZF<br>ZG                         |  |  |
| Ideal loop gain            | 1<br>ZG<br>ZZF<br>ZBZF                                                                                                 | aZGZG<br><br>ZF                     |  |  |
| Actual closed loop<br>gain | <br><br>ZB<br>1<br>ZG<br><br>ZFZG<br>Z<br>1<br>ZF1<br><br>ZB<br><br>ZFZG                                               | aZF<br>ZFZG<br>aZG<br>1<br><br>ZFZG |  |  |
| Closed loop gain           | ZFZG                                                                                                                   | ZFZG                                |  |  |

#### Table 9–1. Tabulation of Pertinent VFA and CFA Equations

Voltage- and Current-Feedback Op Amp Comparison 9-9

# **Chapter 10**

# **Op Amp Noise Theory and Applications**

#### Bruce Carter

# **10.1 Introduction**

The purpose of op amp circuitry is the manipulation of the input signal in some fashion. Unfortunately in the real world, the input signal has unwanted noise superimposed on it.

Noise is not something most designers get excited about. In fact, they probably wish the whole topic would go away. It can, however, be a fascinating study by itself. A good understanding of the underlying principles can, in some cases, be used to reduce noise in the design.

# **10.2 Characterization**

Noise is a purely random signal, the instantaneous value and/or phase of the waveform cannot be predicted at any time. Noise can either be generated internally in the op amp, from its associated passive components, or superimposed on the circuit by external sources. External noise is covered in Chapter 17, and is usually the dominant effect.

#### **10.2.1 rms versus P-P Noise**

Instantaneous noise voltage amplitudes are as likely to be positive as negative. When plotted, they form a random pattern centered on zero. Since noise sources have amplitudes that vary randomly with time, they can only be specified by a probability density function. The most common probability density function is Gaussian. In a Gaussian probability function, there is a mean value of amplitude, which is most likely to occur. The probability that a noise amplitude will be higher or lower than the mean falls off in a bellshaped curve, which is symmetrical around the center (Figure 10–1).

#### Characterization

Here is the image describtion:
```
The image is a graphical representation of a noise signal and its statistical properties. It consists of two main parts: a bell curve (Gaussian distribution) at the top and a series of horizontal lines representing the noise signal at the bottom.

1. **Bell Curve (Gaussian Distribution):**
   - The bell curve is centered around the "Mean Value," which is marked at the peak of the curve.
   - The horizontal axis is labeled with values ranging from -3 to +3, indicating standard deviations from the mean.
   - The curve shows the probability distribution of the noise signal, with most values clustering around the mean and fewer values appearing as you move further away from the mean.

2. **Noise Signal Representation:**
   - Below the bell curve, there is a series of horizontal lines of varying lengths, centered around a vertical line labeled "Mean Value."
   - These lines represent individual samples of the noise signal, with their lengths indicating the magnitude of the noise at each sample point.
   - The noise signal appears to be symmetrically distributed around the mean value, with some lines extending further out, indicating higher noise levels at those points.

3. **RMS Value:**
   - At the bottom of the image, there is a label "rms Value" with arrows pointing to the left and right from the mean value.
   - RMS stands for Root Mean Square, a statistical measure of the magnitude of a varying quantity. In this context, it represents the effective value of the noise signal.
   - The RMS value is a measure of the average power of the noise signal and is used to quantify its overall level.

4. **Noise Signal Label:**
   - There is an arrow pointing to the horizontal lines, labeled "Noise Signal," indicating that these lines represent the noise signal being analyzed.

Overall, the image illustrates the statistical properties of a noise signal, showing its distribution around a mean value and highlighting the RMS value as a measure of its magnitude.
```

**99.7% Probability Signal Will Be <= 6 X rms Value**

### Figure 10–1. Gaussian Distribution of Noise Energy

σ is the standard deviation of the Gaussian distribution and the rms value of the noise voltage and current. The instantaneous noise amplitude is within ±1σ 68% of the time. Theoretically, the instantaneous noise amplitude can have values approaching infinity. However, the probability falls off rapidly as amplitude increases. The instantaneous noise amplitude is within ±3σ of the mean 99.7% of the time. If more or less assurance is desired, it is between ±2σ 95.4% of the time and ±3.4σ 99.94% of the time.

σ2 is the average mean-square variation about the average value. This also means that the average mean-square variation about the average value, i2 or e2 , is the same as the variance σ2.

Thermal noise and shot noise (see below) have Gaussian probability density functions. The other forms of noise do not.

### **10.2.2 Noise Floor**

When all input sources are turned off and the output is properly terminated, there is a level of noise called the noise floor that determines the smallest signal for which the circuit is useful. The objective for the designer is to place the signals that the circuit processes above the noise floor, but below the level where the signals will clip.

#### **10.2.3 Signal-to-Noise Ratio**

The noisiness of a signal is defined as:

$$\frac{\mathbf{S}\_{\text{(l)}}}{\mathbf{N}\_{\text{(l)}}} = \frac{\text{rms signal voltage}}{\mathbf{rms noise voltage}}\tag{10-1}$$

In other words, it is a ratio of signal voltage to noise voltage (hence the name signal-tonoise ratio).

#### **10.2.4 Multiple Noise Sources**

When there are multiple noise sources in a circuit, the total root-mean-square (rms) noise signal that results is the square root of the sum of the average mean-square values of the individual sources:

$$\mathsf{E}\_{\text{Totalms}} = \sqrt{\mathsf{e}\_{\text{1ms}}^2 + \mathsf{e}\_{\text{2ms}}^2 + \dots \mathsf{e}\_{\text{mms}}^2} \tag{10-2}$$

Put another way, this is the only "break" that the designer gets when dealing with noise. If there are two noise sources of equal amplitude in the circuit, the total noise is not doubled (increased by 6 dB). It only increases by 3 dB. Consider a very simple case, two noise sources with amplitudes of 2 Vrms:

$$
\mathsf{E}\_{\text{Totalms}} = \sqrt{\mathbf{2}^2 + \mathbf{2}^2} = \sqrt{\mathbf{8}} = \text{2.83 V}\_{\text{rms}} \tag{10-3}
$$

Therefore, when there are two equal sources of noise in a circuit, the noise is <sup>20</sup> log 2.83 <sup>2</sup> 3.01 dB higher than if there were only one source of noise — instead of double (6 dB) as would be intuitively expected.

This relationship means that the worst noise source in the system will tend to dominate the total noise. Consider a system in which one noise source is 10 Vrms and another is 1 Vrms:

$$\mathsf{E}\_{\mathsf{Totalrms}} = \sqrt{\mathsf{10}^2 + \mathsf{1}^2} = \sqrt{\mathsf{10}\mathsf{1}} = \mathsf{10}.05\,\mathsf{V}\_{\mathsf{rms}}\tag{\mathsf{10-4}}$$

There is hardly any effect from the 1-V noise source at all!

Op Amp Noise Theory and Applications 10-3

#### **10.2.5 Noise Units**

Noise is normally specified as a spectral density in rms volts or amps per root Hertz, V Hz or A Hz . These are not very "user-friendly" units. A frequency range is needed to relate these units to actual noise levels that will be observed.

For example:

- A TLE2027 op amp with a noise specification of 2.5 nV Hz is used over an audio frequency range of 20 Hz to 20 kHz, with a gain of 40 dB. The output voltage is 0 dBV (1 V).
- To begin with, calculate the root Hz part: 20000 20 141.35.
- Multiplying this by the noise spec: 2.5 141.35 353.38 nV, which is the equivalent input noise (EIN). The output noise equals the input noise multiplied by the gain, which is 100 (40 dB).

The signal-to-noise ratio can be now be calculated:

- 353.38 nV 100 35.3 V
- Signal-to-noise (dB) =

$$20 \times \log(\text{//}\text{/}\text{/} + \text{ 35.3 }\text{μ}) = 20 \times \log(2\text{8329}) = \text{89 dBA} \tag{10-5}$$

The TLE2027 op amp is an excellent choice for this application. Remember, though, that passive components and external noise sources can degrade performance. There is also a slight increase in noise at low frequencies, due to the 1/f effect (see below).

# **10.3 Types of Noise**

There are five types of noise in op amps and associated circuitry:

- 1) Shot noise
- 2) Thermal noise
- 3) Flicker noise
- 4) Burst noise
- 5) Avalanche noise

Some or all of these noises may be present in a design, presenting a noise spectrum unique to the system. It is not possible in most cases to separate the effects, but knowing general causes may help the designer optimize the design, minimizing noise in a particular bandwidth of interest. Proper design for low noise may involve a "balancing act" between these sources of noise and external noise sources.

### **10.3.1 Shot Noise**

The name shot noise is short for Schottky noise. Sometimes it is referred to as quantum noise. It is caused by random fluctuations in the motion of charge carriers in a conductor. Put another way, current flow is not a continuous effect. Current flow is electrons, charged particles that move in accordance with an applied potential. When the electrons encounter a barrier, potential energy builds until they have enough energy to cross that barrier. When they have enough potential energy, it is abruptly transformed into kinetic energy as they cross the barrier. A good analogy is stress in an earthquake fault that is suddenly released as an earthquake.

As each electron randomly crosses a potential barrier, such as a pn junction in a semiconductor, energy is stored and released as the electron encounters and then shoots across the barrier. Each electron contributes a little pop as its stored energy is released when it crosses the barrier (Figure 10–2).

Here is the image describtion:
```
The image consists of two diagrams, each depicting an electron (e-) interacting with a potential barrier formed by a junction between n-type and p-type semiconductor materials.

**Top Diagram:**
- The electron (e-) is positioned above a potential barrier, which is represented as a hill-like structure with "n" on the left side and "p" on the right side.
- Arrows labeled "Potential" and "Force from junction" point towards the electron from opposite directions, indicating forces acting on the electron.
- The electron appears to be held in place by these opposing forces.

**Bottom Diagram:**
- The electron (e-) is now positioned at the base of the potential barrier, suggesting it has moved or "popped" from its previous position.
- The word "POP!!!" is written above the electron, indicating a sudden change or movement.
- The arrows labeled "Potential" and "Force from junction" still point towards the electron from opposite directions, but the context suggests that the force from the junction has changed direction, causing the electron to move.
- The potential barrier remains the same, with "n" on the left side and "p" on the right side.

Overall, the image illustrates the concept of an electron being influenced by forces at a semiconductor junction, leading to a sudden change in its position.
```

#### Figure 10–2. Shot Noise Generation

The aggregate effect of all of the electrons shooting across the barrier is the shot noise. Amplified shot noise has been described as sounding like lead shot hitting a concrete wall.

Some characteristics of shot noise:

- Shot noise is always associated with current flow. It stops when the current flow stops.
- Shot noise is independent of temperature.
- Shot noise is spectrally flat or has a uniform power density, meaning that when plotted versus frequency it has a constant value.
- Shot noise is present in any conductor — not just a semiconductor. Barriers in conductors can be as simple as imperfections or impurities in the metal. The level of shot noise, however, is very small due to the enormous numbers of electrons moving in the conductor, and the relative size of the potential barriers. Shot noise in semiconductors is much more pronounced.

The rms shot noise current is equal to:

$$\mathbf{l\_{gh}} = \sqrt{\langle \mathbf{2q|}\_{\mathbf{d}\mathbf{c}} + \mathbf{4q|}\_{\mathbf{0}} \rangle \mathbf{B}} \tag{10-6}$$

Where:

q = Electron charge (1.6 x 10–19 coulombs) Idc = Average forward dc current in A Io = Reverse saturation current in A B = Bandwidth in Hz

If the pn junction is forward biased, Io is zero, and the second term disappears. Using Ohm's law and the dynamic resistance of a junction,

$$\mathbf{r\_d} = \frac{\mathbf{kT}}{\mathbf{q}|\_{\text{dc}}} \tag{10-7}$$

the rms shot noise voltage is equal to:

$$\mathbf{E}\_{\rm sh} = \mathbf{kT} \sqrt{\frac{\mathbf{2B}}{\mathbf{q}!\_{\rm dc}}} \tag{10-8}$$

Where:

k = Boltzmann's constant (1.38 x 10–23 Joules/-K) q = Electron charge (1.6 x 10–19 coulombs) T = Temperature in -K Idc = Average dc current in A B = Bandwidth in Hz

For example, a junction carries a current of 1 mA at room temperature. Its noise over the audio bandwidth is:

$$\mathsf{E}\_{\mathsf{th}} = \mathsf{1.38} \times \mathsf{10}^{-23} \times \mathsf{298} \sqrt{\frac{2(20000 - 20)}{(\mathsf{1.6} \times \mathsf{10}^{-19}) \times (\mathsf{1} \times \mathsf{10}^{-3})}} = \mathsf{65} \,\mathsf{nV} = -\mathsf{144} \,\mathsf{dBV} \tag{\mathsf{10-9}}$$

Obviously, it is not much of a problem in this example.

Look closely at the formula for shot noise voltage. Notice that the shot noise voltage is inversely proportional to the current. Stated another way, shot noise voltage decreases as average dc current increases, and increases as average dc current decreases. This can be an elegant way of determining if shot noise is a dominant effect in the op amp circuit being designed. If possible, decrease the average dc current by a factor of 100 and see if the overall noise increases by a factor of 10. In the example above:

$$\mathsf{E}\_{\mathsf{s}h} = \mathsf{1.38} \times \mathsf{10}^{-23} \times \mathsf{298} \sqrt{\frac{\mathsf{2(20000 - 20)}}{\langle \mathsf{1.6} \times \mathsf{10}^{-19} \rangle \times \langle \mathsf{1} \times \mathsf{10}^{-5} \rangle}} = \mathsf{650} \,\mathsf{nV} = -\mathsf{124} \,\mathsf{dBV} \tag{\mathsf{f}\,\mathsf{0}-\mathsf{f}\,\mathsf{0}}$$

The shot noise voltage does increase by a factor of 10, or 20 dB.

#### **10.3.2 Thermal Noise**

Thermal noise is sometimes referred to as Johnson noise after its discoverer. It is generated by thermal agitation of electrons in a conductor. Simply put, as a conductor is heated, it will become noisy. Electrons are never at rest; they are always in motion. Heat disrupts the electrons' response to an applied potential. It adds a random component to their motion (Figure 10–3). Thermal noise only stops at absolute zero.

Here is the image describtion:
```
The image illustrates the behavior of particles, likely electrons, as they are subjected to increasing amounts of heat. 

1. **Motion at Absolute Zero**: On the left side of the image, three particles (depicted as spheres with a negative sign, indicating electrons) are shown moving in straight lines. This represents their motion at absolute zero temperature, where they have minimal kinetic energy and move in a uniform, linear path.

2. **Slight Heating**: In the middle section, the particles are shown with slightly wavy paths. This indicates that with a slight increase in temperature, the electrons gain some kinetic energy, causing their motion to become less linear and more erratic.

3. **More Heat**: On the right side, the particles' paths are highly irregular and wavy, showing that with further heating, the electrons gain even more kinetic energy. This results in highly erratic and random motion, reflecting the increased thermal energy and the corresponding increase in the randomness of their movement.

Overall, the image effectively demonstrates how the motion of electrons changes from orderly to increasingly chaotic as the temperature rises.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 10–3. Thermal Noise." The text is in a serif font, and it appears to be a label or title for a figure in a document, likely a textbook or technical paper. The figure number "10–3" suggests that it is the third figure in the tenth chapter or section of the document. The topic of the figure is "Thermal Noise," which is a concept in electronics and physics related to the random fluctuations in voltage or current caused by the thermal agitation of charge carriers within a conductor.
```

Like shot noise, thermal noise is spectrally flat or has a uniform power density (it is white), but thermal noise is independent of current flow.

At frequencies below 100 MHz, thermal noise can be calculated using Nyquist's relation:

$$
\boldsymbol{\Xi}\_{\mathsf{th}} = \sqrt{\mathsf{4kTRB}} \tag{10-11}
$$

or

$$\mathbf{l}\_{\text{th}} = \sqrt{\frac{4\mathbf{k}\mathbf{T}\mathbf{B}}{\mathbf{R}}} \tag{10-12}$$

Where:

| Thermal noise voltage in Volts rms   |
|--------------------------------------|
| Thermal noise current in Amps rms    |
| Boltzmann's constant (1.38 x 10 –23) |
| Absolute temperature (Kelvin)        |
| Resistance in ohms                   |
| Noise bandwidth in Hertz (fmax–fmin) |
|                                      |

The noise from a resistor is proportional to its resistance and temperature. It is important not to operate resistors at elevated temperatures in high gain input stages. Lowering resistance values also reduces thermal noise.

For example:

The noise in a 100 kΩ resistor at 25-C (298-K) over the audio frequency range of 20 Hz to 20 kHz is:

$$\begin{aligned} \mathsf{E}\_{\mathsf{H}} &= \sqrt{\mathsf{4kTRB}} \\ &= \sqrt{4 \times (1.38 \times 10^{-23}) \times 298 \times 100,000 \times (20,000 - 20)} \\ &= \textbf{5.73 } \upmu\text{V} \\ &= -104.8 \text{ dBV} \end{aligned} \tag{10-13}$$

Decreasing the temperature would reduce the noise slightly, but scaling the resistor down to 1 kΩ (a factor of 100) would reduce the thermal noise by 20 dB. Similarly, increasing the resistor to 10 MΩ would increase the thermal noise to –84.8 dBV, a level that would affect a 16-bit audio circuit. The noise from multiple resistors adds according to the rootmean-square law in Paragraph 10.2.4. Beware of large resistors used as the input resistor of an op amp gain circuit, their thermal noise will be amplified by the gain in the circuit (Paragraph 10.4). Thermal noise in resistors is often a problem in portable equipment, where resistors have been scaled up to get power consumption down.

#### **10.3.3 Flicker Noise**

Flicker noise is also called 1/f noise. Its origin is one of the oldest unsolved problems in physics. It is pervasive in nature and in many human endeavors. It is present in all active and many passive devices. It may be related to imperfections in crystalline structure of semiconductors, as better processing can reduce it.

Some characteristics of flicker noise:

- It increases as the frequency decreases, hence the name 1/f
- It is associated with a dc current in electronic devices
- It has the same power content in each octave (or decade)

$$\mathsf{E}\_{n} = \mathsf{K}\_{\mathsf{v}} \sqrt{\left(\ln \frac{f\_{\max}}{f\_{\min}}\right)} \qquad \mathsf{I}\_{n} = \mathsf{K}\_{i} \sqrt{\left(\ln \frac{f\_{\max}}{f\_{\min}}\right)} \tag{10-14}$$

Where:

Ke and Ki are proportionality constants (volts or amps) representing En and In at 1 Hz

fmax and fmin are the minimum and maximum frequencies in Hz

Flicker noise is found in carbon composition resistors, where it is often referred to as excess noise because it appears in addition to the thermal noise that is there. Other types of resistors also exhibit flicker noise to varying degrees, with wire wound showing the least. Since flicker noise is proportional to the dc current in the device, if the current is kept low enough, thermal noise will predominate and the type of resistor used will not change the noise in the circuit.

Reducing power consumption in an op amp circuit by scaling up resistors may reduce the 1/f noise, at the expense of increased thermal noise.

### **10.3.4 Burst Noise**

Burst noise, also called popcorn noise, is related to imperfections in semiconductor material and heavy ion implants. It is characterized by discrete high-frequency pulses. The pulse rates may vary, but the amplitudes remain constant at several times the thermal noise amplitude. Burst noise makes a popping sound at rates below 100 Hz when played through a speaker — it sounds like popcorn popping, hence the name. Low burst noise is achieved by using clean device processing, and therefore is beyond the control of the designer. Modern processing techniques at Texas Instruments has all but eliminated its occurrence.

### **10.3.5 Avalanche Noise**

Avalanche noise is created when a pn junction is operated in the reverse breakdown mode. Under the influence of a strong reverse electric field within the junction's depletion region, electrons have enough kinetic energy that, when they collide with the atoms of the crystal lattice, additional electron-hole pairs are formed (Figure 10–4). These collisions are purely random and produce random current pulses similar to shot noise, but much more intense.

Here is the image describtion:
```
The image depicts the behavior of charge carriers in a semiconductor junction, specifically a p-n junction, which is a fundamental component in many electronic devices such as diodes and transistors. The image is divided into two main parts, each illustrating different scenarios within the p-n junction.

1. **Left Part of the Image:**
   - The left side shows an n-type semiconductor region labeled "n" and a p-type semiconductor region labeled "p."
   - Between these regions, there is a depletion region, which is an area where mobile charge carriers (electrons and holes) have diffused away, leaving behind charged ions.
   - An electron (e-) is shown moving towards the depletion region from the n-type side. This indicates the movement of electrons from the n-type region into the depletion region.

2. **Right Part of the Image:**
   - The right side also shows an n-type region labeled "n" and a p-type region labeled "p," with a depletion region in between.
   - In this part, a hole (h+) is shown moving towards the depletion region from the p-type side. This indicates the movement of holes from the p-type region into the depletion region.
   - Additionally, there are electrons (e-) shown moving towards the depletion region from the n-type side, similar to the left part of the image.
   - The presence of both electrons and holes moving towards the depletion region suggests recombination, where electrons and holes combine, neutralizing each other.

3. **Depletion Region:**
   - The depletion region is depicted with silicon (Si) atoms, which are the base material for most semiconductors.
   - The depletion region is characterized by the absence of free charge carriers, creating an electric field that influences the movement of electrons and holes.

Overall, the image illustrates the fundamental behavior of charge carriers in a p-n junction, highlighting the movement of electrons and holes towards the depletion region and the potential for recombination. This behavior is crucial for the operation of semiconductor devices.
```

Figure 10–4. Avalanche Noise

When electrons and holes in the depletion region of a reversed-biased junction acquire enough energy to cause the avalanche effect, a random series of large noise spikes will be generated. The magnitude of the noise is difficult to predict due to its dependence on the materials.

Because the zener breakdown in a pn junction causes avalanche noise, it is an issue with op amp designs that include zener diodes. The best way of eliminating avalanche noise is to redesign a circuit to use no zener diodes.

# **10.4 Noise Colors**

While the noise types are interesting, real op amp noise will appear as the summation of some or all of them. The various noise types themselves will be difficult to separate. Fortunately, there is an alternative way to describe noise, which is called color. The colors of noise come from rough analogies to light, and refer to the frequency content. Many colors are used to describe noise, some of them having a relationship to the real world, and some of them more attuned to the field of psycho-acoustics.

White noise is in the middle of a spectrum that runs from purple to blue to white to pink and red/brown. These colors correspond to powers of the frequency to which their spectrum is proportional, as shown in Table 10–1.

| COLOR     | FREQUENCY CONTENT |
|-----------|-------------------|
| Purple    | f 2               |
| Blue      | f                 |
| White     | 1                 |
| Pink      | 1<br>f            |
| Red/Brown | 1<br>f 2          |

There are an infinite number of variations between the colors. All inverse powers of frequency are possible, as are noises that are narrowband or appear only at one discrete frequency. Those, however, are primarily external sources of noise, so their presence is an important clue that the noise is external, not internal. There are no pure colors; at high frequencies, all of them begin to roll off and become pinkish. The op amp noise sources described above appear in the region between white noise and red/brown noise (Figure 10–5).

|                       | NOISE COLORS               |               |     |                                    |  |  |  |
|-----------------------|----------------------------|---------------|-----|------------------------------------|--|--|--|
|                       | White                      | Pink          | Red | Brown                              |  |  |  |
|                       |                            |               |     |                                    |  |  |  |
| Frequency<br>Spectrum | 1                          | 1/f           |     | 1/f2                               |  |  |  |
|                       |                            | –3 dB/octave  |     | –6 dB/octave                       |  |  |  |
| Types of<br>Noise     | Johnson<br>Thermal<br>Shot | Flicker       |     | Brownian<br>Avalanche*<br>Popcorn* |  |  |  |
|                       |                            | * Approximate |     |                                    |  |  |  |

Figure 10–5. Noise Colors

### **10.4.1 White Noise**

White noise is noise in which the frequency and power spectrum is constant and independent of frequency. The signal power for a constant bandwidth (centered at frequency fo), does not change if fo is varied. Its name comes from a similarity to white light, which has equal quantities of all colors.

When plotted versus frequency, white noise is a horizontal line of constant value.

Shot and thermal (Johnson) noise sources are approximately white, although there is no such thing as pure white noise. By definition, white noise would have infinite energy at infinite frequencies. White noise always becomes pinkish at high frequencies.

Steady rainfall or radio static on an unused channel approximate a white noise characteristic.

#### **10.4.2 Pink Noise**

Pink noise is noise with a 1/f frequency and power spectrum excluding dc. It has equal energy per octave (or decade for that matter). This means that the amplitude decreases logarithmically with frequency. Pink noise is pervasive in nature — many supposedly random events show a 1/f characteristic.

Flicker noise displays a 1/f characteristic, which also means that it rolls off at 3 dB/octave.

## **10.4.3 Red/Brown Noise**

Red noise is not universally accepted as a noise type. Many sources omit it and go straight to brown, attributing red characteristics to brown. This has more to do with aesthetics than it does anything else (if brown noise is the low end of the spectrum, then pink noise should be named tan). So if pink noise is pink, then the low end of the spectrum should be red. Red noise is named for a connection with red light, which is on the low end of the visible light spectrum. But then this noise simulates Brownian motion, so perhaps it should be called Brown. Red/brown noise has a –6 dB/octave frequency response and a frequency spectrum of 1/f2 excluding dc.

Red/brown noise is found in nature. The acoustic characteristics of large bodies of water approximate red/brown noise frequency response.

Popcorn and avalanche noise approximate a red/brown characteristic, but they are more correctly defined as pink noise where the frequency characteristic has been shifted down as far as possible in frequency.

# **10.5 Op Amp Noise**

This section describes the noise in op amps and associated circuits.

## **10.5.1 The Noise Corner Frequency and Total Noise**

Op amp noise is never specified as shot, thermal, or flicker, or even white and pink. Noise for audio op amps is specified with a graph of equivalent input noise versus frequency. These graphs usually show two distinct regions:

- Lower frequencies where pink noise is the dominant effect
- Higher frequencies where white noise is the dominant effect

Actual measurements for the TLV2772 show that the noise has both white and pink characteristics (Figure 10–6). Therefore, the noise equations for each type of noise are not able to approximate the total noise out of the TLV2772 over the entire range shown on the graph. It is necessary to break the noise into two parts — the pink part and the white part — and then add those parts together to get the total op amp noise using the rootmean-square law of Paragraph 10.2.4.

Here is the image describtion:
```
The image is a logarithmic graph that plots the input noise voltage (Vn) in Vrms/√Hz against frequency (f) in Hz. The x-axis represents the frequency, ranging from 10 Hz to 10 kHz, while the y-axis represents the input noise voltage, ranging from 10 Vrms/√Hz to 1000 Vrms/√Hz.

The graph shows a curve that illustrates the relationship between noise voltage and frequency. The curve can be divided into two main regions:

1. **1/f Noise Region**: This region is on the left side of the graph, where the noise voltage decreases as the frequency increases. This type of noise is also known as flicker noise or pink noise. It is dominant at lower frequencies.

2. **White Noise Region**: This region is on the right side of the graph, where the noise voltage remains relatively constant across a range of frequencies. White noise is characterized by having equal intensity at different frequencies, giving it a flat spectral density.

The graph also indicates a transition point labeled as "fnc," where the noise behavior changes from 1/f noise to white noise. The noise voltage curve shows a downward trend in the 1/f noise region and flattens out in the white noise region.

Overall, the graph provides a visual representation of how input noise voltage varies with frequency, highlighting the different noise characteristics in different frequency ranges.
```

Figure 10–6. TLV2772 Op Amp Noise Characteristics

## **10.5.2 The Corner Frequency**

The point in the frequency spectrum where 1/f noise and white noise are equal is referred to as the noise corner frequency, fnc. Note on the graph in Figure 10–6 that the actual noise voltage is higher at fnc due to the root-mean-square addition of noise sources as defined in Paragraph 10.2.4.

fnc can be determined visually from the graph in Figure 10–6. It appears a little above 1 kHz. This was done by:

- Taking the white noise portion of the curve, and extrapolating it down to 10 Hz as a horizontal line.
- Taking the portion of the pink noise from 10 Hz to 100 Hz, and extrapolating it as a straight line.
- The point where the two intercept is fnc, the point where the white noise and pink noise are equal in amplitude. The total noise is then 2 x white noise specification (from Paragraph 10.2.4). This would be about 17 nV Hz for the TLV2772.

This is good enough for most applications. As can be seen from the actual noise plot in Figure 10–6, small fluctuations make precise calculation impossible. There is a precise method, however:

Determine the 1/f noise at the lowest possible frequency.

- Square it.
- Subtract the white noise voltage squared (subtracting noise with root-meansquares is just as valid as adding).
- Multiply by the frequency. This will give the noise contribution from the 1/f noise.
- Then divide by the white noise specification squared. The answer is fnc.

For example:

The TLV2772 has a typical noise voltage of 130 nV Hz at 10 Hz (from 5-V plot on data sheet).

The typical white noise specification for the TLV2772 is 12 nV Hz (from data sheet)

$$\begin{aligned} \text{1/ } f \text{ nōise}^2 \oplus \text{10\text{Hz}} &= \left[ \left( \frac{\text{130 nV}}{\sqrt{\text{Hz}}} \right)^2 - \left( \frac{\text{12 nV}}{\sqrt{\text{Hz}}} \right)^2 \right] \times \text{10 } \text{Hz} = \text{167560(nV)^2} \quad \text{(10-15)}\\ f\_{nc} &= \frac{\text{1/ } f \text{noise}^2 \oplus \text{10} \text{Hz}}{\text{white noise}^2} = \frac{\text{167560(nV)^2}}{\left( \frac{\text{12 nV}}{\sqrt{\text{Hz}}} \right)^2} = \text{1164 } \text{Hz} \end{aligned}$$

Once the corner frequency is known, the individual noise components can be added together as shown in Paragraph 10.2.2. Continuing the example above for a frequency range of 10 Hz to 10 kHz:

$$\mathsf{E}\_{n} = \mathsf{E}\_{\text{whèncoise}} \sqrt{f\_{nc} \times \mathsf{T} \ln \frac{f\_{\text{max}}}{f\_{\text{min}}} + (f\_{\text{max}} - f\_{\text{min}})} \tag{10-17}$$

$$\mathbf{E}\_n = \frac{\mathbf{12 \ nV}}{\sqrt{\mathsf{Hz}}} \sqrt{\mathsf{1164 \ \mathsf{Hz} \times \mathsf{1n}} \frac{\mathsf{104}}{\mathsf{10}} + \left(\mathsf{10^4 \ \mathsf{Hz} - \mathsf{10}\ \mathsf{Hz}\right)}} = \mathsf{1.611} \,\upmu\mathrm{V} = -\mathsf{116} \,\mathrm{dBV} \tag{\mathsf{10-18}}$$

The example above presupposed that the bandwidth includes fnc. If it does not, all of the contribution will be from either the 1/f noise or the white noise. Similarly, if the bandwidth is very large, and extends to three decades or so above fnc, the contribution of the 1/f noise can be ignored.

### **10.5.3 Op Amp Circuit Noise Model**

Texas Instruments measures the noise characteristics of a large sampling of devices. This information is compiled and used to determine the typical noise performance of the device. These noise specifications refer the input noise of the op amp. Some noise portions can be represented better by a voltage source, and some by a current source. Input voltage noise is always represented by a voltage source in series with the noninverting input. Input current noise is always represented by current sources from both inputs to ground (Figure 10–7).

Here is the image describtion:
```
The image depicts a schematic representation of an operational amplifier (op-amp) with noise sources. The op-amp is shown as a triangular symbol, which is a standard representation in electronics. The triangle points to the right, indicating the direction of the signal flow from the input to the output.

Inside the triangle, there is a label "Noiseless Op Amp," suggesting that the op-amp itself is ideal and does not contribute any noise. However, the diagram includes external noise sources that affect the input.

To the left of the triangle, there are two input terminals marked with "+" (non-inverting input) and "−" (inverting input). Between these terminals, there are three noise sources depicted:

1. **inn**: This is represented by a current source symbol with arrows pointing in opposite directions, indicating noise current at the inverting input.
2. **inp**: This is another current source symbol with arrows pointing in opposite directions, indicating noise current at the non-inverting input.
3. **en**: This is represented by a voltage source symbol with a sine wave inside, indicating noise voltage at the input.

These noise sources are connected to the input terminals of the op-amp, showing how they influence the overall performance of the circuit. The presence of these noise sources is crucial for analyzing the noise performance of the op-amp in practical applications.

Overall, the image illustrates an ideal op-amp with external noise sources at its inputs, which is a common scenario in noise analysis of electronic circuits.
```

Figure 10–7. Op Amp Circuit Noise Model

In practice, op amp circuits are designed with low source impedance on the inverting and noninverting inputs. For low source impedances and CMOS JFET inputs, only the noise voltage is important; the current sources are insignificant in the calculations because they are swamped in the input impedances.

The equivalent circuit, therefore, reduces to that shown in Figure 10–8:

Here is the image describtion:
```
The image depicts a schematic representation of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and layout:

1. **Op-Amp Symbol**: The main component in the image is an op-amp, represented by a large triangle. The triangle points to the right, indicating the direction of signal flow from the input to the output.

2. **Inputs**: The op-amp has two input terminals:
   - The inverting input (-) is located at the top left of the triangle.
   - The non-inverting input (+) is located at the bottom left of the triangle.

3. **Output**: The output of the op-amp is at the rightmost point of the triangle.

4. **Noiseless Op Amp Label**: Inside the triangle, there is a label that reads "Noiseless Op Amp," indicating that this particular op-amp is assumed to have no internal noise for the purposes of this schematic.

5. **Noise Source**: There is a small circle with a sine wave symbol inside it, labeled "en," connected to the non-inverting input (+) of the op-amp. This represents an external noise voltage source being applied to the non-inverting input.

6. **Connections**: 
   - The inverting input (-) is shown without any external connections in this schematic.
   - The non-inverting input (+) is connected to the noise source (en).
   - The output is shown as a single line extending to the right from the point of the triangle.

The schematic is a simplified representation, focusing on the concept of a noiseless op-amp with an external noise source applied to its non-inverting input.
```

Figure 10–8. Equivalent Op Amp Circuit Noise Model

Op Amp Noise Theory and Applications 10-15

# **10.5.4 Inverting Op Amp Circuit Noise**

If the previous circuit is operated in an inverting gain stage, the equivalent circuit becomes that shown in Figure 10–9:

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with various components and noise sources. Here is a detailed description:

1. **Op-Amp Configuration**: The circuit features a noiseless operational amplifier with its inverting input (-) and non-inverting input (+) clearly marked. The output of the op-amp is labeled as \( E_0 \).

2. **Input Signal**: The input signal is labeled as \( E_{in} \) and is connected to the inverting input of the op-amp through a resistor \( R_1 \).

3. **Noise Sources**:
   - **\( e_1 \)**: This noise source is in series with the input signal \( E_{in} \) and the resistor \( R_1 \).
   - **\( e_2 \)**: This noise source is in series with a resistor \( R_2 \), which is connected between the output \( E_0 \) and the inverting input of the op-amp.
   - **\( e_3 \)**: This noise source is in series with a resistor \( R_3 \), which is connected to the non-inverting input of the op-amp.
   - **\( e_n \)**: This noise source is directly connected to the non-inverting input of the op-amp.

4. **Resistors**:
   - **\( R_1 \)**: Connected between the input signal \( E_{in} \) and the inverting input of the op-amp.
   - **\( R_2 \)**: Connected between the output \( E_0 \) and the inverting input of the op-amp.
   - **\( R_3 \)**: Connected between the noise source \( e_3 \) and the non-inverting input of the op-amp.

5. **Ground Connections**: The non-inverting input of the op-amp is connected to ground through the resistor \( R_3 \) and the noise source \( e_3 \).

6. **Circuit Functionality**: This circuit appears to be a configuration for analyzing the impact of various noise sources on the output of an op-amp. The op-amp is configured in a feedback loop with resistors \( R_1 \) and \( R_2 \), which suggests it could be an inverting amplifier configuration. The presence of multiple noise sources indicates that the circuit is used to study how these noises affect the overall output \( E_0 \).

In summary, the image shows an op-amp circuit with an input signal, feedback resistors, and multiple noise sources connected to both the inverting and non-inverting inputs, illustrating the analysis of noise in op-amp circuits.
```

Figure 10–9. Inverting Op Amp Circuit Noise Model

The additional voltage sources e1 through e3 represent the thermal noise contribution from the resistors. As stated in Paragraph 10.3.2, the resistor noise can also be discounted if the values are low. Resistor noise will be omitted in the examples that follow. R3 is also not usually present, unless low common-mode performance is important. Deleting it and connecting the noninverting input directly to (virtual) ground makes the common mode response of the circuit worse, but may improve the noise performance of some circuits. There will be one less noise source to worry about. Therefore, the equivalent circuit becomes that shown in Figure 10–10:

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is a triangular symbol representing a noiseless operational amplifier. The op-amp has two input terminals and one output terminal.
   - The inverting input (marked with a minus sign, -) is connected to a resistor labeled \( R_1 \) and to the input voltage source \( E_{in} \).
   - The non-inverting input (marked with a plus sign, +) is connected to the ground (0V reference point).

2. **Resistors**:
   - \( R_1 \): This resistor is connected between the input voltage source \( E_{in} \) and the inverting input of the op-amp.
   - \( R_2 \): This resistor is connected between the output of the op-amp (labeled \( E_0 \)) and the inverting input of the op-amp, forming a feedback loop.

3. **Voltage Sources**:
   - \( E_{in} \): This is the input voltage source connected to the circuit through resistor \( R_1 \).
   - \( e_n \): This symbol inside the op-amp represents an internal noise voltage source, but it is labeled as "Noiseless Op Amp," indicating that the noise is negligible or not considered in this analysis.

4. **Connections**:
   - The inverting input of the op-amp is connected to both \( R_1 \) and \( R_2 \).
   - The non-inverting input is connected to the ground.
   - The output of the op-amp (labeled \( E_0 \)) is connected to one end of \( R_2 \), completing the feedback loop.

The circuit appears to be a classic inverting amplifier configuration, where the input signal \( E_{in} \) is applied to the inverting input through \( R_1 \), and the feedback resistor \( R_2 \) determines the gain of the amplifier. The output voltage \( E_0 \) is taken from the output terminal of the op-amp.
```

Figure 10–10. Inverting Equivalent Op Amp Circuit Noise Model

10-16

This simplifies the gain calculation:

$$\mathbf{E}\_0 = \sqrt{\left(\mathbf{E}\_{\rm in} \frac{\mathbf{R}\_2}{\mathbf{R}\_1}\right)^2 + \left(\mathbf{e}\_{\rm n} \left(\mathbb{1} + \frac{\mathbf{R}\_2}{\mathbf{R}\_1}\right)\right)^2} \tag{10-19}$$

where en = the total noise over the bandwidth of interest.

#### **10.5.5 Noninverting Op Amp Circuit Noise**

Taking the simplified equivalent op amp circuit from Paragraph 10.5.2 as the base, the noise equivalent of a noninverting op amp circuit is shown in Figure 10–11:

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is a noiseless op-amp, represented by a triangular symbol. The op-amp has two input terminals and one output terminal.
   - The inverting input (marked with a minus sign, -) is connected to a feedback loop.
   - The non-inverting input (marked with a plus sign, +) is connected to the input signal.

2. **Input Signal (Ein)**: The input signal, labeled as Ein, is connected to the non-inverting input of the op-amp through a resistor R1. This input signal is represented by a voltage source symbol.

3. **Resistors (R1 and R2)**:
   - **R1**: This resistor is connected between the input signal (Ein) and the non-inverting input of the op-amp.
   - **R2**: This resistor is connected between the output of the op-amp (E0) and the inverting input of the op-amp, forming a feedback loop.

4. **Output Signal (E0)**: The output of the op-amp is labeled as E0. This is the point where the amplified signal is obtained.

5. **Noise Source (en)**: There is a noise source symbol (en) connected to the non-inverting input of the op-amp. This represents the noise voltage that might be present in the circuit.

6. **Ground Connection**: The circuit has a ground connection, which is shown connected to the junction between R1 and the inverting input of the op-amp.

The configuration of the resistors and the op-amp suggests that this is a non-inverting amplifier circuit. The input signal is applied to the non-inverting input, and the feedback resistor R2 and input resistor R1 set the gain of the amplifier. The presence of the noise source en indicates that the circuit is being analyzed for its noise performance, although the op-amp itself is described as noiseless.
```

Figure 10–11. Noninverting Equivalent Op Amp Circuit Noise Model

The gain of this circuit is:

$$\mathbf{E}\_0 = \sqrt{\left(\mathbf{E}\_{\rm in} \left(\mathbb{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_1}\right)\right)^2 + \left(\mathbf{e}\_{\rm n} \left(\mathbb{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_1}\right)\right)^2} \tag{10-20}$$

## **10.5.6 Differential Op Amp Circuit Noise**

Taking the simplified equivalent op amp circuit from Paragraph 10.5.2 as the base, the noise equivalent of a differential op amp circuit is shown in Figure 10–12:

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is a noiseless op-amp, represented by a triangular symbol. The op-amp has two input terminals: the inverting input (marked with a minus sign, -) and the non-inverting input (marked with a plus sign, +). The output terminal is at the point of the triangle.

2. **Input Signals**: 
   - **Ein1**: This is the input signal connected to the inverting input of the op-amp through a resistor labeled \( R_1 \).
   - **Ein2**: This is the input signal connected to the non-inverting input of the op-amp through a resistor labeled \( R_3 \).

3. **Resistors**:
   - **R1**: This resistor is connected between the input signal \( Ein1 \) and the inverting input of the op-amp.
   - **R2**: This resistor is connected between the output of the op-amp and the inverting input, forming a feedback loop.
   - **R3**: This resistor is connected between the input signal \( Ein2 \) and the non-inverting input of the op-amp.
   - **R4**: This resistor is connected between the non-inverting input of the op-amp and ground.

4. **Noise Source (en)**: There is a noise source symbol (represented by a small sine wave) connected to the non-inverting input of the op-amp, indicating that noise is being introduced at this point.

5. **Output Signal (E0)**: The output of the op-amp is labeled \( E0 \) and is taken from the point where the feedback resistor \( R_2 \) connects to the output terminal of the op-amp.

6. **Ground Connections**: The non-inverting input is connected to ground through resistor \( R_4 \).

In summary, the circuit is a typical configuration of an op-amp with both inverting and non-inverting inputs, feedback resistor, and a noise source introduced at the non-inverting input. The output signal \( E0 \) is influenced by the input signals \( Ein1 \) and \( Ein2 \), the resistors, and the noise source.
```

### Figure 10–12. Differential Equivalent Op Amp Circuit Noise Model

Assuming that R1 = R3 and R2 = R4, the gain of this circuit is:

$$\mathbf{E}\_0 = \sqrt{\left( (\mathbf{E}\_{\rm in2} - \mathbf{E}\_{\rm in1}) \frac{\mathbf{R}\_2}{\mathbf{R}\_1} \right)^2 + \left( \mathbf{e}\_n \left( \mathbb{1} + \frac{\mathbf{R}\_2}{\mathbf{R}\_1} \right) \right)^2} \tag{10-21}$$

#### **10.5.7 Summary**

The previous examples, though trivial, illustrate that noise always adds to the overall output of the op amp circuit. Reference 1 provides a much more in-depth derivation of op amp noise in circuits, including resistive effects.

# **10.6 Putting It All Together**

This example is provided for analysis only — actual results depend on a number of other factors. Expanding on the techniques of Paragraph 10.2.5:

A low-noise op amp is needed over an audio frequency range of 20 Hz to 20 kHz, with a gain of 40 dB. The output voltage is 0 dBV (1V). The schematic is shown in Figure 10–13:

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit configured as a non-inverting amplifier. Here is a detailed description of the circuit:

1. **Power Supply:**
   - The op-amp (TLE2027) is powered by a single +5V supply.

2. **Voltage Divider:**
   - There is a voltage divider network at the input, consisting of two 100 kΩ resistors connected in series between +5V and ground. The midpoint of this voltage divider provides a reference voltage of 2.5V (since it is halfway between +5V and ground).

3. **Input Signal (VIN):**
   - The input signal (VIN) is connected to the non-inverting input (+) of the op-amp through a 100 kΩ resistor.

4. **Feedback Network:**
   - The feedback network consists of a 10 MΩ resistor connected between the output (VOUT) and the inverting input (-) of the op-amp.
   - Another 100 kΩ resistor is connected between the inverting input (-) and the reference voltage (2.5V) from the voltage divider.

5. **Operational Amplifier (TLE2027):**
   - The op-amp used in this circuit is a TLE2027, which is a precision low-noise op-amp.

6. **Output (VOUT):**
   - The output of the op-amp is labeled as VOUT.

**Functionality:**
- The circuit is designed to amplify the input signal (VIN) while maintaining a reference voltage of 2.5V at the non-inverting input.
- The gain of the amplifier is determined by the ratio of the feedback resistor (10 MΩ) to the resistor connected to the inverting input (100 kΩ), which gives a gain of 101.
- The output voltage (VOUT) will be an amplified version of the input signal (VIN) with respect to the reference voltage of 2.5V.

This configuration ensures that the op-amp amplifies the difference between the input signal and the reference voltage, providing a stable and amplified output.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 10–13. Split Supply Op Amp Circuit." This suggests that it is a label for a figure in a document, likely a textbook or technical manual, which depicts a split supply operational amplifier (op-amp) circuit. The figure number (10-13) indicates that it is the thirteenth figure in the tenth chapter or section of the document. The term "Split Supply Op Amp Circuit" refers to an operational amplifier circuit that uses a dual power supply, typically providing both positive and negative voltage rails.
```

It would be nice to use a TLE2027 with a noise figure of 2.5 nV Hz . The data sheet, however, reveals that this is a ±15-V part, and that noise figure is only specified at ±15 V. Furthermore, the specification for VOM+ and VOM– (see Chapter 11) show that it can only swing to within approximately 2 V of its voltage rails. If they are +5 V and ground, the op amp is close to clipping with a 1-V output signal. This illustrates a common fallacy: the designer chooses an op amp based on one parameter only, without checking others that affect the circuit. An expert analog designer must develop an attention to details or be prepared to spend a lot of time in the lab with false starts and unexpected problems.

So, the only choice is to select a different op amp. The TLC2201 is an excellent choice. It is a low-noise op amp optimized for single supply operation. Figure 10–14 appears right on the first page of the data sheet, which should be extremely significant to the designer.

Here is the image describtion:
```
The image is a graph titled "TYPICAL EQUIVALENT INPUT NOISE VOLTAGE vs FREQUENCY." It plots the equivalent input noise voltage (Vn) in nanovolts per square root Hertz (nV/√Hz) against frequency (f) in Hertz (Hz). The graph is logarithmic on both axes.

The y-axis represents the equivalent input noise voltage, ranging from 0 to 60 nV/√Hz. The x-axis represents the frequency, ranging from 1 Hz to 10 kHz.

The curve on the graph starts at the top left corner, indicating a high noise voltage at low frequencies (around 60 nV/√Hz at 1 Hz). As the frequency increases, the noise voltage decreases sharply, reaching around 10 nV/√Hz at 100 Hz. Beyond this point, the curve flattens out, showing a gradual decrease in noise voltage, reaching approximately 5 nV/√Hz at 10 kHz.

In the top right corner of the graph, there are conditions specified for the measurements: 
- VDD = 5 V (power supply voltage)
- RS = 20 Ω (source resistance)
- TA = 25°C (ambient temperature)

The graph is grid-lined, with both major and minor lines to help in reading values accurately.
```

Figure 10–14. TLC2201 Op Amp Noise Performance

The first circuit change in this example is to change the TLE2027 to a TLC2201. Visually, the corner frequency fnc appears to be somewhere around 20 Hz (from Paragraph 10.5.2), the lower frequency limit of the band we are interested in. This is good, it means

for all practical purposes the 1/f noise can be discounted. It has 8 nV Hz noise instead

of 2.5 nV Hz , and from Paragraph 10.2.5:

- To begin with, calculate the root Hz part: 20000 20 141.35.
- Multiplying this by the noise spec: 8 141.35 1.131 V, which is the equivalent input noise (EIN). The output noise equals the input noise multiplied by the gain, which is 100 (40 dB).

The signal-to-noise ratio can be now be calculated:

- 1.131 V 100 113.1 V
- Signal-to-noise (dB) =

$$\mathbf{20} \times \log(\text{1V} + \text{173.1 } \mu\text{V}) = \mathbf{20} \times \log(\text{8842}) = \mathbf{78.9} \text{ dB} \tag{10-22}$$

Pretty good, but 10 dB less than would have been possible with a TLE2027. If this is not acceptable (lets say for 16-bit accuracy), one is forced to generate a ±15-V supply. Let's suppose for now that 78.9 dB signal-to-noise is acceptable, and build the circuit.

When it is assembled, it oscillates. What went wrong?

To begin with, it is important to look for potential sources of external noise. The way the schematic in Figure 10–14 is drawn provides a visual clue to the culprit: a long connection from the half-supply voltage reference to the high-impedance noninverting input. Added to that is a 50-kΩ source impedance, which does not effectively swamp external noise sources from entering the noninverting input. There is a big difference between simply providing a correct dc operating point, and providing one that has low impedances where they are needed. Most designers know the "fix", which is to decouple the noninverting input as shown in Figure 10–15:

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit. Here is a detailed description of the circuit components and their connections:

1. **Power Supply:**
   - The op-amp (TLE2201) is powered by a +5V supply connected to its positive power supply pin.

2. **Voltage Divider:**
   - Two 100 kΩ resistors are connected in series between +5V and ground. The junction of these two resistors provides a reference voltage of 2.5V (since it is the midpoint of the voltage divider) which is used as the input voltage \( V_{IN} \).

3. **Input Capacitor:**
   - A 0.1 µF capacitor is connected between the non-inverting input (+) of the op-amp and ground. This capacitor is likely used for filtering purposes to stabilize the input voltage.

4. **Input Resistor:**
   - A 100 kΩ resistor is connected between the junction of the voltage divider (providing \( V_{IN} \)) and the non-inverting input (+) of the op-amp.

5. **Feedback Network:**
   - A 10 MΩ resistor is connected between the output of the op-amp (\( V_{OUT} \)) and the inverting input (-) of the op-amp. This resistor forms the feedback network which determines the gain of the amplifier.

6. **Op-Amp Configuration:**
   - The op-amp is configured in a non-inverting mode, where the input signal is applied to the non-inverting input (+) and the feedback is applied to the inverting input (-).

7. **Output:**
   - The output voltage (\( V_{OUT} \)) is taken from the output pin of the op-amp.

In summary, this circuit is a non-inverting amplifier with a high gain determined by the ratio of the feedback resistor (10 MΩ) to the input resistor (100 kΩ). The input voltage \( V_{IN} \) is derived from a voltage divider and is filtered by a capacitor before being fed into the op-amp.
```

Figure 10–15. TLC2201 Op Amp Circuit

Better — it stopped oscillating. Probably a nearby noise source radiating into the noninverting input was providing enough noise to put the circuit into oscillation. The capacitor lowers the input impedance of the noninverting input and stops the oscillation. There is much more information on this topic in Chapter 17, including layout effects and component selection. For now, it is assumed that all of these have been taken into account.

The circuit is still slightly noisier than the 78.9 dB signal-to-noise ratio given above, especially at lower frequencies. This is where the real work of this example begins: that of eliminating component noise.

The circuit in Figure 10–15 has 4 resistors. Assuming that the capacitor is noiseless (not always a good assumption), that means four noise sources. For now, only the two resistors in the voltage divider that forms the voltage reference will be considered. The capacitor, however, has transformed the white noise from the resistors into pink (1/f) noise. From Paragraph 10.3.2 and 10.2.5, the noise from the resistors and the amplifier itself is:

$$\mathsf{E}\_{\mathsf{Toutrms}} = \sqrt{\mathsf{5.73 } \mathsf{\mu} \mathsf{V}^2 + \mathsf{5.73 } \mathsf{\mu} \mathsf{V}^2 + \mathsf{113.1 } \mathsf{\mu} \mathsf{V}^2} = \mathsf{113.1 } \mathsf{\mu} \mathsf{V}\_{\mathsf{rms}} \tag{70-23}$$

Signal-to-noise (dB) =

$$\text{720} \times \log(\text{71\%} + \text{713.7\#}) = \text{20} \times \log(\text{8842}) = \text{78.9 dB} \tag{\text{70-24}}$$

So far, so good. The amplifier noise is swamping the resistor noise, which will only add a very slight pinkish component at low frequencies. Remember, however, that this noise

Op Amp Noise Theory and Applications 10-21

voltage is multiplied by 101 through the circuit, but that was previously taken into account for the 78.9 dB signal-to-noise calculation above.

Reducing the value of the resistors to decrease their noise is an option. Changing the voltage divider resistors from 100 kΩ to 1 kΩ while leaving the 0.1 µV capacitor the same, changes the corner frequency from 32 Hz to 796 Hz, right in the middle of the audio band.

#### **Note:**

Resist the temptation to make the capacitor larger to move the pinkish effect below the lower limits of human hearing. The resulting circuit must charge the large capacitor up during power up, and down during power down. This may cause unexpected results.

If the noise from the half-supply generator is critical, the best possible solution is to use a low-noise, low-impedance half-supply source. Remember, however, that its noise will be multiplied by 101 in this application.

The effect of the 100-kΩ resistor on the inverting input is whitish, and will appear across the entire bandwidth of the circuit. Compared to the amplifier noise, it is still small, just like the noise from the noninverting resistors on the input. The noise contribution of resistors will be discounted.

Of much more concern, however, is the 10-MΩ resistor used as the feedback resistor. The noise associated with it appears as a voltage source at the inverting input of the op amp, and, therefore, is multiplied by a factor of 100 through the circuit. From Paragraph 10.3.2, the noise of a 10-MΩ resistor is –84.8 dBV, or 57.3 µV. Adding this and the 100-kΩ resistor noise to the amplifier noise:

$$\mathsf{E}\_{\mathsf{Toutums}} = \sqrt{\mathsf{5}.73 \,\upmu\mathsf{V}^2 + \mathsf{1}\,\upmu\mathsf{3}.\mathsf{1}\,\upmu\mathsf{V}^2} = \mathsf{126.8}\,\upmu\mathsf{V}\_{\mathsf{rms}} = -\mathsf{77.9}\,\mathsf{d}\mathsf{B}\,\mathsf{V} \tag{10-25}$$

Signal-to-noise (dB) =

$$\text{720} \times \log(\text{7}\text{V} + \text{726.8}\,\mu\text{V}) = 20 \times \log(7887) = 77.9 \text{ dB} \tag{10-26}$$

The noise contribution from the 10-MΩ resistor subtracts 1 dB from the signal-to-noise ratio. Changing the 10-MΩ resistor to 100 kΩ, and the input resistor from 100 kΩ to 1 kΩ preserves the overall gain of the circuit. The redesigned circuit is shown in Figure 10–16:

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit. Here is a detailed description of the circuit components and their connections:

1. **Power Supply:**
   - The circuit is powered by a +5V supply.

2. **Voltage Divider:**
   - Two 100 kΩ resistors are connected in series between the +5V supply and ground. The junction of these two resistors provides a reference voltage of 2.5V (since the resistors are equal, the voltage is divided equally).

3. **Input Signal (VIN):**
   - The input signal, VIN, is connected to the non-inverting input (+) of the op-amp through a 1 kΩ resistor.

4. **Capacitor:**
   - A 0.1 µF capacitor is connected between the non-inverting input (+) of the op-amp and ground. This capacitor likely serves to filter out any high-frequency noise from the input signal.

5. **Operational Amplifier (TLE2201):**
   - The op-amp used in this circuit is a TLE2201. The non-inverting input (+) is connected to the junction of the 1 kΩ resistor and the capacitor.
   - The inverting input (-) is connected to the output (VOUT) through a 100 kΩ feedback resistor, forming a voltage follower or buffer configuration.

6. **Output (VOUT):**
   - The output of the op-amp (VOUT) is connected back to the inverting input (-) through the 100 kΩ feedback resistor, and it also serves as the output of the entire circuit.

In summary, this circuit is a non-inverting amplifier with a gain of 2, given by the ratio of the feedback resistor (100 kΩ) to the input resistor (1 kΩ). The voltage divider sets a reference voltage at the non-inverting input, and the capacitor filters out noise. The op-amp amplifies the input signal, and the output is taken from the op-amp's output terminal.
```

Figure 10–16. Improved TLC2201 Op Amp Circuit

For frequencies above 100 Hz, where the 1/f noise from the op amp and the reference resistors is negligible, the total noise of the circuit is:

$$\mathsf{E}\_{\mathsf{Tosits}} = \sqrt{0.57 \,\upmu\mathsf{V}^2 + 5.73 \,\upmu\mathsf{V}^2 + \mathsf{Tl3.7} \,\upmu\mathsf{V}^2} = \texttt{113.2 } \mu\mathsf{V}\_{\mathsf{rms}} = -78.9 \,\upmu\mathsf{dB} \,\upmu\qquad \text{(\text{\textquotedbl{}}\!0-27\)}$$

Signal-to-noise (dB) =

$$\mathbf{20} \times \log(\text{1V} + \text{173.2 } \mu\text{V}) = \mathbf{20} \times \log(\text{8830}) = \mathbf{78.9} \text{ dB} \tag{10-28}$$

Proper selection of resistors, therefore, has yielded a signal-to-noise ratio close to the theoretical limit for the op amp itself. The power consumption of the circuit, however, has increased slightly, which may be unacceptable in a portable application. Remember, too, that this signal-to-noise ratio is only at an output level of 0 dBV, an input level of –40 dBV. If the input signal is reduced, the signal-to-noise ratio is reduced proportionally.

Music, in particular almost never sustains peak levels. The average amplitude may be down 20 dB to 40 dB from the peak values. This erodes a 79 dB signal-to-noise ratio to 39 dB in quiet passages. If someone "cranks up the volume" during the quiet passages, noise will become audible. This is done automatically with automatic volume controls. The only way a designer can combat this is to increase the voltage levels through the individual stages. If the preceding audio stages connecting to this example, for instance, could be scaled to provide 10 dB more gain, the TLC2201 would be handling an output level of 3.16 V instead of 1 V, which is well within its rail-to-rail limit of 0 V to 4.7 V. This would increase the signal-to-noise gain of this circuit to 88.9 dB — almost the same as would have been possible with a TLE2027 operated off of ±15V! But noise in the preceding stages would also increase. Combatting noise is a difficult problem, and there are always tradeoffs involved.

# **10.7 References**

(1) Texas Instruments Application Report, Noise Analysis in Operational Amplifier Circuits, SLVA043A, 1999

Op Amp Noise Theory and Applications 10-23

# **Chapter 11**

# **Understanding Op Amp Parameters**

#### Bruce Carter

# **11.1 Introduction**

This chapter is about op amp data sheet parameters. The designer must have a clear understanding of what op amp parameters mean and their impact on circuit design. The chapter is arranged for speedy access to parameter information. Their definitions, typical abbreviations, and units appear in Section 11.2. Section 11.3 digs deeper into important parameters for the designer needing more in-depth information.

While these parameters are the ones most commonly used at Texas Instruments, the same parameter may go by different names and abbreviations at other manufacturers. Not every parameter listed here may appear in the data sheet for a given op amp. An op amp that is intended only for ac applications may omit dc offset information. The omission of information is not an attempt to "hide" anything. It is merely an attempt to highlight the parameters of most interest to the designer who is using the part the way it was intended. There is no such thing as an ideal op amp — or one that is universally applicable. The selection of any op amp must be based on an understanding of what particular parameters are most important to the application.

If a particular parameter cannot be found in the data sheet, a review of the application may well be in order and another part, whose data sheet contains the pertinent information, might be more suitable. Texas Instruments manufactures a broad line of op amps that can implement almost any application. The inexperienced designer could easily select an op amp that is totally wrong for the application. Trying to use an audio op amp with low total harmonic distortion in a high-speed video circuit, for example, will not work — no matter how superlative the audio performance might be.

Some parameters have a statistically normal distribution. The typical value published in the data sheet is the mean or average value of the distribution. The typical value listed is the 1σ value. This means that in 68% of the devices tested, the parameter is found to be ± the typical value or better. Texas Instruments currently uses 6σ to define minimum and maximum values. Usually, typical values are set when the part is characterized and never changes.

# **11.2 Operational Amplifier Parameter Glossary**

There are usually three main sections of electrical tables in op amp data sheets. The absolute maximum ratings table and the recommended operating conditions table list constraints placed upon the circuit in which the part will be installed. Electrical characteristics tables detail device performance.

Absolute maximum ratings are those limits beyond which the life of individual devices may be impaired and are never to be exceeded in service or testing. Limits, by definition, are maximum ratings, so if double-ended limits are specified, the term will be defined as a range (e.g., operating temperature range).

Recommended operating conditions have a similarity to maximum ratings in that operation outside the stated limits could cause unsatisfactory performance. Recommended operating conditions, however, do not carry the implication of device damage if they are exceeded.

Electrical characteristics are measurable electrical properties of a device inherent in its design. They are used to predict the performance of the device as an element of an electrical circuit. The measurements that appear in the electrical characteristics tables are based on the device being operated within the recommended operating conditions.

Table 11–1 is a list of parameters and operating conditions that are commonly used in TI op amp data sheets. The glossary is arranged alphabetically by parameter name. An abbreviation cross-reference is provided after the glossary in Table 11–2 to help the designer find information when only an abbreviation is given. More detail is given about important parameters in Section 11.3.

| PARAMETER                          | ABBV               | UNITS | DEFINITION                                                                                                                                                                                                                               | INFO     |
|------------------------------------|--------------------|-------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| Bandwidth for 0.1 dB flat<br>ness  |                    | MHz   | The range of frequencies within which the gain is ± 0.1 dB of<br>the nominal value.                                                                                                                                                      |          |
| Case temperature for 60<br>seconds |                    | °C    | Usually specified as an absolute maximum — It is meant to<br>be used as guide for automated soldering processes.                                                                                                                         |          |
| Common-mode input ca<br>pacitance  | Cic                | pF    | Input capacitance a common-mode source would see to<br>ground.                                                                                                                                                                           | 11.3.7.1 |
| Common-mode input im<br>pedance    | Zic                | Ω     | The parallel sum of the small-signal impedance between each<br>input terminal and ground.                                                                                                                                                |          |
| Common-mode input volt<br>age      | VIC                | V     | The average voltage at the input pins.                                                                                                                                                                                                   | 11.3.3   |
| Common-mode rejection ra<br>tio    | CMRR<br>or<br>kCMR | dB    | The ratio of differential voltage amplification to common-mode<br>voltage amplification. Note: This is measured by determining<br>the ratio of a change in input common-mode voltage to the<br>resulting change in input offset voltage. | 11.3.9   |

Table 11–1. Op Amp Parameter GLossary

| PARAMETER                              | ABBV | UNITS    | DEFINITION                                                                                                                                                                                                                                            | INFO     |
|----------------------------------------|------|----------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| Continuous total dissipation           |      | mW       | Usually specified as an absolute maximum. It is the power<br>that can be dissipated by the op amp package, including the<br>load power. This parameter may be broken down by ambient<br>temperature and package style in a table.                     |          |
| Crosstalk                              | XT   | dBc      | The ratio of the change in output voltage of a driven channel<br>to the resulting change in output voltage from another channel<br>that is not driven.                                                                                                |          |
| Differential gain error                | AD   | %        | The change in ac gain with change in dc level. The ac signal<br>is 40 IRE (0.28 VPK) and the dc level change is ±100 IRE<br>(±0.7 V). Typically tested at 3.58 MHz (NTSC) or 4.43 MHz<br>(PAL) carrier frequencies.                                   |          |
| Differential input capaci<br>tance     | Cic  | pF       | (see common mode input capacitance)                                                                                                                                                                                                                   | 11.3.7.1 |
| Differential input resistance          | rid  | Ω        | The small-signal resistance between two ungrounded input<br>terminals.                                                                                                                                                                                |          |
| Differential input voltage             | VID  | V        | The voltage at the noninverting input with respect to the in<br>verting input.                                                                                                                                                                        |          |
| Differential phase error               | ΦD   | °        | The change in ac phase with change in dc level. The ac sig<br>nal is 40 IRE (0.28 VPK) and the dc level change is ±100 IRE<br>(±0.7 V). Typically tested at 3.58 MHz (NTSC) or 4.43 MHz<br>(PAL) carrier frequencies.                                 |          |
| Differential voltage amplifi<br>cation | AVD  | dB       | (see open loop voltage gain)                                                                                                                                                                                                                          | 11.3.6   |
| Fall time                              | tf   | ns       | The time required for an output voltage step to change from<br>90% to 10% of its final value.                                                                                                                                                         |          |
| Duration of short-circuit cur<br>rent  |      |          | Amount of time that the output can be shorted to network<br>ground — usually specified as an absolute maximum.                                                                                                                                        |          |
| Input common-mode volt<br>age range    | VICR | V        | The range of common-mode input voltage that, if exceeded,<br>may cause the operational amplifier to cease functioning<br>properly. This is sometimes is taken as the voltage range over<br>which the input offset voltage remains within a set limit. | 11.3.3   |
| Input current                          | II   | mA       | The amount of current that can be sourced or sinked by the<br>op amp input — usually specified as an absolute maximum<br>rating.                                                                                                                      |          |
| Input noise current                    | In   | pA<br>Hz | The internal noise current reflected back to an ideal current<br>source in parallel with the input pins.                                                                                                                                              | 11.3.13  |
| Input noise voltage                    | Vn   | nV<br>Hz | The internal noise voltage reflected back to an ideal voltage<br>source in parallel with the input pins.                                                                                                                                              | 11.3.13  |
| Gain bandwidth product                 | GBW  | MHz      | The product of the open-loop voltage gain and the frequency<br>at which it is measured.                                                                                                                                                               | 11.3.13  |
| Gain margin                            | Am   | dB       | The reciprocal of the open-loop voltage gain at the frequency<br>where the open-loop phase shift first reaches –180°.                                                                                                                                 |          |
| High-level output voltage              | VOH  | V        | The highest positive op amp output voltage for the bias condi<br>tions applied to the power pins.                                                                                                                                                     | 11.3.5   |
| Input bias current                     | IIB  | µA       | The average of the currents into the two input terminals with<br>the output at a specified level.                                                                                                                                                     | 11.3.2   |

| PARAMETER                                     | ABBV        | UNITS      | DEFINITION                                                                                                                                                                                                                                                      | INFO     |
|-----------------------------------------------|-------------|------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| Input capacitance                             | ci          | pF         | The capacitance between the input terminals with either input<br>grounded.                                                                                                                                                                                      | 11.3.7.1 |
| Input offset current                          | IIO         | µA         | The difference between the currents into the two input termi<br>nals with the output at the specified level.                                                                                                                                                    | 11.3.2   |
| Input offset voltage                          | VIO,<br>VOS | mV         | The dc voltage that must be applied between the input termi<br>nals to cancel dc offsets within the op amp.                                                                                                                                                     | 11.3.1   |
| Input offset voltage long<br>term drift       |             | V<br>month | The ratio of the change in input offset voltage to the change<br>time. It is the average value for the month.                                                                                                                                                   | 11.3.1   |
| Input resistance                              | ri          | MΩ         | The dc resistance between the input terminals with either<br>input grounded.                                                                                                                                                                                    | 11.3.7.1 |
| Input voltage range                           | VI          | V          | The range of input voltages that may be applied to either the<br>IN+ or IN– inputs                                                                                                                                                                              | 11.3.15  |
| Large-signal voltage amplifi<br>cation        | AV          | dB         | (see open loop voltage gain)                                                                                                                                                                                                                                    |          |
| Lead temperature for 10 or<br>60 seconds      |             | °C         | Usually specified as an absolute maximum. It is meant to be<br>used as guide for automated and hand soldering processes.                                                                                                                                        |          |
| Low-level output current                      | IOL         | mA         | The current into an output with input conditions applied that<br>according to the product parameter will establish a low level<br>at the output.                                                                                                                |          |
| Low-level output voltage                      | VOL         | V          | The smallest positive op amp output voltage for the bias con<br>ditions applied to the power pins.                                                                                                                                                              | 11.3.5   |
| Maximum peak output volt<br>age swing         | VOM±        | V          | The maximum peak-to-peak output voltage that can be ob<br>tained without clipping when the op amp is operated from a<br>bipolar supply.                                                                                                                         | 11.3.5   |
| Maximum peak-to-peak out<br>put voltage swing | VO(PP)      | V          | The maximum peak-to-peak voltage that can be obtained<br>without waveform clipping when the dc output voltage is zero.                                                                                                                                          |          |
| Maximum-output-swing<br>bandwidth             | BOM         | MHz        | The range of frequencies within which the maximum output<br>voltage swing is above a specified value or the maximum<br>frequency of an amplifier in which the output amplitude is at<br>the extents of it's linear range. Also called full power band<br>width. | 11.3.15  |
| Noise figure                                  | NF          | dB         | The ratio of the total noise power at the output of an amplifier,<br>referred to the input, to the noise power of the signal source.                                                                                                                            |          |
| Open-loop transimpedance                      | Zt          | MΩ         | In a transimpedance or current feedback amplifier, it is the<br>frequency dependent ratio of change in output voltage to the<br>frequency dependent change in current at the inverting input.                                                                   |          |
| Open-loop transresistance                     | Rt          | MΩ         | In a transimpedance or current feedback amplifier, it is the<br>ratio of change in dc output voltage to the change in dc cur<br>rent at the inverting input.                                                                                                    |          |
| Open -loop voltage gain                       | AOL         | dB         | The ratio of change in output voltage to the change in voltage<br>across the input terminals. Usually the dc value and a graph<br>showing the frequency dependence are shown in the data<br>sheet.                                                              |          |
| Operating temperature                         | TA          | °C         | Temperature over which the op amp may be operated. Some<br>of the other parameters may change with temperature, lead<br>ing to degraded operation at temperature extremes.                                                                                      |          |

| PARAMETER                                          | ABBV                                 | UNITS | DEFINITION                                                                                                                                                                                                                                         | INFO    |
|----------------------------------------------------|--------------------------------------|-------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| Output current                                     | IO                                   | mA    | The amount of current that is drawn from the op amp output.<br>Usually specified as an absolute maximum rating — not for<br>long term operation at the specified level.                                                                            |         |
| Output impedance                                   | Zo                                   | Ω     | The frequency dependent small-signal impedance that is<br>placed in series with an ideal amplifier and the output termi<br>nal.                                                                                                                    | 11.3.8  |
| Output resistance                                  | ro                                   | Ω     | The dc resistance that is placed in series with an ideal amplifi<br>er and the output terminal.                                                                                                                                                    |         |
| Overshoot factor                                   | –                                    | –     | The ratio of the largest deviation of the output voltage from its<br>final steady-state value to the absolute value of the step after<br>a step change at the output.                                                                              |         |
| Phase margin                                       | Φm                                   | °     | The absolute value of the open-loop phase shift at the fre<br>quency where the open-loop amplification first equals one.                                                                                                                           | 11.3.15 |
| Power supply rejection ratio                       | PSRR                                 | dB    | The absolute value of the ratio of the change in supply volt<br>ages to the change in input offset voltage. Typically both sup<br>ply voltages are varied symmetrically. Unless otherwise<br>noted, both supply voltages are varied symmetrically. | 11.3.10 |
| Rise time                                          | tr                                   | nS    | The time required for an output voltage step to change from<br>10% to 90% of its final value.                                                                                                                                                      |         |
| Settling time                                      | ts                                   | nS    | With a step change at the input, the time required for the out<br>put voltage to settle within the specified error band of the final<br>value. Also known as total response time, ttot.                                                            |         |
| Short-circuit output current                       | IOS                                  | mA    | The maximum continuous output current available from the<br>amplifier with the output shorted to ground, to either supply, or<br>to a specified point. Sometimes a low value series resistor is<br>specified.                                      |         |
| Slew rate                                          | SR                                   | V/µs  | The rate of change in the output voltage with respect to time<br>for a step change at the input.                                                                                                                                                   | 11.3.12 |
| Storage temperature                                | TS                                   | °C    | Temperature over which the op amp may be stored for long<br>periods of time without damage.                                                                                                                                                        |         |
| Supply current                                     | ICC/IDD                              | mA    | The current into the VCC+/VDD+ or VCC–/VDD– terminal of the<br>op amp while it is operating.                                                                                                                                                       |         |
| Supply current (shutdown)                          | ICC–/<br>IDD–<br>SHDN                | mA    | The current into the VCC+/VDD+ or VCC–/VDD– terminal of the<br>amplifier while it is turned off.                                                                                                                                                   |         |
| Supply rejection ratio                             | kSVR                                 | dB    | (see power supply rejection ratio)                                                                                                                                                                                                                 | 11.3.10 |
| Supply voltage sensitivity                         | kSVS,<br>∆VCC±,<br>∆VDD±,<br>or ∆VIO | dB    | The absolute value of the ratio of the change in input offset<br>voltage to the change in supply voltages.                                                                                                                                         | 11.3.10 |
| Supply voltage                                     | VCC/<br>VDD                          | V     | Bias voltage applied to the op amp power supply pin(s). Usu<br>ally specified as a ± value, referenced to network ground.                                                                                                                          |         |
| Temperature coefficient of<br>input offset current | αIIO                                 | µA/°C | The ratio of the change in input offset current to the change in<br>free-air temperature. This is an average value for the speci<br>fied temperature range.                                                                                        | 11.3.2  |

Understanding Op Amp Parameters 11-5

| PARAMETER                                          | ABBV         | UNITS | DEFINITION                                                                                                                                                  | INFO    |
|----------------------------------------------------|--------------|-------|-------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| Temperature coefficient of<br>input offset voltage | αVIO         | µV/°C | The ratio of the change in input offset voltage to the change in<br>free-air temperature. This is an average value for the speci<br>fied temperature range. | 11.3.1  |
| Total current into VCC+/<br>VDD+                   |              | mA    | Maximum current that can be supplied to the positive power<br>terminal of the op amp — usually specified as an absolute<br>maximum.                         |         |
| Total current out of VDD–                          |              | mA    | Maximum current that can be drawn from the negative power<br>terminal of the op amp — usually specified as an absolute<br>maximum.                          |         |
| Total harmonic distortion                          | THD          | dB    | The ratio of the RMS voltage of the first nine harmonics of the<br>fundamental signal to the total RMS voltage at the output.                               |         |
| Total harmonic distortion<br>plus noise            | THD+N        | dB    | The ratio of the RMS noise voltage and RMS harmonic volt<br>age of the fundamental signal to the total RMS voltage at the<br>output.                        | 11.3.14 |
| Total power dissipation                            | PD           | mW    | The total dc power supplied to the device less any power<br>delivered from the device to a load. Note: At no load: PD =<br>× I or PD = VDD+<br>× I<br>VCC+  |         |
| Turn-on voltage (shutdown)                         | VIH–<br>SHDN | V     | The voltage required on the shutdown pin to turn the device<br>on.                                                                                          |         |
| Turn-off voltage (shutdown)                        | VIL–<br>SHDN | V     | The voltage required on the shutdown pin to turn the device<br>off.                                                                                         |         |
| Turn-on time (shutdown)                            | tEN          | µs    | The time from when the turn-on voltage is applied to the shut<br>down pin to when the supply current has reached half of its<br>final value.                |         |
| Turn-off time (shutdown)                           | tDIS         | µs    | The time from when the turn-off voltage is applied to the shut<br>down pin to when the supply current has reached half of its<br>final value.               |         |
| Unity gain bandwidth                               | B1           | MHz   | The range of frequencies within which the open-loop voltage<br>amplification is greater that unity.                                                         | 11.3.15 |

Table 11–2. Cross-Reference of Op Amp Parameters

| ABBV            | PARAMETER                                       |
|-----------------|-------------------------------------------------|
| αIIO            | Temperature coefficient of input offset current |
| ∆VCC±/<br>∆VDD± | Supply voltage sensitivity                      |
| αVIO            | Temperature coefficient of input offset voltage |
| ∆VIO            | Supply voltage sensitivity                      |
| AD              | Differential gain error                         |
| Am              | Gain margin                                     |
| AOL             | Open loop voltage gain                          |
| AV              | Large-signal voltage amplification              |
| AVD             | Differential voltage amplification              |

| ABBV                  | PARAMETER                            |  |  |  |
|-----------------------|--------------------------------------|--|--|--|
| B1                    | Unity gain bandwidth                 |  |  |  |
| BOM                   | Maximum-output-swing bandwidth       |  |  |  |
| ci                    | Input capacitance                    |  |  |  |
| Cic                   | Common-mode input capacitance        |  |  |  |
| CMRR                  | Common-mode rejection ratio          |  |  |  |
| GBW                   | Gain bandwidth product               |  |  |  |
| ICC–SHDN/<br>IDD–SHDN | Supply current (shutdown)            |  |  |  |
| ICC/IDD               | Supply current                       |  |  |  |
| II                    | Input current                        |  |  |  |
| IIB                   | Input bias current                   |  |  |  |
| IIO                   | Input offset current                 |  |  |  |
| In                    | Input noise current                  |  |  |  |
| IO                    | Output current                       |  |  |  |
| IOL                   | Low-level output current             |  |  |  |
| IOS                   | Short-circuit output current         |  |  |  |
| kCMR                  | Common-mode rejection ratio          |  |  |  |
| kSVR                  | Supply rejection ratio               |  |  |  |
| kSVS                  | Supply voltage sensitivity           |  |  |  |
| NF                    | Noise figure                         |  |  |  |
| PD                    | Total power dissipation              |  |  |  |
| PSRR                  | Power supply rejection ratio         |  |  |  |
| ri                    | Input resistance                     |  |  |  |
| Rid                   | Differential input resistance        |  |  |  |
| Ro                    | Output resistance                    |  |  |  |
| Rt                    | Open-loop transresistance            |  |  |  |
| SR                    | Slew rate                            |  |  |  |
| TA                    | Operating temperature                |  |  |  |
| tDIS                  | Turn-off time (shutdown)             |  |  |  |
| tEN                   | Turn-on time (shutdown)              |  |  |  |
| THD                   | Total harmonic distortion            |  |  |  |
| tf                    | Fall time                            |  |  |  |
| THD+N                 | Total harmonic distortion plus noise |  |  |  |
| tr                    | Rise time                            |  |  |  |
| ts                    | Settling time                        |  |  |  |
| TS                    | Storage temperature                  |  |  |  |
| VCC/VDD               | Supply voltage                       |  |  |  |
| VI                    | Input voltage range                  |  |  |  |
| VIC                   | Common-mode input voltage            |  |  |  |
| VICR                  | Input common-mode voltage range      |  |  |  |

Understanding Op Amp Parameters 11-7

| ABBV        | PARAMETER                                 |
|-------------|-------------------------------------------|
| VID         | Differential input voltage                |
| VIHSHDN     | Turn-on voltage (shutdown)                |
| VIL–SHDN    | Turn-off voltage (shutdown)               |
| VIO,<br>VOS | Input offset voltage                      |
| Vn          | Input noise voltage                       |
| VO(PP)      | Maximum peak-to-peak output voltage swing |
| VOH         | High-level output voltage                 |
| VOL         | Low-level output voltage                  |
| VOM±        | Maximum peak output voltage swing         |
| XT          | Crosstalk                                 |
| Zic         | Common-mode input impedance               |
| Zo          | Output impedance                          |
| Zt          | Open-loop transimpedance                  |
| ΦD          | Differential phase error                  |
| Φm          | Phase margin                              |

# **11.3 Additional Parameter Information**

Depending on the application, some op amp parameters are more important than others. This section contains additional information for parameters that impact a broad range of designs.

# **11.3.1 Input Offset Voltage**

All op amps require a small voltage between their inverting and noninverting inputs to balance mismatches due to unavoidable process variations. The required voltage is known as the input offset voltage and is abbreviated VIO. VIO is normally modeled as a voltage source driving the noninverting input.

Figure 11–1 shows two typical methods for measuring input offset voltage — DUT stands for device under test. Test circuit (a) is simple, but since Vout is not at zero volts, it does not really meet the definition of the parameter. Test circuit (b) is referred to as a servo loop. The action of the loop is to maintain the output of the DUT at zero volts.

Bipolar input op amps typically offer better offset parameters than JFET or CMOS input op amps.

Here is the image describtion:
```
The image shows two different electronic circuits, labeled (a) and (b), each containing operational amplifiers (op-amps) and various resistors and capacitors. Both circuits are designed to test a Device Under Test (DUT), which is an op-amp in this context.

### Circuit (a):
1. **Configuration**: 
   - The circuit is a non-inverting amplifier configuration.
   - The non-inverting input (+) of the DUT is connected to a voltage divider formed by two 10-ohm resistors, which are connected between a voltage source and ground.
   - The inverting input (-) of the DUT is connected to the output through a 10 k-ohm feedback resistor.
   - The output of the DUT is labeled as Vout.

2. **Components**:
   - Two 10-ohm resistors forming a voltage divider.
   - One 10 k-ohm feedback resistor.
   - One operational amplifier (DUT).

### Circuit (b):
1. **Configuration**:
   - The circuit is a more complex configuration involving two stages of amplification.
   - The first stage is similar to circuit (a), with the non-inverting input (+) of the DUT connected to a voltage divider formed by two 10-ohm resistors.
   - The inverting input (-) of the DUT is connected to the output through a 10 k-ohm feedback resistor.
   - The output of the DUT is connected to a second stage through a 10 k-ohm resistor.
   - The second stage consists of another operational amplifier configured as a low-pass filter.
   - The low-pass filter is formed by a 1 k-ohm resistor and a 10 nF capacitor connected in series between the output of the second op-amp and ground.

2. **Components**:
   - Two 10-ohm resistors forming a voltage divider.
   - Two 10 k-ohm resistors (one for feedback in the first stage and one for input to the second stage).
   - One 1 k-ohm resistor and one 10 nF capacitor forming the low-pass filter.
   - Two operational amplifiers (DUT and the second op-amp).

3. **Output**:
   - The output of the second stage is labeled as Vout.
   - There is an additional note indicating that \( V_{IO} = \frac{V_{out}}{1000} \), suggesting that the output voltage Vout is scaled down by a factor of 1000 to obtain \( V_{IO} \).

### Summary:
- Circuit (a) is a simple non-inverting amplifier with a single op-amp (DUT).
- Circuit (b) is a two-stage amplifier with the first stage being similar to circuit (a) and the second stage being a low-pass filter.
- Both circuits use a voltage divider at the non-inverting input and feedback resistors to set the gain.
- Circuit (b) includes an additional scaling factor for the output voltage.
```

Figure 11–1.Test Circuits for Input Offset Voltage

TI data sheets show two other parameters related to VIO; the average temperature coefficient of input offset voltage, and the input offset voltage long-term drift.

The average temperature coefficient of input offset voltage, αVIO, specifies the expected input offset drift over temperature. Its units are µV/-C. VIO is measured at the temperature extremes of the part, and αVIO is computed as ∆VIO/∆-C.

Normal aging in semiconductors causes changes in the characteristics of devices. The input offset voltage long-term drift specifies how VIO is expected to change with time. Its units are µV/month.

VIO is normally attributed to the input differential pair in a voltage feedback amplifier. Different processes provide certain advantages. Bipolar input stages tend to have lower offset voltages than CMOS or JFET input stages.

Input offset voltage is of concern anytime that DC accuracy is required of the circuit. One way to null the offset is to use external null inputs on a single op amp package (Figure 11–2). A potentiometer is connected between the null inputs with the adjustable terminal connected to the negative supply through a series resistor. The input offset voltage is nulled by shorting the inputs and adjusting the potentiometer until the output is zero.

Here is the image describtion:
```
The image depicts a simplified schematic of an operational amplifier (op-amp) circuit with a current source. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangle with two input terminals and one output terminal.
   - The non-inverting input is labeled as "IN +" and is connected to the positive input terminal of the op-amp.
   - The inverting input is labeled as "IN -" and is connected to the negative input terminal of the op-amp.
   - The output terminal of the op-amp is labeled as "OUT".

2. **Transistors**:
   - There are two transistors, N1 and N2, connected to the output of the op-amp.
   - The base of transistor N1 is connected to the output of the op-amp.
   - The collector of transistor N1 is connected to the positive power supply (not shown in the image).
   - The emitter of transistor N1 is connected to the base of transistor N2.
   - The collector of transistor N2 is connected to the output terminal labeled "OUT".
   - The emitter of transistor N2 is connected to a current source.

3. **Current Source**:
   - The current source is represented by a symbol consisting of an arrow pointing upwards through a resistor.
   - The current source is connected between the emitter of transistor N2 and the negative power supply labeled "Vcc-".

In summary, the image shows an op-amp with its output driving a pair of transistors (N1 and N2) in a configuration that includes a current source connected to the negative power supply. The circuit likely functions as a current mirror or a similar current control mechanism, with the op-amp providing the necessary control to maintain the desired current through the transistors.
```

Figure 11–2.Offset Voltage Adjust

#### **11.3.2 Input Current**

The input circuitry of all op amps requires a certain amount of bias current for proper operation. The input bias current, IIB, is computed as the average of the two inputs:

$$\mathbb{I}\_{\mathsf{IB}} = \frac{\left(\mathbb{I}\_{\mathsf{N}} + \mathbb{I}\_{\mathsf{P}}\right)}{\mathsf{Z}} \tag{17-\mathsf{T}}$$

CMOS and JFET inputs offer much lower input current than standard bipolar inputs. Figure 11–3 shows a typical test circuit for measuring input bias currents.

The difference between the bias currents at the inverting and noninverting inputs is called the input offset current, IIO = IN–IP. Offset current is typically an order of magnitude less than bias current.

Here is the image describtion:
```
The image depicts a test circuit for measuring the input bias currents of an operational amplifier (op-amp), labeled as DUT (Device Under Test). The circuit includes two switches, S1 and S2, which can be closed to measure the input bias currents at the inverting and non-inverting terminals of the op-amp, respectively.

Here is a detailed description of the circuit components and their connections:

1. **Operational Amplifier (DUT)**: The op-amp has two input terminals, labeled as IN (inverting input) and IP (non-inverting input), and one output terminal labeled as Vout.

2. **Resistors and Capacitors**:
   - Two 10 MΩ resistors are connected to the input terminals of the op-amp.
   - Two 1 nF capacitors are connected in parallel with the 10 MΩ resistors.

3. **Switches (S1 and S2)**:
   - **S1**: When closed, it connects the 1 nF capacitor and 10 MΩ resistor network to the inverting input (IN) of the op-amp.
   - **S2**: When closed, it connects the 1 nF capacitor and 10 MΩ resistor network to the non-inverting input (IP) of the op-amp.

4. **Voltage Reference (Vref)**: A reference voltage (Vref) is connected to the non-inverting input network through the 10 MΩ resistor and 1 nF capacitor when S2 is closed.

5. **Output Voltage (Vout)**: The output of the op-amp is labeled as Vout.

6. **Equations**:
   - When S1 is closed, the input bias current at the non-inverting input (IP) is given by:
     \[
     I_P = \frac{Vout - Vref}{10^7}
     \]
   - When S2 is closed, the input bias current at the inverting input (IN) is given by:
     \[
     I_N = \frac{Vout - Vref}{10^7}
     \]

The circuit is designed to measure the input bias currents of the op-amp by closing either S1 or S2 and observing the resulting output voltage (Vout). The bias currents are calculated using the provided equations, which take into account the voltage difference between Vout and Vref, divided by the resistance (10 MΩ).
```

Here is the image describtion:
```
The image is a text label that reads "Figure 11–3. Test Circuit – I_B". This label likely refers to a specific figure in a technical document, such as a textbook or a research paper, which illustrates a test circuit used to measure or analyze the base current (I_B) in an electronic component, possibly a transistor. The figure number "11–3" suggests that it is the third figure in the eleventh chapter or section of the document.
```

Input bias current is of concern when the source impedance is high. If the op amp has high input bias current, it will load the source and a lower than expected voltage is seen. The best solution is to use an op amp with either CMOS or JFET input. The source impedance can also be lowered by using a buffer stage to drive the op amp that has high input bias current.

In the case of bipolar inputs, offset current can be nullified by matching the impedance seen at the inputs. In the case of CMOS or JFET inputs, the offset current is usually not an issue and matching the impedance is not necessary.

The average temperature coefficient of input offset current, αIIO, specifies the expected input offset drift over temperature. Its units are µA/°C. IIO is measured at the temperature extremes of the part, and αIIO is computed as ∆IIO/∆-C.

# **11.3.3 Input Common Mode Voltage Range**

The input common voltage is defined as the average voltage at the inverting and noninverting input pins. If the common mode voltage gets too high or too low, the inputs will shut down and proper operation ceases. The common mode input voltage range, VICR, specifies the range over which normal operation is guaranteed.

Different input structures allow for different input common-mode voltage ranges:

The LM324 and LM358 use bipolar PNP inputs that have their collectors connected to the negative power rail. This allows the common-mode input voltage range to include the negative power rail.

The TL07X and TLE207X type BiFET op amps use P-channel JFET inputs with the sources tied to the positive power rail via a bipolar current source. This allows the common-mode input voltage range to include the positive power rail.

TI LinCMOS op amps use P-channel CMOS inputs with the substrate tied to the positive power rail. This allows the common-mode input voltage range to include the negative power rail.

Rail-to-rail input op amps use complementary N- and P-type devices in the differential inputs. When the common-mode input voltage nears either rail, at least one of the differential inputs is still active, and the common-mode input voltage range includes both power rails.

The trends toward lower, and single supply voltages make VICR of increasing concern.

Rail-to-rail input is required when a noninverting unity gain amplifier is used and the input signal ranges between both power rails. An example of this is the input of an analog-to digital-converter in a low-voltage, single-supply system.

High-side sensing circuits require operation at the positive input rail.

# **11.3.4 Differential Input Voltage Range**

Differential input voltage range is normally specified as an absolute maximum. Exceeding the differential input voltage range can lead to breakdown and part failure.

Some devices have protection built into them, and the current into the input needs to be limited. Normally, differential input mode voltage limit is not a design issue.

# **11.3.5 Maximum Output Voltage Swing**

The maximum output voltage, VOM±, is defined as the maximum positive or negative peak output voltage that can be obtained without wave form clipping, when quiescent DC output voltage is zero. VOM<sup>±</sup> is limited by the output impedance of the amplifier, the saturation voltage of the output transistors, and the power supply voltages. This is shown pictorially in Figure 11–4.

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a waveform graph on the right.

### Circuit Diagram:
- **Power Supply:**
  - The circuit is powered by a dual power supply with +Vcc at the top and -Vcc at the bottom.
- **Components:**
  - **Current Source:** At the top left, there is a current source symbol.
  - **Transistors:** There are two NPN transistors, labeled Q1 and Q2.
    - Q1 is connected to the positive supply (+Vcc) through its collector.
    - Q2 is connected to the negative supply (-Vcc) through its collector.
  - **Diodes:** Two diodes, labeled D1 and D2, are connected in series.
    - D1 is connected to the base of Q1.
    - D2 is connected to the base of Q2.
  - **Resistors:** Two resistors, labeled R1 and R2.
    - R1 is connected between the emitter of Q1 and the output node (Vo).
    - R2 is connected between the output node (Vo) and the emitter of Q2.
- **Output Node (Vo):** The output voltage (Vo) is taken from the junction between R1 and R2.

### Waveform Graph:
- **Axes:**
  - The vertical axis represents voltage.
  - The horizontal axis represents time.
- **Waveform:**
  - The waveform is a sinusoidal signal centered around 0V.
  - The positive peak of the waveform is labeled as VOM+.
    - The voltage drop across R1 and the saturation voltage of Q1 (V_sat of Q1) determine the maximum positive output voltage (VOM+).
  - The negative peak of the waveform is labeled as VOM-.
    - The voltage drop across R2 and the saturation voltage of Q2 (V_sat of Q2) determine the maximum negative output voltage (VOM-).
- **Notes:**
  - It is noted that VOM+ and VOM- depend on the output load.
  - The voltage drops across R1 and R2, along with the saturation voltages of Q1 and Q2, are indicated as the factors limiting the output voltage peaks.

### Summary:
The circuit appears to be a push-pull amplifier configuration, where Q1 and Q2 are used to amplify the positive and negative halves of the input signal, respectively. The diodes D1 and D2 provide biasing for the transistors. The output voltage (Vo) is a sinusoidal waveform with its amplitude limited by the voltage drops across the resistors and the saturation voltages of the transistors.
```

Here is the image describtion:
```
The image is a snippet of text that reads "Figure 11–4. V_OM". The text appears to be a caption or label for a figure in a document, likely a technical or scientific paper. The "11–4" suggests that this is the fourth figure in the eleventh chapter or section of the document. The "V_OM" is likely a variable or parameter related to the figure, with the subscript "OM" indicating a specific notation or context within the document. The font is standard and the text is in black on a white background.
```

This emitter follower structure cannot drive the output voltage to either rail. Rail-to-rail output op amps use a common emitter (bipolar) or common source (CMOS) output stage. With these structures, the output voltage swing is only limited by the saturation voltage (bipolar) or the on resistance (CMOS) of the output transistors, and the load being driven.

Because newer products are focused on single supply operation, more recent data sheets from Texas Instruments use the terminology VOH and VOL to specify the maximum and minimum output voltage.

Maximum and minimum output voltage is usually a design issue when dynamic range is lost if the op amp cannot drive to the rails. This is the case in single supply systems where the op amp is used to drive the input of an A to D converter, which is configured for full scale input voltage between ground and the positive rail.

# **11.3.6 Large Signal Differential Voltage Amplification**

Large signal differential voltage amplification, AVD, is similar to the open loop gain of the amplifier except open loop is usually measured without any load. This parameter is usually measured with an output load. Figure 11–11 shows a typical graph of AVD vs. frequency.

AVD is a design issue when precise gain is required. The gain equation of a noninverting amplifier:

$$\mathsf{Gain} = \frac{\mathfrak{l}}{\mathfrak{\beta}} \times \frac{\mathfrak{l}}{\mathfrak{l} + \frac{\mathfrak{l}}{\mathfrak{A}\_{\mathsf{V}\mathfrak{D}}\mathfrak{\beta}}} \tag{11-2}$$

 is a feedback factor, determined by the feedback resistors. The term <sup>1</sup> AVD in the equation is an error term. As long as AVD is large in comparison with <sup>1</sup> , it will not greatly affect the gain of the circuit.

#### **11.3.7 Input Parasitic Elements**

Both inputs have parasitic impedance associated with them. Figure 11–5 shows a model of the resistance and capacitance between each input terminal and ground and between the two terminals. There is also parasitic inductance, but the effects are negligible at low frequency.

Input impedance is a design issue when the source impedance is high. The input loads the source.

Here is the image describtion:
```
The image depicts a simplified equivalent circuit model of an operational amplifier (op-amp). The op-amp is represented by a triangular symbol with two input terminals and internal components.

1. **Op-Amp Symbol**: The triangular symbol represents the operational amplifier. The left side of the triangle has two input terminals, and the right side typically represents the output, although the output is not shown in this specific diagram.

2. **Input Terminals**:
   - **Vn**: The inverting input terminal, marked with a minus sign (-).
   - **Vp**: The non-inverting input terminal, marked with a plus sign (+).

3. **Internal Components**:
   - **Cd**: A capacitor connected between the inverting input (Vn) and the non-inverting input (Vp).
   - **Rd**: A resistor connected in parallel with Cd, also between the inverting input (Vn) and the non-inverting input (Vp).
   - **Cn**: A capacitor connected between the inverting input (Vn) and ground.
   - **Rn**: A resistor connected in parallel with Cn, also between the inverting input (Vn) and ground.
   - **Cp**: A capacitor connected between the non-inverting input (Vp) and ground.
   - **Rp**: A resistor connected in parallel with Cp, also between the non-inverting input (Vp) and ground.

The internal components (Cd, Rd, Cn, Rn, Cp, Rp) represent the parasitic elements and the internal impedance characteristics of the op-amp. These elements are used to model the frequency response and stability of the op-amp in various applications.
```

Figure 11–5.Input Parasitic Elements

#### **11.3.7.1 Input Capacitance**

Input capacitance, Ci , is measured between the input terminals with either input grounded. Ci is usually a few pF. In Figure 11–5, if Vp is grounded, then Ci = Cd || Cn.

Sometimes common-mode input capacitance, Cic is specified. In Figure 11–5, if Vp is shorted to Vn, then Cic = Cp || Cn. Cic is the input capacitance a common mode source would see referenced to ground.

#### **11.3.7.2 Input Resistance**

Input resistance, ri is the resistance between the input terminals with either input grounded. In Figure 11–5, if Vp is grounded, then ri = Rd || Rn. ri ranges from 107 Ω to 1012 Ω, depending on the type of input.

Sometimes common-mode input resistance, ric, is specified. In Figure 11–5, if Vp is shorted to Vn, then ric = Rp || Rn. ric is the input resistance a common mode source would see referenced to ground.

#### **11.3.8 Output Impedance**

Different data sheets list the output impedance under two different conditions. Some data sheets list closed-loop output impedance while others list open-loop output impedance, both designated by Zo.

Zo is defined as the small signal impedance between the output terminal and ground. Data sheet values run from 50 Ω to 200 Ω.

Common emitter (bipolar) and common source (CMOS) output stages used in rail-to-rail output op amps have higher output impedance than emitter follower output stages.

Output impedance is a design issue when using rail-to-rail output op amps to drive heavy loads. If the load is mainly resistive, the output impedance will limit how close to the rails the output can go. If the load is capacitive, the extra phase shift will erode phase margin.

Figure 11–6 shows how output impedance affects the output signal assuming Zo is mostly resistive.

Here is the image describtion:
```
The image shows two different circuit configurations for a voltage amplifier with a resistive load and a capacitive load, respectively.

1. **Resistive Load Configuration:**
   - The circuit consists of a voltage amplifier represented by a diamond-shaped symbol labeled \( A_{VD} \).
   - The amplifier is connected to a resistor \( Z_O \) in series with the output.
   - The output voltage \( V_O \) is taken across a load resistor \( R_L \) which is connected to ground.
   - The output voltage \( V_O \) is given by the formula:
     \[
     V_O = A_{VD} \frac{R_L}{R_L + Z_O}
     \]

2. **Capacitive Load Configuration:**
   - Similar to the resistive load configuration, this circuit also has a voltage amplifier \( A_{VD} \) connected to a resistor \( Z_O \) in series with the output.
   - However, instead of a resistive load, the output is connected to a capacitive load \( C_L \) which is connected to ground.
   - The output voltage \( V_O \) in this case is given by the formula:
     \[
     V_O = \frac{1}{(jf/f_O) + 1}
     \]
   - Here, \( f_O \) is the cutoff frequency, defined as:
     \[
     f_O = \frac{1}{2\pi Z_O C_L}
     \]

The image effectively illustrates how the output voltage \( V_O \) is influenced by the type of load (resistive or capacitive) connected to the amplifier and provides the corresponding mathematical expressions for each configuration.
```

Figure 11–6.Effect of Output Impedance

Some new audio op amps are designed to drive the load of a speaker or headphone directly. They can be an economical method of obtaining very low output impedance.

## **11.3.9 Common-Mode Rejection Ratio**

Common-mode rejection ratio, CMRR, is defined as the ratio of the differential voltage amplification to the common-mode voltage amplification, ADIF/ACOM. Ideally this ratio would be infinite with common mode voltages being totally rejected.

The common-mode input voltage affects the bias point of the input differential pair. Because of the inherent mismatches in the input circuitry, changing the bias point changes the offset voltage, which, in turn, changes the output voltage. The real mechanism at work is ∆VOS/∆VCOM.

In a Texas Instruments data sheet, CMRR = ∆VCOM/∆VOS, which gives a positive number in dB. CMRR, as published in the data sheet, is a dc parameter. CMRR, when graphed vs. frequency, falls off as the frequency increases.

A common source of common-mode interference voltage is 50-Hz or 60-Hz ac noise. Care must be used to ensure that the CMRR of the op amp is not degraded by other circuit components. High values of resistance make the circuit vulnerable to common mode (and other) noise pick up. It is usually possible to scale resistors down and capacitors up to preserve circuit response.

#### **11.3.10 Supply Voltage Rejection Ratio**

Supply voltage rejection ratio, kSVR (AKA power supply rejection ratio, PSRR), is the ratio of power supply voltage change to output voltage change.

The power voltage affects the bias point of the input differential pair. Because of the inherent mismatches in the input circuitry, changing the bias point changes the offset voltage, which, in turn, changes the output voltage.

For a dual supply op amp, KSVR VCC VOS or KSVR VDD VOS . The term ∆VCC± means that the plus and minus power supplies are changed symmetrically. For a single supply op

$$\text{approx.}\,\mathsf{K}\_{\mathsf{SVR}} = \frac{\Delta\mathsf{V}\_{\mathsf{SC}}}{\Delta\mathsf{V}\_{\mathsf{OS}}} \text{ or } \,\mathsf{K}\_{\mathsf{SVR}} = \frac{\Delta\mathsf{V}\_{\mathsf{DD}}}{\Delta\mathsf{V}\_{\mathsf{OS}}}.$$

Also note that the mechanism that produces kSVR is the same as for CMRR. Therefore kSVR as published in the data sheet is a dc parameter like CMRR. When kSVR is graphed vs. frequency, it falls off as the frequency increases.

Switching power supplies produce noise frequencies from 50 kHz to 500 kHz and higher. kSVR is almost zero at these frequencies so that noise on the power supply results in noise on the output of the op amp. Proper bypassing techniques must be used (see Chapter 17) to control high-frequency noise on the power lines.

# **11.3.11 Supply Current**

Supply current, IDD, is the quiescent current draw of the op amp(s) with no load. In a Texas Instruments data sheet, this parameter is usually the total quiescent current draw for the whole package. There are exceptions, however, such as data sheets that cover single and multiple packaged op amps of the same type. In these cases, IDD is the quiescent current draw for each amplifier.

In op amps, power consumption is traded for noise and speed.

#### **11.3.12 Slew Rate at Unity Gain**

Slew rate, SR, is the rate of change in the output voltage caused by a step input. Its units are V/µs or V/ms. Figure 11–7 shows slew rate graphically. The primary factor controlling slew rate in most amps is an internal compensation capacitor CC, which is added to make the op amp unity gain stable. Referring to Figure 11–8, voltage change in the second stage is limited by the charging and discharging of the compensation capacitor CC. The maximum rate of change is when either side of the differential pair is conducting 2IE. Essentially SR = 2IE/CC. Remember, however, that not all op amps have compensation capacitors. In op amps without internal compensation capacitors, the slew rate is determined by internal op amp parasitic capacitances. Noncompensated op amps have greater bandwidth and slew rate, but the designer must ensure the stability of the circuit by other means.

In op amps, power consumption is traded for noise and speed. In order to increase slew rate, the bias currents within the op amp are increased.

Here is the image describtion:
```
The image consists of three main parts: a circuit diagram, a step input signal, and a graph illustrating the concept of slew rate.

1. **Circuit Diagram**:
   - The leftmost part of the image shows a simple operational amplifier (op-amp) circuit.
   - The op-amp has two input terminals: the inverting input (marked with a minus sign) and the non-inverting input (marked with a plus sign).
   - The non-inverting input is connected to an input voltage source labeled \( V_{IN} \).
   - The output of the op-amp is labeled \( V_O \).
   - There is a feedback loop from the output back to the inverting input, indicating a negative feedback configuration.
   - Below the op-amp, there is a formula: \( SR = dV/dt \), where \( SR \) stands for slew rate, \( dV \) is the change in voltage, and \( dt \) is the change in time.

2. **Step Input Signal**:
   - The middle part of the image shows a step input signal.
   - The signal is initially at a low level and then abruptly jumps to a higher level at \( t = 0 \).
   - This represents a sudden change in the input voltage, which is a common test signal used to evaluate the performance of an op-amp.

3. **Slew Rate Graph**:
   - The rightmost part of the image illustrates the concept of slew rate.
   - It shows a graph with time on the horizontal axis and voltage on the vertical axis.
   - At \( t = 0 \), the voltage starts to increase linearly.
   - The graph highlights two points: the initial voltage level and the final voltage level, with the difference between them labeled as \( dV \).
   - The time interval over which this change occurs is labeled \( dt \).
   - The slope of the line, which represents the rate of change of voltage with respect to time, is the slew rate (\( SR \)).

Overall, the image explains the concept of slew rate in the context of an operational amplifier, showing how the output voltage responds to a step input signal and how the rate of this response is quantified.
```

Figure 11–7.Figure 6. Slew Rate

Here is the image describtion:
```
The image depicts a schematic diagram of a three-stage operational amplifier (op-amp). The stages are labeled as Input Stage, Second Stage, and Output Stage. Here is a detailed description of each stage and its components:

### Input Stage:
1. **Transistors Q1 and Q2**: These are NPN transistors forming a differential pair. The input signals \( V_n \) and \( V_p \) are applied to the bases of Q1 and Q2, respectively.
2. **Transistor Q3**: This is an NPN transistor connected to the emitter of Q1.
3. **Transistor Q4**: This is an NPN transistor connected to the emitter of Q2.
4. **Current Source**: A current source is connected to the common node of the emitters of Q1 and Q2, providing bias current for the differential pair.

### Second Stage:
1. **Transistor Q5**: This is an NPN transistor that acts as a common-emitter amplifier. The collector of Q5 is connected to the output of the input stage, and the emitter is connected to the output stage.
2. **Capacitor \( C_c \)**: This is a compensation capacitor connected between the collector of Q5 and the output stage. It helps in stabilizing the amplifier and improving frequency response.

### Output Stage:
1. **Transistor Q6**: This is a PNP transistor connected to the positive supply voltage \( +V_{cc} \). The emitter of Q6 is connected to \( +V_{cc} \), and the collector is connected to the output \( V_o \).
2. **Transistor Q7**: This is an NPN transistor connected to the negative supply voltage \( -V_{cc} \). The emitter of Q7 is connected to \( -V_{cc} \), and the collector is connected to the output \( V_o \).
3. **Diodes D1 and D2**: These diodes are connected in series between the base of Q6 and the base of Q7. They provide biasing for the output transistors to ensure proper operation and reduce crossover distortion.
4. **Current Source**: Another current source is connected to the base of Q6, providing bias current for the output stage.

### Connections:
- The input signals \( V_n \) and \( V_p \) are applied to the bases of Q1 and Q2, respectively.
- The output \( V_o \) is taken from the common node of the collectors of Q6 and Q7.
- The positive supply voltage \( +V_{cc} \) and negative supply voltage \( -V_{cc} \) are connected to the respective points in the circuit.

Overall, the diagram represents a typical structure of an operational amplifier with differential input, intermediate gain stage, and push-pull output stage.
```

Figure 11–8.Figure 7. Simplified Op Amp Schematic

### **11.3.13 Equivalent Input Noise**

Noise is covered in more detail in Chapter 10.

All op amps have parasitic internal noise sources. Noise is measured at the output of an op amp, and referenced back to the input. Therefore, it is called equivalent input noise.

Equivalent input noise parameters are usually specified as voltage, Vn, (or current, In) per root Hertz. For audio frequency op amps, a graph is usually included to show the noise over the audio band.

### **11.3.13.1 Spot Noise**

The spectral density of noise in op amps has a pink and a white noise component. Pink noise is inversely proportional to frequency and is usually only significant at low frequencies. White noise is spectrally flat. Figure 11–9 shows a typical graph of op amp equivalent input noise.

Usually spot noise is specified at two frequencies. The first frequency is usually 10 Hz where the noise exhibits a 1/f spectral density. The second frequency is typically 1 kHz where the noise is spectrally flat. The units used are normally nVrms Hz (or pArms Hz for current noise). In Figure 11–9 the transition between 1/f and white is denoted as the corner frequency, fnc.

### **11.3.13.2 Broadband Noise**

A noise parameter like VN(PP), is the a peak to peak voltage over a specific frequency band, typically 0.1 Hz to 1 Hz, or 0.1 Hz to 10 Hz. The units of measurement are typically nV P–P.

Given the same structure within an op amp, increasing bias currents lowers noise (and increases SR, GBW, and power dissipation).

Also the resistance seen at the input to an op amp adds noise. Balancing the input resistance on the noninverting input to that seen at the inverting input, while helping with offsets due to input bias current, adds noise to the circuit.

Here is the image describtion:
```
The image is a log-log plot that illustrates the relationship between noise voltage and frequency. The x-axis represents the logarithm of frequency (Log Frequency), while the y-axis represents the logarithm of noise voltage (Log Noise Voltage).

The plot is divided into two distinct regions:

1. **1/f Noise Region**: On the left side of the plot, the noise voltage decreases with increasing frequency. This region is labeled "1/f Noise," indicating that the noise voltage is inversely proportional to the frequency. The slope of this region suggests a negative relationship between noise voltage and frequency.

2. **White Noise Region**: On the right side of the plot, the noise voltage remains constant regardless of the frequency. This region is labeled "White Noise," indicating that the noise voltage is independent of frequency.

The transition between the 1/f noise region and the white noise region occurs at a specific frequency, denoted as \( f_{nc} \). This frequency is marked by a vertical dashed line, indicating the point where the noise behavior changes from 1/f noise to white noise.

Overall, the plot shows how noise voltage varies with frequency, highlighting the different characteristics of 1/f noise and white noise.
```

Figure 11–9.Typical Op amp Input Noise Spectrum

# **11.3.14 Total Harmonic Distortion Plus Noise**

Total harmonic distortion plus noise, THD + N, compares the frequency content of the output signal to the frequency content of the input. Ideally, if the input signal is a pure sine wave, the output signal is a pure sine wave. Due to nonlinearity and noise sources within the op amp, the output is never pure.

THD + N is the ratio of all other frequency components to the fundamental and is usually specified as a percentage:

$$\begin{aligned} \text{\tiny THD} + \text{\tiny N} &= \left[ \frac{\text{(\tiny \Sigma \text{ \tiny \text{\tiny \text{\textbullet}monic} \text{\textbullet} \text{\textbullet} \text{\textbullet} \text{\textbullet} \text{\textbullet} \text{\textbullet})}{\text{F} \text{\textbullet} \text{\textbullet} \text{\textbullet} \text{\textbullet} \text{\textbullet}}} \right] \times \text{\textbullet} \text{\textbullet} \text{\textbullet} \end{aligned} $$

Figure 11–10 shows a hypothetical graph where THD + N = 1%. The fundamental is the same frequency as the input signal. Nonlinear behavior of the op amp results in harmonics of the fundamental being produced in the output. The noise in the output is mainly due to the input noise of the op amp. All the harmonics and noise added together make up 1% of the fundamental.

Two major reasons for distortion in an op amp are the limit on output voltage swing and slew rate. Typically an op amp must be operated at or below its recommended operating conditions to realize low THD.

Here is the image describtion:
```
The image is a graph that illustrates the relationship between output voltage (V_OUT) as a percentage and frequency. The x-axis represents frequency, starting from 0 and increasing in multiples of a fundamental frequency (f), labeled as f, 2f, 3f, 4f, 5f, and 6f. The y-axis represents the output voltage (V_OUT) in percentage, ranging from "Noise" at the bottom to 99% at the top.

Key elements of the graph include:

1. **Fundamental Frequency (f)**: This is the primary frequency component of the signal, shown at frequency f on the x-axis. It has the highest output voltage, reaching up to 99% on the y-axis.

2. **Harmonics**: These are integer multiples of the fundamental frequency. The graph shows harmonics at 2f, 3f, 4f, 5f, and 6f. Each harmonic has a lower output voltage compared to the fundamental frequency, with the voltage decreasing as the frequency increases.

3. **Noise**: At the very beginning of the x-axis (frequency 0), the output voltage is labeled as "Noise," indicating the presence of low-level noise in the signal.

4. **Arrows**: Arrows are used to point out the fundamental frequency and the harmonics, with the fundamental frequency being the highest peak and the harmonics decreasing in amplitude.

The graph visually represents how the output voltage of a signal is distributed across its fundamental frequency and its harmonics, with the fundamental frequency having the highest amplitude and the harmonics having progressively lower amplitudes.
```

Figure 11–10. Output Spectrum with THD + N = 1%

#### **11.3.15 Unity Gain Bandwidth and Phase Margin**

There are five parameters relating to the frequency characteristics of the op amp that are likely to be encountered in Texas Instruments data sheets. These are unity-gain bandwidth (B1), gain bandwidth product (GBW), phase margin at unity gain (φm), gain margin (Am), and maximum output-swing bandwidth (BOM).

Unity-gain bandwidth (B1) and gain bandwidth product (GBW) are very similar. B1 specifies the frequency at which AVD of the op amp is 1:

$$\mathsf{B}\_{\mathsf{I}} = \mathsf{(f)} \mathsf{A}\_{\mathsf{VD}} = \mathsf{T} \tag{\mathsf{M}-4}$$

GBW specifies the gain-bandwidth product of the op amp in an open loop configuration and the output loaded:

$$\mathsf{GBW} = \mathsf{A}\_{\mathsf{VD}} \times \mathsf{f} \tag{14-5}$$

GBW is constant for voltage-feedback amplifiers. It does not have much meaning for current-feedback amplifiers because there is not a linear relationship between gain and bandwidth.

Phase margin at unity gain (φm) is the difference between the amount of phase shift a signal experiences through the op amp at unity gain and 180-:

$$
\mathfrak{d}\mathfrak{g}\_{\mathfrak{m}} = \mathfrak{A}\mathfrak{B}\mathfrak{d}^{\circ} - \mathfrak{q}\mathfrak{B}\mathfrak{B}\mathfrak{A} \tag{\mathfrak{m}\mathfrak{f}-\mathfrak{G}} \tag{\mathfrak{m}\mathfrak{f}-\mathfrak{G}}
$$

Gain margin is the difference between unity gain and the gain at 180phase shift:

$$\mathsf{Gain\ margin} = \mathsf{4} - \mathsf{Gain\ @1\\$0}^{\circ}\mathsf{phase\ shift} \tag{14-7}$$

Maximum output-swing bandwidth (BOM) specifies the bandwidth over which the output is above a specified value:

$$\mathsf{B}\_{\mathsf{OM}} = \mathsf{f}\_{\mathsf{MAX},} \mathsf{with} \\ \mathsf{let} \\ \mathsf{V}\_{\mathsf{O}} > \mathsf{V}\_{\mathsf{MIN}} \\ \tag{14-8}$$

The limiting factor for BOM is slew rate. As the frequency gets higher and higher the output becomes slew rate limited and can not respond quickly enough to maintain the specified output voltage swing.

In order to make the op amp stable, capacitor, CC, is purposely fabricated on chip in the second stage (Figure 11–8). This type of frequency compensation is termed dominant pole compensation. The idea is to cause the open-loop gain of the op amp to roll off to unity before the output phase shifts by 180-. Remember that Figure 11–8 is very simplified, and there are other frequency shaping elements within a real op amp.

Figure 11–11 shows a typical gain vs. frequency plot for an internally compensated op amp as normally presented in a Texas Instruments data sheet.

As noted earlier, AVD falls off with frequency. AVD (and thus B1 or GBW) is a design issue when precise gain is required of a specific frequency band.

Phase margin (φm) and gain margin (Am) are different ways of specifying the stability of the circuit. Since rail-to-rail output op amps have higher output impedance, a significant phase shift is seen when driving capacitive loads. This extra phase shift erodes the phase margin, and for this reason most CMOS op amps with rail-to-rail outputs have limited ability to drive capacitive loads.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: the magnitude plot (top) and the phase plot (bottom).

1. **Magnitude Plot (Top):**
   - The vertical axis represents the gain in decibels (dB), labeled as \( A_{V(D)} \) - dB, ranging from 0 dB to 120 dB.
   - The horizontal axis represents the frequency in Hertz (Hz), ranging from 0.1 Hz to 10 MHz on a logarithmic scale.
   - The plot starts at 100 dB at low frequencies and decreases steadily, indicating a dominant pole at low frequencies.
   - The gain continues to decrease until it crosses 0 dB at a frequency labeled as \( B1 \).
   - The gain margin is indicated at the point where the gain crosses 0 dB.

2. **Phase Plot (Bottom):**
   - The vertical axis represents the phase in degrees, ranging from 0° to 225°.
   - The horizontal axis is the same as the magnitude plot, representing frequency in Hertz (Hz).
   - The phase starts at 0° at low frequencies, increases to around 45°, and then decreases steadily.
   - The phase crosses 90° and continues to decrease, reaching a minimum before increasing again.
   - The phase margin \( \phi_m \) is indicated at a specific frequency.

3. **Annotations:**
   - The dominant pole is marked on the magnitude plot at the point where the gain starts to decrease.
   - The gain margin is marked on the magnitude plot at the frequency where the gain crosses 0 dB.
   - The phase margin \( \phi_m \) is marked on the phase plot at a specific frequency.

Overall, the Bode plot provides a comprehensive view of the system's gain and phase response across a wide range of frequencies, highlighting key stability margins such as the gain margin and phase margin.
```

Figure 11–11.Voltage Amplification and Phase Shift vs. Frequency

# **11.3.16 Settling Time**

It takes a finite time for a signal to propagate through the internal circuitry of an op amp. Therefore, it takes a period of time for the output to react to a step change in the input. In addition, the output normally overshoots the target value, experiences damped oscillation, and settles to a final value. Settling time, ts, is the time required for the output voltage to settle to within a specified percentage of the final value given a step input.

Figure 11–12 shows this graphically:

Here is the image describtion:
```
The image is a graph that illustrates the response of a system over time, specifically focusing on the output voltage (V_OUT) as it approaches a final value. The x-axis represents time, while the y-axis represents the output voltage (V_OUT).

Key features and annotations on the graph include:

1. **Slew Rate**: This is the initial steep slope of the curve, indicating how quickly the output voltage rises from its initial value towards the final value.

2. **Overshoot**: This is the peak of the curve that exceeds the final value. It shows that the output voltage temporarily surpasses the desired final value before settling down.

3. **Damped Oscillation**: After the overshoot, the curve exhibits oscillations that gradually decrease in amplitude. These oscillations are damped, meaning they reduce over time until the output stabilizes.

4. **Settling Time**: This is the time it takes for the output voltage to settle within a specified tolerance range around the final value. It is marked from the start of the response to the point where the output remains within the tolerance range.

5. **Tolerance**: This is the acceptable range around the final value within which the output voltage is considered stable. It is indicated by two horizontal dashed lines above and below the final value.

6. **Final Value**: This is the desired steady-state value of the output voltage that the system aims to achieve.

The graph effectively demonstrates the dynamic behavior of the system's output as it responds to a change, highlighting important characteristics such as the speed of response (slew rate), the tendency to overshoot, the presence of oscillations, and the time required to achieve a stable output within a specified tolerance.
```

Figure 11–12. Settling Time

Settling time is a design issue in data acquisition circuits when signals are changing rapidly. An example is when using an op amp following a multiplexer to buffer the input to an A to D converter. Step changes can occur at the input to the op amp when the multiplexer changes channels. The output of the op amp must settle to within a certain tolerance before the A to D converter samples the signal.

# **Chapter 12**

# **Instrumentation: Sensors to A/D Converters**

#### Ron Mancini

# **12.1 Introduction**

The typical transducer measurement system block diagram is shown in Figure 12–1. The transducer is the electronic system's interface with the real world, and it issues data about a variable. The transducer converts the data into an electrical signal adequate for processing by the circuitry that follows the transducer. Bias and excitation circuitry does the care and feeding of the transducer, thus this circuitry provides offset voltages, bias currents, excitation signals, external components, and protection that is required for the transducer to operate properly. The output of the transducer is an electrical signal representing the measured variable.

Here is the image describtion:
```
The image is a block diagram representing a signal processing system. Here is a detailed description of each component and their connections:

1. **Input Variable**: This is the initial signal or variable that needs to be processed. It is shown entering the system from the left side of the diagram.

2. **Transducer**: The first block in the system, labeled "Transducer," converts the input variable into an electrical signal. The transducer is connected to the "Bias or Excitation Circuits" block, which provides the necessary power or excitation to the transducer.

3. **Bias or Excitation Circuits**: This block supplies the required biasing or excitation to the transducer to ensure it operates correctly. It is connected to the transducer and also receives power from the "Power Supply" block.

4. **Amplifier**: The electrical signal from the transducer is then fed into the "Amplifier" block. The amplifier increases the strength of the signal to a level suitable for further processing. The amplifier is also powered by the "Power Supply" block.

5. **Power Supply**: This block provides the necessary electrical power to the "Bias or Excitation Circuits," "Transducer," "Amplifier," and "ADC" blocks to ensure they function correctly.

6. **ADC (Analog-to-Digital Converter)**: The amplified signal is then sent to the "ADC" block, which converts the analog signal into a digital format. The ADC is also powered by the "Power Supply" block and receives "Digital Control" signals to manage its operation.

7. **Digital Control**: This input to the ADC block provides control signals to manage the conversion process.

8. **Digital Data Out**: The final output of the system is the digital data, which is shown exiting the ADC block on the right side of the diagram.

The diagram illustrates the flow of the signal from the input variable through various stages of processing, including conversion, amplification, and digitization, resulting in a digital output.
```

Figure 12–1. Block Diagram of a Transducer Measurement System

The variables that must be measured are determined by the customer's application, and the measured variable normally dictates the transducer selection. If the measured variable is temperature, then some sort of temperature sensing transducer must be employed, and the range of temperatures to be measured or the accuracy of the measurement is the primary factor influencing temperature transducer selection. Notice that the electrical output of the transducer is not a major concern at this point in the transducer selection. The transducer's electrical output is always a consideration, although picking the right transducer for the job is the primary goal. The correct transducer for the job can have an Ω/°C change, µV/°C change, or mV/°C change. All transducers have offset voltages or currents, and they can be referenced to ground, either power supply rail, or some other voltage. The selection of the transducer is out of circuit designer's hands; thus, the circuit designer must accept what the application demands.

The ADC selection is based on several system criteria such as resolution, conversion speed, power requirements, physical size, processor compatibility, and interface structure. The ADC must have enough bits to obtain the resolution required by the accuracy specification. The formula for calculating the resolution of an ADC is given in Equation 12–1 where n is the number of significant bits contained in the ADC.

$$\mathsf{RESSOLUTION} = \mathsf{Z}^{\mathsf{n}} \tag{\mathsf{M-}}$$

Some confusion exists about the word bits because the same word is used for binary bits and significant bits. Binary bits are ones and zeros used to calculate binary numbers; for example, a converter with 8 different digital states has 8 significant bits and 2n= 256 binary bits (see Figure 12–2). The voltage value of a single bit, called a least significant bit (LSB), is calculated in Equation 12–2.

Here is the image describtion:
```
The image depicts an 8-bit digital converter, which is a device that converts analog signals into digital signals using 8 bits. The digital code shown in the image is "10011110". 

- The code is represented as a binary number, consisting of 8 bits.
- The leftmost bit is labeled as "MSB," which stands for Most Significant Bit. In this case, the MSB is '1'.
- The rightmost bit is labeled as "LSB," which stands for Least Significant Bit. In this case, the LSB is '0'.
- The bits between the MSB and LSB are referred to as "Intermediate Bits." In this example, the intermediate bits are "001111".

The image is likely used to illustrate the structure of an 8-bit binary number and how each bit is categorized within the digital code.
```

**Number of Binary Bits = 2n = 28 = 256**

Figure 12–2. Significant Bits versus Binary Bits

$$\mathsf{LSSB} = \frac{\mathsf{FSV}}{\mathsf{Z}^n} \tag{12-2}$$

FSV is the full-scale voltage of the converter in volts; hence, a 12-bit converter FSV = 10 volts has an LSB equal to 10/212 = 2.441406 mV/bit. In an ADC, an LSB is the maximum voltage change required to for a one-bit output change, and in an ADC an LSB is defined as LSB = FSV/(2<sup>n</sup> – 1).

Conversion speed is not critical in temperature measurement applications because temperature changes occur at slow rates. Directional control in a rocket traveling at Mach 2 happens much faster than temperature changes, so conversion speed is an important factor in rocket applications. The speed of an ADC is generally thought of as the conversion time plus the time required between conversions, and conversion speed dictates the converter structure. When conversion speed is a primary specification a flash converter is used, and flash converters require low impedance driving circuits. This is an example of a converter imposing a specification requirement, low output impedance, on the driving amplifier.

The system definition specifies the voltages available for design and the maximum available current drain. Some systems have multiple voltages available, and others are limited to a single voltage. The available voltage impacts the converter selection. Size, processor compatibility, and interface structure are three more factors that must be considered when selecting the ADC. The available package that the converter comes in determines what footprint or size that the converter takes on the printed circuit board. Some applications preclude large power-hungry ADCs, so these applications are limited to recursive or Σ∆-type ADCs. The converter must be compatible with the processor to preclude the addition of glue logic; thus, the processor dictates the ADC's structure. This defines the interface structure, sometimes the ADC structure, and the ADC timing.

Notice that the amplifier designer has not been consulted during this decision process, but in actuality, the systems engineers do talk to the amplifier designers if only to pacify them. The selection of the ADC is out of circuit designer's hands; thus, the circuit designer must accept what the application demands.

There are many different transducer/ADC combinations, and each combination has a different requirement. Although they may be natural enemies, any transducer may be coupled with any ADC, thus the amplifier must make the coupling appear to be seamless. There is no reason to expect that the selected transducer's output voltage span matches the selected ADC's input voltage span, so an amplifier stage must match the transducer output voltage span to the ADC input voltage span. The amplifier stage amplifies the transducer output voltage span and shifts its dc level until the transducer output voltage span matches the ADC input voltage span. When the spans are matched, the transducer/ ADC combination achieve the ultimate accuracy; any other condition sacrifices accuracy and/or dynamic range.

The transducer output voltage span seldom equals the ADC input voltage span. Transducer data is lost and/or ADC dynamic range is not fully utilized when the spans are unequal, start at different dc voltages, or both. In Figure 12–3 (A), the spans are equal (3 V), but they are offset by 1 V. This situation requires level shifting to move the sensor output voltage up by one volt so the spans match. In Figure 12–3 (B), the spans are unequal (2 V and 4 V), but no offset voltage exists. This situation requires amplification of the sensor output to match the spans. When the spans are unequal (2 V versus 3 V) and offset (1 V), as is the case in Figure 12–3 (C), level shifting and amplification are required to match the spans.

Here is the image describtion:
```
The image consists of three diagrams labeled (A), (B), and (C). Each diagram illustrates the relationship between a sensor's output span and an Analog-to-Digital Converter (ADC) input span. Here is a detailed description of each diagram:

### Diagram (A):
- **Sensor Output Span**: The sensor's output voltage ranges from 0V to 3V.
- **ADC Input Span**: The ADC can accept input voltages ranging from 1V to 4V.
- **Observation**: There is a mismatch between the sensor output span and the ADC input span. The sensor's output starts at 0V, which is below the ADC's minimum input of 1V, and the sensor's maximum output of 3V is within the ADC's range but does not utilize the full span of the ADC.

### Diagram (B):
- **Sensor Output Span**: The sensor's output voltage ranges from 0V to 2V.
- **ADC Input Span**: The ADC can accept input voltages ranging from 0V to 4V.
- **Observation**: The sensor's output span is fully within the ADC's input span. However, the sensor only uses half of the ADC's input range, from 0V to 2V, leaving the upper half of the ADC's range (2V to 4V) unused.

### Diagram (C):
- **Sensor Output Span**: The sensor's output voltage ranges from 0V to 2V.
- **ADC Input Span**: The ADC can accept input voltages ranging from 1V to 4V.
- **Observation**: There is a partial mismatch between the sensor output span and the ADC input span. The sensor's output starts at 0V, which is below the ADC's minimum input of 1V, and the sensor's maximum output of 2V is within the ADC's range but does not utilize the full span of the ADC.

In summary, each diagram shows a different scenario of how the sensor's output voltage range aligns with the ADC's input voltage range, highlighting potential mismatches and underutilization of the ADC's input span.
```

Figure 12–3. Example of Spans That Require Correction

The output span of the transducer must be matched to the input span of the ADC to achieve optimum performance. When the spans are mismatched either the transducer output voltage does not fit into the ADC input span thus losing sensor data, or the transducer output voltage does not fill the ADC input span thus losing ADC accuracy. The latter situation requires an increase in ADC dynamic range (increased cost) because a higher bit converter must be used to achieve the same resolution. The best analog circuit available for matching the spans is the op amp because it level shifts and amplifies the input voltage to make the spans equal. The op amp is so versatile that it shifts the signal's dc level and amplifies the input signal simultaneously.

A similar but different problem exists in the digital to analog converter (DAC) to actuator interface. The DAC output voltage or current span must match the actuator input voltage span to achieve maximum performance. The procedure for matching the DAC output span to the actuator input span can be quite different from the procedure for matching the transducer output span to the ADC input span. Transducer outputs are usually low-level signals, thus care must be taken to preserve their signal to noise ratio. Actuator input signals may require significant power, thus robust op amps are required to drive some actuators.

The system specifications eventually determine the transducer, ADC, and analog circuit specifications. System specifications are seen as absolute specifications; they must be met for the design to function in a satisfactory manner. Component specifications are divided into several categories; absolute maximum ratings (AMR), guaranteed minimum/ maximum specifications (VMAX or VMIN), typical specifications (V), and guaranteed but not tested specifications (GNT).

If any of the device parameters are taken beyond the AMR, the device can be destroyed (expect destruction). The manufacturer guard bands the AMR to guarantee safety and quality, and you should guard band the AMRs, too. Typical specifications are the most appealing, but throw them out because they are meaningless in most cases. In the vast majority of cases the typical specifications are not related to meaningful data; rather, they are marketing dreams. Never design with typical specifications unless you are in the habit of designing with meaningless data or have a good reason for believing that typical is close to reality. A violation of this rule is a specification like output voltage swing that depends heavily on test conditions such as the value of the load resistor. When the load resistance is much higher than that specified for the test condition, the output voltage swing is closer to the typical rather than the guaranteed specification. The laws of physics guarantee this truth, but the amount of extra voltage swing that is achieved is hard to calculate.

Guaranteed min/max specifications define the limits of a parameter. The parameter will always exceed the minimum value, and it will never exceed the maximum value. The guaranteed min/max specifications are your design specifications. Guaranteed but not tested (GNT) specifications are usually applied to parameters that are very expensive to test. The manufacturer either tests some other parameter related to the specification or they sample test each lot to insure compliance. GNT specifications are design specifications. There is a fifth specification called guaranteed by design (GBD), and if they are not critical specifications, GBD is a useful design specification.

All specifications have conditions associated with testing. They specify ambient temperature, supply voltage, test signals, test loads, and other conditions, and they define how the measurements are made. Inspect the test conditions carefully; an op amp that specifies a 5-V output swing with a 50-Ω load is much more capable of driving a load than an op amp that specifies a 5-V output swing with a 10-kΩ load. Beware, you assume the risk of a parameter being out of specification when you use devices at conditions other than the test conditions.

An error budget is a logical and orderly method of tabulating errors, and it helps the designer keep track of the errors by error sources. Meeting the system specifications translates into minimizing errors, choosing components with acceptable errors, and canceling or eliminating errors when possible. The error budget is first applied to the ADC and transducer because they are the components that the designer has the least control over. When these two error budgets are combined and subtracted from the system error allowance the result is the error allowance for the amplifier and peripheral circuits. The designer must choose components and design wisely to stay within the error allowance, or the system specifications are not met.

Sometimes the systems specifications can't be met, and this fact is greeted with moans, name calling, and finger pointing. The error budgets are the design engineer's only defense against subjective accusations. The error budgets document the design trail, and they show where changes need to be made to do the best job possible. It is very hard to maintain an error budget because errors must be converted to equivalent units (volts, bits, or amps), and the impact of the error term may not be calculable at that point in the design. When this situation occurs, tabulate the error terms in a table and calculate their effect later in the design process.

This chapter teaches the designer how to characterize the transducer and ADC, how to determine amplifier and design specifications through the use of error budgets, and how to complete circuit design. The equations developed in this chapter are not nearly as important as the design philosophy.

# **12.2 Transducer Types**

This is not a treatise on transducers, but an appreciation for the many different types of transducers gives a feel for the extent and complexity of the transducer characterization problem (following section). The variety of electrical output that transducers offer loosely groups transducers. Various types of transducer outputs are resistive, optical, ac-excited, junction voltage, and magnetic, and each of these outputs must be converted to an electrical signal that can be amplified to fit the input span of an ADC. There are excellent references1 that deal with transducer characterization, but the transducer manufacturer should be your first source of reference material.

The transducer manufacturer publishes data similar to that contained in an IC data sheet, and they take the same liberties with typical specifications that the IC manufacturers do. Sort through the data to determine the meaning of the various specifications, and then pay special attention to the test conditions that prevailed when the data was gathered. Look for application notes that show transducer excitation, bias, or interface circuits. Search several manufacturers for similar information because nobody manages to cover every aspect of a design

Some transducers such as strain gages, thermistors, RTDs, and potentiometers sense a change in resistance (∆R). The ∆R sensing devices are used in at least three circuit configurations; the voltage divider, current excited, and Wheatstone bridge circuits shown in Figures 12–4, 12–5, and 12–6. The transducer resistance is RT, and the change in transducer resistance caused by a change in the measured variable is ∆R.

Here is the image describtion:
```
The image depicts a simple electrical circuit diagram. Here is a detailed description of the components and their connections:

1. **Voltage Source (V_REF)**: On the left side of the diagram, there is a voltage source labeled as V_REF. This is the reference voltage that powers the circuit.

2. **Resistor R1**: Connected in series with the voltage source V_REF is a resistor labeled R1. This resistor is positioned horizontally and is the first component connected to the positive terminal of the voltage source.

3. **Resistor RT**: Below R1, there is another resistor labeled RT. This resistor is connected in series with R1 and is oriented vertically. 

4. **ΔR**: There is a symbol ΔR next to RT, indicating a change in resistance or a variable resistor. This suggests that RT might be a thermistor or another type of sensor whose resistance changes with temperature or another variable.

5. **Ground**: The bottom end of RT is connected to the ground, which is the reference point for the circuit.

6. **Output Voltage (V_OUT)**: The junction between R1 and RT is connected to an output terminal labeled V_OUT. This is where the output voltage of the circuit is measured.

The circuit is a voltage divider, where the output voltage V_OUT is determined by the ratio of the resistances R1 and RT. The presence of ΔR indicates that the output voltage will vary based on the changes in the resistance of RT.
```

Here is the image describtion:
```
The image shows a caption that reads "Figure 12-4. Voltage Divider Circuit for a Resistive Transducer." This suggests that the figure is part of a larger document, likely a textbook or technical manual, and it is specifically illustrating a voltage divider circuit that is used with a resistive transducer. The caption indicates that the figure is the fourth one in chapter 12 of the document. The actual circuit diagram or image is not visible in the provided content, so no further details about the circuit itself can be described.
```

The voltage divider circuit uses a stable reference voltage to convert the transducer resistance into voltage, and its output voltage is given in Equation 12–3.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{V}\_{\mathsf{REF}} \frac{\Delta \mathsf{R} + \mathsf{R}\_{\mathsf{T}}}{\Delta \mathsf{R} + \mathsf{R}\_{\mathsf{T}} + \mathsf{R}\_{\mathsf{T}}} \tag{12-3}$$

If R1 is comparable in value with RT, the circuit has very low sensitivity because the circuit must measure a small change in resistance in the presence of a large resistance. When the bias resistor, R1, is selected as a large value, VREF and R1 act as a current source, and the transducer resistance can be neglected in the calculations thus yielding Equation 12–4. When R1 >> (RT + ∆R) Equation 12–3 reduces to Equation 12–4.

$$\mathcal{N}\_{\mathsf{OUT}} = \frac{\mathsf{V}\_{\mathsf{REF}}}{\mathsf{R}\_{\mathsf{T}}} \left(\mathsf{AR} + \mathsf{R}\_{\mathsf{T}}\right) \tag{12-4}$$

Equation 12–5 is the equivalent of Equation 12–4, and it is obtained by exciting the transducer with a bias current as shown in Figure 12–5. The bias current can be made very accurate by employing op amps in a current source configuration as shown in Figure 12–6, thus the approximation R1 >> (RT + ∆R) need not enter the calculations.

Here is the image describtion:
```
The image depicts an electrical circuit diagram. Here is a detailed description of the components and their connections:

1. **Current Source (I)**: On the left side of the diagram, there is a symbol representing a current source. This is indicated by a circle with a triangle inside it, pointing upwards. The current source is providing a constant current, denoted by the symbol "I".

2. **Resistor R1**: Connected in series with the current source is a resistor labeled "R1". This resistor is positioned horizontally to the right of the current source.

3. **Node**: The point where the resistor R1 connects to the next components is a node, represented by a black dot.

4. **Resistor ΔR**: From the node, there is a vertical resistor labeled "ΔR". This resistor is connected in series with another resistor below it.

5. **Resistor RT**: Below the resistor ΔR, there is another resistor labeled "RT". This resistor is also oriented vertically and is connected to the ground.

6. **Ground**: The bottom end of the resistor RT is connected to the ground, which is represented by the standard ground symbol (a set of horizontal lines that get progressively shorter).

7. **Output Voltage (Vout)**: The node where R1 and ΔR meet is also connected to an output terminal labeled "Vout". This terminal is positioned to the right of the node and is open-ended, indicating that it is the point where the output voltage is measured.

In summary, the circuit consists of a current source in series with a resistor R1, which then connects to a node. From this node, there are two resistors in series (ΔR and RT) that connect to the ground. The output voltage Vout is taken from the node between R1 and ΔR.
```

Figure 12–5. Current Source Excitation for a Resistive Transducer

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp), a transistor, and several resistors. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp has two input terminals: the inverting input (-) and the non-inverting input (+).
   - The non-inverting input (+) is connected to the input voltage source labeled \( V_{IN} \).

2. **Resistor \( R_2 \)**:
   - One end of resistor \( R_2 \) is connected to the output of the op-amp.
   - The other end of \( R_2 \) is connected to the base of an NPN transistor.

3. **NPN Transistor**:
   - The base of the transistor is connected to the junction between the op-amp output and resistor \( R_2 \).
   - The collector of the transistor is connected to a resistor \( R \) which is in turn connected to the positive supply voltage \( V_{CC} \).
   - The emitter of the transistor is connected to a variable resistor \( R_T + \Delta R \), which is grounded.

4. **Resistor \( R \)**:
   - One end of resistor \( R \) is connected to the positive supply voltage \( V_{CC} \).
   - The other end of \( R \) is connected to the collector of the transistor.

5. **Variable Resistor \( R_T + \Delta R \)**:
   - This resistor is connected between the emitter of the transistor and ground.

6. **Current Equation**:
   - The current \( I \) flowing through the circuit is given by the equation:
     \[
     I = \frac{V_{CC} - V_{IN}}{R}
     \]

In summary, the circuit is a feedback configuration where the op-amp controls the base current of the transistor, which in turn regulates the current through the variable resistor \( R_T + \Delta R \). The current \( I \) is determined by the difference between the supply voltage \( V_{CC} \) and the input voltage \( V_{IN} \), divided by the resistor \( R \).
```

Here is the image describtion:
```
The image is a caption that reads "Figure 12-6. Precision Current Source." This suggests that it is part of a larger document, likely a textbook or technical manual, and refers to a specific figure within Chapter 12. The figure itself is not shown in the image, but based on the caption, it can be inferred that the figure illustrates a precision current source, which is an electronic circuit designed to provide a constant current regardless of the voltage across it or the load it is driving.
```

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{I}\left(\Delta \mathsf{R} + \mathsf{R}\_{\mathsf{T}}\right) \tag{72-5}$$

The Wheatstone bridge shown in Figure 12–7 is a precision device used to measure small changes in resistance. One leg of the bridge is made up of a voltage divider consisting of equal stable resistors (R1 and R2) and the reference voltage. When RX and ∆R equal zero, RTX is selected equal to RT. As the transducer resistance changes ∆R assumes some value, and RX is switched until the bridge output voltage nulls to zero. At this point the value of ∆R is read from the RX dial. Bridge circuits are used to convert resistive transducer values to dial readings, but there are methods of using transducers in bridge circuits that yield a voltage change proportional to the resistance change. The bridge circuit has a high output impedance, thus op amps configured in an instrumentation configuration (both inputs are equal high resistances) must be used to amplify the output voltage from bridge circuits.

Here is the image describtion:
```
The image depicts a Wheatstone bridge circuit, which is commonly used to measure unknown electrical resistances. The circuit consists of four resistors arranged in a diamond shape with a voltage source connected across the bridge.

Here are the detailed components and connections in the circuit:

1. **Voltage Source (V_REF)**: This is the reference voltage applied across the Wheatstone bridge. It is connected between the top left and bottom left nodes of the bridge.

2. **Resistors**:
   - **R_TX**: This resistor is located on the left side of the bridge, between the top left and top nodes.
   - **R_X**: This is the unknown resistor that we aim to measure. It is located on the top side of the bridge, between the top and top right nodes.
   - **R_1**: This resistor is located on the right side of the bridge, between the top right and bottom right nodes.
   - **R_2**: This resistor is located on the bottom side of the bridge, between the bottom right and bottom nodes.
   - **R_T**: This resistor is located on the bottom left side of the bridge, between the bottom left and bottom nodes.
   - **ΔR**: This represents a small change in resistance, typically associated with R_T, indicating a variable or sensor element.

3. **Output Voltage (V_OUT)**: The output voltage is measured between the top right and bottom right nodes of the bridge. This voltage is used to determine the balance of the bridge and, consequently, the value of the unknown resistor R_X.

4. **Ground Connection**: The bottom node of the bridge is connected to the ground.

The Wheatstone bridge operates by adjusting the resistances such that the voltage difference between the two midpoints (top right and bottom right nodes) is zero when the bridge is balanced. When the bridge is unbalanced, the output voltage (V_OUT) is used to calculate the unknown resistance (R_X) based on the known values of the other resistors and the reference voltage (V_REF).
```

Figure 12–7. Wheatstone Bridge Circuit

The three most popular optical transducers are the photoconductive cell, the photodiode and the photovoltaic cell. The photoconductive cell acts like a light sensitive resistor, thus one of the circuits shown in Figures 12–4, 12–5, or 12–7 that convert resistance changes to voltage is used in photoconductive cell applications. The photodiode is a very fast diode with a small output current, and the circuit shown in Figure 12–8 is used to convert current to voltage. The photodiode is reversed biased with a constant voltage, so the photodiode terminating voltage stays constant thus maintaining linearity. The photodiode amplifier output voltage equation is Equation 12–6.

Here is the image describtion:
```
The image depicts a photodiode amplifier circuit, which is commonly used to convert light into an electrical signal. Here is a detailed description of the components and their connections:

1. **Photodiode**: The photodiode is the primary sensor in this circuit. It is represented by a diode symbol with arrows pointing towards it, indicating that it is sensitive to light (photons). When light (denoted by λ) hits the photodiode, it generates a photocurrent (ID).

2. **Operational Amplifier (Op-Amp)**: The circuit includes an operational amplifier, which is represented by a triangle with two inputs and one output. The non-inverting input (+) of the op-amp is connected to the ground, while the inverting input (-) is connected to the photodiode and a feedback resistor (RF).

3. **Feedback Resistor (RF)**: A resistor (RF) is connected between the output of the op-amp (VOUT) and the inverting input (-). This resistor is crucial for setting the gain of the amplifier and converting the photocurrent (ID) into a voltage.

4. **Reference Voltage (VREF)**: The anode of the photodiode is connected to a reference voltage (VREF), which is typically ground in this configuration. This ensures that the photodiode operates in reverse bias, which is necessary for it to function correctly as a light sensor.

5. **Output Voltage (VOUT)**: The output of the op-amp (VOUT) provides a voltage that is proportional to the photocurrent generated by the photodiode. This output voltage can be used for further processing or measurement.

In summary, the photodiode detects light and generates a current (ID) proportional to the intensity of the light. This current flows through the feedback resistor (RF), and the op-amp amplifies the signal, producing an output voltage (VOUT) that is proportional to the light intensity. The reference voltage (VREF) ensures proper biasing of the photodiode.
```

Figure 12–8. Photodiode Amplifier

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\_{\mathsf{D}} \mathsf{R}\_{\mathsf{F}} \tag{72-6}$$

The phototransistor has a junction that is light sensitive, and the junction has a transparent cover so that it can sense ambient light. The collector-base junction of the transistor is reverse biased, and normal transistor action takes place with the ambient light induced base current taking place of the normal base current (see Figure 12–9).

Here is the image describtion:
```
The image depicts a simple circuit diagram featuring a phototransistor. Here is a detailed description of the components and their connections:

1. **Phototransistor**: The main component in the circuit is a phototransistor, which is a type of transistor that is controlled by light. It has three terminals: the collector, the emitter, and the base. In this diagram, the base is not explicitly shown because it is controlled by light (indicated by the arrows pointing towards the phototransistor).

2. **Light Source (λ)**: The arrows pointing towards the phototransistor represent incident light (denoted by the symbol λ). This light activates the phototransistor.

3. **Collector (C)**: The collector of the phototransistor is connected to a resistor (R).

4. **Resistor (R)**: The resistor is connected between the collector of the phototransistor and the positive supply voltage (Vcc).

5. **Vcc**: This is the positive supply voltage connected to the other end of the resistor.

6. **Emitter (E)**: The emitter of the phototransistor is connected to the ground (GND).

7. **Output Voltage (Vout)**: The output voltage (Vout) is taken from the junction between the resistor (R) and the collector of the phototransistor.

In operation, when light falls on the phototransistor, it allows current to flow from the collector to the emitter. This current flow causes a voltage drop across the resistor (R), which can be measured as the output voltage (Vout). The intensity of the light affects the amount of current flowing through the phototransistor, thereby modulating the output voltage (Vout).
```

Figure 12–9. Phototransistor Amplifier

The photovoltaic or solar cell circuit is shown in Figure 12–10. The circuit zero-biases the cell for minimum leakage current, and the cell's output current is a linear function of the area exposed to light. When the photovoltaic cell is properly masked and evenly flooded with light, it operates as a linear distance transducer (see Figure 12–10 and Equation 12–6).

Here is the image describtion:
```
The image depicts a photodiode amplifier circuit, which is commonly used to convert light into an electrical signal. Here is a detailed description of the components and their connections:

1. **Photodiode**: The circuit includes a photodiode, which is represented by a diode symbol with arrows pointing towards it, indicating that it is sensitive to light (denoted by the symbol λ). The photodiode is oriented with its anode connected to ground and its cathode connected to the inverting input of an operational amplifier (op-amp).

2. **Operational Amplifier (Op-Amp)**: The op-amp is depicted with the standard triangular symbol. The inverting input (marked with a minus sign) is connected to the cathode of the photodiode. The non-inverting input (marked with a plus sign) is connected to ground.

3. **Feedback Resistor (RF)**: There is a resistor labeled RF connected between the output of the op-amp and the inverting input. This resistor provides negative feedback, which is essential for the operation of the amplifier.

4. **Output Voltage (VOUT)**: The output of the op-amp is labeled VOUT, which represents the amplified voltage signal that corresponds to the current generated by the photodiode when it is exposed to light.

5. **Photocurrent (ID)**: The current generated by the photodiode due to incident light is labeled ID. This current flows from the cathode of the photodiode through the feedback resistor RF to the output of the op-amp.

In summary, the circuit is a transimpedance amplifier where the photodiode converts light into a current (ID), and the op-amp with the feedback resistor RF converts this current into a proportional output voltage (VOUT). The configuration ensures that the output voltage is directly related to the intensity of the incident light on the photodiode.
```

Figure 12–10. Photovoltaic Cell Amplifier

AC-excited transducers are usually used to make motion and/or distance sensors. In one type of ac-excited transducer, a stationary winding is excited with an ac current, and another winding is moved past the stationary winding inducing a voltage in the second winding. In a well-designed transducer, the induced voltage is proportional to distance, hence the output voltage is proportional to distance. Another ac-excited transducer uses two plates; one plate is excited with an ac current, and the other plate is ground. An object coming near the excited plate changes the capacitance between the plates, and the result is an output voltage change.

Resolvers and synchros are position transducers that indicate position as a function of the phase angle between the exciting signal and the output signal. Resolvers and synchros normally are multiple-winding devices excited from two or more sources. They indicate position very accurately, but their special circuitry requirements, cost, and weight limit them to a few applications such as airfoil control surfaces and gyros.

AC-excited transducers require a rectifier circuit to make the output voltage unipolar prior to integration. Coarse transducers use a diode or diode bridge to rectify the output voltage, but diodes are not adequate for precision applications because their forward voltage drop is temperature sensitive and poorly regulated. The diode problems are overcome through the use of feedback in the active full wave rectifier circuit shown in Figure 12–11. An integrating capacitor, C, is added to the circuit so the output voltage is a dc voltage proportional to the average voltage value of the input voltage.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring operational amplifiers, resistors, diodes, and a capacitor. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage labeled as V_IN.

2. **Resistors**: 
   - The input voltage V_IN is connected to a series of resistors. The first resistor is labeled R.
   - After the first resistor, the circuit splits into two paths:
     - One path continues through another resistor labeled R.
     - The other path goes through a diode labeled D2, which is connected to the inverting input of an operational amplifier (op-amp).

3. **Diodes**:
   - Diode D2 is oriented with its anode connected to the resistor R and its cathode connected to the inverting input of the op-amp.
   - Another diode, D1, is connected in series with D2, with its anode connected to the cathode of D2 and its cathode connected to another resistor R.

4. **Operational Amplifiers**:
   - The first op-amp has its non-inverting input connected to the ground.
   - The second op-amp has its non-inverting input also connected to the ground.

5. **Capacitor**:
   - A capacitor labeled C is connected in parallel with the second op-amp's feedback loop.

6. **Output Voltage (V_OUT)**:
   - The output of the second op-amp is labeled as V_OUT.

7. **Additional Resistors**:
   - There is a resistor labeled R/2 connected in series with the output of the first op-amp and the input of the second op-amp.
   - Another resistor labeled R is connected in series with the capacitor C and the input of the second op-amp.

The circuit appears to be a precision rectifier or peak detector, utilizing the diodes and op-amps to process the input signal and produce a rectified or peak-detected output at V_OUT. The exact function would depend on the specific configuration and values of the components used.
```

Figure 12–11. Active Full-Wave Rectifier and Filter

Semiconductor or wire junctions (thermocouples) are often used as temperature transducers because there is a linear relationship between temperature and output voltage over a restricted temperature range. Thermocouples have small voltages varying from µV/°C to mV/°C, and they normally are configured with thermistors and zeroing resistors in the output circuit. Thermocouples have small output voltages and high output resistance, thus a special op amp called an instrumentation amplifier is required for thermocouple amplification. An instrumentation amplifier has very high and equal input impedances, thus they don't load the input signal source.

Semiconductor junctions have a nominal temperature coefficient (TC) of –2 mV/°C. The TC is linear, but it varies from diode to diode because of manufacturing techniques, semiconductor materials, and bias currents. In a well-controlled application where thermal mass is insignificant, semiconductor junctions make excellent temperature transducers. The junction effect is so stable and linear that commercial temperature transducers have become available in a single IC.

Magnetic fields can be sensed by the Hall effect, and special semiconductors called Halleffect sensors have been developed to sense magnetic fields. Current is passed through the semiconductor in a direction perpendicular to the magnetic field. A pair of voltage pick off leads is placed perpendicular to the direction of current flow, and the output voltage is proportional to the magnetic field strength. The manufacturing process for Hall effect transducers is a standard semiconductor manufacturing process, so Hall effect transducers are offered for sale as transistors or ICs.

# **12.3 Design Procedure**

A step-by-step design procedure that results in the proper op amp selection and circuit design is given below. This design procedure works best when the op amp has almost ideal performance, thus the ideal op amp equations are applicable. When nonideal op amps are used, parameters like input current affect the design, and they must be accounted for in the design process. The latest generation of rail-to-rail op amps makes the ideal op amp assumption more valid than it ever was.

No design procedure can anticipate all possible situations, and depending on the op amp selected, procedure modifications may have to be made to account for op amp bias current, input offset voltage, or other parameters. This design procedure assumes that system requirements have determined the transducer and ADC selection and that changing these selections adversely impacts the project.

- 1) Review the system specifications to obtain specifications for noise, power, current drain, frequency response, accuracy, and other variables that might affect the design.
- 2) Characterize the reference voltage including initial tolerances and drift.
- 3) Characterize the transducer to determine its salient parameters including output voltage swing, output impedance, dc offset voltage, output voltage drift, and power requirements. These parameters determine the op amp's required input voltage range (VIN1 to VIN2), and input impedance requirements. The offset voltage and voltage drift are tabulated as errors. At this point it is assumed that the selected op amp's input voltage span is greater than the transducer's output voltage excursion. Design peripheral circuits if required.
- 4) Scrutinize the ADC's specification sheet to determine it's required input voltage range because this range eventually sets the op amp's output voltage swing requirement (VOUT1 to VOUT2). Determine the ADC's input resistance, input capacitance, resolution, accuracy, full-scale range, and allowable input circuit charge time. Calculate the LSB value.
- 5) Create an error budget (in bits) for the transducer and ADC. Use the transducer/ ADC error budget to determine the value and range of the critical op amp parameters. Select an op amp, and justify the selection by creating an error budget for the op amp circuit.
- 6) Scan the transducer and ADC specifications, and make a set of analog interface amplifier (AIA) specifications
- 7) Complete the AIA circuit design.
- 8) Build the circuit, and test it.

# **12.4 Review of the System Specifications**

The power supply has only one voltage available, and that voltage is 5V ± 5% = 5 V ± 250 mV. The power supply is connected with the negative terminal at ground and the positive terminal at VCC. This is not a portable application, thus the allowed current drain, 50 mA, is adequate for the job. No noise specifications are given, but the proposed power, ground, and signal traces are being done on high-quality circuit board material with planes and good size copper. A system of this quality should experience no more than 50 mV of noise on the logic power lines and 10 mV of noise on the analog power lines.

This is a temperature measuring system that requires updates every 10 seconds. Clearly, ADC conversion speed or input charging rate is not cause for consideration. The low conversion speed translates into lower logic speed, and slow logic means less noise generated. The temperature transducer is located at the end of a three-foot long cable, so expect some noise picked up by the cable to be introduced into the circuit. Fortunately, the long time between ADC conversions enable extensive filtering to reduce the cable noise.

The system accuracy required is 11 bits. The application measures several parameters so it is multiplexed, and a TLV2544 12 bits resolution ADC has been selected. The temperature transducer is a diode, and the temperature span to be measured is –25°C to 100°C. The ambient temperature of the electronics package is held between 15°C to 35°C.

# **12.5 Reference Voltage Characterization**

A reference voltage is required to bias the transducer and act as a reference voltage for the analog interface amplifier (AIA). Selecting a reference with a total accuracy better than the accuracy specification (11 bits) does not guarantee meeting the system accuracy specification because other error sources exist in the design. Resistor tolerances, amplifier tolerances, and transducer tolerances all contribute to the inaccuracy, and the reference can't diminish these errors. The quandary here is a choice between an expensive reference and expensive accurate components, or an adjustment to null out initial errors. This quandary boils down to which is the lesser of two evils; expensive components or the expense of an adjustment.

System engineering has decided that they want the adjustment, so the reference does not have to have 11-bit accuracy. A TL431A voltage reference is chosen for the design. The output voltage specification at 25°C and 10-mA bias current is 2495 mV ± 25 mV. This reference has a temperature drift of 25 mV over 70°C, and this translates to 7.14 mV drift over a 20°C temperature range. There is another drift caused by the cathode voltage change, and this drift is 2.7 mV/V. The supply voltage regulation is 0.5 V, but much of this tolerance is consumed by the initial tolerance and wiring scheme, so the less than 0.1 V is due to regulator drift. The total drift is 7.14 mV + 0.27 mV = 7.41 mV. This yields a total drift of 0.3% maximum. The amplifier usually uses a fraction of the reference voltage, so the final AIA will not drift the full 0.3%.

# **12.6 Transducer Characterization**

The temperature transducer is a special silicon diode that is characterized for temperature measurement work. When this diode is forward biased at 2.0 mA ± 0.1 mA its forward voltage drop is 0.55 V ± 50 mV, and its temperature coefficient is –2 mV/°C. The wide acceptable variation in bias current makes this an easy device to work with. The circuit for the bias calculations is shown in Figure 12–12.

Here is the image describtion:
```
The image depicts a simple electronic circuit involving a Zener diode and a regular diode. Here is a detailed description of the circuit:

1. **Power Supply**: The circuit is powered by a +5V DC supply connected at the top left of the diagram.

2. **Resistors**: There are two resistors in the circuit:
   - **RB1**: This resistor is connected in series with the Zener diode. It is connected between the +5V supply and the anode of the Zener diode.
   - **RB2**: This resistor is connected between the cathode of the Zener diode and the anode of the regular diode (D1). It is also connected to the output voltage point (VOUT).

3. **Zener Diode**: The Zener diode is oriented with its cathode connected to the junction between RB1 and RB2, and its anode connected to ground. The Zener diode is used to maintain a stable reference voltage (VZ) across it. The current through the Zener diode is labeled as IREF.

4. **Regular Diode (D1)**: The regular diode is oriented with its anode connected to the junction between RB2 and the cathode of the Zener diode, and its cathode connected to ground. The current through this diode is labeled as ID.

5. **Output Voltage (VOUT)**: The output voltage is taken from the junction between RB2 and the anode of the regular diode (D1).

In summary, the circuit is designed to provide a stable output voltage (VOUT) using a Zener diode for voltage regulation. The Zener diode maintains a constant voltage across it, and the regular diode (D1) is used to ensure proper current flow and voltage regulation. The resistors RB1 and RB2 are used to limit the current through the diodes and to set the operating point of the circuit.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 12–12. Reference and Transducer Bias Circuit." The text is in a standard font and appears to be a caption or title for a figure in a document, likely a technical or engineering manual. The figure number "12–12" suggests that it is part of a larger series of figures in a chapter or section labeled "12." The content of the figure itself is not visible in the image, only the caption is shown.
```

The current through RB1 is calculated in Equation 12–7. Remember, the reference must be biased at 10 mA, and the transducer must be biased at 2 mA.

$$\mathsf{I} = \mathsf{I}\_{\mathsf{REF}} + \mathsf{I}\_{\mathsf{D}} = \mathsf{I}\mathsf{O} + \mathsf{Z} = \mathsf{I}\mathsf{Z}\mathsf{mA} \tag{72-7}$$

The value of RB1 is calculated in Equation 12–8, and the value of RB2 is calculated in Equation 12–9.

$$\mathcal{R}\_{\mathsf{B1}} = \frac{\mathsf{V}\_{+\mathsf{5}} - \mathsf{V}\_{\mathsf{ref}}}{\mathsf{I}} = \frac{\mathsf{5} - \mathsf{2.495}}{\mathsf{I}\mathsf{2}} = \mathsf{208} \,\,\Omega\tag{72-8}$$

$$\mathcal{R}\_{\rm B2} = \frac{\mathcal{V}\_{\rm ref}}{\mathcal{l}\_{\rm D}} = \frac{\mathcal{Z}.495}{2} = \mathcal{I}247 \text{ }\Omega \tag{12-9}$$

Both resistors are selected from the list of 1% decade values, thus RB1 = 210 Ω, 1%, and RB2 = 1240 Ω, 1%. The resistor values have been established, so it is time to calculate

12-13

the worst case excursions of ID (Equations 12–10 and 12–11). The resistors are assumed to have a 2% tolerance in these calculations. The extra 1% allows for temperature changes, vibration, and life. Three percent tolerances would have been used if the electronics' ambient temperature range were larger.

$$\mathbf{I}\_{\text{D(MIN)}} = \frac{\mathbf{V}\_{\text{REF(MIN)}}}{\mathbf{R}\_{\text{B2(MAX)}}} = \frac{\mathbf{2.47} - \mathbf{0.025} - \mathbf{0.007}}{\mathbf{1.02 (1.24)}} = \mathbf{1.93 mA} \quad \text{(12-10)}$$

$$\left|\right|\_{\text{D(MAX)}} = \frac{\bigvee\_{\text{REF(MAX)}}}{\bigmathbf{R}\_{\text{B2(MIN)}}} = \frac{2.52 - 0.025 - 0.007}{0.98 \text{ (1.24)}} = 2.10 \text{ mA} \quad \text{(12-11)}$$

The bias current extremes do not exceed the transducer bias current requirements, so the transducer will meet the specifications advertised. The converter is 12 bits and the full-scale voltage is assumed to be 5 V, so the value of an LSB is calculated in Equation 12–12. The nominal transducer output voltage is 550 mV at an ambient temperature of 25°C. At –25°C, the transducer output voltage is 550 mV+ (–2 mV/°C)(–50°C) = 650 mV. At 125°C, the transducer output voltage is 550 mV + (–2 mV°C)(75°C) = 400 mV. This data is tabulated in Table 12–1.

$$\mathsf{LSSB} = \frac{\mathsf{FSSV}}{\mathsf{Z^N}} = \frac{\mathsf{5}}{\mathsf{Z^{12}}} = \mathsf{1.22}\ \mathsf{mV} \tag{\mathsf{12-12}}$$

Table 12–1. Transducer Output Voltage

| TRANSDUCER<br>TEMPERATURE | TRANSDUCER<br>OUTPUT VOLTAGE | ANALOG INTERFACE<br>AMPLIFIER INPUT VOLTAGE |  |
|---------------------------|------------------------------|---------------------------------------------|--|
| –25°C                     | 650 mV                       | VIN1 = 650 mV                               |  |
| 25°C                      | 550 mV                       | 550 mV                                      |  |
| 100°C                     | 400 mV                       | VIN2 = 400 mV                               |  |

The steady state (VTOS) offset voltage is ± 50 mV, thus transducer output voltage (VTOV) ranges from 350 mV to 700 mV. The offset voltage is stripped out by the adjustments in the AIA, so it is not of any concern here. VTOS spans 100 mV, thus it is a 100 mV/1.22 mV/ bit = 82 bit error unless it is adjusted out.

The output impedance of the transducer is equivalent to the resistance of a forward biased diode (Equation 12–13).

$$\mathcal{R}\_{\mathsf{D}} = \frac{\mathsf{26}}{\mathsf{l}} = \frac{\mathsf{26}}{\mathsf{2}} = \mathsf{13} \,\mathsf{2} \tag{\mathsf{12-13}}$$

At this stage of the design there are two parameters that influence the accuracy of the measurement, and they are the temperature coefficient of the transducer and the output impedance of the transducer. The temperature transducer has been biased correctly, thus its temperature coefficient should be the advertised value of –2 mV/° C. The output impedance of the transducer forms a voltage divider with the input resistance of the AIA, but this error can't be calculated until the AIA is selected. The final transducer error contribution is that portion of the VTOS that can't be adjusted out, and this error is determined during the AIA design.

# **12.7 ADC Characterization**

This particular ADC was selected because it has a multiplexer and it enables different modes of operation. The temperature measurement is done in the single-shot mode because this mode allows the user to set the charge time at the input to the converter. During charging, the ADC's input resistance is low, but after the ADC input is charged the input resistance rises to 20 kΩ. This high input resistance does not load the AIA output circuit, thus the AIA achieves full rail-to-rail output voltage swing.

The internal reference is used in this application, and the reference sets the input voltage span required to obtain full accuracy for the ADC. Using the internal reference, the input voltage span is 0 V to 4 V. The offset voltage (VADCOS) is ± 150 mV, and the voltage drift is 40 PPM/°C. The voltage drift over the full temperature range is 40 PPM/°C(20°C) = 800 PPM. There are 244 PPM/LSB in a 12-bit converter, so the drift voltage error is 800/244 ≈ 4 bits error.

The ADC output is full scale (all bits 1) when the input voltage is 4 V, and it is zero (all bits 0) when the input voltage is 0 V. This data is tabulated in Table 12–2. Because the full scale output voltage has changed to 4 volts the LSB is calculated to be 4/(212) = 976.6 µV/bit.

| ADC INPUT<br>VOLTAGE | DIGITAL OUTPUT | ANALOG INTERFACE<br>AMPLIFIER OUTPUT VOLTAGE |
|----------------------|----------------|----------------------------------------------|
| 0 V                  | 000000000000   | VOUT1 = 0 V                                  |
| 4 V                  | 111111111111   | VOUT2 = 4 V                                  |

Table 12–2. ADC Input Voltage

# **12.8 Op Amp Selection**

It is time to select the op amp, and the easiest way to do this is to list the known specifications or requirements, list a candidate op amp's specifications, and calculated the projected error that the candidate op amp yields.

| DESIGN<br>SPECIFICATION | ESTIMATED VALUE  | CANDIDATE OP AMP:<br>TLV247X |  |
|-------------------------|------------------|------------------------------|--|
| RIN                     | 106 (13) Ω       | 1012 Ω                       |  |
| VTOV                    | 350 mV to 700 mV | –0.2 V to 5.2 V              |  |
| ROUT                    |                  | 1.8 Ω                        |  |
| VINADC                  | 0 V to 4 V       | 0.15 V to 4.85 V             |  |
| VOS                     | –––              | 2.2 mV                       |  |
| IB                      | –––              | 100 pA                       |  |
| VN                      | –––              | 28 nV<br>Hz                  |  |
| IN                      | –––              | 0.39 pA<br>Hz                |  |
| Analog noise            | –––              | 10 mV                        |  |
| kSVR                    | –––              | 63 dB                        |  |

Table 12–3. Op Amp Selection

There should be almost no error from RIN because the transducer output impedance is very low. The high side of the op amp's output voltage swing (4.85 V) is much higher than the ADC input voltage (4 V). The low side of the op amp's output voltage swing (0.185 V) is less than the ADC input voltage swing (0 V). The ADC input circuit is 20 kΩ and that doesn't load the op amp output stage, so the op amp output voltage swing is very close to the ADC input voltage range. ROUT should present no problems acting as a voltage divider with the ADC input resistance. VOS and IIB create offset voltages that add to the reference offset voltage, and they have to be adjusted out as a group. The system noise overshadows the op amp noise, thus the op amp noise is accepted unless later calculation prove otherwise.

# **12.9 Amplifier Circuit Design**

Enough information exists for the AIA to be designed. The TLV247X op amp is selected because it meets all the system requirements. The first step in the design is to determine the AIA input and output voltages, and this has already been done. These voltages are taken from Tables 12–1 and 12–2, and repeated here as Table 12–4.

| Table 12–4. | AIA Input and Output Voltages |  |  |
|-------------|-------------------------------|--|--|
|-------------|-------------------------------|--|--|

| INPUT VOLTAGE | OUTPUT VOLTAGES |                         |
|---------------|-----------------|-------------------------|
| VIN1 = 650 mV | VOUT1 = 0 V     | 1st pair of data points |
| VIN2 = 400 mV | VOUT2 = 4 V     | 2nd pair of data points |

The equation of an op amp is the equation of a straight line as given in Equation 12–14.

$$
\mathbf{M} = \mathbf{M}\mathbf{X} + \mathbf{P} \tag{12-\text{74}}
$$

Two pairs of data points shown in Table 12–4 are substituted in Equation 12–14 making Equations 12–15 and 12–16.

$$\mathbf{4} = \mathbf{0}.4\mathbf{m} + \mathbf{b} \tag{12-15}$$

$$\mathbf{0} = \mathbf{0}.\mathbf{65}\mathbf{m} + \mathbf{b} \tag{12-16}$$

Equation 12–15 is solved and substituted into Equation 12–16 to obtain Equation 12–17.

$$\mathbf{A} = \mathbf{0}.4 \mathbf{(}\overline{\mathbf{b}}\text{ - }\mathbf{b}\text{)} + \mathbf{b} \tag{12-17}$$

Solving Equation 12–17 yields b = 10.4, and solving Equation 12–15 yields m = –16. Substituting these values back into Equation 12–14 yields Equation 12–18, and Equation 12–18 (the final equation for the AIA) is put in electronic terminology.

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{16V}\_{\mathsf{IN}} + \mathsf{10.4} \tag{\mathsf{M}-\mathsf{18}}$$

The circuit that yields the transfer function developed in Equation 12–18 is shown in Figure 12–13.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit configured as a non-inverting amplifier with a reference voltage. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangle with two input terminals (inverting and non-inverting) and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+). The output is at the right side of the triangle.

2. **Power Supply (Vcc)**: The op-amp is powered by a voltage source labeled Vcc, connected to the positive power supply pin of the op-amp. The ground symbol is connected to the negative power supply pin of the op-amp.

3. **Input Voltage (VIN)**: The input voltage source, labeled VIN, is connected to the left side of the circuit. It is connected to the inverting input of the op-amp through a resistor labeled RG.

4. **Feedback Resistor (RF)**: A resistor labeled RF is connected between the output of the op-amp and the inverting input. This resistor forms part of the feedback loop, which determines the gain of the amplifier.

5. **Reference Voltage (VREF)**: A reference voltage source, labeled VREF, is connected to the non-inverting input of the op-amp through a resistor labeled R2. This reference voltage sets a baseline voltage level for the non-inverting input.

6. **Voltage Divider (R1 and R2)**: The resistors R1 and R2 form a voltage divider network connected to the non-inverting input of the op-amp. R2 is connected between VREF and the non-inverting input, while R1 is connected between the non-inverting input and ground.

7. **Output Voltage (VOUT)**: The output voltage, labeled VOUT, is taken from the output terminal of the op-amp.

In summary, this circuit is a non-inverting amplifier with a reference voltage applied to the non-inverting input. The gain of the amplifier is determined by the resistors RG and RF, while the reference voltage VREF sets the baseline voltage level for the non-inverting input. The output voltage VOUT is a function of the input voltage VIN and the reference voltage VREF.
```

#### Figure 12–13. AIA Circuit

The equations for the AIA circuit are given below.

$$\mathbb{V}\_{\text{OUT}} = -\mathbb{V}\_{\text{IN}} \left( \frac{\mathsf{R}\_{\text{F}}}{\mathsf{R}\_{\text{G}}} \right) + \mathbb{V}\_{\text{REF}} \left( \frac{\mathsf{R}\_{\text{1}}}{\mathsf{R}\_{\text{1}} + \mathsf{R}\_{\text{2}}} \right) \left( \frac{\mathsf{R}\_{\text{F}} + \mathsf{R}\_{\text{G}}}{\mathsf{R}\_{\text{G}}} \right) \tag{12-19}$$

$$|\mathfrak{M}| = \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{12-20}$$

$$\mathbf{b} = \mathbb{V}\_{\mathsf{REF}} \left( \frac{\mathsf{R}\_{\mathsf{1}}}{\mathsf{R}\_{\mathsf{1}} + \mathsf{R}\_{\mathsf{2}}} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) \tag{12-21}$$

Equation 12–18 gives the value for m as 16, and using Equation 12–20 yields RF = 16RG. Select RF = 383 kΩ and RG = 23.7 kΩ because they are standard 1% resistor values, and

12-17

this yields m = 16.16. The resistors R1 and R2 are calculated with the aid of Equations 12–22 and 12–23.

$$\frac{\mathcal{R}\_1}{\mathcal{R}\_1 + \mathcal{R}\_2} = \frac{\mathsf{p}}{\mathsf{V}\_{\mathsf{R}\to\mathsf{F}}} \left( \frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}} \right) = \frac{\mathsf{10.4}}{2.495} \left( \frac{23.7}{23.7 + 383} \right) = \mathsf{0.2424} \qquad \text{(\text{\textquotedbl{}2-22})}$$

$$\mathsf{R}\_1 = \frac{\textbf{0.2424}}{\textbf{0.7576}} \,\mathsf{R}\_2 = \textbf{0.32} \,\mathsf{R}\_2 \tag{12-23}$$

The parallel combination of R1 and R2 should equal the parallel combination of RF and RG so that the input voltage offset caused by the op amp input current is cancelled. Select R2 = 105 kΩ and R1 = 33.2 kΩ because they are standard 1% values, and then b = 10.3. The value of the parallel combination of R1, R2 (R1||R2 = 25.22 kΩ) almost matches the value of the parallel combination of RF, RG (RF||RG = 22.3kΩ), and this is an adequate match for input current cancellation. The downsides of selecting large resistor values for RF are current noise amplification, increased resistor noise, smaller bandwidth because of stray capacitance, and increased offset voltage due to input current. Bandwidth clearly is not a factor in this design. The op amp input current is 100 pA, so it won't cause much offset with a 383-kΩ feedback resistor (38.3 µV). The noise current and voltage are calculated later when the error budget is made.

The gain, m, and the intercept, b, are not accurate because the exact resistor values were not available in the 1%-resistor selection chart. This is a normal situation, and in less demanding designs the small error either does not matter or is corrected someplace else in the signal chain. That error is critical in this design, so it must eliminated. There are several nondrift type errors that have accumulated up to this point, and now is the time to correct all the nondrift errors with the addition of adjustments. Two adjustments are used; one adjustment controls the gain, m, and the other controls the intercept, b. The value of the adjustable resistor must be large enough to deliver an adequate adjustment range, but any value larger than that decreases the adjustment resolution.

The data that determines the adjustment range required is tabulated in Table 12–5. Drift and gain errors are calculated in volts, but drift errors are calculated in bits because they are not eliminated by adjustments. Remember, a LSB for this system is 4/4096 = 976.6 µV/bit.

| ERROR<br>PARAMETER            | INTERCEPT | GAIN     | DRIFT                   |
|-------------------------------|-----------|----------|-------------------------|
| VREF                          | ±25 mV    |          |                         |
| VREF drift                    |           |          | 7.41 mV ≈ 8 LSB         |
| Transducer offset             |           | ± 50 mV  |                         |
| Transducer ROUT               |           |          | 13 Ω ≈ 0 LSB            |
| ADC reference                 |           | ± 150 mV | 1 LSB                   |
| Total unadjusted<br>ADC error |           |          | 2 LSB                   |
| Gain error                    |           | 1.6 LSB  |                         |
| ADC drift                     |           |          | 4 LSB                   |
| VOS op amp                    | 2.2 mV    |          |                         |
| IB op amp                     | 100 pA    |          |                         |
| VN op amp                     |           |          | 28 nV<br>≈ 1 LSB<br>Hz  |
| IN op amp                     |           |          | 139 pA<br>≈ 0 LSB<br>Hz |
| VNPS PS noise                 |           |          | 10 mV ≈ 2 LSB           |
| ROUT op amp                   |           |          | 1.8 Ω ≈ 0 LSB           |
| VOUT LOW op amp               |           |          | 70 mV ≈ 72 LSB          |
| Total error                   |           |          | 18 LSB                  |

## Table 12–5. Offset and Gain Error Budget

The adjustment for the intercept, b, depends on R1, R2, and VREF. This adjustment has to account for the reference offset, the op amp input voltage offset, the op amp input current, and the resistor tolerances. The offset voltage inherent in the reference is given as ± 25 mV. The op amp input offset voltage is 2.2 mV; usually op amp offset voltage calculations include multiplying this offset by the closed loop gain, but this isn't done because the offset voltage is adjusted out in the input circuit. The op amp input current is converted to a common-mode voltage by the parallel combination of the reference resistors, so it is neglected in this calculation.

The worst case reference input voltage for the op amp, VREF(MIN), is calculated in Equation 12–24, where the resistor tolerances are assumed to be 3%, and the reference voltage error is 50 mV.

$$\begin{split} \left( \mathbf{V\_{REF(MIN)}} \right) &= \left( \mathbf{V\_{REF}} - \mathbf{50 } \mathbf{m} \right) \frac{\mathbf{0.97 R\_1}}{\mathbf{0.97 R\_1} + \mathbf{1.03 R\_2}} \\ &= \left< \mathbf{2.495} - \mathbf{0.05} \right> \frac{\mathbf{0.97 (33.2)}}{\mathbf{0.97 (33.2)} + \mathbf{1.03 (105)}} = \mathbf{0.566 V} \end{split} \tag{12-24}$$

The nominal reference voltage at the op amp input is 0.6 V, so the reference voltage has to have about 40 mV adjustment around the nominal, or a total adjustment range of 80 mV. The nominal current through the voltage divider is IDIVIDER = (2.495/(105 + 33.2) kΩ = 0.018 mA. A 4444-kΩ resistor drops 80 mV, thus the adjustable resistor (a potentiometer) must be greater than 4444 kΩ. Select the adjustable resistor, R1A, equal to 5 kΩ because this is an available potentiometer value, and the offset adjustment is ± 45 mV. Half of the potentiometer value is subtracted from R1 to yield R1B, and this subtraction centers the adjustment about the nominal value of 0.6V. R1B = 33.2 kΩ – 2.5 kΩ = 30.7 kΩ. Select R1B as 30.9 kΩ.

The adjustment for the gain employs RF and RG to insure that the gain can always be set at the value required to insure that the transducer output swing fills the ADC input range. The gain equation (Equation 12–18) is algebraically manipulated, worst case values are substituted for m and b, and it is presented as Equation 12–25.

$$\mathbf{G} = \frac{\mathbb{V}\_{\text{OUT}} - \text{10.4}}{-\mathbb{V}\_{\text{IN}}} = \frac{\mathbf{3.85} - \text{10.4}}{-\mathbf{0.35}} = \text{18.71} \tag{12-25}$$

Equation 12–26 is Equation 12–27 with 3% resistor tolerances.

$$\mathbf{0.97R\_F} = \mathbf{48.74} \left( \mathbf{4.03R\_G} \right) \tag{12-26}$$

Doing the arithmetic in Equation 12–26 yields RF = 19.86 RG. Thus, on the high side the gain must go from 16 to 19.86, or it must increase by 3.86. Assuming that the low side gain variation is equal, and rounding off to 4 sets the gain variation from 12 to 20. When RG = 23.7 kΩ RF varies from 284.4 kΩ to 474 kΩ. RF is divided into a potentiometer RFA = 200 kΩ and RFB = 280 kΩ, thus the nominal gain can be varied from 11.8 to 20.2.

12-20

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring a temperature sensor, a voltage reference, and an operational amplifier (op-amp) configured for signal conditioning and amplification. Here is a detailed description of the components and their connections:

1. **Temperature Sensor (D1)**: 
   - The circuit starts with a temperature sensor, represented by a diode symbol labeled "TEMP SENSOR" and "D1". The anode of the diode is connected to ground, and the cathode is connected to a resistor network.

2. **Resistor Network**:
   - **RB1 (210 Ω)**: Connected between the cathode of the temperature sensor (D1) and a +5V power supply.
   - **RB2 (1240 Ω)**: Connected in series with RB1, leading to a node that connects to the non-inverting input of the op-amp (TLV247x) through a resistor (RG).

3. **Voltage Reference (TL431A)**:
   - A TL431A voltage reference is connected with its reference pin tied to a voltage divider formed by resistors R1A (5 kΩ) and R1B (30.7 kΩ). The anode of the TL431A is grounded, and the cathode is connected to the node between RB2 and R2.
   - A 10 µF capacitor is connected across the TL431A for stability, and a 0.01 µF capacitor is connected in parallel with R1A.

4. **Resistors and Capacitors**:
   - **RG (23.7 kΩ)**: Connected between the node of RB2 and the non-inverting input of the op-amp.
   - **R2 (105 kΩ)**: Connected between the node of RB2 and the inverting input of the op-amp.
   - **RFA (200 kΩ)** and **RFB (280 kΩ)**: Form a feedback network around the op-amp. RFA is connected between the output (VOUT) and the inverting input, while RFB is connected between the inverting input and the node of RB2.
   - **Capacitors (1 µF and 0.01 µF)**: Connected in parallel between the +5V supply and ground, providing power supply decoupling for the op-amp.

5. **Operational Amplifier (TLV247x)**:
   - The op-amp is labeled TLV247x, with its non-inverting input connected to the node between RG and the temperature sensor network.
   - The inverting input is connected to the feedback network formed by RFA and RFB.
   - The output of the op-amp (VOUT) is the final output of the circuit.

The circuit is designed to amplify the signal from the temperature sensor, with the op-amp providing the necessary gain and the voltage reference ensuring stable operation. The resistors and capacitors are carefully chosen to set the gain and filter the signal, ensuring accurate temperature measurement and signal conditioning.
```

Figure 12–14. Final Analog Interface Circuit

There is no easy method of setting two interacting adjustments because when the gain is changed the offset voltage changes. They quickest method of adjustment is to connect the transducer to the circuit, adjust the offset, and then adjust the gain. It takes several series of adjustments to get to the point where the both parameters are set correctly.

The impedance and noise errors are calculated prior to completing the error budget. The op amp input impedance works against the transducer output impedance to act like a voltage divider. The value of the voltage divider is calculated in Equation 12–27, and as Equation 12–27 indicates, the output resistance of the transducer is negligible compared to the input resistance of the op amp. This is not always the case!

$$\mathsf{V}\_{\mathsf{D}} = \mathsf{V}\_{\mathsf{T}} \frac{\mathsf{R}\_{\mathsf{IN}}}{\mathsf{r}\_{\mathsf{c}} + \mathsf{R}\_{\mathsf{IN}}} = \mathsf{V}\_{\mathsf{T}} \frac{\mathsf{r}\mathsf{O}^{6}}{\mathsf{r}\mathsf{3} + \mathsf{1}\mathsf{O}^{6}} \approx \mathsf{V}\_{\mathsf{T}} \tag{12-27}$$

The ADC input impedance works against the op amp output impedance to act like a voltage divider. The value of the voltage divider is calculated in Equation 12–28. The voltage divider action introduces about a 0.009% error into the system, and this is within 13-bit accuracy, so it can be neglected.

$$\mathbb{V}\_{\mathsf{IN}} = \mathbb{V}\_{\mathsf{OUT}} \frac{2\mathsf{O}(\mathsf{10}^3)}{\mathsf{1.8} + 2\mathsf{O}(\mathsf{10}^3)} = \frac{2\mathsf{0}}{2\mathsf{0}.\mathsf{00}\mathsf{18}} = \mathsf{0.9999}\mathsf{1}\,\mathsf{V}\_{\mathsf{OUT}} \quad \text{(\text{!2-28})}$$

The noise specification is given in nV/(Hz0.5), and this must be converted to volts. There are involved formulas for the conversion, but the simplest thing to do is assume the noise is wide band. If the numbers add up to a significant error, detail calculations have to be made. The voltage noise is multiplied by the closed loop gain, thus VNWB = VN (GMAX) = 28 nV(20) = 560 nV = 0.56 µV. The current noise is multiplied by the parallel combination of RF and RG, thus INWB IN(RF||RG) = 139 pA(22.5 kΩ) = 3.137 nV. The system noise is 10 mV, and this noise comes in through the inputs and the power supply. The power supply contribution is reduced by the power supply rejection ratio, and it is 10 mV/63 dB = 10 mV/1412 = 7.08 nV. This calculation assumes that high-frequency noise is not a problem, but if this is not true, CMRR must be reduced per the data sheet CMRR versus frequency curves.

Some of the system noise propagates through the inputs and is rejected by the commonmode rejection of the op amp. The op amp is not configured as a differential amplifier, so a portion of the closed loop gain will multiply some of the system noise.

The ac gain of the AIA is given in Equation 12–29.

$$\begin{split} \mathbb{V}\_{\mathsf{OUT}} &= \alpha \mathbb{V}\_{\mathsf{SN}} \left( \frac{\mathsf{R}\_{\mathsf{I}}}{\mathsf{R}\_{\mathsf{I}} + \mathsf{R}\_{\mathsf{2}}} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}} \right) - \alpha \mathbb{V}\_{\mathsf{SN}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \\ &= \alpha \mathbb{V}\_{\mathsf{SN}} \left( \mathsf{4.12} - \mathsf{16} \right) \ = \mathsf{11.8} \ \alpha \mathbb{V}\_{\mathsf{SN}} \end{split} \tag{12-29}$$

All of the system noise does not get in on the inputs, rather most of the system noise is found on the power supply. The fraction of the system noise that gets into the ground system and onto the op amp inputs is very small. This fraction, α, is normally about 0.01 because the power supplies are heavily decoupled to localize the noise. Considering this, the system noise is 1.18 mV, or less than 2 LSBs.

The op amp output voltage range does not include 0 volts, and the ADC output voltage low value is 0 volts, so this introduces another error. The guaranteed op amp low voltage is 185 mV at a load current of 2.5 mA. The output current in this design is 185 mV/20 kΩ = 9.25 µA. This output current approximates a no load condition, hence the nominal low voltage typical specification of 70 mV is used. This leads to a 72 LSB error, by far the biggest error.

Referring to Table 12–5, notice that the total error is 90 LSB. Losing 90 LSBs out of 4096 total LSBs is approximately 11.97 bits accurate, so the 11-bit specification is met. The final circuit is shown in Figure 12–14.

Notice that large decoupling capacitors have been added to the power supply and reference voltage. The decoupling capacitors localize IC noise, prevent interaction between circuits, and help keep noise from propagating. Two decoupling capacitors are used, a large electrolytic for medium and low frequencies, and a ceramic for high frequencies. Although this portion of the design is low frequency, the op amp has a good frequency response, and the decoupling capacitors prevent local oscillations through the power lines. If cable noise is a problem, an integrating capacitor can be put in parallel with RF to form a low-pass filter.

# **12.10 Test**

The final circuit is ready to build and test. The testing must include every possible combination of transducer input and ADC output to determine that the AIA functions in all manufacturing situations. The span of the adjustments, op amp output voltage range, and ADC input range must be checked for conformance to the design criteria. After the design has been tested for the specification limits it should be tested for user abuse. What happens when the power supply is ramped up, turned on instantly, or something between these two limits? What happens when the inputs are subjected to over voltage, or when the polarity is reversed? These are a few ideas to guide your testing.

# **12.11 Summary**

The systems engineers select the transducer and ADC, and their selection criterion is foreordained by the application requirements. The AIA design engineer must accept the selected transducer and ADC, and it is the AIA designer's job to make these parts play together with adequate accuracy. The AIA design often includes the design of peripheral circuits like transducer excitation circuits, and references.

The design procedure starts with an analysis of the transducer and ADC. The analysis is followed by a characterization of the transducer and reference. At this point enough information is available to make an error budget and select candidate op amps. The op amp is selected in the next step in the procedure, and the circuit design follows.

The output voltage span of the transducer and corresponding input voltage span of the ADC are coupled as two pairs of data points that form the equation of a straight line. The data point pairs are substituted into simultaneous equations, and the equations are solved to determine the slope and intercept of a straight line (an op amp solution). The op amp circuit configuration is selected based on the sign of the slope and the intercept. Finally, the passive components used in the op amp circuit are calculated with the aid of the op amp circuit design equations.

The final circuit must be tested for conformance to the system specifications, but the prudent engineer tests beyond these specifications to determine the AIA's true limits.

# **12.12 References**

1 Wobschall, Darold, Circuit Design for Electronic Instrumentation, McGraw-Hill Book Company, 1979

# **Chapter 13**

# **Wireless Communication: Signal Conditioning for IF Sampling**

Perry Miller and Richard Cesari

# **13.1 Introduction**

High-speed operational amplifiers (op amps) are used extensively in wireless communication systems. These amplifiers typically operate at intermediate frequencies (IF) ≤ 500 MHz and most frequently operate below 25 MHz. Applications for high-speed op amps include filtering circuits in radio receivers, IF amplifiers, mixer circuits, and bandpass amplifiers.

# **13.2 Wireless Systems**

This chapter focuses on the requirements for the op amp and a number of techniques used in wireless communication systems to interface high-speed op amps to analog-todigital converters (ADCs) and digital-to-analog converters (DACs). This section provides several examples of different op amp usage.

Figure 13–1 shows an example of a dual-IF receiver. In this application, several stages with different IF frequencies are used to get the desired performance. The receiver converts the received radio frequency (RF) input from the antenna to a baseband signal. This type of system requires the ability to receive and operate over a wide range of signal strength. The inherent system noise level determines the lower operating limit and is a critical factor in the overall performance of the receiver. The receiver performance is measured in terms of receiver sensitivity, which is defined as the ratio between the power of the wanted baseband signal at the output of the ADC and the total power of all unwanted signals (include random noise, aliasing, distortion, and phase noise contributed by the local oscillator) introduced by the different circuit elements in the receiver. A low-sensitivity receiver can cause signal saturation in the ADC input.

Here is the image describtion:
```
The image displays the text "Wireless Systems" in a serif font. The text appears to be slightly italicized, giving it a slanted appearance to the right. The background is plain white, and the text is in black, making it stand out clearly against the background. The font size is moderate, and the text is centered within the image.
```

Here is the image describtion:
```
The image depicts a block diagram of a superheterodyne receiver system designed to process a signal at 900 MHz with a power level of -104 dBm, while also dealing with an interferer at -13 dBm. The system includes various components and stages to filter, amplify, and convert the signal to a lower frequency for further processing.

1. **Antenna**: The signal at 900 MHz is received by the antenna.
2. **Duplexer**: The duplexer separates the received signal from the transmitted signal, allowing the receiver to process the incoming signal.
3. **LNA (Low Noise Amplifier)**: The LNA amplifies the weak received signal to a higher level for further processing.
4. **Image Rejection Filter 1**: This filter has a bandwidth of 35 MHz and is used to reject unwanted image frequencies before the first mixing stage.
5. **1st Mixer**: The signal is mixed with a local oscillator (RFLO) at 660 MHz to convert the 900 MHz signal to the first intermediate frequency (IF).
6. **SAW Filter**: The Surface Acoustic Wave (SAW) filter further refines the signal at the first IF stage.
7. **1st IF Amp**: The first IF amplifier boosts the signal strength at the first IF stage.
8. **Image Rejection Filter 2**: Another image rejection filter is used to clean the signal before the second mixing stage.
9. **2nd Mixer**: The signal is mixed with a second local oscillator (2nd RFLO) at 222.7 MHz to convert the signal to the second IF at 17.3 MHz.
10. **Image Rejection Filter 3**: This filter has a bandwidth of 200 kHz and is used to reject unwanted frequencies at the second IF stage.
11. **2nd IF Amp with AGC (Automatic Gain Control)**: The second IF amplifier with AGC adjusts the gain to maintain a consistent signal level.
12. **LPF (Low Pass Filter)**: The low pass filter removes high-frequency components from the signal.
13. **ADC (Analog-to-Digital Converter)**: The ADC converts the analog signal to a digital format for further processing. The sampling frequency (fs) is 52 MHz.

The diagram shows a detailed flow of the signal through various stages of filtering, amplification, and frequency conversion, ultimately preparing the signal for digital processing.
```

Figure 13–1. A Typical GSM Cellular Base Station Receiver Block Diagram

The receiver contains two mixer stages reminiscent of a classic superhetrodyne receiver with good selectivity. The process of hetrodyning involves the translation of one frequency to another by the use of a mixer and local oscillator (LO) offset at the proper frequency to convert the RF signal to the desired IF. The LO signal is at a much higher level than the RF signal. In Figure 13–1, the 900 MHz RF signal is picked up by the antenna and amplified by a low-noise amplifier (LNA). After being sufficiently amplified by the LNA to overcome the noise level, the RF signal passes through a bandpass filter (BPF) used to provide image rejection and sufficient selectivity prior to the first stage mixing.

High selectivity prevents adjacent channel energy from getting into the input of the ADC and decreasing the receiver dynamic range. A strong signal in an adjacent channel causes intermodulation products in the receiver that can result in loss of the received signal. The band-pass filter is implemented with a surface acoustic wave (SAW) filter. The SAW filter provides very sharp edges to the passband, with minimum ripple and phase distortion.

The first stage mixer down-converts the band-limited RF signal with the LO signal, producing a number of new frequencies in the spectrum, including the sum frequency component, the difference frequency component, and spurious responses. The first stage IF filter provides sufficient filtering after the mixing circuit. It selects the difference frequency component while rejecting the sum frequency component and undesirable spurious responses. Passing the difference frequency component on to the next stage of the receiver makes it much easier to provide the gain and filtering needed for proper receiver functionality. Image rejection also places a constraint on the choice of the IF (10 MHz – 20 MHz). The spurious responses are the result of power supply harmonics and intermodulation products created during the mixing of the RF signal and the LO signal. If not substantially suppressed, spurious responses often corrupt the IF signal and cause it to be accepted as a valid IF signal by the IF amplifier.

The first stage IF amplifier minimizes the effects of the first stage filter loss on the noise figure and amplifies the signal to a suitable level for the second stage mixer. The output from the second stage mixer is applied to the second stage IF amplifier, automatic gain control (AGC) amplifier, and the subsequent low-pass filter, producing a 1-V full-scale input to the ADC. The ADC samples and digitizes this baseband analog input. The AGC amplifier ensures that if the received signal amplitude goes up rapidly, the ADC is not saturated. At the other extreme, if there is a fast power ramp down, the AGC prevents the signal quality from passing below an acceptable level. High-speed current-feedback operational amplifiers (CFA) are typically used to filter and amplify the IF signals because this type of operational amplifier has good slew rate, wide bandwidth, large dynamic range, and a low noise figure.

In this type of receiver, the ADC is a key component requiring sampling rates ≥ 40 MSPS with 12 bits to 14 bits of resolution and is usually a pipeline architecture device. The output of the ADC is highly dependent on the ADC's sampling frequency, nonlinearities in the ADC and the analog input signal, and the converter maximum frequency.

Table 13–1 tabulates the contribution of each stage depicted in Figure 13–1 to the system level budget for a typical GSM receiver. GSM is the global system for mobile communications. It is one of the most popular digital cellular formats in the world.

| ELEMENT                   | NOISE FIGURE (dB) | GAIN (dB) | ANF†          |
|---------------------------|-------------------|-----------|---------------|
| Duplexer                  | 1                 | –1        | 1             |
| LNA                       | 1.6               | +18       | 0.51616       |
| Image rejection Filter #1 |                   | –2        | 0.00517       |
| 1st stage mixer           | 9.87              | –7        | 0.21853       |
| Noise Filter              |                   | –2        | 0.07363       |
| 1st stage amplifier       | 7.92              | +49       | 1.7957        |
| Image rejection filter #2 |                   | –2        | 4.31E–06      |
| 2nd stage mixer           | 10.8              | –7        | 5.68E–05      |
| 2nd stage image filter    |                   | –2        | 0.0009        |
| AGC                       | 11                | +50       | 2.16E–09      |
| Anti-alias filter         |                   | –2        | 3.83E–10      |
| ADC                       | 7.63              | –2        | 3.83E–10      |
| Total                     |                   |           | 3.61 (5.7 dB) |

## Table 13–1. GSM Receiver Block System Budget

† ANF = Adjusted noise figure (linear).

Figure 13–2 shows a more flexible implementation for the receiver using a digital signal processor (DSP). Using a DSP allows a single receiver to access several different wireless systems through changes in software configuration.

Here is the image describtion:
```
The image depicts a block diagram of a superheterodyne receiver system, which is commonly used in radio frequency (RF) communication systems. The diagram can be broken down into several key stages:

1. **Antenna and RF Band-Pass Filter (RF-BPF)**:
   - The system starts with an antenna that receives a 900 MHz RF signal.
   - The received signal is then passed through an RF Band-Pass Filter (RF-BPF) to filter out unwanted frequencies and noise, allowing only the desired frequency range to pass through.

2. **Low Noise Amplifier (LNA)**:
   - The filtered signal is then amplified by a Low Noise Amplifier (LNA) to increase the signal strength while minimizing the addition of noise.

3. **First Mixer and First Intermediate Frequency (1st IF)**:
   - The amplified signal is mixed with a signal from a local oscillator (RFLO) in the first mixer to convert the RF signal to an intermediate frequency (IF). This process is known as downconversion.
   - The output of the mixer is the first intermediate frequency (1st IF) signal.

4. **Surface Acoustic Wave (SAW) Filter**:
   - The 1st IF signal is then passed through a SAW Filter, which provides further filtering to remove unwanted frequencies and improve signal quality.

5. **IF Amplifier and IF Filter**:
   - The filtered IF signal is amplified by an IF Amplifier to boost the signal strength.
   - The amplified signal is then passed through an IF Filter for additional filtering.

6. **Second Mixer and Second Intermediate Frequency (2nd IF)**:
   - The filtered IF signal is split into two paths: I (In-phase) and Q (Quadrature).
   - Each path has its own mixer, where the signal is mixed with another local oscillator (RFLO) signal to convert the 1st IF signal to a second intermediate frequency (2nd IF).
   - The I and Q signals are then amplified by 2nd IF Amplifiers.

7. **Baseband Processor**:
   - The I and Q signals are passed through Low Pass Filters (LPF) to remove high-frequency components and noise.
   - The filtered signals are then digitized by Analog-to-Digital Converters (ADC).
   - The digitized signals are processed by Finite Impulse Response (FIR) filters to further refine the signal.
   - The processed signals are then sent to a c6X Digital Signal Processor (DSP) for demodulation and further baseband processing.

The entire system is designed to receive, filter, amplify, downconvert, and process RF signals to extract the desired information. The use of multiple stages of filtering, amplification, and mixing helps to improve the signal quality and reduce noise and interference.
```

## Figure 13–2. An Implementation of a Software-Configurable Dual-IF Receiver

Figure 13–3 shows a basic W-CDMA transmit chain. A voiceband CODEC (coder–decoder), op amps, and a DSP are used to digitize and band-limit the audio signal. The digitized signal is then compressed to the appropriate data rate either in hardware or by a software program implemented on the DSP. Redundancy (error correction), encryption, and the appropriate form of modulation (QPSK for W–CDMA or GMSK for GSM) are added to the compressed digitized signal. This signal goes via an interpolating filter to the communication DAC as shown in Figure 13–4. Eight times interpolation[1],[2] is shown in Figure 13–4, but other multiple-of-2 interpolations are possible and quite often used. Assuming that the modulated bit stream is a 3.84 MSPS W–CDMA signal, for 8x interpolation, the sampling clock frequency would need to be 30.72 MHz. The DAC converts the modulated bit stream to analog, and the conversion is usually performed by a pair of DACs: one for I channel and one for Q channel — see Figure 13–3. The reconstruction filter, at the output

Here is the image describtion:
```
The image depicts a block diagram of a digital communication transmitter system. Here is a detailed description of each component and the signal flow:

1. **DSP/ASIC**: The system starts with a Digital Signal Processor (DSP) or Application-Specific Integrated Circuit (ASIC). This component processes digital data and prepares it for transmission.

2. **DACs (Digital-to-Analog Converters)**: The processed digital signals are then fed into two DACs. These converters transform the digital signals into analog signals. There are two DACs, indicating that the system uses I (In-phase) and Q (Quadrature) components for modulation.

3. **Filters**: After conversion to analog, the signals pass through filters. These filters shape the analog signals to remove unwanted frequencies and prepare them for modulation.

4. **Mixers**: The filtered analog signals are then fed into mixers. Mixers modulate the signals by mixing them with a local oscillator (LO) signal. There are two mixers, one for the I component and one for the Q component.

5. **Quadrature Modulator**: The modulated I and Q signals are then combined in a quadrature modulator. This modulator uses a local oscillator (LO1) signal split into two paths with a 90-degree phase difference to modulate the I and Q signals. The modulated signals are summed to produce a single complex signal.

6. **Amplifier**: The combined signal is then amplified to increase its power level for transmission.

7. **PA (Power Amplifier)**: The amplified signal is further boosted by a power amplifier to ensure it has sufficient power for transmission over long distances.

8. **Filters**: Additional filters are used after the power amplifier to clean up the signal and remove any unwanted frequencies generated during amplification.

9. **Antenna**: Finally, the clean, amplified RF (Radio Frequency) signal is transmitted through an antenna.

The signal flow starts from the DSP/ASIC, goes through DACs, filters, mixers, quadrature modulator, amplifiers, and filters, and ends at the antenna for transmission.
```

of the DAC, is usually a high-order Bessel or elliptic filter used to low-pass filter the analog output from the DAC.

Figure 13–3. Basic W-CDMA Cellular Base Station Transmitter Block

The modulator block converts the baseband I and Q signal to the appropriate carrier frequency, typically 864 MHz. The up-converted 864 MHz signal is amplified to a suitable level by the power amplifier (PA) and sent out via the antenna over the air or to a nearby wireless base station.

The RF power amplifier is a large-signal device with power gain and efficiency on the order of 50% for GSM and about 30% for code division multiple access (CDMA), an access method in which multiple users are permitted simultaneously on the same frequency.

Here is the image describtion:
```
The image depicts a signal processing chain for a W-CDMA (Wideband Code Division Multiple Access) system with a sampling rate of 3.84 MSPS (Mega Samples Per Second). The chain consists of several stages:

1. **W-CDMA Input Signal**: The process begins with a W-CDMA signal sampled at 3.84 MSPS.

2. **Interpolation Filter**: The W-CDMA signal is fed into an interpolation filter. This filter increases the sampling rate by a factor of 8. The interpolation process involves inserting additional samples between the original samples to increase the overall sampling rate. The output of this filter is a baseband signal with a bandwidth of 0 to 4 MHz.

3. **THS5672 Comms DAC**: The interpolated baseband signal is then input to a THS5672 Communications Digital-to-Analog Converter (DAC). The DAC converts the digital baseband signal into an analog signal. The DAC operates at a sampling frequency (f_s) of 30.72 MHz, which is the result of the original 3.84 MSPS signal being interpolated by a factor of 8.

4. **Reconstruction Filter**: The analog signal output from the DAC is passed through a reconstruction filter. This filter smooths the analog signal and removes any high-frequency components introduced during the digital-to-analog conversion process.

The overall process involves taking a W-CDMA signal, increasing its sampling rate through interpolation, converting it to an analog signal using a DAC, and then filtering the analog signal to produce a clean output.
```

Figure 13–4. Communication DAC with Interpolation and Reconstruction Filters

# **13.3 Selection of ADCs/DACs**

In communication applications, the dc nonlinearity specifications that describe the converter's static performance are less important than the dynamic performance of the ADC. The receiver (overall system) specifications depend very much on the ADC dynamic performance parameters: effective number of bits (ENOB), SFDR (spurious free dynamic range), THD (total harmonic distortion), and SNR (signal-to-noise ratio). Good dynamic performance and fast sampling rate are required for accurate conversion of the baseband analog signal at RF or IF frequencies. The SFDR specification describes the converter's in-band harmonic characterization and it represents the converter's dynamic range. SFDR is slew rate and converter input frequency dependent.

The output from an ADC is highly dependent on the converter sampling frequency and the maximum frequency of the analog input signal. A low-pass or band-pass anti-aliasing filter placed immediately before the ADC band-limits the analog input. Band-limiting ensures that the original input signal can be reconstructed exactly from the ADC's output samples when a sampling frequency (ƒs) of twice the information bandwidth of the analog input signal is used (Nyquist sampling). Undesirable signals, above ƒs/2, of a sufficient level, can create spectrum overlap and add distortion to the desired baseband signal. This must not be allowed to dominate the distortion caused by ADC nonlinearities. Sampling at the Nyquist rate places stringent requirements on the anti-aliasing filter — usually a steep transition 10th or higher order filter is needed.

Oversampling techniques (sampling rate greater than the Nyquist rate) can be employed to drastically reduced the steepness of the anti-aliasing filter rolloff and simplify the filter design. However, whenever oversampling is used, a faster ADC is required to digitize the input signal. Very fast ADCs can be costly and they consume a fair amount of power (≥ 1000 mW). In a system application, such as a wireless base station, where large numbers of ADCs are used, the individual device power consumption must be kept to the bare minimum (≤ 400 mW). High-resolution ADCs, with slower sampling rates, offer potential cost savings, lower power consumption, and good performance, and are often used in some applications. In this case, undersampling or bandpass sampling techniques (the analog signal digitization by the ADC exceeds half the sampling frequency (ƒs) of the ADC, but the signal information bandwidth is ≤ ƒs/2) are employed.

Operating the ADC in a bandpass sampling application requires knowledge of the converter's dynamic performance for frequencies above ƒs/2. In general, as the input signal frequency to the converter increases, ENOB, SNR, SFDR, and harmonic performance degrades.

The fact that the analog input to the ADC cannot be represented exactly with a limited number of discrete amplitude levels introduces quantization error into the output digital samples. This error is given by the rms quantization error voltage e2 qns <sup>=</sup> 1 <sup>12</sup> q2 s.

The mean squared quantization noise power is is Pqn = q2 s 12R where qs is the quantization step size and R is the ADC input resistance, typically 600 Ω to 1000 Ω.

Communication ADCs similar to the THS1052 and THS1265 typically have a full scale range (FSR) of 1 Vp–pto 2 Vp–p. Generally, wireless systems are based on a 50-Ω input/ output termination, therefore, the ADC input is made to look like 50 Ω. Based on this assumption, the quantization noise power for a 12-bit, 65 MSPS ADC (THS1265) is –73.04 dBm.

For a noise-limited receiver, the receiver noise power can be computed as the thermal noise power in the given receiver bandwidth plus the receiver noise figure NF[3].

For 200 kHz BW (GSM channel), temperature 25-C, and 4 dB to 6 dB NF, the receiver noise power is –115 dBm. Therefore, to boost the receiver noise to the quantization noise power level requires a gain of 42 dB.

In Figure 13–1, the GSM–900 signal is at –104 dBm (GSM–900 spec for smallest possible signal at which the raw bit-error rate must meet or exceed 1%) and, therefore, the signalto-noise ratio (SNR) at baseband or at the converter and due to the thermal noise compo-

$$\text{moment is given by } \mathsf{SNR}\_{\mathsf{thermal}} = \frac{\mathsf{E}\_{\mathsf{b}}}{\mathsf{N}\_{0}} = -\mathsf{1O4} \text{ dBm} + \mathsf{115} \text{ dBm} = \mathsf{9} \text{ dB} \dots$$

In order for the raw BER to be 1% in a GSM system, testing and standard curves [4] indicate, that a baseband SNR (derived from the sum of both thermal noise and ADC noise) of 9 dB is needed for this performance node.

The process gain Gp is defined as:

$$\mathbf{G\_{p}} = \frac{f\_{\mathbf{s}}}{\mathbf{B}\mathbf{W}} = \frac{5\mathbf{2} \times 10^{6}}{200 \times 10^{3}} = 2.6 \times 10^{2} = 24.15 \text{ dB} \tag{13-1}$$

where GSM channel BW = 200 kHz and ƒ<sup>s</sup> = 52 MHz (the ADC sampling frequency).

The converter noise at baseband should be much better than the radio noise ( = thermal noise + process gain). Furthermore, the thermal noise alone brings the system only to the reference bit-error rate (BER).

Therefore the converter noise (at baseband) = SNRadc + process gain Gp.

The ADC SNRadc should be 20 dB to 40 dB above the SNRthermal of the thermal noise component (+9 dBm). In this example, ADC SNRadc is selected to be 37 dB better than the SNRthermal of the thermal noise component (9 dB).

In other words, if the converter SNRadc is desired to be 37 dB better than the thermal noise component (SNRthermal), the baseband converter is chosen to be 9 + 37 dB = 46 dB.

The total noise (Nsum) = thermal noise (Nt) + converter noise (Nconv).

Therefore, the noise-to-signal ratio is:

$$\begin{split} \frac{\mathsf{N\_{sum}}}{\mathsf{S\_{GSM}}} &= \frac{\mathsf{N\_{t}}}{\mathsf{S\_{GSM}}} + \frac{\mathsf{N\_{conv}}}{\mathsf{S\_{GSM}}} \\ &= \frac{1}{10^{0.9}} + \frac{1}{10^{4.6}} \end{split} \tag{13-2}$$

The signal-to-noise ratio SGSM Nsum = 7.942 (linear), which is 8.999 dB.

This shows that the converter noise degenerates the baseband SNR due to thermal noise alone, by only 0.0001 dB (9.000 dBm – 8.999 dB) when the signal is at reference sensitivity level.

At fs = 52 MSPS, the converter SNRadc required to fit the GSM–900 signal is (46 – 24.15) dB = 22 dB.

The effective number of bits (ENOB) required for fitting the GSM–900 signal is

$$\text{ENOB} = \frac{\text{SNR} - 1.76}{6.02} \tag{13-3}$$

and thus 4 bits are needed for the GSM–900 signal.

Assuming that filter #3 attenuates the interferer by 50 dB, the interferer drops from –13 dBm to –53 dBm, or 40 dB above the GSM signal. The requirements for the number of bits needed to accommodate the interferer is 40 dB 6 dBbit = 6.3 bits.

Approximately 6 bits are needed to accommodate the interferer, plus 2 bits of head room for constructive interference, for a total of 8 bits. The ADC requirements are 4 bits for the GSM signal plus 8 bits for the interferer for a total of 12 bits:

Here is the image describtion:
```
The image depicts a 12-bit Analog-to-Digital Converter (ADC) output, represented as a series of 12 binary bits, numbered from 0 to 11. The bits are arranged in a horizontal line, with bit 0 on the far right and bit 11 on the far left.

The 12 bits are divided into two distinct groups:
1. The upper 8 bits (bits 4 to 11) are labeled as "Upper 8 bits accommodate noise + interference." This suggests that these bits are primarily used to capture and represent noise and interference in the signal.
2. The lower 4 bits (bits 0 to 3) are labeled as "Lower 4 bits accommodate quantized signal." This indicates that these bits are used to represent the actual quantized signal, which is the useful part of the data after the analog signal has been converted to digital form.

The image provides a clear visual representation of how the 12-bit ADC output is divided to handle both the signal and the noise/interference components.
```

It follows from the above analysis that the GSM signal is 8 bits down, or 8 bits x 6 dB/bit = 48 dB down from the 1 V FSR of the ADC. The full-scale input power to an ADC having a 50-Ω termination can be calculated as:

$$\frac{\text{V}^2}{\text{R}} = \frac{\text{(\textdegree t)}^2}{\text{50}} = \text{2} \times \text{10}^{-2} = \text{13 dBm (full scale or } \text{FSR)}\tag{\text{\textdegree 3-4}}$$

Therefore, the 4 bits for the GSM signal gives 13 dBm – (8 bits x 6 dB/bit) = –35 dBm, the smallest possible ADC input signal power with the interferer that will meet the GSM specification. Without the interferer present, the signal level is chosen to be about 20 dB below the ADC full scale, or –8 dBm, to accommodate constructive interference and to accommodate any large ADC input signal that may arise from short-term errant gain due to gain settling in the AGC. Thus, with the smallest possible signal specified by the GSM–900 spec, the signal is amplified from –104 dBm to –8dBm without the interferer, and to –35 dBm with the interferer.

For a practical receiver, as shown in Figure 13–1, an AGC is necessary to assure that the LSB represents a uniform noise input while the peak power does not exceed the ADC's FSR.

The receiver block shown in Figure 13–1 uses a high-speed, fairly wide bandwidth (100 MHz to 550 MHz) communication ADC to convert the baseband signal to a highspeed parallel bit stream for processing in a DSP. For an ADC to accurately produce a digital version of the baseband analog input, the device must have very good resolution and dynamic performance.

The signal path shown in Figure 13–1 needs 95 dB of gain in order to bring the –104 dBm GSM signal up to –9 dBm (equivalent to about 0.112 Vp–p across 50 Ω), with allowances for losses in the filters, and mixers. Usually this gain is split evenly between the RF and baseband, but baseband gain is less expensive and consumes less power. The LNA provides 18 dB, which, after filtering and cable losses, yields about 16 dB, while the mixer provides –7 dB of conversion gain/loss.

Modern communication DACs are, effectively, an array of matched current sources optimized for frequency domain performance. To handle both strong and weak signals, communication DACs require large dynamic range. The dynamic specifications of most interest are SFDR, SNR, THD, IMD (two-tone intermodulation distortion), ACPR (adjacent channel power rejection), and settling time.

Besides these, there are a number of dc parameters, such as integral nonlinearity (INL) and differential nonlinearity (DNL), that are considered important because of their influence on the SFDR parameter. DNL errors occur only at certain points in the converter's transfer function. INL and DNL errors appear as spurious components in the output spectrum and can degrade the signal-to-noise ratio of the DAC.

Typical SFDR figures for 12-bit DACs and 14-bit DACs, with a 5-MHz single tone input at 50 MSPS, range from 75 dB to 80 dB. In order to prevent adjacent communication channels from interfering with each other, the DAC must exhibit a good SFDR specification. Communication DACs normally have differential outputs, and the current-mode architecture is used to give the DAC a higher update rate.

# **13.4 Factors Influencing the Choice of Op Amps**

IF amplifiers and filters can be built from discrete components, though most modern applications use integrated circuits. High-speed wideband op amps are employed as buffer amplifiers in the LO circuit, at the front end of ADCs, at the output of the DAC, in the external voltage reference circuits for ADCs and DACs, and in the AGC amplifier and anti-aliasing stage. Op amps operating at IF frequencies, such as the AGC amplifier in Figure 13–1, must attain a large gain control range. How well the amplifier handles large and small signals is a measure of its dynamic range. The current-feedback op amp can be used everywhere except for the anti-aliasing filter and in the reconstruction filter stage. The op amp must have a level gain response from almost dc to at least 500 MHz, after which a gentle rolloff is acceptable. Also, the phase response is important to avoid dispersing the signal — this requires a linear phase response.

Several factors influence the choice of the current-feedback op amp (CFA) and voltagefeedback amplifier (VFA) for use in wireless communication systems:

- The ADC/DAC resolution
- ADC/DAC dynamic specification
- Operating frequencies
- Type of signal
- Supply voltages and
- Cost

In both the receiver and transmit circuits, shown in Figures 13–1 and 13–3, the SFDR and IMD are the key ADC/DAC parameters that have the most influence on op amp selection. A minimum requirement is that the op amp's SFDR or THD parameter, measured at the frequency of operation, should be 5 dB to 10 dB better than the converter's SFDR. For a perfect 12-bit ADC, the SFDR is 72 dB, thus the op amp in front of the ADC should exhibit a SFDR (or THD) of 77 dB to 82 dB.

When an op amp is used as a buffer amplifier, it must faithfully reproduce the input to a very high degree of accuracy. This requires that the amplifier be designed and optimized for settling time. Fast settling time is mandatory when driving the analog input of an ADC because the op amp output must settle to within 1 LSB of its final value (within a time period set by the sampling rate) before the ADC can accurately digitize the analog input. The amplifier settling time determines the maximum data transfer rate for a given accuracy. For example, to settle within 1 LSB of full scale range implies that the settling accuracy of the ADC is ± LSB. Hence, a 12-bit ADC will require the op amp to settle to 1 <sup>2</sup> <sup>212</sup> 1.22 <sup>10</sup>4 of final value, or 0.0122% of final value. An LSB = 244 µV for a 12-bit ADC with 1 V full-scale range. Values for the settling time and other important op

amp parameters as they relate to the receiver and transmit blocks are listed in Table 13–2.

The op amp dynamic parameters in Table 13–2 represent the range of values to achieve low noise, good SFDR, high slew rate, good bandwidth, etc.

Table 13–2. High-Speed Op Amp Requirements

| PARAMETER                 | VALUE                    |
|---------------------------|--------------------------|
| Noise voltage             | 2.7 nV Hz  to 8 nV<br>Hz |
| Noise current             | 1 pA Hz  to 30 pA<br>Hz  |
| THD                       | 70 dBc to 95 dBc         |
| Slew rate                 | 260 V/µV to 3500 V/µV    |
| Small signal bandwidth    | 200 MHz to 600 MHz       |
| Large signal bandwidth    | ≥ 100 MHz                |
| Common-mode input voltage | 3 V                      |
| Supply voltage            | ± 5 V                    |
| Settling time             | 8 ns to 20 ns            |
| Output current            | 40 mA to 100 mA          |
| Output impedance          | ≤ 20 Ω                   |
| PSRR                      | – 60 dB                  |
| CMRR                      | –70 dB                   |
| Input offset voltage      | 10 mV (typical)          |

Op amps operating from ± 5-V supplies typically have 6 V to 8 V of common-mode range. Single-supply op amps often handle much smaller voltage ranges, and in some communication applications, could exhibit limited linear operation over a wide signal swing. With the exception of rail-to-rail op amps, most op amps can swing to within 1 V to 1.5 V of the positive rail. Typically signal-to-noise ratio, slew rate, and bandwidth suffer for devices operating from low supply voltages.

When selecting current-feedback op amps, the gain-bandwidth plots are essential. They are needed because with current feedback ordinary loop-gain-proportional bandwidth relationships do not hold.

# **13.5 Anti-Aliasing Filters**

Spurious effects in the receiver channel (Figure 13–1) appear as high frequency noise in the baseband signal present at the ADC. The spurious signals (> ƒs/ 2) must be blocked from getting to the ADC (sampling at Nyquist rate, ƒs) where they will cause aliasing errors in the ADC output.

A suitable anti-aliasing low-pass analog filter placed immediately before the ADC can block all frequency components capable of causing aliasing from reaching the ADC. The anti-aliasing filter cutoff frequency (fc) is set to the highest baseband signal frequency of interest (fmax) so that fc = fmax. Sampling theorem requires that the ADC minimum Nyquist rate sampling frequency fs = 2fmax. This ensures that the original base band or IF signal can be reconstructed exactly from the ADC's digital outputs. It is important to know that only an anti-aliasing filter having a brickwall-type response could fully satisfy the exacting requirements imposed by the sampling theorem. The rolloff of real filters increases more gradually from cutoff to the stop band, and therefore, in practice, the ADC sampling frequency is usually slightly higher than 2ƒmax.

The anti-aliasing filter must reduce the out-of-band aliasing producing signals to less than 1 LSB of the ADC resolution, without introducing additional distortion of the baseband or IF signal in-band components and without predominating distortion due to the ADC nonlinearities. The spectrum overlap (aliasing) requirements are determined by:

- Highest frequency of interest
- Sampling rate
- ADC resolution

The highest signal frequency of interest sets the filter cutoff frequency. For example, suppose the input signal is to be sampled to 12-bit accuracy with a sampling frequency of 52 MHz. If the IF signal is 17 MHz an 18 MHz filter –3dB cutoff frequency could be chosen. All frequencies above the Nyquist frequency should be attenuated to ≤ LSB, but generally only frequencies above the ADC's limit of resolution will be a problem; i.e., ƒalias = (52 – 17) MHz = 35 MHz. The frequency rolloff is 18 MHz to 35 MHz (about 1 octave) and the required attenuation is 72 dB (12-bit ADC). A very high-order filter is required to accomplish this task. Practical ant-aliasing filters are limited to fifth-order or sixth-order type because of amplifier bandwidth, phase margin, layout parasitics, supply voltage, and component tolerances. Keep in mind that as the rolloff sharpens, the passband ripple and phase distortion increase.

For communication applications, linear phase characteristic and gain accuracy (low passband ripple) are important. And normally, Chebychev or elliptic (Cauer) filter types are used for the anti-aliasing filter.

For good transient response or to preserve a high degree of phase coherence in complex signals, the filter must be of linear-phase type (Bessel-type filter).

The THS4011 or THS4021 voltage-feedback op amp is a good choice for implementing anti-aliasing filter in this example.

The quality of the capacitors and resistors used to implement the design is critical for performance anti-aliasing filter.

# **13.6 Communication D/A Converter Reconstruction Filter**

Modern communication DACs are, effectively, an array of matched current sources optimized for frequency domain performance. The most important dynamic specifications are SFDR, SNR, THD, IMD, ACPR and settling time. The dc parameters INL and DNL are considered important because of their influence on the SFDR parameter. Typical SFDR figures for 12-bit to 14-bit DACs, with a 5-MHz single-tone input at 50 MSPS, ranges from 75 dB to 80 dB. In order to prevent adjacent communication channels from interfering with each other, the DAC must exhibit a good SFDR specification.

Communication DACs normally have differential outputs and current-mode architecture is used to give the DAC a higher update rate.

Figure 13–4 shows an interpolating filter block before the DAC and the reconstruction analog filter at the output of the DAC. The interpolating filter is a digital filter whose system clock frequency is an integer multiple of the filter input data stream and is employed to reduce the DAC's in-band aliased images. This eases the job of the reconstruction filter at the output of the DAC. The filter is used to smooth the input data — the output waveform frequency is the same as the input to the interpolating filter. Figure 13–5 shows the interpolation filter output. The system clock frequency of the DAC and the interpolating filter are running at the same rate; therefore, the frequency spectrum of the DAC output signal, repeated at integer multiples of the sampling rate, becomes increasingly separated as the sampling rate is increased. The further apart the repeated DAC output spectrum, then the less steep the attenuation characteristic of the anti-aliasing needs to be. Consequently, a simpler anti-aliasing filter with a less steep rolloff from pass band to stop band can be used without any increase in distortion due to aliasing. In Figure 13–4, the system clock is 30.772 MHz (3.84 MSPS x 8). Figure 13–6 shows the attenuation characteristics needed for the reconstruction anti-aliasing filter.

The aliasing frequency is ƒalias = (28.7 – 2) = 26.7 MHz, and the required attenuation is 84 dB (14-bit DAC). A third-order anti-aliasing low-pass elliptic or Bessel filter could be used to meet the attenuation requirements. Either type of high-order filter gives a relatively flat response up to just below the sampling frequency, followed by a sharp cutoff. But this arrangement provides no correction for the sinc function (Sinx)/x falloff in amplitude naturally produced by the sample and hold function in the DAC.

The tradeoff in building a simpler reconstruction filter is that a faster DAC is required to convert the input digital data stream to analog signal.

Here is the image describtion:
```
The image is a graph that plots Power in decibels (dB) against Frequency in Megahertz (MHz). The x-axis represents the frequency, ranging from 0 to 16 MHz, while the y-axis represents the power level, ranging from -100 dB to 40 dB.

The graph shows a significant drop in power level at around 2 MHz. From 0 to approximately 2 MHz, the power level is relatively high, fluctuating around 20 dB. After 2 MHz, there is a sharp decline in power, dropping to around -40 dB. Beyond this point, from approximately 2 MHz to 16 MHz, the power level remains relatively constant, fluctuating around -40 dB with some minor variations and noise.

The graph appears to depict the frequency response of a low-pass filter, where frequencies below 2 MHz are passed with minimal attenuation, while frequencies above 2 MHz are significantly attenuated.
```

Figure 13–5. QPSK Power Spectral Density Without Raised Cosine Filter — W-CDMA

Here is the image describtion:
```
The image is a graph that represents the amplitude of a signal as a function of frequency (f) in MHz. The x-axis is labeled with frequency in MHz, and the y-axis is labeled with amplitude.

1. **Frequency Range and Amplitude**:
   - The graph starts at 0 MHz and extends beyond 30.772 MHz.
   - At 0 MHz, the amplitude is zero.
   - From 0 MHz to 2 MHz, the amplitude increases linearly to a certain level.
   - From 2 MHz to 28.7 MHz, the amplitude remains constant at this level.
   - From 28.7 MHz to 30.772 MHz, the amplitude decreases linearly back to zero.

2. **Key Points**:
   - At 2 MHz, there is a vertical line indicating a significant point where the amplitude reaches its maximum constant value.
   - At 28.7 MHz, there is another vertical line indicating the start of the linear decrease in amplitude.
   - At 30.772 MHz, the amplitude reaches zero again.
   - There is a label "CLK" at a frequency slightly less than 30.772 MHz, indicating a clock frequency or a significant point related to the clock signal.

3. **Graph Characteristics**:
   - The graph has a piecewise linear shape with three distinct segments: an increasing segment from 0 to 2 MHz, a constant segment from 2 to 28.7 MHz, and a decreasing segment from 28.7 to 30.772 MHz.
   - The dashed line from 0 to 2 MHz indicates the initial increase in amplitude.
   - The solid lines indicate the constant and decreasing segments of the amplitude.

Overall, the graph depicts the amplitude response of a signal over a range of frequencies, showing how the amplitude increases, remains constant, and then decreases within the specified frequency range.
```

Figure 13–6. Reconstruction Filter Characteristics

Figure 13–7 shows a first-order reconstruction (low-pass) filter consisting of a high-speed differential amplifier configured for unity gain. The DAC outputs are terminated into 50 Ω. In Figure 13–7, the value for the filter capacitor is given by the expression:

Here is the image describtion:
```
The image depicts a circuit diagram involving a Digital-to-Analog Converter (DAC) and an operational amplifier (op-amp) configuration. Here is a detailed description:

1. **DAC (THS5672)**:
   - The DAC is labeled as THS5672.
   - It has two current output pins, IOUT1 and IOUT2.

2. **Resistors**:
   - There are several resistors in the circuit, each with specified resistance values.
   - Two resistors with a value of 49.9 ohms are connected to the ground from the IOUT1 and IOUT2 pins of the DAC.
   - Two resistors labeled R1 with a value of 499 ohms are connected in series with the IOUT1 and IOUT2 pins.
   - Two resistors labeled R2 with a value of 499 ohms are connected in the feedback loop of the op-amp.

3. **Capacitors**:
   - Two capacitors labeled Cfb are connected in parallel with the R2 resistors in the feedback loop of the op-amp.
   - The value of Cfb is given by the formula: \( C_{fb} = \frac{3.1827 \times 10^{-4}}{f_{clk}/2} \).

4. **Operational Amplifier (Op-Amp)**:
   - The op-amp is shown with its inverting (-) and non-inverting (+) inputs.
   - The non-inverting input is connected to the common output voltage \( V_{COM,OUT} \).
   - The inverting input is connected to the junction of the R1 resistors and the output of the DAC.
   - The output of the op-amp is labeled as \( V_{OUT} \).

5. **Op-Amp Models**:
   - The op-amp can be one of three models: THS4131, THS4141, or THS4151.

6. **Connections**:
   - The IOUT1 and IOUT2 pins of the DAC are connected to the R1 resistors.
   - The R1 resistors are connected to the inverting input of the op-amp.
   - The feedback loop consists of the R2 resistors and Cfb capacitors connected between the output and the inverting input of the op-amp.
   - The non-inverting input of the op-amp is connected to \( V_{COM,OUT} \).

The circuit appears to be designed for converting digital signals to analog signals using the DAC and op-amp configuration, with specific feedback components to control the response and stability of the op-amp.
```

Figure 13–7. A Single-Pole Reconstruction Filter

# **13.7 External Vref Circuits for ADCs/DACs**

Figure 13–8 shows an op amp voltage follower circuit that is often used to interface the external precision voltage reference supplying the ADC/DAC external reference voltage (see for example, Miller and Moore, [5], [6],1999, 2000 for a more detailed discussion on voltage reference circuits used in ADC an DAC systems). Vin is the output from a precision voltage reference, such as the Thaler Corp. VRE3050. The low-pass filter (formed by C1R1) filters noise from the reference and op amp buffer. The –3 dB corner frequency of the filter is 1/2πC1R1and the transfer function for this circuit can be written as

$$\frac{\mathbf{V\_{o}}}{\mathbf{V\_{in}}} = \frac{\left(\mathbf{1} + \mathbf{s}\mathbf{C\_{2}R\_{2}}\right)}{\left(\mathbf{s^{2}} + \frac{\mathbf{s}\mathbf{C\_{2}R\_{2}}}{\mathbf{C\_{1}C\_{2}R\_{1}R\_{2}}} + \frac{\mathbf{1}}{\mathbf{C\_{1}C\_{2}R\_{1}R\_{2}}}\right)\mathbf{C\_{1}C\_{2}R\_{1}R\_{2}}} \tag{13-6}$$

which has a zero at s = C2R2.

With the approximation C2R2 = 2C1R1, the denominator polynomial is solved for complex poles p1 and p2 of the response, which results in:

$$\mathbf{P\_1} = -\frac{\mathbf{1}}{2\mathbf{C\_1R\_1}} + j\frac{\mathbf{1}}{2\mathbf{C\_1R\_1}}\tag{13-7}$$

$$\mathbf{P}\_2 = -\frac{\mathfrak{I}}{2\mathbf{C}\_1\mathbf{R}\_1} - j\frac{\mathfrak{I}}{2\mathbf{C}\_1\mathbf{R}\_1} \tag{13-8}$$

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. The op-amp used in the circuit is labeled as TLE2227. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (TLE2227)**:
   - The op-amp has two input terminals: the non-inverting input (+) and the inverting input (-).
   - The non-inverting input (+) is connected to the input voltage source labeled as \( V_{IN} \).

2. **Feedback Network**:
   - A capacitor \( C_2 \) with a value of 0.047 F is connected between the inverting input (-) and the output of the op-amp.
   - A resistor \( R_2 \) with a value of 2.15 kΩ is connected between the inverting input (-) and the ground.

3. **Output Network**:
   - The output of the op-amp is connected to a resistor \( R_1 \) with a value of 42.2 Ω.
   - The other end of \( R_1 \) is connected to the output voltage \( V_O \).

4. **Capacitor \( C_1 \)**:
   - A capacitor \( C_1 \) with a value of 1.2 F is connected between the output voltage \( V_O \) and the ground.

5. **Reference**:
   - The reference point is labeled as "REF – (REF +)" and is connected to the ground.

In summary, the circuit is a feedback configuration of an op-amp with specific resistor and capacitor values, designed to achieve a particular transfer function or filtering characteristic. The feedback network includes a capacitor and resistor, and the output network includes a resistor and capacitor to ground.
```

Figure 13–8. Voltage Reference Filter Circuit

The zero in the numerator of the transfer function improves the relative stability of the circuit. Resistor R2 should be kept fairly low, since a small amount of bias current flows through it and causes dc error and noise. Resistor R1 value ranges from 10 Ω to 50 Ω. Resistor R1 is in the feedback loop, so any small leakage current that is due to capacitor C1 flows through R1and the voltage dropped across R1 is divided by the loop gain. For all practical purposes, the voltage across C2 is 0 V and hence give rise to negligible leakage current.

A design example for a 3-kHz bandwidth filter is illustrated:

Choose C1 = 1.2 µF and R1 = 42.2 Ω.

Having determined the value for C1 and R1, the capacitor C2 value is estimated to be approximately 4% to 5% of C1 value (C2 = 0.047 µF) and resistor R2 is calculated using the approximation C2R2 = 2C1R1 (R2 = 2.15 kΩ).

The calculated –3-dB bandwidth for the circuit is 3.1 kHz and this value agrees with the circuit's frequency response plot shown in Figure 13–9. This circuit topology is good for driving large capacitive loads.

Here is the image describtion:
```
The image is a graph that displays the frequency response of a system, showing both amplitude and phase characteristics. The x-axis represents frequency, ranging from 10 Hz to 100 MHz, with logarithmic scaling. The y-axis on the left side represents the output voltage (V_out) in decibels (dB), ranging from 0 dB to -120 dB. The y-axis on the right side represents phase in degrees, ranging from 0 degrees to -350 degrees.

Two curves are plotted on the graph:
1. The amplitude response curve, labeled "Amplitude," starts at 0 dB at low frequencies and gradually decreases as the frequency increases, reaching approximately -100 dB at 100 MHz.
2. The phase response curve, labeled "Phase," starts at 0 degrees at low frequencies and decreases more steeply than the amplitude curve, reaching approximately -300 degrees at 100 MHz.

The graph is divided into several frequency ranges: 10 Hz, 100 Hz, 1 kHz, 10 kHz, 100 kHz, 1 MHz, 10 MHz, and 100 MHz. The amplitude and phase curves show how the system's output changes with frequency, indicating a typical behavior of a low-pass filter where higher frequencies are attenuated and phase shifts occur.
```

Figure 13–9. Voltage Follower Frequency Response Plot

Figure 13–10 shows an external reference circuit that provides a wide adjustment range of the ADC full-scale range. Resistors R281 and R282 play two roles in this circuit:

- Form part of the low-pass filter used to rolloff noise
- Isolate the ADC's reference input load capacitance from the buffer op amp output

Potentiometer R247 sets the external common-mode voltage (Vocm) for the differential amplifier in Figure 13–11.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring operational amplifiers (op-amps) and various resistive components. Here is a detailed description of the circuit:

1. **Power Supply and Reference Voltage:**
   - The circuit is powered by a 10V reference voltage (V_REF) connected at the top left of the diagram.

2. **Voltage Divider Network:**
   - A voltage divider network is formed using resistors R2 (2.21 kΩ), R100 (a 2 kΩ potentiometer), and R1 (1.05 kΩ). This network is connected between the 10V reference voltage and ground.
   - The wiper of the potentiometer R100 can be adjusted to vary the voltage at its output.

3. **Operational Amplifiers:**
   - Two TLE2227 operational amplifiers are used in the circuit.
   - The first op-amp has its non-inverting input connected to the wiper of the potentiometer R100 and its inverting input connected to the output of the op-amp through a feedback resistor R9 (1.1 kΩ).
   - The second op-amp has its inverting input connected to the wiper of the potentiometer R100 and its non-inverting input connected to the output of the op-amp through a feedback resistor R9 (1.1 kΩ).

4. **Output Stage:**
   - The outputs of the two op-amps are connected to a common node through a 2 kΩ potentiometer R247.
   - This common node is then connected to three resistors: R282 (10 Ω), R296 (10 Ω), and R281 (10 Ω).

5. **Capacitors and Outputs:**
   - The node after R282 is connected to a capacitor C196 (4.7 F) and labeled as "REF -".
   - The node after R296 is labeled as "V_OCM OUTPUT".
   - The node after R281 is connected to a capacitor C197 (4.7 F) and labeled as "REF +".

6. **Adjustments:**
   - The potentiometers R100 and R247 allow for fine-tuning of the voltages and the balance of the circuit.

In summary, this circuit appears to be a precision voltage reference or a differential amplifier setup with adjustable reference points and outputs. The use of potentiometers allows for fine adjustments, and the capacitors provide filtering or stabilization at the output nodes.
```

Figure 13–10. External Voltage Reference Circuit for ADC/DAC.

Wireless Communication: Signal Conditioning for IF Sampling 13-17

# **13.8 High-Speed Analog Input Drive Circuits**

Communication ADCs, for the most part, have differential inputs and require differential input signals to properly drive the device. Drive circuits are implemented with either RF transformers or high-speed differential amplifiers with large bandwidth, fast settling time, low output impedance, good output drive capabilities, and a slew rate of the order of 1500 V/µS. The differential amplifier is usually configured for a gain of 1 or 2 and is used primarily for buffering and converting the single-ended incoming analog signal to differential outputs. Unwanted common-mode signals, such as hum, noise, dc, and harmonic voltages are generally attenuated or cancelled out. Gain is restricted to wanted differential signals, which are often 1 V to 2 V.

The analog input drive circuit, as shown in Figure 13–11, employs a complementary bipolar (BiCom) THS4141 device. BiCom offers fast speed, linear operation over a wide frequency range, and wide power-supply voltage range, but draws slightly more current than a BiCMOS device. The circuit closed-loop response is shown in Figure 13–12, where the –3-dB bandwidth is 120 MHz measured at the output of the amplifier. The analog input Vin is ac-coupled to the THS4141 and the dc voltage Vocm is the applied input commonmode voltage. The combination R47– C57 and R26 – C34 are selected to meet the desired frequency rolloff. If the input signal frequency is above 5 MHz, higher-order low-pass filtering techniques (third-order or greater) are employed to reduce the op amp's inherent second harmonic distortion component.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit designed for signal conditioning and analog-to-digital conversion. Here is a detailed description of the components and their connections:

1. **Input Section:**
   - **VIN:** The input signal is labeled VIN.
   - **R27:** A resistor with a value of 49.9 ohms is connected between VIN and ground.
   - **VOCM Input:** This is a common-mode voltage input, connected through a capacitor (0.1 F) to ground and another capacitor (0.01 F) to the non-inverting input of the operational amplifier.

2. **Operational Amplifier (THS4141):**
   - The operational amplifier is labeled THS4141.
   - **R28:** A resistor with a value of 511 ohms is connected between VIN and the non-inverting input of the THS4141.
   - **R32:** A resistor with a value of 511 ohms is connected between the non-inverting input and the output of the THS4141.
   - **R31:** A resistor with a value of 511 ohms is connected between the inverting input and the output of the THS4141.
   - **R36:** A resistor with a value of 523 ohms is connected between the inverting input and ground.
   - **C27:** A capacitor with a value of 1.8 pF is connected in parallel with R31.
   - **C45:** A capacitor with a value of 1.8 pF is connected in parallel with R32.

3. **Output Section:**
   - **R47:** A resistor with a value of 49.9 ohms is connected between the output of the THS4141 and the positive input (IN+) of the ADC.
   - **R26:** A resistor with a value of 49.9 ohms is connected between the inverting input of the THS4141 and the negative input (IN-) of the ADC.
   - **C57:** A capacitor with a value of 47 pF is connected between the positive input (IN+) of the ADC and ground.
   - **C45:** A capacitor with a value of 47 pF is connected between the negative input (IN-) of the ADC and ground.

4. **Analog-to-Digital Converter (ADC):**
   - The ADC is labeled THS1470.
   - The ADC has several pins labeled IN+, IN-, CLK+, CLK-, REF+, and REF-.
   - The output of the ADC is labeled with the number 14.

The circuit is designed to condition the input signal VIN using the THS4141 operational amplifier and then convert the conditioned signal to a digital format using the THS1470 ADC. The resistors and capacitors are used to set the gain, filter the signal, and match impedance.
```

Figure 13–11. Single-Ended to Differential Output Drive Circuit

13-18

Here is the image describtion:
```
The image consists of two graphs, one above the other, both plotted on logarithmic scales for frequency. The graphs are labeled with the model number "THS4141" and the condition "Gain = 1."

### Top Graph: V_out - dBV vs. Frequency
- **Y-Axis (Vertical):** The y-axis represents the output voltage in decibels relative to 1 volt (dBV), ranging from -40 dBV to 10 dBV.
- **X-Axis (Horizontal):** The x-axis represents the frequency in Hertz (Hz), ranging from 100 kHz to 1 GHz.
- **Plot:** The plot shows a frequency response curve that starts flat at 0 dBV and begins to roll off at higher frequencies.
- **Key Point:** The -3 dB point is marked at 120.8 MHz, indicating the frequency at which the output voltage drops by 3 dB from its maximum value.

### Bottom Graph: Phase - Degrees vs. Frequency
- **Y-Axis (Vertical):** The y-axis represents the phase in degrees, ranging from -100 degrees to 200 degrees.
- **X-Axis (Horizontal):** The x-axis represents the frequency in Hertz (Hz), ranging from 100 kHz to 1 GHz.
- **Plot:** The plot shows the phase response curve, which starts at 200 degrees and decreases as the frequency increases.
- **Key Point:** The phase at 120.8 MHz is marked as 38.9 degrees.

### Additional Details:
- **Dashed Vertical Line:** Both graphs have a dashed vertical line at 120.8 MHz, aligning with the -3 dB point in the top graph and the phase value in the bottom graph.
- **Dashed Horizontal Line:** The top graph has a dashed horizontal line at 0 dBV, and the bottom graph has a dashed horizontal line at 0 degrees.

The graphs provide a detailed view of the frequency response and phase response of the THS4141 at a gain of 1, highlighting the -3 dB bandwidth and the corresponding phase shift at that frequency.
```

Figure 13–12. Differential Amplifier Closed-Loop Response

Figure 13–13 shows a design example of an ac-coupled, single-ended analog input drive circuit. This circuit uses a THS3201 current-feedback op amp and operates up to 975 MHz. The amplifier is configured as a noninverting amplifier with a gain of 2, where gain is 1 + R4/R3. In a current-feedback amplifier, the feedback resistor sets the amplifier

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit designed for signal processing, specifically for interfacing an analog signal with an Analog-to-Digital Converter (ADC). Here is a detailed description of the components and their connections:

1. **Input Signal (VIN)**: The circuit starts with an input signal labeled VIN.

2. **Resistor (R5)**: A resistor with a value of 49.9 ohms is connected between the input signal VIN and ground.

3. **Operational Amplifier (THS3201)**: The input signal is fed into the non-inverting input (+) of an operational amplifier labeled THS3201. The inverting input (-) of the op-amp is connected to a network of resistors and capacitors.

4. **Resistors (R3 and R4)**: Two resistors, R3 and R4, both with values of 619 ohms, are connected in a feedback configuration. R3 is connected between the inverting input (-) and ground, while R4 is connected between the output of the op-amp and the inverting input (-).

5. **Capacitor (C16) and Resistor (R7)**: There is a parallel combination of a capacitor (C16) with a value of 4.7 pF and a resistor (R7) with a value of 2 k ohms connected between the inverting input (-) and ground.

6. **Resistor (49.9 ohms)**: Another resistor with a value of 49.9 ohms is connected in series with the output of the op-amp.

7. **Capacitor (C66)**: A capacitor with a value of 100 nF is connected in series after the 49.9-ohm resistor.

8. **Resistor (R)**: A resistor labeled R is connected between the junction of the 100 nF capacitor and the next stage, and a voltage source labeled VOCM.

9. **Capacitor (47 pF)**: A capacitor with a value of 47 pF is connected between the junction of the resistor R and ground.

10. **Analog-to-Digital Converter (THS1470)**: The signal is then fed into an ADC labeled THS1470. The ADC has differential inputs labeled IN+ and IN-, and a common-mode voltage input labeled VCOM.

11. **Capacitor (0.1 F)**: A capacitor with a value of 0.1 F is connected between the VCOM input of the ADC and ground.

The circuit is designed to condition the input signal VIN, amplify it using the THS3201 op-amp, and then interface it with the THS1470 ADC for digital conversion. The resistors and capacitors are used for setting the gain, filtering, and impedance matching to ensure proper signal processing and conversion.
```

bandwidth and the frequency response shape as well as defining the gain of the circuit. R4 and R3 cannot be arbitrary values.

Figure 13–13. ADC Single-Ended Input Drive Circuit

The frequency response plots for a gain of 2, with R3 = R4 = 619 Ω, are shown in Figures 13–13 and 13–14. R4 affects the amplifier bandwidth and frequency response peaking. R3 has no effect on bandwidth and frequency peaking; it only affects the gain. The –3-dB bandwidth is 520 MHz. Increasing the resistance of R4 decreases the bandwidth. Conversely, lowering R4 resistance increases the bandwidth at the expense of increased peaking in the ac response.

The phase plot in Figure 13–14 exhibits a fairly linear phase shift (a flat group delay response) and hence the amplifier output should show excellent signal reproduction.

Unlike a voltage-feedback amplifier, the power supply voltage affects the bandwidth of a current-feedback amplifier. For example, lowering the supply voltage of the THS3201 from ± 5 V to ± 2.5 V reduces the bandwidth from 925 MHz to 350 MHz.

Here is the image describtion:
```
The image is a graph that plots the output voltage (V_OUT) in decibels (dB) against frequency (f) in Hertz (Hz). The x-axis represents the frequency on a logarithmic scale, ranging from 100 kHz (kilohertz) to 1 GHz (gigahertz). The y-axis represents the output voltage in decibels, ranging from -20 dB to 10 dB.

The graph shows a frequency response curve, which is relatively flat at around 5 dB from 100 kHz up to approximately 100 MHz. Beyond 100 MHz, the curve starts to drop off, indicating a decrease in output voltage. The drop becomes more pronounced as the frequency increases, with the output voltage falling below -15 dB as it approaches 1 GHz.

The curve suggests that the system or component being measured has a consistent output voltage up to a certain frequency (around 100 MHz), after which the output voltage significantly decreases, indicating a loss in performance or attenuation at higher frequencies.
```

Figure 13–14. Gain vs Frequency Plot for THS3201

Here is the image describtion:
```
The image is a graph that plots phase in degrees against frequency in Hertz. The x-axis represents the frequency, which is displayed on a logarithmic scale ranging from 100 kHz (kilohertz) to 1 GHz (gigahertz). The y-axis represents the phase in degrees, ranging from 0 degrees at the top to -300 degrees at the bottom.

The graph shows a curve that starts at 0 degrees phase at the lower frequencies (100 kHz) and gradually decreases as the frequency increases. The phase shift becomes more pronounced as the frequency approaches 1 GHz. The curve shows a smooth decline initially, but the rate of phase shift increases significantly as the frequency moves into the higher MHz range and approaches GHz. The curve appears to have a steeper slope beyond 100 MHz, indicating a rapid phase shift, and it continues to drop sharply until it reaches around -250 degrees near 1 GHz.

The grid lines on the graph help to visualize the changes in phase and frequency more clearly, with major and minor grid lines marking the logarithmic scale on the x-axis and the linear scale on the y-axis.
```

Figure 13–15. Phase vs Frequency for THS3201

Wireless Communication: Signal Conditioning for IF Sampling 13-21

# **13.9 References**

[1] Rabiner, L.R., and Gold. B., Theory and Application of Digital signal Processing, Prentice Hall, Englewood Cliffs, New Jersey, 1975

[2] Parks, T.W., and Burrus, C.S., Digital Filter Design, Wiley, New York, NY, 1987

[3] Miller, P., Aspects of Data Acquisition System Design, Analog Application Journal, Texas Instruments, August 1999

[4] Proakis, J.G., Digital Communications, McGraw–Hill Book Company, New York, 1983

[5] Miller, P., and Moore, D., Precision Voltage References, Analog Application Journal, Texas Instruments, November 1999

[6] Miller, P., and Moore, D., The Design and Performance of a Precision Voltage Reference Circuit for 14-Bit and 16-Bit A-to-D and D-to-A Converters, Analog Application Journal, Texas Instruments, May 2000

[7] Daniel H. Sheingold, Analog–Digital Conversion Handbook, 3rd Edition, Prentice Hall, Englewood Cliffs, New Jersey 07632

[8] Graeme J.G., Tobey G.E., and Huelsman L.P., Burr–Brown, Operation Amplifiers Design and Application, McGraw–Hill Book Company, New York, 1971

[9] Schartz, M., Information Transmission, Modulation and Noise, McGraw–Hill Book Company, New York, 1970

[10] Papoulis A., On The Approximation Problem on Filter Design, IRE conv. Record, Pt.2, pp. 175 – 1957

# **Chapter 14**

# **Interfacing D/A Converters to Loads**

#### Bruce Carter

# **14.1 Introduction**

A digital to analog converter, or D/A, is a component that takes a digital word and converts it to a corresponding analog voltage. It has the opposite function of an A/D converter. The D/A is only capable of producing a quantized representation of an analog voltage, not an infinite range of output voltages.

The application will almost always dictate the selection of the D/A converter, leaving the designer the task of interfacing that converter with the output load.

A D/A converter interfaces with a buffer op amp. Most D/A converters are manufactured with a process that is incompatible with op amps. Therefore, the op amp cannot be manufactured on the same IC. It must be external, and its characteristics are an integral part of the conversion process. In most cases, the data sheet will make a recommendation for the selection of a buffer op amp. Follow the recommendation, unless there is a compelling reason not to do so. Performance can be improved only if you know exactly what op amp specifications need to be optimized.

Signal conditioning — low pass filtering, DC offsets, and power stages — should all be placed after the recommended op amp buffer. Do not attempt to combine these functions with the buffer unless you are an experienced designer with a good grasp of all of the implications.

# **14.2 Load Characteristics**

There are two main types of loads that a D/A may have to drive — ac and dc. Each has different characteristics, and will require different interface circuitry.

#### **14.2.1 DC Loads**

These include linear actuators such as those used on positioning tables, motors, programmable power supplies, outdoor displays, and lighting systems. Large load currents and/or high voltages characterize some of these loads. DC accuracy is important, because it is related to a series of desired mechanical positions or intensities in the load device.

#### **14.2.2 AC Loads**

These include linear actuators such as those used on positioning tables, motors, programmable power supplies, outdoor displays, and lighting systems. Large load currents and/or high voltages characterize some of these loads. DC accuracy is important, because it is related to a series of desired mechanical positions or intensities in the load device.

# **14.3 Understanding the D/A Converter and its Specifications**

It is important to understand the D/A converter and its specifications before discussing interfaces.

#### **14.3.1 Types of D/A Converters — Understanding the Tradeoffs**

D/A converters are available in several types, the most common of which is the resistor ladder type. There are several variations on the resistor ladder technique, with the R/2R configuration being the most common.

#### **14.3.2 The Resistor Ladder D/A Converter**

In this type of converter, a precision voltage reference is divided into 2N–1 parts in an internal voltage divider, where N is the number of bits specified for the converter. One switch at a time turns on, corresponding to the correct dc level (Figure 14–1).

Here is the image describtion:
```
The image depicts a digital-to-analog converter (DAC) circuit using a binary-weighted resistor network and an operational amplifier (op-amp) in a summing configuration. Here is a detailed description of the circuit:

1. **Voltage Reference (V_REF):** At the top of the circuit, there is a voltage reference labeled V_REF. This provides a stable reference voltage for the DAC.

2. **Resistor Ladder Network:** The circuit includes a series of resistors, each with the same resistance value R, connected in a ladder configuration. There are four resistors in total, each connected in series.

3. **Binary Switches (B3, B2, B1, B0):** There are four switches labeled B3, B2, B1, and B0. Each switch is connected to a node between the resistors in the ladder network. These switches represent the binary input bits of the DAC. When a switch is closed, it connects the corresponding node to the inverting input of the op-amp. When a switch is open, the node is disconnected.

4. **Operational Amplifier (Op-Amp):** The op-amp is configured as a summing amplifier. The inverting input of the op-amp is connected to the nodes of the resistor ladder network through the switches. The non-inverting input of the op-amp is connected to ground.

5. **Output (V_OUT):** The output of the op-amp is labeled V_OUT. This is the analog output voltage of the DAC, which is a weighted sum of the binary input bits.

The operation of the circuit is as follows:
- The binary input bits (B3, B2, B1, B0) control the switches.
- Depending on the state of each switch (open or closed), different voltages from the resistor ladder network are summed at the inverting input of the op-amp.
- The op-amp amplifies this sum and provides the corresponding analog output voltage at V_OUT.

This type of DAC converts a 4-bit binary input into an analog voltage output, with each bit contributing a specific weighted value to the output based on its position in the binary number.
```

Figure 14–1. Resistor Ladder D/A Converter

14-2

Unfortunately, the number of resistors and switches doubles for each additional bit of resolution. This means that an 8-bit D/A converter would have 255 resistors and 256 switches, and a 16-bit D/A converter would have 65535 resistors and 65536 switches. For this reason, this architecture is almost never used for higher resolution D/A converters.

### **14.3.3 The Weighted Resistor D/A Converter**

This type of converter is very similar to the Resistor Ladder D/A converter. In this case, however, each resistor in the string is given a value proportional to the binary value of the bit it represents. Currents are then summed from each active bit to achieve the output (Figure 14–2).

Here is the image describtion:
```
The image depicts a 4-bit Digital-to-Analog Converter (DAC) circuit using a binary-weighted resistor network and an operational amplifier (op-amp) in an inverting configuration. Here is a detailed description of the circuit:

1. **Reference Voltage (V_REF):** The circuit starts with a reference voltage source labeled as V_REF at the top left corner.

2. **Resistor Network:**
   - The circuit consists of four resistors with values weighted in binary fashion: 8R, 4R, 2R, and R.
   - These resistors are connected in parallel, each linked to a switch that can connect either to V_REF (logic 1) or ground (logic 0).

3. **Binary Inputs (B3, B2, B1, B0):**
   - There are four binary input switches labeled B3, B2, B1, and B0.
   - Each switch can be in one of two positions: connected to V_REF (representing a binary 1) or connected to ground (representing a binary 0).
   - The positions of these switches determine the binary input code to the DAC.

4. **Current Summing Junction (I_IN):**
   - The currents from each resistor branch (I3, I2, I1, I0) are summed at a node labeled I_IN.
   - This node is connected to the inverting input of the operational amplifier.

5. **Operational Amplifier (Op-Amp):**
   - The op-amp is configured in an inverting summing amplifier configuration.
   - The inverting input of the op-amp is connected to the I_IN node through a resistor of value R.
   - The non-inverting input of the op-amp is connected to ground.
   - The output of the op-amp is labeled as V_OUT.

6. **Output Voltage (V_OUT):**
   - The output voltage (V_OUT) is the analog output of the DAC.
   - The value of V_OUT is determined by the binary input code (B3, B2, B1, B0) and the reference voltage (V_REF).

In summary, this circuit converts a 4-bit binary input into a corresponding analog voltage. The binary-weighted resistors ensure that each bit contributes a proportional amount of current to the summing junction, which is then converted to a voltage by the op-amp. The output voltage is an inverted and scaled version of the input binary code.
```

Figure 14–2. Binary Weighted D/A Converter

The number of resistors and switches reduced to one per bit, but the range of the resistors is extremely wide for high-resolution converters, making it hard to fabricate all of them on the IC. The resistor used for B3 is the limiting factor for power dissipation from VREF to ground.

This converter architecture is often used to make logarithmic converters. In this case, the R, 2R, 4R, 8R … resistors are replaced with logarithmically-weighted resistors.

This type of converter, and the R/2R converter described in the next paragraph, use a feedback resistor fabricated on the D/A IC itself. This feedback resistor is not an optional convenience for the designer — it is crucial to the accuracy of the D/A. It is fabricated on the same silicon as the resistor ladder. Therefore, it experiences the same thermal drift as the resistor ladder. The gain of the buffer amplifier is fixed, with a full-scale output voltage limited to VREF. If a different full-scale D/A output voltage is needed, change VREF. If the full scale VOUT must exceed the maximum rating of the D/A reference voltage, use a gain stage after the buffer op amp (see Paragraph 14.7.2).

The op amp must be selected carefully, because it will be operated in much less than unity gain mode for some combinations of bits. This is probably one of the main reasons why this architecture is not popular, as well as the requirement for a wide range of resistor values for high precision converters.

### **14.3.4 The R/2R D/A Converter**

An R/R2 network can be used to make a D/A converter (Figure 14–3).

Here is the image describtion:
```
The image shows a series of resistor networks, each progressively more complex, illustrating the concept of current division in electrical circuits. Here is a detailed description of each circuit from left to right and top to bottom:

1. **First Circuit (Top Left):**
   - A simple series circuit with a voltage source \( V_{REF} \) connected to a resistor \( R \).
   - The current \( I \) flows through the resistor \( R \) and then to ground.

2. **Second Circuit (Top Middle):**
   - A voltage source \( V_{REF} \) connected to a series resistor \( 2R \).
   - The current \( I \) splits into two equal parts \( I/2 \) at the junction, with one path going through the resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).

3. **Third Circuit (Top Right):**
   - A voltage source \( V_{REF} \) connected to a series resistor \( 2R \).
   - The current \( I \) splits into two equal parts \( I/2 \) at the junction, with one path going through the resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).
   - The current \( I/2 \) then splits again into \( I/4 \) at another junction, with one path going through another resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).

4. **Fourth Circuit (Bottom Left):**
   - A voltage source \( V_{REF} \) connected to a series resistor \( 2R \).
   - The current \( I \) splits into two equal parts \( I/2 \) at the junction, with one path going through the resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).
   - The current \( I/2 \) then splits again into \( I/4 \) at another junction, with one path going through another resistor \( R \) and the other path going directly to ground through another resistor \( R \).

5. **Fifth Circuit (Bottom Middle):**
   - A voltage source \( V_{REF} \) connected to a series resistor \( 2R \).
   - The current \( I \) splits into two equal parts \( I/2 \) at the junction, with one path going through the resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).
   - The current \( I/2 \) then splits again into \( I/4 \) at another junction, with one path going through another resistor \( R \) and the other path going directly to ground through another resistor \( R \).
   - The current \( I/4 \) then splits again into \( I/8 \) at another junction, with one path going through another resistor \( R \) and the other path going directly to ground through another resistor \( R \).

6. **Sixth Circuit (Bottom Right):**
   - A voltage source \( V_{REF} \) connected to a series resistor \( 2R \).
   - The current \( I \) splits into two equal parts \( I/2 \) at the junction, with one path going through the resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).
   - The current \( I/2 \) then splits again into \( I/4 \) at another junction, with one path going through another resistor \( R \) and the other path going directly to ground through another resistor \( R \).
   - The current \( I/4 \) then splits again into \( I/8 \) at another junction, with one path going through another resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).
   - The current \( I/8 \) then splits again into \( I/16 \) at another junction, with one path going through another resistor \( 2R \) and the other path going directly to ground through another resistor \( 2R \).

Each circuit demonstrates the principle of current division, where the current splits at each junction according to the resistances in the paths. The complexity increases from left to right and top to bottom, showing more stages of current division.
```

Figure 14–3. R/2R Resistor Array

For a given reference voltage VREF, a current I flows through resistor R. If two resistors, each the same value (2R) are connected from VREF to ground, a current I/2 flows through each leg of the circuit. But the same current will flow if one leg is made up of two resistors, each with the value of R. If two resistors in parallel whose value is 2R replace the bottom resistor, the parallel combination is still R. I/4 flows through both legs, adding to I/2. Extending the network for 4 bits as shown on the right, the total current on the bottom leg is I/4 plus I/8 plus I/16 plus I/16 in the resistor to ground. Kirchoff's current law is satisfied, and convenient tap points have been established to construct a D/A converter (Figure 14–4):

Here is the image describtion:
```
The image depicts a 4-bit Digital-to-Analog Converter (DAC) circuit using an R-2R ladder network. Here is a detailed description of the components and their connections:

1. **Voltage Reference (V_REF)**: The circuit starts with a voltage reference source labeled V_REF on the left side.

2. **Resistors**: The circuit consists of resistors arranged in a specific pattern:
   - Four resistors labeled R are connected in series horizontally.
   - Each of these R resistors is connected to a pair of resistors labeled 2R, which are connected vertically.

3. **Binary Switches (B3, B2, B1, B0)**: There are four switches labeled B3, B2, B1, and B0. Each switch can be in one of two positions, representing binary states 1 or 0:
   - B3 is connected to the first pair of 2R resistors.
   - B2 is connected to the second pair of 2R resistors.
   - B1 is connected to the third pair of 2R resistors.
   - B0 is connected to the fourth pair of 2R resistors.

4. **Binary Inputs (I3, I2, I1, I0)**: The binary switches are controlled by binary inputs I3, I2, I1, and I0, which determine the position of each switch (either connected to V_REF or ground).

5. **Current Summing Node (I_IN)**: The bottom ends of the 2R resistors are connected to a common node labeled I_IN, which sums the currents from the different branches of the R-2R ladder network.

6. **Operational Amplifier**: The current summing node I_IN is connected to the inverting input of an operational amplifier (op-amp). The non-inverting input of the op-amp is grounded.

7. **Feedback Resistor (R)**: There is a feedback resistor labeled R connected between the output of the op-amp (V_OUT) and the inverting input (I_IN).

8. **Output Voltage (V_OUT)**: The output voltage of the DAC is taken from the output of the op-amp, labeled V_OUT.

The R-2R ladder network and the op-amp together convert the binary input (I3, I2, I1, I0) into an analog output voltage (V_OUT). The binary inputs control the switches, which determine the contribution of each bit to the final output voltage. The op-amp ensures that the output voltage is proportional to the weighted sum of the binary inputs.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 14–4. R2R D/A Converter." This suggests that it is a label for a figure in a document, likely a textbook or technical manual, which depicts an R2R digital-to-analog (D/A) converter. The R2R D/A converter is a type of digital-to-analog converter that uses a resistor ladder network consisting of resistors of two values, R and 2R, to convert digital signals into analog voltages. The figure itself is not shown, but the caption indicates that it would illustrate the configuration and operation of such a converter.
```

This converter architecture has advantages over the types previously mentioned. The number of resistors has doubled from the number required for the current-summing type, but there are only two values. Usually, the 2R resistors are composed of two resistors in series, each with a value of R. The feedback resistor for the buffer amplifier is again fabricated on the converter itself for maximum accuracy. Although the op amp is still not operated in unity gain mode for all combinations of bits, it is much closer to unity gain with this architecture.

The important op amp parameters for all resistor ladder D/As are:

- Input offset voltage — the lower the better. It adds to the converter offset error.
- Input bias current — the lower the better. The product of the bias current and the feedback resistance creates an output offset error.
- Output voltage swing — it must meet or preferably exceed the zero to full-scale swing from the D/A.
- Settling time and slew rate — must be fast enough to allow the op amp to settle before the next digital bit combination is presented to the D/A input register.

### **14.3.5 The Sigma Delta D/A Converter**

The sigma delta D/A converter takes advantage of the speed of advanced IC processes to do a conversion as a series of approximations summed together. A phase-locked loopderived (PLL) sample clock operates at many times the overall conversion frequency in the case shown in Figure 14–5, it is 128×. The PLL is used to drive an interpolation filter, a digital modulator, and a 1-bit D/A converter. The conversion is done by using the density ratio of the voltage out of the 1-bit D/A as the analog signal. As the pattern of 1s and 0s is presented to the 1-bit converter, their time average at the sample frequency recreates the analog waveform.

Here is the image describtion:
```
The image is a block diagram of a digital signal processing system. Here is a detailed description of each component and the flow of data:

1. **Sample Clock (Fs)**: This is the input clock signal that sets the sampling rate for the system.

2. **PLL (Phase-Locked Loop)**: The sample clock (Fs) is fed into a PLL, which generates a higher frequency clock signal. In this case, the output of the PLL is 128 times the input sample clock frequency (128 Fs).

3. **Interpolation Filter**: The data input, which is 16 bits wide, enters the interpolation filter. The interpolation filter increases the sample rate of the input data, effectively interpolating the data to a higher rate. The output of the interpolation filter is also 16 bits wide.

4. **Digital Modulator**: The 16-bit output from the interpolation filter is then fed into the digital modulator. The digital modulator processes the data and converts it into a 1-bit data stream.

5. **1-Bit D/A (Digital-to-Analog Converter)**: The 1-bit output from the digital modulator is sent to a 1-bit digital-to-analog converter, which converts the digital signal into an analog signal.

The flow of data starts from the 16-bit data input, goes through the interpolation filter, then through the digital modulator, and finally through the 1-bit D/A converter to produce the output signal. The entire process is synchronized by the sample clock (Fs) and the higher frequency clock generated by the PLL (128 Fs).
```

Figure 14–5. Sigma Delta D/A Converter

Sigma delta converters are popular for audio frequencies, particularly CD players. The primary limiting factor is the sample clock. CD players operate at a sample rate of 44.1 kHz, which means that according to Nyquist sampling theory, the maximum audio frequency that can be reproduced is 22.05 kHz. If an audio frequency of 23.05 kHz is present in the recorded material, it will alias back into the audio output at 1 kHz — producing an annoying whistle. This places a tremendous constraint on the low-pass filter following the D/A in a CD player. It must reject all audio frequencies above 22.05 kHz while passing those up to 20 kHz, the commonly accepted upper limit of human hearing. While this can be done in conventional filter topologies, they are extremely complex (9 or more poles). Inevitably, phase shift and amplitude rolloff or ripple will start far below 20 kHz. The original CD players often sounded a bit "harsh" or "dull" because of this.

The solution was to overclock the sample clock. To keep things simple, designers made it a binary multiple of the original sampling frequency. Today, 8× or even higher oversampling is standard in CD players. Little do the audio enthusiasts know that the primary reason why this was done was to substantially reduce the cost of the CD player! A faster sample clock is very cheap. Nine-pole audio filters are not. At 8× oversampling, the CD player only needs to achieve maximum rolloff at 352.8 kHz — a very easy requirement. Instead of the filter having to roll off in a mere 2 kHz of bandwidth, now it has 332 kHz of bandwidth to accomplish the rolloff. The sound of an oversampled CD player really is better, but it comes at the cost of increased radiated RFI, coming from the sample clock.

Sigma delta converters introduce a great deal of noise onto the power rails, because the internal digital circuitry is continually switching to the power supply rails at the sample clock frequency FS.

# **14.4 D/A Converter Error Budget**

The system designer must do an error budget to know how many bits are actually needed to meet the system requirements — how much "graininess" or what step size is acceptable in the output signal.

### **14.4.1 Accuracy versus Resolution**

It is important for the designer to understand the difference between converter accuracy and converter resolution. The number of bits determines resolution of a converter. Insufficient resolution is not error — it is a design characteristic of the D/A. If a given converter's resolution is insufficient, use a converter with better resolution (more bits).

Accuracy is the error in the analog output from the theoretical value for a given digital input. Errors are described in the next paragraph. A very common method of compensating for D/A error is to use a converter that has one or two bits more resolution than the application requires. With the cost of converters coming down, and more advanced models being introduced every day, this may be cost effective.

### **14.4.2 DC Application Error Budget**

DC applications will depend on the value of dc voltage coming out of the converter. THD and signal-to-noise will not be important because the frequency coming out of the converter is almost dc.

The resolution of a converter is ±1/2 LSB, where an LSB is defined as:

$$\mathsf{T}\mathsf{L}\mathsf{SB} = \frac{\mathsf{V}\_{\mathsf{FS}}}{\mathsf{2}^{\mathsf{N}} - \mathsf{T}} \tag{14-1}$$

Where:

VFS Full-scale output voltage N Number of converter bits

The number of bits in a dc system determines the dc step size that corresponds to a bit. Table 14–1 shows the number of bits, and the corresponding voltage step size for three popular voltages:

Table 14–1. DC Step Size for D/A converters

| BITS | STATES   | 3 V       | 5 V       | 10 V      |
|------|----------|-----------|-----------|-----------|
| 4    | 16       | 0.1875    | 0.3125    | 0.625     |
| 8    | 256      | 0.011719  | 0.019531  | 0.039063  |
| 10   | 1024     | 0.00293   | 0.004883  | 0.009766  |
| 12   | 4096     | 0.000732  | 0.001221  | 0.002441  |
| 14   | 16384    | 0.000183  | 0.000305  | 0.00061   |
| 16   | 65536    | 4.58 E–05 | 7.63 E–05 | 0.000153  |
| 18   | 262144   | 1.14 E–05 | 1.91 E–05 | 3.81 E–05 |
| 20   | 1048576  | 2.86 E–06 | 4.77 E–06 | 9.54 E–06 |
| 22   | 4194304  | 7.15 E–07 | 1.19 E–06 | 2.38 E–06 |
| 24   | 16777216 | 1.79 E–07 | 2.98 E–07 | 5.96 E–07 |

Interfacing D/A Converters to Loads 14-7

The bit step size can get critical, especially for portable equipment. There is a requirement to operate off of low voltage, to minimize the number of batteries. The buffer amplifier, if it includes gain, will use large resistor values, lowering its noise immunity. Fortunately, the vast majority of dc applications are not portable; they are in an industrial environment.

For example: A converter is used to position a drill on a table used to drill PCB holes. The positions of the holes are specified as 0.001 inches, ±0.0003 inches. The actuators are centered on the table at zero volts, with full negative position of –12 inches occurring at –5 V, and full positive position of +12 inches occurring at +5 V. There are two actuators, one for vertical, and one for horizontal.

This example has several aspects. The first is that the positioning voltage has to swing both positive and negative. In the real world, it may be necessary to add (or subtract in this case) a fixed offset to the D/A output. The output voltage has to swing over a 10-V range, which may mean that the output of the D/A has to be amplified. The actuators themselves probably operate off of higher current than the D/A is designed to provide. Section 14.7 covers some methods for meeting these requirements.

Assume, for now, that the D/A has the necessary offset and gain. A ±12 inch position is 24 inches total, which corresponds to ±5 V from the D/A circuitry. The 24-inch range must be divided into equal 0.0003-inch steps to meet the resolution requirement, which is 80,000 steps. From Table 14–1, an 18-bit D/A converter is required. The actual system will be able to position with a step size of 0.0000916 inches. Two independent conversion systems are needed, one for horizontal and one for vertical.

# **14.4.3 AC Application Error Budget**

The error budget for an ac application will most likely be specified as total harmonic distortion, dynamic range, or signal-to-noise ratio. Assuming no internal noise, and no noise in the buffer op amp circuitry, the inverse of the dynamic range is the signal-to-noise ratio of the converter D/A. Of course, noise is always present, and is measured with all input data set to zero. Noise will make the S/N ratio decrease.

The number of converter bits, however, is the overwhelming factor determining these parameters. Technically, they are not "errors", because the design of the converter sets them. If the designer cannot live with these design limits, the only choice is to specify a converter with better resolution (more bits).

#### **14.4.3.1 Total Harmonic Distortion**

The total harmonic distortion of an ideal D/A converter is the quantization noise due to the converter resolution. The number of bits of the converter determines the lowest possible total harmonic distortion. The greater the number of bits, the lower the amplitude of the harmonics, as shown in Figure 14–6.

Here is the image describtion:
```
The image is a graph that displays the amplitude (in decibels, dB) versus frequency (in Hertz, Hz). The x-axis represents the frequency ranging from 0 Hz to 10 kHz, while the y-axis represents the amplitude ranging from -130 dB to 20 dB.

The graph shows a series of peaks at specific frequencies. The highest peak, labeled "Fundamental F," occurs at 1 kHz with an amplitude of approximately -20 dB. This peak represents the fundamental frequency of the signal.

Following the fundamental frequency, there are several smaller peaks labeled as harmonics. These harmonics are denoted as H2, H3, H4, H5, H6, H7, H8, and H9, corresponding to frequencies of 2 kHz, 3 kHz, 4 kHz, 5 kHz, 6 kHz, 7 kHz, 8 kHz, and 9 kHz respectively. Each harmonic peak has a lower amplitude compared to the fundamental frequency, with amplitudes ranging from approximately -80 dB to -100 dB.

The graph indicates that the signal contains a fundamental frequency at 1 kHz and its harmonics at integer multiples of the fundamental frequency. The amplitude of the harmonics decreases as the frequency increases. The background noise level is relatively low, remaining around -120 dB across the frequency spectrum.
```

Figure 14–6. Total Harmonic Distortion

Assuming ideal D/A conversion, there is a direct relationship between the number of bits and the THD caused by the resolution:

$$\mathsf{THD(\%)} = \frac{\mathsf{T}}{\mathsf{Z^N}} \times \mathsf{100} \tag{14-2}$$

Where N is the number of converter bits. Of course, this is the limit for ideal conversion.

#### **14.4.3.2 Dynamic Range**

There is also a direct relationship between the number of bits (n) and the maximum dynamic range of the D/A (Equation 14–2 and Table 14–2):

$$\text{Dynamic } \mathsf{Rangse} = \mathsf{6.02} \times \mathsf{n} + \mathsf{1.76} \tag{14-3}$$

Notice that there is approximately a 6-dB improvement in dynamic range per bit. This is an easy way to figure out what improvement can be realized by increasing the number of bits from one value to another.

| BITS | STATES   | THD       | Dynamic Range |
|------|----------|-----------|---------------|
| 4    | 16       | 6.25%     | 25.8          |
| 8    | 256      | 0.390625% | 49.9          |
| 10   | 1024     | 0.097656% | 62.0          |
| 12   | 4096     | 0.024414% | 74.0          |
| 14   | 16384    | 0.006104% | 86.0          |
| 16   | 65536    | 0.001526% | 98.1          |
| 18   | 262144   | 0.000381% | 110.1         |
| 20   | 1048576  | 0.000095% | 122.2         |
| 22   | 4194304  | 0.000024% | 134.2         |
| 24   | 16777216 | 0.000006% | 146.2         |

Table 14–2. Converter Bits, THD, and Dynamic Range

For example, if the designers of a CD player want to have a 90-dB signal-to-noise ratio, they would pick a 16-bit converter from Table 14–2. The THD is 0.0015% minimum.

#### **14.4.4 RF Application Error Budget**

RF applications are a high-frequency subset of ac applications. RF applications may be concerned with the position and relative amplitude of various harmonics. Minimizing one harmonic at the expense of another may be acceptable if the overall RF spectrum is within specified limits.

# **14.5 D/A Converter Errors and Parameters**

The D/A errors described in this section will add to the errors caused by the resolution of the converter.

This section is divided into dc and ac sections, but many of the dc errors masquerade as ac errors. A given D/A may or may not include either dc or ac error specifications. This should give the designer a clue that the device is optimized for dc or ac applications. Like any component, D/A converters are designed with tradeoffs. It is possible to misapply a converter meant for high-frequency ac operation in a dc application, etc.

#### **14.5.1 DC Errors and Parameters**

The following paragraphs describe D/A dc errors and parameters.

#### **14.5.1.1 Offset Error**

The analog output voltage range for the complete range of input bits may be shifted linearly from the ideal 0 to full-scale value (Figure 14–7). The offset error is the ±∆ V from 0 V that results when a digital code is entered that is supposed to produce 0.

Here is the image describtion:
```
The image is a graph that illustrates the concept of offset error in a digital-to-analog converter (DAC). The graph has two axes: the horizontal axis represents the Digital Output Code, and the vertical axis represents the Analog Output Voltage.

1. **Axes and Labels**:
   - The horizontal axis (Digital Output Code) is labeled with binary codes: 000, 001, 010, and 011.
   - The vertical axis (Analog Output Voltage) is labeled with voltage values: 0, 1, 2, and 3.

2. **Lines and Points**:
   - There are two lines on the graph: a dashed line labeled "Ideal" and a solid line labeled "Actual".
   - The dashed "Ideal" line starts at the origin (0,0) and increases linearly, passing through the points corresponding to each digital output code.
   - The solid "Actual" line starts at a point above the origin, indicating an offset, and also increases linearly but is shifted upwards compared to the ideal line.

3. **Offset Error**:
   - The graph highlights the concept of "Offset Error" by showing the difference between the actual and ideal lines.
   - The "Actual Offset" is marked on the vertical axis, showing the starting point of the actual line above the origin.
   - The "Offset Error" is quantified as "+ 1 1/4 LSB" (Least Significant Bit), indicating the amount by which the actual output voltage is higher than the ideal output voltage for a given digital code.

4. **Annotations**:
   - The graph includes annotations pointing to the actual and ideal lines, as well as the actual offset and offset error.
   - The "Actual" annotation points to the solid line, while the "Ideal" annotation points to the dashed line.
   - The "Actual Offset" annotation points to the starting point of the actual line on the vertical axis.
   - The "Offset Error" annotation points to the horizontal distance between the ideal and actual lines for the digital output code 010.

Overall, the image effectively demonstrates how an offset error affects the output of a DAC, showing the deviation of the actual output from the ideal output.
```

Figure 14–7. D/A Offset Error

Related to the offset error is the offset error temperature coefficient, which is the change in offset over temperature. This is usually specified in ppm/-C.

Offset error is critical in dc applications. For this reason, a buffer op amp must be selected that does not contribute to the problem — its own offset voltages should be much less than that of the converter. In ac applications, the offset error is not important and can be ignored. The buffer op amp can be selected for low THD, high slew rate, or whatever other parameters are important for the application.

#### **14.5.1.2 Gain Error**

The gain of the D/A converter may greater than or less than the gain needed to produce the desired full-scale analog voltage (Figure 14–8). The gain error is the difference in slope between the ideal D/A output gain and the actual gain.

Here is the image describtion:
```
The image is a graph that illustrates the relationship between the digital input code and the analog output value in a digital-to-analog converter (DAC). The x-axis represents the digital input code, ranging from 000 to 111, while the y-axis represents the analog output value, ranging from 0 to 7.

There are two lines plotted on the graph:
1. The dashed line represents the "Ideal" output, which is a straight line indicating the expected linear relationship between the digital input code and the analog output value.
2. The solid line represents the "Actual Gain," which shows the real output of the DAC. This line is slightly below the ideal line, indicating a deviation from the expected output.

The graph highlights a "Gain Error" of -1 1/4 LSB (Least Significant Bit), which is the difference between the ideal and actual output values. This error is depicted by a vertical arrow pointing from the ideal line to the actual line at the digital input code 111.

The graph also includes labels to indicate the "Ideal" and "Actual Gain" lines, as well as the "Gain Error." The ideal line starts at the origin (0,0) and increases linearly, while the actual gain line starts slightly above the origin and increases at a slightly lower rate than the ideal line.
```

Figure 14–8. D/A Gain Error

Related to the gain error is the gain error temperature coefficient, which is the change in gain over temperature.

Gain error can be critical in both ac and dc applications. For example:

- An RF predriver must not cause the output stage to exceed FCC license requirements.
- A mechanical positioner must not stop short of or go past its intended position.

The op amp buffer should be operated with the internal feedback resistor. If possible, fullscale amplitude adjustments should be made to VREF. This way, tolerances and thermal drift in external resistors do not contribute to the gain error.

#### **14.5.1.3 Differential Nonlinearity Error**

When the increase in output voltage (∆V) is not the same for every combination of bits, the converter has a differential nonlinearity error (DNL). If the DNL exceeds 1 LSB, the converter is nonmonotonic. This can cause a problem for some servo control loops. A nonmonotonic D/A would appear in Figure 14–9 as a momentary dip in the analog output characteristic.

Here is the image describtion:
```
The image is a graph that illustrates the relationship between digital input codes and their corresponding analog output values. The x-axis represents the digital input code, ranging from 000 to 101, while the y-axis represents the analog output value, ranging from 0 to 6.

The graph shows a series of points connected by a line, indicating the analog output values for each digital input code. The line generally follows an upward trend, indicating that higher digital input codes correspond to higher analog output values.

Key features of the graph include:
1. The line starts at the origin (0,0) for the digital input code 000.
2. The line rises steeply from 000 to 001, indicating a significant increase in the analog output value.
3. The line continues to rise, but at a more gradual rate, as the digital input code increases from 001 to 101.

The graph also highlights Differential Non-Linearity (DNL) errors at specific points:
1. At the digital input code 011, there is a DNL error of +1/4 LSB (Least Significant Bit), indicating that the actual analog output value is slightly higher than the ideal value.
2. At the digital input code 100, there is a DNL error of -1/4 LSB, indicating that the actual analog output value is slightly lower than the ideal value.

The graph includes annotations showing the magnitude of 1 LSB and the DNL errors at the specified points. The DNL error is the deviation of the actual step size from the ideal step size, and it is measured in fractions of an LSB.

Overall, the graph provides a visual representation of how the analog output value changes with different digital input codes and highlights the presence of DNL errors in the conversion process.
```

Figure 14–9. Differential Nonlinearity Error

#### **14.5.1.4 Integral Nonlinearity Error**

The integral nonlinearity error is similar to the differential nonlinearity error, except it is a first-order effect that stretches across the entire range from 0 to full scale output voltage (Figure 14–10).

Here is the image describtion:
```
The image is a graph that illustrates the relationship between the digital input code and the analog output value. The x-axis represents the digital input code in binary format, ranging from 000 to 111, while the y-axis represents the analog output value, ranging from 0 to 7.

The graph features a solid line that represents the ideal linear relationship between the digital input code and the analog output value. This line is perfectly diagonal, indicating a direct proportionality between the input and output.

There are also data points plotted on the graph, which are represented by small black dots. These points are connected by a dashed line, which shows the actual output values. The dashed line closely follows the ideal solid line but deviates slightly at certain points, indicating small errors in the output.

Two specific points of deviation are highlighted on the graph:
1. At Step 001 (binary), the analog output value is shown to be off by 1/4 of the Least Significant Bit (LSB).
2. At Step 011 (binary), the analog output value is shown to be off by 1/2 of the LSB.

An arrow labeled "End-Point Linear Error" points to the deviation at Step 011, indicating that this is a measure of the linearity error at the end points of the range.

The graph is enclosed within a dashed box, which represents the maximum possible range for both the digital input code and the analog output value. The dashed box extends from 000 to 111 on the x-axis and from 0 to 7 on the y-axis.
```

Figure 14–10. Integral Nonlinearity Error

Both the INL and DNL errors affect ac applications as distortion and spectral harmonics (spurs). In dc applications, they will result in an error in the dc output voltage. The mechanical steps of a positioning table, for instance, may not be exact increments.

#### **14.5.1.5 Power Supply Rejection Ratio**

The power supply rejection ratio is sometimes called the power supply sensitivity. It is the ability of the converter to reject ripple and noise on its power inputs. DC applications may not be adversely affected. Poor power supply rejection can cause spurs and harmonic distortion in ac applications, as external frequency components leak into the output and modulate with it. The designer must decouple the D/A and buffer op amp carefully to combat these problems.

### **14.5.2 AC Application Errors and Parameters**

The following paragraphs describe D/A ac errors and parameters.

#### **14.5.2.1 THD+N**

There will always be some noise that is generated internally in the converter and buffer amp. A useful specification for audio and communication system designers is the THD+N (total harmonic distortion plus noise). The distortion plus noise (THD+N) is the ratio of the sum of the harmonic distortion and noise to the rms power of the input signal. As was the case with op amp parameters (Chapter 11), the noise sources add according to the rootmean-square law. The distortion and noise are measured separately and then added together to form the ratio. The noise voltage relates to the measured bandwidth.

#### **14.5.2.2 SINAD**

The signal-to-noise and distortion (SINAD) is the ratio of the input signal to the sum of the harmonic distortion and noise. The distortion and noise are measured separately and than added together to form the ratio. The SINAD is the reciprocal to the THD+N. The SI-NAD and THD+N are a good indication of the overall dynamic performance of the ADC, because all components of noise and distortion are included.

#### **14.5.2.3 ENOB**

The SINAD is used to determine the effective number of bits (ENOB) of accuracy the converter displays at that frequency. For example, a nominal 8-bit resolution D/A may be specified as having 45-dB SNR at a particular input frequency. The number of effective bits is defined as

$$\mathsf{ENOB} = \frac{\mathsf{SNR}\_{\mathsf{REAL}} - \mathsf{1.76}}{6.02} = \mathsf{7.2} \text{ bits} \tag{14-4}$$

The actual performance of the device is therefore less than its nominal resolution at this frequency.

#### **14.5.2.4 Spurious Free Dynamic Range**

Spurious free dynamic range is the difference in dB between the maximum signal component and the largest distortion component (Figure 114–11):

Here is the image describtion:
```
The image is a graph that displays a frequency spectrum, with the x-axis representing frequency in Hertz (Hz) and the y-axis representing amplitude in decibels (dB). The frequency range spans from 0 Hz to 10 kHz, and the amplitude range spans from -130 dB to 20 dB.

Key features of the graph include:

1. **Fundamental Frequency (F):** There is a prominent peak at 1 kHz, labeled as the "Fundamental — F." This peak reaches an amplitude of 0 dB, indicating it is the primary frequency component of the signal.

2. **Spurious-Free Dynamic Range (SFDR):** An arrow labeled "SFDR" points from the fundamental frequency peak at 1 kHz to another peak at 3 kHz. The SFDR is a measure of the ratio between the amplitude of the fundamental frequency and the largest spurious signal (in this case, the peak at 3 kHz).

3. **Harmonics and Spurious Signals:** There are additional smaller peaks at regular intervals (2 kHz, 3 kHz, 4 kHz, 5 kHz, 6 kHz, 7 kHz, 8 kHz, 9 kHz, and 10 kHz). These peaks are significantly lower in amplitude compared to the fundamental frequency, with the highest spurious peak at 3 kHz.

4. **Noise Floor:** The baseline of the graph, which represents the noise floor, is relatively flat and hovers around -120 dB, indicating a low level of background noise.

Overall, the graph illustrates the frequency components of a signal, highlighting the fundamental frequency and the spurious-free dynamic range, with additional harmonic and spurious signals present at various intervals.
```

Figure 14–11. Spurious Free Dynamic Range

It is an important specification in RF applications, where FCC regulations specify the magnitude of spurs.

Improper decoupling may cause spurs. A notch filter can be used to eliminate a spur, but many RF applications are RF agile — changing the frequency of the spur as well. The notch must catch all spur frequencies, or it is useless.

#### **14.5.2.5 Intermodulation Distortion**

The differential and integral nonlinearity errors described previously appear in a high-frequency ac application as intermodulation distortion (Figure 14–12).

Here is the image describtion:
```
The image is a graph that displays a frequency spectrum with amplitude in decibels (dB) on the vertical axis and frequency in Hertz (Hz) on the horizontal axis. The amplitude scale ranges from -130 dB to 20 dB, and the frequency scale ranges from 0 Hz to 10 kHz, with major ticks at every 1 kHz interval.

Several distinct peaks are labeled on the graph, indicating specific frequencies and their corresponding amplitudes. The labeled peaks are as follows:

1. A peak at approximately 1 kHz labeled "f2 - f1".
2. A peak at approximately 3 kHz labeled "2f1 - f2".
3. A peak at approximately 4 kHz labeled "f1".
4. A peak at approximately 5 kHz labeled "f2".
5. A peak at approximately 6 kHz labeled "2f2 - f1".
6. A peak at approximately 9 kHz labeled "f1 + f2".

The peaks at 4 kHz and 5 kHz, labeled "f1" and "f2" respectively, are the most prominent, reaching the highest amplitude levels. The other peaks are significantly lower in amplitude, indicating they are harmonics or intermodulation products of the primary frequencies f1 and f2. The background noise level is relatively low, hovering around -120 dB across the frequency spectrum.
```

Figure 14–12. Intermodulation Distortion

The best method of combating intermodulation distortion is to make the buffer amplifier system as linear as possible (beware of rail-to-rail op amps that may not be linear near the voltage rails). Try to limit current through the internal feedback resistor in the DAC. See Paragraph 14.7.1 on increasing the voltage rail for suggestions about reducing internal feedback resistor power dissipation.

## **14.5.2.6 Settling Time**

The settling time of a D/A converter is the time between the switching of the digital inputs of the converter and the time when the output reaches its final value and remains within a specified error band (Figure 14–13). Settling time is the reciprocal of the maximum D/A conversion rate.

Here is the image describtion:
```
The image is a graph that illustrates the response of an analog output voltage to a digital change over time. The x-axis represents time (t), and the y-axis represents the analog output voltage.

Key elements of the graph include:

1. **Digital Change**: This is the initial event that triggers the response in the analog output voltage. It is marked at the origin of the graph.

2. **Delay Time**: This is the initial period after the digital change during which there is no significant change in the analog output voltage. It is the time taken for the system to start responding to the digital change.

3. **Glitch**: This is a small, brief deviation in the analog output voltage that occurs shortly after the delay time. It is a transient spike or dip before the output starts to follow the intended path.

4. **Slew Rate**: This is the rate at which the analog output voltage changes after the initial delay and glitch. It represents how quickly the voltage rises or falls towards the final value.

5. **Settling Time (t_s)**: This is the total time taken for the analog output voltage to settle within a specified error band around the final value after the digital change. It includes the delay time, the time taken to reach the peak, and the time taken to settle within the error band.

6. **Error Band**: This is a range around the final value within which the analog output voltage is considered to have settled. It is typically defined by a percentage of the final value.

7. **Final Value**: This is the target or desired value of the analog output voltage after the system has responded to the digital change and settled within the error band.

The graph shows the analog output voltage initially remaining constant during the delay time, then experiencing a glitch, followed by a rapid change (slew rate) towards the final value. The voltage overshoots and oscillates before finally settling within the error band around the final value.
```

Here is the image describtion:
```
The image is a caption or label for a figure in a document, likely a textbook or technical manual. The caption reads "Figure 14–13. D/A Settling Time." This indicates that the figure is the 13th figure in Chapter 14 of the document, and it pertains to the concept of "D/A Settling Time," which refers to the time it takes for a digital-to-analog converter (DAC) to stabilize to its final output value after a change in input. The caption is written in a standard font and style typically used in technical documentation.
```

When an output buffer op amp is used with a D/A, it becomes a part of the settling time/ conversion rate calculations.

Related to the settling time is a glitch response that occurs when the digital code changes state. Even though this effect is transitory in nature, it can result in noise or harmonics when used in fast AC applications. The best way of reducing the glitch is to properly decouple the D/A and op amp buffer (see Chapter 17). In extreme cases, a deglitching circuit may be needed (Figure 14–14).

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring a sample-and-hold circuit. Here is a detailed description of the components and their connections:

1. **Buffer Out**: This is the input signal to the circuit, labeled as "BUFFER OUT". It is connected to a resistor labeled "R".

2. **Resistors (R)**: There are two resistors in the circuit, both labeled "R". The first resistor is connected between the "BUFFER OUT" and a switch. The second resistor is connected between the output of the switch and the inverting input (-) of an operational amplifier (op-amp).

3. **Switch**: The switch is controlled by a signal labeled "CONTROL". It has two positions: one connects the resistor from "BUFFER OUT" to the second resistor and the inverting input of the op-amp, and the other position connects the second resistor to ground.

4. **Operational Amplifier (Op-Amp)**: The op-amp has its non-inverting input (+) connected to ground. The inverting input (-) is connected to the second resistor and also to a capacitor labeled "C_HOLD".

5. **Capacitor (C_HOLD)**: This capacitor is connected between the inverting input (-) of the op-amp and its output.

6. **Deglitched Output**: The output of the op-amp is labeled "DEGLITCHED OUTPUT".

The circuit functions as follows:
- When the switch is in the position connecting the resistors, the input signal from "BUFFER OUT" is passed through the resistors to the inverting input of the op-amp.
- The capacitor "C_HOLD" stores the voltage at the inverting input of the op-amp.
- The op-amp outputs a voltage that is held constant by the capacitor when the switch is in the position connecting the second resistor to ground.
- This results in a stable output signal labeled "DEGLITCHED OUTPUT", which is free from transient glitches that might occur in the input signal.

Overall, this circuit is designed to sample the input signal and hold its value, providing a stable output.
```

Here is the image describtion:
```
The image is a snippet of text that appears to be a caption for a figure in a document, likely a technical or engineering manual. The text reads: "Figure 14-14. D/A Deglitch Circuit." This suggests that the figure labeled as 14-14 in the document is an illustration or diagram of a Digital-to-Analog (D/A) deglitch circuit, which is a type of electronic circuit used to minimize or eliminate glitches in the output signal of a digital-to-analog converter. The text is in a standard font and is likely part of a larger section discussing D/A conversion and related circuitry.
```

This technique relies on the software designer to balance the timing of the control signal so it activates the hold function right before the D/A input code changes, then releases the hold right after the code has changed. The selection of CHOLD is critical — it must hold the buffer output without droop and without compromising system bandwidth.

# **14.6 Compensating For DAC Capacitance**

D/A converters are constructed of either bipolar or CMOS technology, with CMOS being the more common. CMOS transistors, however, have a lot of capacitance. This capacitance will add in D/A converters, depending on the number of resistors switched on or off. Capacitance at an inverting op amp input is a good way to cause it to oscillate, especially since some buffer amplifiers will be operated at less than unity gain. The converter capacitance CO must be compensated for externally (Figure 14–15).

Here is the image describtion:
```
The image depicts a circuit diagram of a Digital-to-Analog (D/A) converter with an operational amplifier (op-amp) configuration. Here is a detailed description of the components and their connections:

1. **VREF**: This is the reference voltage input to the D/A converter. It is connected to a resistor labeled RIN.

2. **RIN**: This resistor is connected in series with the reference voltage VREF and leads into the D/A converter block.

3. **D/A Converter Block**: Inside this block, there is a current source symbol labeled "D" and a resistor labeled "VREF/R". The current source is controlled by the digital input to the D/A converter, and the resistor is connected in parallel with the current source.

4. **RS**: This resistor is connected to the output of the D/A converter block. It is in series with the capacitor CO.

5. **CO**: This capacitor is connected in series with the resistor RS and leads to the inverting input of the operational amplifier.

6. **Operational Amplifier (Op-Amp)**: The inverting input of the op-amp is connected to the junction of RS and CO. The non-inverting input of the op-amp is connected to the ground.

7. **RF**: This feedback resistor is connected between the output of the op-amp and the inverting input.

8. **CF**: This feedback capacitor is connected in parallel with the feedback resistor RF, between the output of the op-amp and the inverting input.

9. **VOUT**: This is the output voltage of the circuit, taken from the output of the operational amplifier.

The circuit functions as a D/A converter with an op-amp configured as an integrator or low-pass filter, which smooths the output signal. The combination of RF and CF in the feedback loop of the op-amp helps to stabilize the output and filter out high-frequency noise.
```

#### Figure 14–15. Compensating for CMOS DAC Output Capacitance

The normal technique for compensating the buffer amplifier for output capacitance is to add a feedback capacitor CF. CF is calculated by the following:

$$\mathbf{C}\_{\text{F}} = 2 \times \sqrt{\frac{\mathbf{C}\_{\text{O}}}{2\pi \mathbf{R}\_{\text{F}}} \times \frac{1}{\mathbf{G}\_{\text{BW}}}} \tag{14-5}$$

Where:

CO the output capacitance from the D/A data sheet RF the feedback resistance from the D/A data sheet GBW the small signal unity gain bandwidth product of the output amplifier

Unfortunately, the feedback capacitors CF and the internal D/A capacitance CO will both limit the conversion speed of the D/A. If faster conversion is needed, a D/A with a lower output capacitance, and therefore a lower feedback compensation capacitor will be needed. The overall settling time with the external capacitance is:

$$\mathsf{T}\_{\mathsf{S}} \approx \sqrt{\frac{\mathsf{R}\_{\mathsf{F}} \left( \mathsf{C}\_{\mathsf{O}} + \mathsf{C}\_{\mathsf{F}} \right)}{2 \mathsf{G}\_{\mathsf{BW}}}} \tag{14-6}$$

Where:

CO the D/A internal capacitance

RF the feedback resistor

CF the compensation capacitance

GBW the small signal unity gain bandwidth product of the output amplifier

# **14.7 Increasing Op Amp Buffer Amplifier Current and Voltage**

Process limitations of op amps limit the power that can be dissipated at the output. Unfortunately, there are applications that will require the DAC to interface to loads that dissipate considerable power. These include actuators, position solenoids, stepper motors, loudspeakers, vibration tables, positioning tables — the possibilities are endless.

While several "power op amps" are available that can drive heavy loads, they usually compromise several other specifications to achieve the high power operation. Input voltage offset, input current, and input capacitance can be decades higher than the designer is accustomed to, and make these power op amps unsuitable for direct interface with a DAC as a replacement for the buffer op amp.

The power booster stage can be designed discretely, or a prepackaged amplifier of some sort, depending on what is needed for the application. Sometimes high current is required for driving loads such as actuators and stepper motors. Audio applications can require a lot of wattage to drive loudspeakers. This implies a higher voltage rail than op amps commonly operate at. This and other high voltage applications can operate off of, and generate lethal voltages. The designer needs to be extremely careful not to create an unsafe product, or be electrocuted while developing it.

The power stage is most often included in the feedback loop of the op amp circuit, so that the closed loop can compensate for power stage errors. This is not always possible if the voltage swing of the output exceeds that of the op amp voltage rails. In these cases, a voltage divided version of the output should be used.

There are three broad categories of booster, the current booster, the voltage booster, and boosters that do both. All of them work on the same principle: anything that is put inside the feedback loop of the op amp will be compensated for — the output voltage will swing to whatever voltage it needs to make the voltage at the buffer op amp inputs equal.

### **14.7.1 Current Boosters**

These usually use some variation of the class-B push-pull amplifier topology (Figure 14–16).

Here is the image describtion:
```
The image depicts a circuit diagram that includes a digital-to-analog converter (D/A), an operational amplifier, and a complementary push-pull output stage. Here is a detailed description of the components and their connections:

1. **Digital-to-Analog Converter (D/A)**:
   - **VREF**: The reference voltage input to the D/A converter.
   - **RIN**: An input resistor connected to VREF.
   - **Current Source**: A current source labeled VREF/R, which is controlled by the digital input D.
   - **RS**: A resistor connected in parallel with the current source.
   - **CO**: A capacitor connected in parallel with RS.
   - **RF**: A feedback resistor connected to the output of the D/A converter.

2. **Operational Amplifier**:
   - The output of the D/A converter is connected to the inverting input (-) of the operational amplifier.
   - **CF**: A feedback capacitor connected between the output and the inverting input of the operational amplifier.
   - The non-inverting input (+) of the operational amplifier is connected to the ground.

3. **Complementary Push-Pull Output Stage**:
   - **NPN Transistor**: The collector is connected to +15V through a bias resistor, and the emitter is connected to the output VOUT through a small resistor.
   - **PNP Transistor**: The emitter is connected to -15V through a bias resistor, and the collector is connected to the output VOUT through a small resistor.
   - **Diodes**: Two diodes are connected in series between the output of the operational amplifier and the bases of the NPN and PNP transistors. The first diode is connected to the base of the NPN transistor, and the second diode is connected to the base of the PNP transistor.
   - **Bias Resistors**: Resistors are connected to the bases of the NPN and PNP transistors to provide biasing.

4. **Output (VOUT)**:
   - The output VOUT is connected to the emitters of the NPN and PNP transistors through small resistors.
   - There is an inductor and a capacitor connected to the output VOUT, which likely form a filter network.

Overall, the circuit converts a digital signal to an analog voltage using the D/A converter, amplifies the signal using the operational amplifier, and then drives the output using a complementary push-pull stage to provide a stable and high-current output.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 14–16. D/A Output Current Booster." This suggests that it is a caption for a figure in a document, likely a technical or engineering manual, that illustrates or explains a Digital-to-Analog (D/A) converter output current booster. The figure number indicates it is the 16th figure in the 14th chapter or section of the document.
```

The circuit in Figure 14–16 has been employed for decades — many resources are available that can be used to design exact component values. It boosts current because the output impedance of the op amp has been bypassed, and used as the driver for the base of the NPN and PNP power transistors. The two diodes compensate for the VBE drop in the transistors, whose bases are biased by two resistors off of the supplies. The output of the booster stage is fed back to the feedback resistor in the D/A to complete the feedback loop. The output impedance of the stage is only limited by the characteristics of the output transistors and small emitter resistors. Modern power transistors have such high frequency response that this circuit may oscillate. The RC snubber network and a small inductor in series with the load can be used to damp the oscillation — or be omitted if oscillation is not a problem. Beware of varying transistor betas, however.

#### **14.7.2 Voltage Boosters**

If even more current is needed, or the output voltage swing must be more than ±15 V, the booster stage can be operated at voltages higher than the buffer amplifier potentials. A designer might be tempted to try the circuit of Figure 14–17.

Here is the image describtion:
```
The image depicts a circuit diagram that includes a Digital-to-Analog Converter (D/A), an operational amplifier (op-amp), and a high-voltage amplifier. Here is a detailed description of the components and their connections:

1. **D/A Converter (DAC)**:
   - The DAC is shown on the left side of the diagram.
   - It has an input labeled "VREF" which is the reference voltage.
   - The DAC has a digital input labeled "D".
   - Inside the DAC, there are several components:
     - A resistor labeled "RIN" connected to the digital input "D".
     - A current source symbol connected to the junction of RIN and another resistor labeled "VREF/R".
     - A feedback resistor labeled "RF" connected to the output of the DAC.
     - A resistor labeled "RS" and a capacitor labeled "CO" connected in parallel, forming a network that connects to the inverting input of the op-amp.

2. **Operational Amplifier (Op-Amp)**:
   - The op-amp is shown in the middle of the diagram.
   - The inverting input of the op-amp is connected to the output of the DAC.
   - The non-inverting input of the op-amp is connected to the ground.
   - A feedback capacitor labeled "CF" is connected between the output and the inverting input of the op-amp.
   - The op-amp is powered by a dual power supply with +15V and -15V.

3. **High-Voltage Amplifier**:
   - The high-voltage amplifier is shown on the right side of the diagram.
   - The input of the high-voltage amplifier is connected to the output of the op-amp.
   - The high-voltage amplifier is powered by a dual high-voltage power supply with +100V and -100V.
   - The output of the high-voltage amplifier is labeled "VOUT".

4. **Feedback Network**:
   - A feedback resistor labeled "RF-EXT" is connected from the output "VOUT" of the high-voltage amplifier back to the inverting input of the op-amp.

In summary, the circuit consists of a DAC that converts a digital input to an analog signal, which is then processed by an op-amp and further amplified by a high-voltage amplifier. The feedback network ensures proper operation and stability of the circuit. The power supplies for the op-amp and high-voltage amplifier are also indicated.
```

Figure 14–17. Incorrect Method of Increasing Voltage Swing of D/A Converters

Any time there are higher voltage rails on the output section, there are potential hazards. The circuit above illustrates a common misapplication.

- The whole reason for using the booster amp is to allow the VOUT to swing to a ±100-V rail. If this circuit was operated in the unity gain mode (external RF = 0), the VOUT will only swing ±15 V, maximum. There would be no need for the ±100-V rail. That voltage rail is there to allow voltage gain.
- If the circuit is operated with a gain (external R larger than 0), the external RF adds to the internal RF to create the gain:

$$\mathbf{Gain} = \frac{\mathbf{R\_{F-EXT}} + \mathbf{R\_{F-INT}}}{\mathbf{R\_S}} \tag{14-7}$$

The problem with this is that the wattage of the resistors increases as the external voltage rail increases. The designer has control over the wattage of the external RF, but has no control whatsoever over internal RF or RS. Because these resistors are fabricated on the IC, their wattage is limited. Even if the wattage rating of the internal resistors is meticulously observed, they may have undesirable thermal coefficients if allowed to dissipate that wattage. Resistor self-heating will change the resistance according to its rated temperature coefficient (maximum). The external resistor is sure to have a different thermal coefficient from the internal resistors, causing a gain error. The designer may never have encountered the effects of resistor self-heating before, because through-hole and surfacemount devices have enough bulk to minimize the effect of self-heating. At the geometries present on IC D/As, resistor self-heating is a much more pronounced effect. It will produce a nonlinearity error in the D/A output.

This effect is most pronounced in high-resolution converters, where the geometry is the smallest. The designer, therefore, must limit the current in the feedback resistor if at all possible. Figure 14–18 shows a method of achieving gain control while keeping the high current path out of the internal feedback resistor:

Here is the image describtion:
```
The image depicts a circuit diagram that includes a Digital-to-Analog Converter (D/A) and two operational amplifiers (op-amps) configured to amplify the output signal. Here is a detailed description of the components and their connections:

1. **D/A Converter Section:**
   - **VREF:** This is the reference voltage input to the D/A converter.
   - **RIN:** A resistor connected to the VREF input.
   - **D:** Represents the digital input to the D/A converter.
   - **Current Source:** A current source is shown, which is controlled by the digital input (D) and the reference voltage (VREF).
   - **RF:** A feedback resistor connected within the D/A converter.
   - **RS:** A series resistor connected to the output of the D/A converter.
   - **CO:** A capacitor connected in parallel with RS, likely for filtering purposes.

2. **First Operational Amplifier:**
   - The output of the D/A converter is connected to the inverting input of the first op-amp.
   - The non-inverting input of the op-amp is grounded.
   - **CF:** A feedback capacitor connected between the output and the inverting input of the op-amp.
   - The op-amp is powered by a dual power supply with +15V and -15V.

3. **Second Operational Amplifier:**
   - The output of the first op-amp is connected to the inverting input of the second op-amp.
   - The non-inverting input of the second op-amp is grounded.
   - The second op-amp is powered by a higher dual power supply with +100V and -100V.

4. **Output Section:**
   - The output of the second op-amp is connected to a voltage divider network consisting of resistors R3 and R2.
   - **VOUT:** The final output voltage is taken from the junction of R3 and R2.

The circuit appears to be designed to convert a digital signal to an analog voltage, amplify it through two stages of operational amplifiers, and then provide a scaled output voltage. The use of different power supply voltages for the op-amps suggests that the circuit is designed to handle a wide range of output voltages.
```

Figure 14–18. Correct Method of Increasing Voltage Range

In Figure 14–18:

- R3 and R2 are selected to ensure that the feedback voltage to the D/A internal RF can never exceed the D/A rated limits.
- R3 and R2, of course, have to be the correct power rating. R2, in particular, has to be carefully selected. If it burns out, the feedback loop will present hazardous voltages to the D/A. R3, which drops the bulk of the voltage, will have to dissipate considerable wattage.

If the combination of voltage swing and power ratings cannot be balanced to achieve a working design, the only choice left to the designer will be to break the feedback loop and live with the loss of accuracy. For ac applications, this may be acceptable.

### **14.7.3 Power Boosters**

The two types of boosters above can, of course, be combined to produce more power. In audio applications, for example, a ±15-V power supply limits the output power to 112.5 W, absolute maximum, into an 8-Ω load. In order to increase the power, the voltage rails must also be increased, with all of the cautions of the previous paragraph observed.

#### **14.7.4 Single-Supply Operation and DC Offsets**

A D/A power circuit is not the right place to try to apply single-supply design techniques. In audio applications, a single-supply design would force a large coupling capacitor, which would distort and limit low frequency response. In dc applications, a dc offset will continually drive a load — which will have to dissipate the excess voltage through its internal resistance as heat.

Nevertheless, there may be applications that require a dc offset. The designer is fortunate in that there is already a precision reference available in the circuit. The reference drives the resistor network in the D/A, and may be external or internal to it. In most cases, an internal reference is brought out to a pin on the device. It is important for the designer not to excessively load the reference, as that would directly affect D/A accuracy (Figure 14–19).

Here is the image describtion:
```
The image depicts a circuit diagram of a digital-to-analog converter (DAC) with an operational amplifier (op-amp) configuration. Here is a detailed description of the components and their connections:

1. **VREF**: This is the reference voltage input to the DAC.

2. **D/A Block**: This block represents the digital-to-analog converter. It converts a digital input (D) into an analog output. The DAC is connected to the reference voltage (VREF) and has several resistors and a current source inside it:
   - **RIN**: A resistor connected to the VREF.
   - **VREF/R**: A resistor connected to the VREF.
   - **RS**: A resistor connected to the current source.
   - **CO**: A capacitor connected to the current source.
   - **RF**: A feedback resistor connected to the output of the DAC.

3. **Operational Amplifier (Op-Amp)**: The output of the DAC is fed into an op-amp configuration. The op-amp has:
   - **CF**: A feedback capacitor connected between the output and the inverting input of the op-amp.
   - **R**: A resistor connected to the output of the op-amp.

4. **Second Op-Amp Stage**: The output of the first op-amp is connected to a second op-amp stage through a resistor (R). This second op-amp has:
   - **R**: A resistor connected to the non-inverting input.
   - **R**: A resistor connected to the inverting input and ground.
   - **+VCC**: A positive supply voltage connected to the op-amp.

5. **VOUT**: The final output voltage of the circuit is taken from the output of the second op-amp.

The circuit is designed to convert a digital signal into an analog voltage, with the op-amps providing amplification and filtering to ensure a stable and accurate output.
```

Figure 14–19. Single-Supply DAC Operation

In the circuit in Figure 14–19, the output of the buffer amplifier is shifted up in dc level by VREF (not VCC). VREF was selected because it is much more stable and accurate than VCC. The four resistors in the level shifter circuit must be highly accurate and matched, or this circuit will contribute to gain and offset errors. Thermal errors, however, cannot be compensated for, because the external resistors are probably going to have a different thermal drift than those on the IC. This technique is limited to applications that will see only a small change in ambient temperature.

# **Chapter 15**

# **Sine Wave Oscillators**

Ron Mancini and Richard Palmer

# **15.1 What is a Sine Wave Oscillator?**

Op amp oscillators are circuits that are unstable — not the type that are sometimes unintentionally designed or created in the lab — but circuits intentionally designed to remain in an unstable state. Oscillators are useful for creating uniform signals that are used as a reference in applications such as audio, function generators, digital systems, and communication systems.

Two general classes of oscillators exist: sinusoidal and relaxation. Sinusoidal oscillators consist of amplifiers with RC or LC circuits that have adjustable oscillation frequencies, or crystals that have a fixed oscillation frequency. Relaxation oscillators generate triangular, sawtooth, square, pulse, or exponential waveforms, and they are not discussed here.

Op amp sine wave oscillators operate without an externally applied input signal. Some combination of positive and negative feedback is used to drive the op amp into an unstable state, causing the output to transition back and forth at a continuous rate. The amplitude and the oscillation frequency are set by the arrangement of passive and active components around a central op amp.

Op amp oscillators are restricted to the lower end of the frequency spectrum because op amps do not have the required bandwidth to achieve low phase shift at high frequencies. Voltage-feedback op amps are limited to a the low kHz range since their dominant, open loop pole may be as low as 10 Hz. The new current-feedback op amps have a much wider bandwidth, but they are very hard to use in oscillator circuits because they are sensitive to feedback capacitance and are beyond the scope of this chapter. Crystal oscillators are used in high frequency applications up to the hundreds of MHz range.

# **15.2 Requirements for Oscillation**

The canonical, or simplest form, of a negative feedback system is used to demonstrate the requirements for oscillation to occur. The block diagram of this system is shown in Figure 15–1, and the corresponding classic expression for a feedback system is shown in Equation 15–1. The derivation and explanation of the block diagram and equation can be found in Chapter 5.

Here is the image describtion:
```
The image depicts a block diagram of a feedback control system. Here is a detailed description of the components and their connections:

1. **Input Signal (V_IN)**: The system starts with an input signal labeled as \( V_{IN} \).

2. **Summing Junction**: The input signal \( V_{IN} \) enters a summing junction, represented by a circle with a summation symbol (Σ) inside it. This junction has two inputs: one positive (indicated by a plus sign) and one negative (indicated by a minus sign). The positive input is connected to \( V_{IN} \), and the negative input is connected to the feedback path.

3. **Amplifier (A)**: The output of the summing junction is fed into a block labeled "A", which represents an amplifier or a system with a gain factor \( A \).

4. **Output Signal (V_OUT)**: The output of the amplifier is the output signal of the system, labeled as \( V_{OUT} \).

5. **Feedback Path**: The output signal \( V_{OUT} \) is also fed back into the system through a feedback path. This path includes a block labeled "β", which represents a feedback factor or a feedback network with a gain \( \beta \).

6. **Feedback to Summing Junction**: The output of the feedback block \( \beta \) is connected to the negative input of the summing junction, completing the feedback loop.

In summary, the diagram illustrates a classic negative feedback control system where the output \( V_{OUT} \) is fed back through a feedback network with gain \( \beta \) and subtracted from the input \( V_{IN} \) at the summing junction. The resulting error signal is then amplified by the system with gain \( A \) to produce the output \( V_{OUT} \).
```

Figure 15–1. Canonical Form of a Feedback System with Positive or Negative Feedback

$$\frac{\mathsf{V}\_{\mathsf{OUT}}}{\mathsf{V}\_{\mathsf{IN}}} = \frac{\mathsf{A}}{\mathsf{1} + \mathsf{A}\mathsf{\beta}}\tag{15-4}$$

Oscillators do not require an externally applied input signal, but instead use some fraction of the output signal created by the feedback network as the input signal. It is the noise voltage that provides the inital boost signal to the circuit when positive feedback is employed. Over a period of time, the output builds up, oscillating at the frequency set by the circuit components[1].

Oscillation results when the feedback system is not able to find a stable state because its transfer function can not be satisfied. The system becomes unstable when the denominator in Equation 15–1 is 0. When (1 +Aβ) = 0, Aβ = –1. The key to designing an oscillator, then, is to ensure that Aβ = –1. This is called the Barkhausen criterion. This constraint requires the magnitude of the loop gain be 1 with a corresponding phase shift of 180 as indicated by the minus sign. An equivalent expression using complex math is Aβ = 1∠–180 for a negative feedback system. For a positive feedback system, the expression becomes Aβ = 1∠0and the sign is negative in Equation 15–1.

Once the phase shift is 180 and Aβ = |1|, the output voltage of the unstable system heads for infinite voltage in an attempt to destroy the world, and is only prevented from succeeding by an energy-limited power supply. When the output voltage approaches either power rail, the active devices in the amplifiers change gain, causing the value of A to change so the value of Aβ ≠ 1; thus the charge to infinite voltage slows down and eventually halts. At this point, one of three things can occur. First, nonlinearity in saturation or cutoff can cause the system to become stable and lock up at the power rail. Second, the initial charge can cause the system to saturate (or cutoff) and stay that way for a long time before it becomes linear and heads for the opposite power rail. Third, the system stays linear and reverses direction heading for the opposite power rail. Alternative two produces highly distorted oscillations (usually quasi square waves), and the resulting oscillators are called relaxation oscillators. Alternative three produces sine wave oscillators.

# **15.3 Phase Shift in the Oscillator**

The 180 phase shift in the equation Aβ = 1∠–180 is introduced by active and passive components. Like any well-designed feedback circuit, oscillators are made dependent on passive component phase shift because it is accurate and almost drift-free. The phase shift contributed by active components is minimized because it varies with temperature, has a wide initial tolerance, and is device dependent. Amplifiers are selected such that they contribute little or no phase shift at the oscillation frequency. These constraints limit the op amp oscillator to relatively low frequencies.

A single pole RL or RC circuit contributes up to 90 phase shift per pole, and because 180 of phase shift is required for oscillation, at least two poles must be used in the oscillator design. An LC circuit has two poles, thus it contributes up to 180 phase shift per pole pair. But LC and LR oscillators are not considered here because low frequency inductors are expensive, heavy, bulky, and very nonideal. LC oscillators are designed in high frequency applications, beyond the frequency range of voltage feedback op amps, where the inductor size, weight, and cost are less significant. Multiple RC sections are used in low frequency oscillator design in lieu of inductors.

Phase shift determines the oscillation frequency because the circuit oscillates at the frequency that accumulates 180 phase shift. The rate of change of phase with frequency, dφ/dω, determines frequency stability. When buffered RC sections (an op amp buffer provides high input and low output impedance) are cascaded, the phase shift multiplies by the number of sections, n (see Figure 15–2).

Here is the image describtion:
```
The image is a Bode plot that shows the phase response of multiple RC (resistor-capacitor) sections in a logarithmic scale. The x-axis represents the normalized frequency (ω/ωC), where ω is the angular frequency and ωC is the cutoff frequency. The x-axis ranges from 0.01 to 100. The y-axis represents the normalized phase shift (ϕ/°) in degrees, ranging from 0° to -360°.

There are four curves on the plot, each representing a different number of RC sections:
1. The topmost curve represents 1 RC section.
2. The second curve from the top represents 2 RC sections.
3. The third curve from the top represents 3 RC sections.
4. The bottommost curve represents 4 RC sections.

As the number of RC sections increases, the phase shift becomes more pronounced at lower frequencies. Each additional RC section adds an additional -90° phase shift at high frequencies. The phase shift starts at 0° at low frequencies and decreases as the frequency increases, approaching -90°, -180°, -270°, and -360° for 1, 2, 3, and 4 RC sections, respectively, at high frequencies.

The plot uses a logarithmic scale for the frequency axis, which allows for a wide range of frequencies to be displayed compactly. The grid lines help in reading the values more accurately.
```

Figure 15–2. Phase Plot of RC Sections

The frequency of oscillation is very dependent upon the change in phase at the point where the phase shift is 180-. A tight frequency specification will require a large change in phase shift, dφ, for a small change in frequency, dω, at 180-. Figure 15–2 demonstrates that, although two cascaded RC sections eventually provide 180 phase shift, dφ/dω at the oscillator frequency is unacceptably low. Thus, oscillators made with two cascaded RC sections have poor frequency stability. Three equal cascaded RC filter sections have a much higher dφ/dω (see Figure 15–2), and the resulting oscillator has improved frequency stability. Adding a fourth RC section produces an oscillator with an excellent dφ/dω (see Figure 15–2); thus this is the most stable RC oscillator configuration. Four sections are the maximum number used because op amps come in quad packages, and the four-section oscillator section yields four sine waves 45 phase shifted relative to each other. This oscillator can be used to obtain sine/cosine or quadrature sine waves.

Crystal or ceramic resonators make the most stable oscillators because resonators have an extremely high dφ/dω resulting from their nonlinear properties. Resonators are used for high frequency oscillators, but low frequency oscillators do not use resonators because of size, weight, and cost restrictions. Op amps are not generally used with crystal or ceramic resonator oscillators because op amps have low bandwidth. Experience shows that it is more cost effective to build a high frequency crystal oscillator, count the output down, and filter the output to obtain a low frequency than it is to use a low frequency resonator.

# **15.4 Gain in the Oscillator**

The oscillator gain must equal 1 (Aβ = 1∠–180-) at the oscillation frequency. Under normal conditions, the circuit becomes stable when the gain exceeds 1 and oscillations cease. However, when the gain exceeds 1 with a phase shift of –180-, the active device nonlinearity reduces the gain to 1 and the circuit oscillates. The nonlinearity happens when the amplifier swings close to either power rail because cutoff or saturation reduces the active device (transistor) gain. The paradox is that worst case design practice requires nominal gains exceeding 1 for manufacturability, but excess gain causes more distortion of the output sine wave.

When the gain is too low, oscillations cease under worst case conditions, and when the gain is too high, the output wave form looks more like a square wave than a sine wave. Distortion is a direct result of excess gain overdriving the amplifier; thus gain must be carefully controlled in low-distortion oscillators. Phase shift oscillators have distortion, but they achieve low-distortion output voltages because cascaded RC sections act as distortion filters. Also, buffered phase shift oscillators have low distortion because the gain is controlled and distributed among the buffers.

Most circuit configurations require an auxiliary circuit for gain adjustment when low-distortion outputs are desired. Auxiliary circuits range from inserting a nonlinear component in the feedback loop, to automatic gain control (AGC) loops, to limiting by external components such as resistors and diodes. Consideration must also be given to the change in gain due to temperature variations and component tolerances, and the level of circuit complexity will be determined based on the required stability of the gain. The more stable the gain, the better the purity of the sine wave output.

# **15.5 Active Element (Op Amp) Impact on the Oscillator**

Up to now, it has been assumed that the op amp has an infinite bandwidth and the output is not frequency dependent. In reality, the op amp has many poles, but it has been compensated so that they are dominated by a single pole over the specified bandwidth. Thus Aβ, is now frequency dependant through the op amp gain term, A. Equation 15–2 shows this dependance, where a is the maximum open loop gain, ωa is the dominant pole frequency, and ω is the frequency of the signal. Figure 15–3 graphically depicts the frequency dependence of the op amp gain and phase. The closed loop gain, ACL = 1/β does not contain any poles or zeros and its therefore constant over frequency to the point where it impacts the op amp open-loop gain at ω3dB. Here, the signal amplitude is attenuated by 3 dB and the phase shift introduced by the op amp is 45°. The amplitude and phase really begin to change one decade below this point at 0.1 ω3dB, and the phase will continue to shift until it has reached 90° at 10 ω3dB, one decade beyond the 3–dB point. The gain continues to roll off at –20 dB/decade until other poles and zeros come into play. The higher the closed-loop gin, the earlier ACL intercepts the op amp gain.

$$\mathsf{A}\_{\mathsf{CL}} = \frac{\mathsf{A}}{\mathsf{1} + \mathsf{A}\beta} = \frac{\frac{\mathsf{1}}{\mathsf{\beta}}}{\mathsf{1} + \frac{\mathsf{1}}{\mathsf{A}\beta}} = \frac{\mathsf{A}\_{\mathsf{CL}\,\mathsf{L}\,\mathsf{ideal}}}{\mathsf{1} + \frac{\mathsf{A}\_{\mathsf{CL}\,\mathsf{ideal}}}{\mathsf{A}\_{\mathsf{OL}}}} \tag{15-2}$$

The phase shift contributed by the op amp will impact the performance of the oscillator circuit by lowering the oscillation frequency, and the reduction in ACL can make Aβ < 1 and the oscillator will not oscillate.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one for gain (in decibels, dB) and one for phase (in degrees, °), both plotted against frequency (in Hertz, Hz) on a logarithmic scale.

### Gain Plot (Top Half):
- The vertical axis represents gain in decibels (dB).
- The horizontal axis represents frequency in Hertz (Hz), marked logarithmically.
- The gain plot starts with a constant gain labeled as \( A_{CL} \) up to a certain frequency.
- At a frequency labeled \( 0.1 f_c \), the gain starts to decrease at a rate of -20 dB per decade.
- The gain continues to decrease at this rate until it intersects the 0 dB line at a frequency labeled \( f_c \).
- Beyond \( f_c \), the gain continues to decrease at the same rate.
- There is a shaded region labeled "Minimum Desired Range of \( f_{osc} \)" that spans a range of frequencies around \( f_c \).

### Phase Plot (Bottom Half):
- The vertical axis represents phase in degrees (°).
- The horizontal axis is the same as the gain plot, representing frequency in Hertz (Hz).
- The phase plot starts at 0° and remains constant up to \( 0.1 f_c \).
- At \( 0.1 f_c \), the phase begins to decrease linearly at a rate of -45° per decade.
- The phase continues to decrease until it reaches -90° at a frequency of \( 10 f_c \).

### Key Points:
- The gain plot shows a flat response at \( A_{CL} \) up to \( 0.1 f_c \), then a slope of -20 dB/decade.
- The phase plot shows a flat response at 0° up to \( 0.1 f_c \), then a slope of -45°/decade.
- The shaded region indicates the desired frequency range for oscillation, centered around \( f_c \).

This Bode plot is typically used to analyze the stability and frequency response of control systems or amplifiers.
```

Figure 15–3. Op Amp Frequency Response

Most op amps are compensated and may have more than the 45 of phase shift at ω3dB. The op amp should therefore be chosen with a gain bandwidth that is at least one decade above the oscillation frequency, as shown by the shaded area of Figure 15–3. The Wien bridge requires a gain bandwidth greater than 43ωOSC to maintain the gain and frequency within 10% of the ideal values [2]. Figure 15–4 compares the output distortion versus frequency of an LM328, a TLV247x, and a TLC071 op amp, which have bandwidths of 0.4 MHz and 2.8 MHz, and 10 MHz, respectively, in a Wien bridge oscillator with nonlinear feedback (see Section 15.7.1 for the circuit and transfer function) The oscillation frequency ranged from 16 Hz to 160 kHz. The graph illustrates the importance of choosing the correct op smp for the application. The LM328 achieved a maximum oscillation of 72 kHz and was attenuated more than 75%, while the TLV247x achieved 125 kHz with 18% attenuation. The wide bandwidth of the TLC071 provided a 138 kHz oscillation frequency with a mere 2% attenuation. The op amp must be chosen with the proper bandwidth or the output may oscillate at a frequency well below the design specification.

Here is the image describtion:
```
The image is a graph that plots distortion percentage against frequency in Hertz (Hz). The x-axis represents the frequency, ranging from 10 Hz to 100 kHz, on a logarithmic scale. The y-axis represents the distortion percentage, ranging from 0% to 8%.

Three different curves are plotted on the graph, each representing a different operational amplifier (op-amp):

1. **TLC4501**: This curve starts with a low distortion percentage at lower frequencies and gradually increases as the frequency increases. The distortion percentage rises sharply after around 10 kHz, reaching above 7% at 100 kHz.

2. **LM328**: This curve shows a moderate increase in distortion percentage as the frequency increases. It starts below 1% at lower frequencies, peaks around 2-3% between 1 kHz and 10 kHz, and then increases again, reaching around 4% at 100 kHz.

3. **TLV247x**: This curve starts with the lowest distortion percentage among the three at lower frequencies. It remains relatively low and stable up to around 10 kHz, after which it starts to increase. The distortion percentage reaches around 3% at 100 kHz.

The graph provides a comparative analysis of the distortion performance of these three op-amps across a range of frequencies. The TLV247x op-amp shows the lowest distortion at lower frequencies, while the TLC4501 exhibits the highest distortion at higher frequencies.
```

Figure 15–4. Op Amp Bandwidth and Oscillator Output

Care must be taken when using large feedback resistors since they interact with the input capacitance of the op amp to create poles with negative feedback, and both poles and zeros with positive feedback. Large resistor values can move these poles and zeros into the proximity of the oscillation frequency and impact the phase shift [3].

A final consideration is given to the slew-rate limitation of the op amp. The slew rate must be greater than 2πVPf0, where VP is the peak output voltage and f0 is the oscillation frequency, or distortion of the output signal will result.

# **15.6 Analysis of the Oscillator Operation (Circuit)**

Oscillators are created using various combinations of positive and negative feedback. Figure 15–5 shows the basic negative feedback amplifier block diagram with a positive feedback loop added. When positive and negative feedback are used, the gain of the negative feedback path is combined into one gain term (representing the closed loop gain) and Figure 15–5 reduces to Figure 15–1. The positive feedback network is then represented by β = β2 and subsequent analysis is simplified. When negative feedback is used, then the positive feedback loop can be ignored since β2 is 0. The case of positive and negative feedback combined is covered here since the negative feedback case was reviewed in Chapters 5 and 6.

Here is the image describtion:
```
The image depicts a block diagram of a control system with feedback loops. Here is a detailed description of the components and their connections:

1. **Summing Junction (Σ)**: This is the first component on the left side of the diagram. It has three inputs and one output. The inputs are:
   - A positive input (denoted by a plus sign) at the bottom.
   - Two negative inputs (denoted by minus signs) at the top and left.

2. **Block A**: The output of the summing junction is fed into Block A. This block likely represents a system or a process with a transfer function denoted by "A".

3. **Output (Vout)**: The output of Block A is labeled as Vout, which represents the output of the entire system.

4. **Feedback Paths**:
   - **First Feedback Path (β1)**: The output Vout is fed back into the summing junction through a block labeled β1. This block represents a feedback element with a transfer function or gain denoted by β1. The feedback signal is connected to the negative input of the summing junction.
   - **Second Feedback Path (β2)**: Similarly, the output Vout is also fed back into the summing junction through another block labeled β2. This block represents another feedback element with a transfer function or gain denoted by β2. This feedback signal is also connected to the negative input of the summing junction.

In summary, the diagram shows a control system with two feedback loops. The output of the system (Vout) is fed back into the summing junction through two different feedback paths (β1 and β2), which are subtracted from the input signal to the system. The system itself is represented by Block A.
```

# Figure 15–5. Block Diagram of an Oscillator: a) Positive and Negative Feedback Loops, and b) Simplified Diagram w

A general form of an op amp with positive and negative feedback is shown in Figure 15–6a. The first step is to break the loop at some point without altering the gain of the circuit. The positive feedback loop is broken at the point marked with an X. A test signal (VTEST) is applied to the broken loop and the resulting output voltage (VOUT) is measured with the equivalent circuit shown in Figure 15–6b.

Here is the image describtion:
```
The image consists of two diagrams labeled (a) and (b), which represent different stages of analyzing an electronic circuit involving an operational amplifier (op-amp) and impedances.

(a) Original Circuit:
- This diagram shows the original configuration of the circuit.
- The circuit includes an operational amplifier (op-amp) with its inverting (-) and non-inverting (+) inputs.
- The non-inverting input is connected to the ground through an impedance labeled Z4.
- The inverting input is connected to the ground through an impedance labeled Z1.
- The output of the op-amp is labeled VOUT.
- The output is connected back to the inverting input through an impedance labeled Z2.
- Additionally, the inverting input is connected to the ground through another impedance labeled Z3.
- There is a break in the feedback loop at the output, indicated by an 'X' mark.

(b) Loop Gain Calculation Equivalent Circuit:
- This diagram is used for calculating the loop gain of the original circuit.
- It is divided into two parts, each representing different sections of the equivalent circuit.
- On the left side, there is a voltage source labeled VTEST connected to the non-inverting input of the op-amp.
- The non-inverting input is connected to the ground through an impedance labeled Z4.
- The inverting input is connected to the ground through an impedance labeled Z3.
- The voltage at the non-inverting input is labeled V+.
- On the right side, the voltage V+ is applied to the inverting input through an impedance labeled Z1.
- The current through Z1 is labeled I and is given by the equation I = -V+/Z1.
- The inverting input is connected to the output through an impedance labeled Z2.
- The output voltage is labeled VOUT.
- The op-amp is represented by a diamond-shaped symbol indicating a dependent voltage source with a gain of A.

Overall, the image illustrates the process of breaking down the original circuit into an equivalent circuit for the purpose of calculating the loop gain, which is a crucial step in analyzing the stability and performance of feedback systems.
```

Figure 15–6. Amplifier with Positive and Negative Feedback

V+ is calculated first in Equation 15–3, and then is treated as an input signal to a noninverting amplifier, resulting in Equation 15–4. Equation 15–3 is substituted for V+ into Equation 15–4 to get the transfer function in Equation 15–5. The actual circuit elements are then substituted for each impedance and the equation is simplified. These equations are valid when the op amp open-loop gain is large and the oscillation frequency is < 0.1 ω3dB.

$$\mathcal{V}\_{+} = \mathcal{V}\_{\text{TEST}} \left( \frac{\mathbb{Z}\_{4}}{\mathbb{Z}\_{3} + \mathbb{Z}\_{4}} \right) \tag{15-3}$$

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{V}\_{+} \left( \frac{\mathsf{Z}\_{1} + \mathsf{Z}\_{2}}{\mathsf{Z}\_{1}} \right) \tag{15-4}$$

$$\frac{\mathbb{V}\_{\text{OUT}}}{\mathbb{V}\_{\text{TEST}}} = \left(\frac{\mathbb{Z}\_3}{\mathbb{Z}\_3 + \mathbb{Z}\_4}\right) \left(\frac{\mathbb{Z}\_1 + \mathbb{Z}\_2}{\mathbb{Z}\_1}\right) \tag{15-5}$$

Phase shift oscillators generally use negative feedback, so the positive feedback factor (β2) becomes zero. Oscillator circuits such as the Wien bridge use both negative (β1) and positive (β2) feedback to achieve a constant state of oscillation. This circuit is analyzed in detain in Section 15.7.1 using Equation 15–5.

# **15.7 Sine Wave Oscillator Circuits**

There are many types of sine wave oscillator circuits and variations of these circuits the choice depends upon the frequency and the desired purity of the output waveform. The focus of this section is on the more prominent oscillator circuits: Wien bridge, phase shift, and quadrature. The transfer function is derived for each case using the techniques described in Section 15.6 of this chapter and in Chapters 3, 5, and 6.

### **15.7.1 Wien Bridge Oscillator**

The Wien bridge is one of the simplest and best known oscillators and is used extensively in circuits for audio applications. Figure 15–7 shows the basic Wien bridge circuit configuration. This circuit has only a few components and good frequency stability. The major drawback of the circuit is that the output amplitude is at the rails, saturating the op amp output transistors and causing high output distortion. Taming this distortion is more of a challenge than getting the circuit to oscillate. There are a couple of ways to minimize this effect, which will be covered later. It is now time to analyze this circuit and come up with the transfer function.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two input terminals (inverting and non-inverting) and one output terminal. The non-inverting input is marked with a "+" sign, and the inverting input is marked with a "-" sign.

2. **Power Supply (Vcc)**: The op-amp is powered by a voltage source labeled Vcc, connected to the positive power supply pin of the op-amp.

3. **Feedback Resistor (RF)**: A resistor labeled RF is connected between the output of the op-amp and the inverting input (-) of the op-amp.

4. **Gain Resistor (RG)**: Another resistor labeled RG is connected between the inverting input (-) of the op-amp and ground.

5. **Capacitors (C)**: There are three capacitors in the circuit, all labeled C. One capacitor is connected between the non-inverting input (+) of the op-amp and ground. The other two capacitors are part of a network connected to the output of the op-amp.

6. **Resistors (R)**: There are four resistors labeled R in the circuit. Two of these resistors are connected in series with the capacitors in the network at the output of the op-amp. The other two resistors are connected in series with each other and with a capacitor, forming a voltage divider network.

7. **Reference Voltage (VREF)**: A reference voltage source labeled VREF is connected to the junction of the two series resistors and the capacitor in the voltage divider network.

8. **Output Voltage (VOUT)**: The output voltage of the circuit is labeled VOUT and is taken from the junction where the op-amp output, the feedback resistor RF, and the network of resistors and capacitors meet.

The configuration suggests a complex feedback network involving both resistive and capacitive components, which could be used for various purposes such as filtering, oscillation, or signal conditioning depending on the specific values and arrangement of the components.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 15-7. Wien Bridge Circuit Schematic." This suggests that it is a label for a figure in a document, likely a textbook or technical manual, which depicts the schematic diagram of a Wien Bridge Circuit. The figure number (15-7) indicates that it is the seventh figure in the fifteenth chapter or section of the document. The Wien Bridge Circuit is typically used in electronic engineering for generating sine waves and measuring frequencies.
```

The Wien bridge circuit is of the form that is detailed in Section 15.6. The transfer function for the circuit is created using the technique described in that section. It is readily apparent that Z1 = RG, Z2 = RF, Z3 = (R1 + 1/sC1) and Z4 = (R21/sC2). The loop is broken between the output and Z1, VTEST is applied to Z1, and VOUT is calculated. The positive feedback voltage, V+, is calculated first in Equations 15–6 through 15–8. Equation 15–6 shows the simple voltage divider at the noninverting input. Each term is then multiplied by (R2C2s + 1) and divided by R2 to get Equation 15–7.

$$\mathbb{V}\_{+} = \mathbb{V}\_{\text{TEST}} \left( \frac{\mathbb{Z}\_{4}}{\mathbb{Z}\_{3} + \mathbb{Z}\_{4}} \right) = \mathbb{V}\_{\text{TEST}} \left[ \frac{\left( \frac{\mathbb{R}\_{2}}{\mathbb{R}\_{2}\mathbb{C}\_{2} \text{s} + \text{\textdegree C}} \right)}{\left( \frac{\mathbb{R}\_{2}}{\mathbb{R}\_{2}\mathbb{C}\_{2} \text{s} + \text{\textdegree I}} \right) + \left( \mathbb{R}\_{\text{\textdegree I}} + \frac{\text{\textdegree I}}{\text{C}\_{\text{\textdegree S}}} \right)} \right] \qquad \text{(\textdegree 5-6)}$$

$$\frac{\mathbf{V}\_{+}}{\mathbf{V}\_{\text{TEST}}} = \frac{\mathbf{1}}{\mathbf{1} + \mathbf{R}\_{1}\mathbf{C}\_{2}\mathbf{S} + \frac{\mathbf{R}\_{1}}{\mathbf{R}\_{2}} + \frac{\mathbf{1}}{\mathbf{R}\_{2}\mathbf{C}\_{1}\mathbf{s}} + \frac{\mathbf{C}\_{2}}{\mathbf{C}\_{1}}} \tag{15-7}$$

Substitute s = jω0, where ω0 is the oscillation frequency, ω1 = 1/R1C2, and ω2 = 1/R2C1 to get Equation 15–8.

$$\frac{\mathbb{V}\_{+}}{\mathbb{V}\_{\mathsf{TESS}}} = \frac{\mathsf{1}}{\mathsf{1} + \frac{\mathsf{R}\_{1}}{\mathsf{R}\_{2}} + \frac{\mathsf{C}\_{2}}{\mathsf{C}\_{1}} + \mathsf{j}\left(\frac{\mathsf{w}\_{0}}{\mathsf{w}\_{1}} - \frac{\mathsf{w}\_{2}}{\mathsf{w}\_{0}}\right)}\tag{15-8}$$

Some interesting relationships now become apparent. The capacitor in the zero, represented by ω1, and the capacitor in the pole, represented by ω2, must each contribute 90- of phase shift toward the 180 required for oscillation at ω0. This requires that C1 = C2 and R1 = R2. Setting ω1 and ω2 equal to ω0 cancels the frequency terms, ideally removing any change in amplitude with frequency since the pole and zero negate one another. An overall feedback factor of β = 1/3 is the result (Equation 15–9).

$$\frac{\mathsf{V}\_{+}}{\mathsf{V}\_{\mathsf{T}\mathsf{EST}}} = \frac{\mathsf{I}}{\mathsf{I} + \frac{\mathsf{R}}{\mathsf{R}} + \frac{\mathsf{C}}{\mathsf{C}} + \mathsf{j}\left(\frac{\mathsf{co}\_{0}}{\mathsf{co}\_{0}} - \frac{\mathsf{co}\_{0}}{\mathsf{o}\_{0}}\right)} = \frac{\mathsf{I}}{\mathsf{3} + \mathsf{j}\left(\frac{\mathsf{co}\_{0}}{\mathsf{co}\_{0}} - \frac{\mathsf{co}\_{0}}{\mathsf{o}\_{0}}\right)} = \frac{\mathsf{I}}{\mathsf{3}}\tag{15-9}$$

The gain of the negative feedback portion, A, of the circuit must then be set such that Aβ = 1, requiring A = 3. RF must be set to twice the value of RG to satisfy the condition. The op amp in Figure 15–7 is single supply, so a dc reference voltage, VREF, must be applied to bias the output for full-scale swing and minimal distortion. Applying VREF to the positive input through R2 restricts dc current flow to the negative feedback leg of the circuit. VREF was set at 0.833V to bias the output at the midrail of the single supply, rail-to-rail input and output amplifier, or 2.5 V. See Cahpter 4 for details on dc biasing single-supply op amps. VREF is shorted to ground for split supply applications.

The final circuit is shown in Figure 15–8, with component values selected to provide an oscillation frequency of ω0 = 2πf0, where f0 = 1/(2πRC) = 15.9 kHz. The circuit oscillated at 1.57 kHz due to slightly varying component values with 2% distortion. This high value is due to the extensive clipping of the output signal at both supply rails, producing several large odd and even harmonics. The feedback resistor was then adjusted ±1%. Figure 15–9 shows the output voltage waveforms. The distortion grew as the saturation increased with increasing RF, and oscillations ceased when RF was decreased by more than 0.8%.

Here is the image describtion:
```
The image shows an operational amplifier (op-amp) circuit configuration. Here is a detailed description of the circuit:

1. **Op-Amp**: The op-amp used in the circuit is a TLV2471, which is a single low-power op-amp.

2. **Power Supply**: The op-amp is powered by a +5V supply.

3. **Feedback Network**: 
   - The feedback resistor \( R_F \) is connected between the output of the op-amp and the inverting input (-). The value of \( R_F \) is 20 kΩ.
   - The inverting input (-) is also connected to a resistor \( R_G \) which is 10 kΩ, and this resistor is connected to the ground.

4. **Non-Inverting Input**: 
   - The non-inverting input (+) is connected to a voltage divider network and a capacitor network.
   - There is a reference voltage \( V_{REF} \) of 0.833V connected to the non-inverting input through a resistor \( R \) of 10 kΩ.
   - There is a capacitor \( C \) of 10 nF connected in parallel with the resistor \( R \) to the non-inverting input.
   - Another resistor \( R \) of 10 kΩ is connected from the non-inverting input to the ground.
   - Another capacitor \( C \) of 10 nF is connected in parallel with the resistor \( R \) to the ground.

5. **Output**: The output of the op-amp is labeled as \( V_{OUT} \).

6. **Component Values**:
   - \( R_F = 20 \text{kΩ} \)
   - \( R_G = 10 \text{kΩ} \)
   - \( R = 10 \text{kΩ} \)
   - \( C = 10 \text{nF} \)
   - \( V_{REF} = 0.833 \text{V} \)

The circuit appears to be a non-inverting amplifier with a specific gain set by the feedback and gain resistors. The capacitors in the circuit suggest that it might also be designed to filter certain frequencies, possibly acting as a low-pass filter. The reference voltage \( V_{REF} \) sets a baseline voltage for the non-inverting input.
```

Figure 15–8. Final Wien Bridge Oscillator Circuit

Here is the image describtion:
```
The image is a graphical representation of three sinusoidal waveforms displayed on an oscilloscope screen. The screen is divided into a grid with horizontal and vertical divisions. The horizontal axis represents time, with a scale of 500 microseconds per division (Time = 500 µs/div). The vertical axis represents the output voltage (V_OUT), with a scale of 2 volts per division (V_OUT = 2 V/div).

On the left side of the image, there are some given parameters:
- V_CC = 5 V
- V_REF = 0.833 V
- R_G = 10.0 kΩ

Three different waveforms are shown, each corresponding to different feedback resistor (R_F) values:
1. The top waveform is labeled V_+1% with R_F = 20.20 kΩ.
2. The middle waveform is labeled V_I with R_F = 20 kΩ.
3. The bottom waveform is labeled V_-0.8% with R_F = 19.84 kΩ.

Each waveform is a sinusoidal signal, and the differences in their amplitudes and phases are due to the variations in the feedback resistor values. The waveforms are vertically aligned for easy comparison, and the grid helps in measuring the amplitude and time period of the signals.
```

Figure 15–9. Wien Bridge Output Waveforms

Applying nonlinear feedback can minimize the distortion inherent in the basic Wien bridge circuit. A nonlinear component such as an incandescent lamp can be substituted into the circuit for RG as shown in Figure 15–10. The lamp resistance, RLAMP, is nominally selected as half the feedback resistance, RF, at the lamp current established by RF and RLAMP. When the power is first applied the lamp is cool and its resistance is small, so the gain is large (> 3). The current heats up the filament and the resistance increases, lowering the gain. The nonlinear relationship between the lamp current and resistance keeps output voltage changes small. Figure 15–11 shows the output of this amplifier with a distortion of 1% for fOSC = 1.57 kHz. The distortion for this variation is reduced over the basic circuit by avoiding hard saturation of the op amp transistors.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is a TLV247x op-amp. The op-amp has a positive power supply of +5V and is configured in a feedback loop.

2. **Feedback Resistor (RF)**: A resistor with a value of 377 ohms is connected between the output of the op-amp and the inverting input (-).

3. **Non-Inverting Input (+)**: The non-inverting input of the op-amp is connected to a node that is grounded through a capacitor (10 nF) and also connected to a voltage reference (VREF) of 0.833V through another capacitor (10 nF).

4. **Voltage Reference (VREF)**: A voltage source providing 0.833V is connected to the non-inverting input of the op-amp through a capacitor (10 nF).

5. **Output (VOUT)**: The output of the op-amp is labeled as VOUT and is connected to two resistors (each 10 kΩ) in series, with a capacitor (10 nF) connected in parallel to each resistor.

6. **Load (RL)**: A TI-327 lamp is connected to the inverting input (-) of the op-amp and grounded. This lamp acts as the load (RL) in the circuit.

7. **Capacitors (C)**: There are three capacitors, each with a value of 10 nF, used in the circuit. One capacitor is connected between the non-inverting input and ground, another between the non-inverting input and the voltage reference, and the third one is connected in parallel with the resistors at the output.

The circuit appears to be a feedback control system, possibly for regulating the current through the lamp (RL) using the op-amp. The feedback resistor (RF) and the capacitors (C) are likely used to stabilize the circuit and filter out noise. The voltage reference (VREF) sets a reference voltage for the op-amp to compare against the feedback signal.
```

Figure 15–10. Wien Bridge Oscillator with Nonlinear Feedback

Here is the image describtion:
```
The image is a screenshot of an oscilloscope display showing a sinusoidal waveform. The vertical axis is labeled "V_OUT = 1 V/div," indicating that each vertical division represents 1 volt. The waveform appears to be a clean, periodic sine wave with a peak-to-peak amplitude of approximately 4 volts, as it spans four vertical divisions from peak to trough. The horizontal axis is not explicitly labeled with a time scale, but it shows the time progression of the waveform. The sine wave completes about two full cycles across the display. The grid overlay on the screen helps in measuring the amplitude and period of the waveform.
```

**Time = 500** µ**s/div**

Figure 15–11. Output of the Circuit in Figure 15–10

15-12

The impedance of the lamp is mostly due to thermal effects. The output amplitude is then very temperature sensitive and will tend to drift. The gain must be set higher than 3 to compensate for any temperature variations, which increases the distortion in the circuit [4]. This type of circuit is useful when the temperature does not fluctuate over a wide range or when used in conjunction with an amplitude limiting circuit.

The lamp has an effective low frequency thermal time constant, tthermal (4). As fOSC approaches tthermal, distortion is greatly increased. Several lamps can be placed in series to increase tthermal and reduce distortion. The drawbacks are that the time required for oscillations to stabilize is increased and the output amplitude is reduced.

An automatic gain control (AGC) circuit must be used when neither of the two previous circuits yield low distortion. A typical Wien bridge oscillator with an AGC circuit is shown in Figure 15–12, with the output waveform of the circuit shown in Figure 15–13. The AGC is used to stabilize the magnitude of the sinusoidal output to an optimum gain level. The JFET serves as the AGC element, providing excellent control because of the wide range of the drain to source resistance (RDS), which is controlled by the gate voltage. The JFET gate voltage is 0 V when the power is applied, and the JFET turns on with low RDS. This places RG2+RS+RDS in parallel with RG1, raising the gain to 3.05, and oscillations begin and gradually build up. As the output voltage gets large, the negative swing turns the diode on and the sample is stored on C1, which provides a dc potential to the gate of Q1. Resistor R1 limits the current and establishes the time constant for charging C1, which should be much greater than fOSC. When the output voltage drifts high, RDS increases, lowering the gain to a minimum of 2.87 (1+RF/RG1). The output stabilizes when the gain reaches 3. The distortion of the AGC is 0.8%, which is due to slight clipping at the positive rail.

The circuit of Figure 15–12 is biased with VREF for a single-supply amplifier. A zener diode can be placed in series with D1 to limit the positive swing of the output and reduce distortion. A split supply can be easily implemented by grounding all points connected to VREF. There are a wide variety of Wien bridge variations that exist to more precisely control the amplitude and allow selectable or even variable oscillation frequencies. Some circuits use diode limiting in place of a nonlinear feedback component. The diodes reduce the distortion by providing a soft limit for the output voltage.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring various components and their interconnections. Here is a detailed description of the circuit:

1. **Capacitor (C1)**: 
   - Value: 0.1 µF
   - Connected between the positive terminal of a voltage source and ground.

2. **Resistor (R2)**:
   - Value: 11.3 kΩ
   - Connected in series with a variable component (possibly a potentiometer or a junction J1).

3. **Junction (J1)**:
   - Connected to the negative terminal of the voltage source through a resistor (RS).

4. **Resistor (RS)**:
   - Value: 10 kΩ
   - Connected between the negative terminal of the voltage source (VREF) and junction J1.

5. **Voltage Source (VREF)**:
   - Value: 2.5 V
   - Connected to the ground and RS.

6. **Resistor (R1)**:
   - Value: 10 kΩ
   - Connected between the positive terminal of the voltage source and the anode of a diode (D1).

7. **Diode (D1)**:
   - Type: 1N4933
   - Anode connected to R1 and cathode connected to a node that connects to RG2 and RF.

8. **Resistor (RG2)**:
   - Value: 10 kΩ
   - Connected between the cathode of D1 and ground.

9. **Resistor (RF)**:
   - Value: 18.2 kΩ
   - Connected between the cathode of D1 and the inverting input of an operational amplifier (op-amp).

10. **Operational Amplifier (Op-Amp)**:
    - The inverting input is connected to RF.
    - The non-inverting input is connected to a node that connects to RG1 and a capacitor (C).

11. **Resistor (RG1)**:
    - Value: 10 kΩ
    - Connected between the non-inverting input of the op-amp and ground.

12. **Capacitor (C)**:
    - Connected between the non-inverting input of the op-amp and ground.

13. **Resistor (R)**:
    - Connected in series with a capacitor (C) between the output of the op-amp and the inverting input.

14. **Capacitor (C)**:
    - Connected in series with R between the output of the op-amp and the inverting input.

15. **Output (VOUT)**:
    - Taken from the output of the op-amp.

The circuit appears to be a complex configuration involving filtering, amplification, and possibly voltage regulation or reference generation, given the presence of the diode, capacitors, and resistors in specific arrangements.
```

Figure 15–12. Wien Bridge Oscillator with AGC

Here is the image describtion:
```
The image is a graph displaying three different waveforms, each with distinct frequencies. The vertical axis is labeled "Vout = 1 V/div," indicating that each division on the vertical axis represents 1 volt. The horizontal axis is labeled "Time = 500 µs/div," meaning each division on the horizontal axis represents 500 microseconds.

The top waveform has the highest frequency, showing multiple cycles within the given time frame. The middle waveform has a lower frequency than the top one, with fewer cycles visible. The bottom waveform has the lowest frequency, with even fewer cycles compared to the middle waveform.

The graph is divided into a grid with both vertical and horizontal lines, helping to measure the amplitude and period of the waveforms. The waveforms appear to be sinusoidal, with smooth, repetitive oscillations.
```

Figure 15–13. Output of the Circuit in Figure 15–12

### **15.7.2 Phase Shift Oscillator, Single Amplifier**

Phase shift oscillators have less distortion than the Wien bridge oscillator, coupled with good frequency stability. A phase shift oscillator can be built with one op amp as shown in figure 15–14. Three RC sections are cascaded to get the steep dφ/dω slope as described in Section 15–3 to get a stable oscillation frequency. Any less and the oscillation frequency is high and interferes with the op amp BW limitations.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) and a series of resistors and capacitors. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp used is a TLV2471.
   - The non-inverting input (+) of the op-amp is connected to a 2.5 V reference voltage.
   - The inverting input (-) is connected to a resistor \( R_G \) and a feedback resistor \( R_F \).

2. **Resistors and Capacitors**:
   - \( R_G \) is a resistor with a value of 55.2 kΩ, connected to the input signal.
   - \( R_F \) is a feedback resistor with a value of 1.5 MΩ, connected between the output of the op-amp and the inverting input (-).
   - The output of the op-amp is connected to a series of three identical RC (resistor-capacitor) low-pass filter stages.
   - Each RC stage consists of a 10 kΩ resistor (R) in series with a 10 nF capacitor (C) connected to ground.
   - The stages are connected in series, with the output of one stage feeding into the input of the next.

3. **Power Supply**:
   - The op-amp is powered by a +5 V supply.

4. **Output**:
   - The final output of the circuit is labeled as \( V_{OUT} \).

In summary, the circuit is an op-amp configuration with a feedback network and a series of three low-pass filter stages. The op-amp is configured with a reference voltage at the non-inverting input and a feedback resistor network to set the gain. The output of the op-amp is then filtered through three RC low-pass filters before reaching the final output \( V_{OUT} \).
```

Figure 15–14. Phase Shift Oscillator (Single Op Amp)

Here is the image describtion:
```
The image is a screenshot of an oscilloscope display showing a waveform. Here are the details:

1. **Grid Layout**: The display is divided into a grid with horizontal and vertical lines. Each division represents a specific unit of measurement for both voltage and time.

2. **Voltage Scale**: The vertical axis is labeled "V_OUT = 1 V/div," indicating that each vertical division represents 1 volt.

3. **Time Scale**: The horizontal axis is labeled "Time = 500 µs/div," indicating that each horizontal division represents 500 microseconds (µs).

4. **Waveform**: The waveform displayed is a periodic signal, likely a sine wave, with a consistent amplitude and frequency. The waveform appears to have a peak-to-peak voltage of approximately 2 divisions, which translates to 2 volts peak-to-peak.

5. **Frequency**: The waveform completes approximately 4 cycles within 4 horizontal divisions. Since each division represents 500 µs, 4 divisions represent 2000 µs (or 2 milliseconds). Therefore, the frequency of the waveform is approximately 2 cycles per millisecond, or 2 kHz.

6. **Amplitude**: The amplitude of the waveform is about 1 division above and below the centerline, which corresponds to 1 volt peak.

In summary, the oscilloscope display shows a 2 kHz sine wave with a peak amplitude of 1 volt and a peak-to-peak voltage of 2 volts.
```

Figure 15–15. Output of the Circuit in Figure 15–14

$$\mathsf{A}\clubsuit = \mathsf{A}\left(\frac{\mathsf{I}}{\mathsf{RCs}+\mathsf{I}}\right)^{3} \tag{\mathsf{i}\,\mathsf{5-10}}$$

The normal assumption is that the phase shift sections are independent of each other. Then Equation 15–10 is written. The loop phase shift is –180 when the phase shift of each section is –60-, and this occurs when ω = 2πf = 1.732/RC because the tangent of 60- = 1.732. The magnitude of β at this point is (1/2)3, so the gain, A, must be equal to 8 for the system gain to be equal to one.

The oscillation frequency with the component values shown in Figure 15–14 is 3.76 kHz rather than the calculated oscillation frequency of 2.76 kHz as shown in Figure 15–14. Also, the gain required to start oscillation is 27 rather than the calculated gain of 8. These discrepancies are partially due to component variations, but the biggest contributing factor is the incorrect assumption that the RC sections do not load each other. This circuit configuration was very popular when active components were large and expensive. But now op amps are inexpensive, small, and come four in a package, so the single op amp phase shift oscillator is losing popularity. The output distortion is a low 0.46%, considerably less than the Wein bridge circuit without amplitude stabilization.

### **15.7.3 Phase Shift Oscillator, Buffered**

The buffered phase shift oscillator is much improved over the unbuffered version, the cost being a higher component count. The buffered phase shift oscillator is shown in Figure 15–16 and the resulting output waveform in Figure 15–17. The buffers prevent the RC sections from loading each other, hence the buffered phase shift oscillator performs closer to the calculated frequency and gain. The gain setting resistor, RG, loads the third RC section. If the fourth buffer in a quad op amp buffers this RC section, the performance becomes ideal. Low-distortion sine waves can be obtained from either phase shift oscillator design, but the purest sine wave is taken from the output of the last RC section. This is a high-impedance node, so a high impedance input is mandated to prevent loading and frequency shifting with load variations.

Here is the image describtion:
```
The image depicts a multi-stage operational amplifier (op-amp) circuit. Here is a detailed description of the components and their configuration:

1. **Op-Amps**: The circuit uses four op-amps, each labeled as ¼ TLV2474. This indicates that the op-amps are part of a quad op-amp package (TLV2474).

2. **Resistors**:
   - **RG**: A resistor with a value of 180 kΩ is connected to the non-inverting input (+) of the first op-amp.
   - **RF**: A feedback resistor with a value of 1.5 MΩ is connected between the output and the inverting input (-) of the first op-amp.
   - **R**: There are four resistors, each with a value of 10 kΩ, connected in series with capacitors in the subsequent stages of the circuit.

3. **Capacitors**:
   - **C**: There are four capacitors, each with a value of 10 nF, connected in parallel with the resistors in the subsequent stages of the circuit.

4. **Voltage Sources**:
   - The first op-amp has a +5 V power supply connected to its positive power rail.
   - The non-inverting input of the first op-amp is connected to a 2.5 V voltage source.

5. **Connections**:
   - The non-inverting input of the first op-amp is connected to the 2.5 V voltage source through the 180 kΩ resistor (RG).
   - The inverting input of the first op-amp is connected to the output of the same op-amp through the 1.5 MΩ feedback resistor (RF).
   - The output of the first op-amp is connected to a series of three stages, each consisting of a resistor (10 kΩ) and a capacitor (10 nF) in parallel, followed by an op-amp configured as a buffer (non-inverting configuration).
   - The final stage consists of a resistor (10 kΩ) and a capacitor (10 nF) in parallel, leading to the output labeled VOUT.

6. **Ground Connections**:
   - The capacitors are connected to the ground.
   - The negative power rail of the op-amps is connected to the ground.

The circuit appears to be a multi-stage filter or amplifier, with each stage providing additional filtering or amplification. The use of resistors and capacitors suggests that it may be designed to process signals with specific frequency characteristics.
```

Figure 15–16. Phase Shift Oscillator, Buffered

Here is the image describtion:
```
The image is a screenshot of an oscilloscope display showing a waveform. Here are the details:

1. **Waveform**: The waveform displayed is a sinusoidal wave, which appears to be a decaying sine wave. This means the amplitude of the sine wave decreases over time.

2. **Grid**: The oscilloscope screen is divided into a grid with horizontal and vertical lines. Each division on the grid helps in measuring the time and voltage of the waveform.

3. **Voltage Scale**: On the left side of the screen, it is indicated that the vertical scale is set to 200 mV per division (V_OUT = 200 mV/div). This means each vertical division represents 200 millivolts.

4. **Time Scale**: At the bottom of the screen, it is indicated that the horizontal scale is set to 500 microseconds per division (Time = 500 µs/div). This means each horizontal division represents 500 microseconds.

5. **Waveform Characteristics**:
   - The waveform starts with a higher amplitude and gradually decreases.
   - The waveform crosses the zero line multiple times, indicating it is alternating in nature.
   - The frequency of the waveform can be estimated by counting the number of cycles within a given time frame. For example, if there are approximately 5 cycles within 2 divisions (1 millisecond), the frequency would be around 5 kHz.

6. **Overall Appearance**: The waveform is smooth and continuous, typical of a sinusoidal signal, but with a decaying amplitude, suggesting it might be a damped oscillation.

This oscilloscope display is likely showing a signal that is decaying over time, such as a damped harmonic oscillator or a signal that is losing energy.
```

Figure 15–17. Output of the Circuit Figure 15–16

#### **15.7.4 Bubba Oscillator**

The bubba oscillator in Figure 15–18 is another phase shift oscillator, but it takes advantage of the quad op amp package to yield some unique advantages. Four RC sections require 45 phase shift per section, so this oscillator has an excellent dφ/dt resulting in minimized frequency drift. The RC sections each contribute 45 phase shift, so taking outputs from alternate sections yields low impedance quadrature outputs. When an output is taken from each op amp, the circuit delivers four 45 phase shifted sine waves. The loop equation is given in Equation 15–11. When ω = 1/RCs, Equation 15–11 reduces to Equations 15–12 and 15–13.

$$\mathsf{A}\emptyset = \mathsf{A}\left(\frac{\mathfrak{I}}{\mathsf{RCs}+\mathfrak{I}}\right)^{4} \tag{15-\mathfrak{I}\mathfrak{I}}$$

$$|\clubsuit| = \left| \left( \frac{\clubsuit}{\mathbf{j} + \mathbf{4}} \right)^{4} = \frac{\clubsuit}{\sqrt{2}^{4}} = \frac{\clubsuit}{4} \right| \tag{15-12}$$

$$\spadesuit = \mathsf{tan}^{-\dagger}(\mathsf{1}) = \mathsf{45}^{\circ} \tag{\mathsf{15-43}}$$

Here is the image describtion:
```
The image depicts a circuit diagram featuring multiple operational amplifiers (op-amps) configured to generate sine and cosine wave outputs. The circuit uses the TLV2474 op-amp, which is a quad op-amp (four op-amps in one package).

Here is a detailed description of the circuit:

1. **Power Supply and Reference Voltage:**
   - The op-amps are powered by a +5V supply.
   - A reference voltage of 2.5V is provided to the non-inverting input of the first op-amp.

2. **First Op-Amp Configuration:**
   - The first op-amp is configured as a non-inverting amplifier.
   - The feedback resistor (RF) is 1.5 MΩ, and the input resistor (RG) is 360 kΩ.
   - This configuration sets the gain of the amplifier.

3. **RC Network:**
   - The output of the first op-amp is connected to an RC network consisting of resistors (R) and capacitors (C).
   - Each resistor in the network is 10 kΩ, and each capacitor is 10 nF.
   - The RC network is used to shape the waveform and phase shift the signal.

4. **Second and Third Op-Amps:**
   - The second and third op-amps are configured as integrators.
   - Each integrator has a resistor (10 kΩ) and a capacitor (10 nF) in its feedback loop.
   - The integrators further process the signal to generate sine and cosine waveforms.

5. **Output Signals:**
   - The output of the second op-amp is labeled as "VOUT Sine," indicating that it produces a sine wave.
   - The output of the third op-amp is labeled as "VOUT Cosine," indicating that it produces a cosine wave.

Overall, the circuit is designed to generate sine and cosine waveforms using a combination of op-amps and RC networks. The precise values of resistors and capacitors are chosen to achieve the desired frequency and phase characteristics of the output signals.
```

Figure 15–18. Bubba Oscillator

Here is the image describtion:
```
The image is a screenshot of an oscilloscope display showing two sinusoidal waveforms. Here are the details:

1. **Grid Layout**: The display is divided into a grid with horizontal and vertical lines. Each division represents a specific unit of measurement.
   
2. **Vertical Scale**: The vertical axis is labeled "V_OUT = 1 V/div," indicating that each vertical division represents 1 volt.

3. **Horizontal Scale**: The horizontal axis is labeled "Time = 500 µs/div," indicating that each horizontal division represents 500 microseconds.

4. **Waveforms**: There are two sinusoidal waveforms displayed on the screen:
   - The top waveform has a higher amplitude and appears to be slightly out of phase with the bottom waveform.
   - The bottom waveform has a lower amplitude compared to the top waveform.

5. **Amplitude**: The top waveform spans approximately 2 vertical divisions peak-to-peak, which corresponds to 2 volts peak-to-peak. The bottom waveform spans approximately 1.5 vertical divisions peak-to-peak, which corresponds to 1.5 volts peak-to-peak.

6. **Frequency**: Both waveforms have the same frequency, as they complete the same number of cycles within the same horizontal span. Each waveform completes approximately 2 cycles within 4 horizontal divisions, which corresponds to a period of 2 ms (4 divisions * 500 µs/div). This gives a frequency of 500 Hz (1 / 2 ms).

7. **Phase Relationship**: The waveforms are not perfectly aligned, indicating a phase difference between them.

Overall, the image shows two sinusoidal signals with different amplitudes and a phase difference, both having the same frequency of 500 Hz.
```

Figure 15–19. Output of the Circuit in Figure 15–18.

The gain, A, must equal 4 for oscillation to occur. The test circuit oscillated at 1.76 kHz rather than the ideal frequency of 1.72 kHz when the gain was 4.17 rather than the ideal gain 4. The output waveform is shown in Figure 15–19. Distortion is 1% for VOUTSINE and 0.1% for VOUTCOSINE. With low gain, A, and low bias current op amps, the gain setting resistor, RG, does not load the last RC section, thus ensuring oscillator frequency accuracy. Very low distortion sine waves can be obtained from the junction of R and RG. When low-distortion sine waves are required at all outputs, the gain should be distributed between all of the op amps. The noninverting input of the gain op amp is biased at 0.5 V to set the quiescent output voltage at 2.5 V for single supply operation, and should be ground for split supply op amps. Gain distribution requires biasing of the other op amps, but it has no effect on the oscillator frequency.

## **15.7.5 Quadrature Oscillator**

The quadrature oscillator shown in Figure 15–20 is another type of phase shift oscillator, but the three RC sections are configured so each section contributes 90 of phase shift. This provides both sine and cosine waveform outputs (the outputs are quadrature, or 90- apart), which is a distinct advantage over other phase shift oscillators. The idea of the quadrature oscillator is to use the fact that the double integral of a sine wave is a negative sine wave of the same frequency and phase. The phase of the second integrator is then inverted and applied as positive feedback to induce oscillation [6].

The loop gain is calculated in Equation 15–14. When R1C1 = R2C2 = R3C3, Equation 15–14 reduces to Equation 15–15. When ω = 1/RC, Equation 15–14 reduces to 1∠–180, so oscillation occurs at ω = 2πf = 1/RC. The test circuit oscillated at 1.65 kHz rather than the calculated 1.59 kHz, as shown in Figure 15–21. This discrepancy is attributed to component variations. Both outputs have relatively high distortion that can be reduced with a gain stabilizing circuit. The sine output had 0.846% distortion and the cosine output had 0.46% distortion. Adjusting the gain can increase the amplitudes. The cost is bandwidth.

$$\mathsf{A}\clubsuit = \mathsf{A}\Big(\frac{1}{\mathsf{R}\_1\mathsf{C}\_1\mathsf{s}}\Big)\Big(\frac{\mathsf{R}\_3\mathsf{C}\_3\mathsf{s}+\mathsf{1}}{\mathsf{R}\_3\mathsf{C}\_3\mathsf{s}(\mathsf{R}\_2\mathsf{C}\_2\mathsf{s}+\mathsf{1})}\Big)\tag{15-14}$$

$$\mathsf{A}\emptyset = \mathsf{A}\left(\frac{\mathfrak{l}}{\mathsf{RCs}}\right)^2 \tag{15-\mathsf{i}\mathfrak{s}}$$

Here is the image describtion:
```
The image depicts a circuit diagram featuring two operational amplifiers (op-amps) from the TLV2474 series, configured to generate sine and cosine wave outputs. Here is a detailed description of the circuit:

1. **Power Supply and Grounding:**
   - The op-amps are powered by a +5V supply.
   - The ground is connected to the negative terminals of the op-amps.

2. **Components and Connections:**
   - **Resistors:**
     - R1, R2, and R3 are all 10 kΩ resistors.
   - **Capacitors:**
     - C1, C2, and C3 are all 10 nF capacitors.

3. **First Op-Amp Configuration:**
   - The first op-amp (labeled as ½ TLV2474) has its non-inverting input connected to a voltage divider formed by R1 and a 2.5V reference voltage.
   - The inverting input is connected to the junction of R1 and the output of the op-amp.
   - A capacitor (C1) is connected between the output of the op-amp and the inverting input.
   - The output of this op-amp is labeled as V_OUT Sine, indicating it produces a sine wave output.

4. **Second Op-Amp Configuration:**
   - The second op-amp (also labeled as ½ TLV2474) has its non-inverting input connected to the junction of R3 and the 2.5V reference voltage.
   - The inverting input is connected to the junction of R2 and C2.
   - A capacitor (C2) is connected between the inverting input and ground.
   - The output of this op-amp is labeled as V_OUT Cosine, indicating it produces a cosine wave output.
   - A capacitor (C3) is connected between the output of the second op-amp and the inverting input of the first op-amp.

5. **Signal Path:**
   - The circuit is designed to generate sine and cosine waveforms, with the first op-amp producing the sine wave and the second op-amp producing the cosine wave.
   - The feedback network involving resistors and capacitors ensures the correct phase shift between the sine and cosine outputs.

6. **Overall Function:**
   - This circuit is likely used in applications requiring quadrature signals, such as in signal processing or communication systems, where sine and cosine waveforms are needed with a 90-degree phase difference.

The circuit utilizes the properties of op-amps, resistors, and capacitors to create a stable oscillation, producing the desired sine and cosine waveforms at the outputs.
```

Figure 15–20. Quadrature Oscillator

Here is the image describtion:
```
The image is a graph displaying two waveforms, labeled "VOUT SINE" and "VOUT COSINE." The vertical axis represents the output voltage (VOUT) with a scale of 2 volts per division, while the horizontal axis represents time with a scale of 500 microseconds per division.

The top waveform, labeled "VOUT SINE," is a sine wave. It starts at zero, rises to a positive peak, returns to zero, drops to a negative peak, and returns to zero again, completing one cycle. This pattern repeats periodically.

The bottom waveform, labeled "VOUT COSINE," is a cosine wave. It starts at a positive peak, drops to zero, continues to a negative peak, returns to zero, and rises back to the positive peak, completing one cycle. This pattern also repeats periodically.

Both waveforms have the same frequency and amplitude, but they are phase-shifted relative to each other. The sine wave starts at zero, while the cosine wave starts at its maximum positive value. This phase difference is characteristic of sine and cosine functions.
```

Figure 15–21. Output of the Circuit in Figure 15–20

## **15.7.6 Conclusion**

Op amp oscillators are restricted to the lower end of the frequency spectrum because they do not have the required bandwidth to achieve low phase shift at high frequencies. The new current-feedback op amps have a much greater bandwidth than the voltage-feedback op amps, but are very difficult to use in oscillator circuits because of their sensitivity to feedback capacitance. Voltage-feedback op amps are limited to tens of Hz (at the most!) because of their low frequency rolloff. The bandwidth is reduced when op amps are cascaded due to the multiple contribution of phase shift.

The Wien bridge oscillator has few parts and good frequency stability, but the basic circuit has a high output distortion. AGC improves the distortion considerably, particularly at the lower frequency range. Nonlinear feedback offers the best performance over the mid and upper frequency ranges. The phase shift oscillator has lower output distortion and, without buffering, requires a high gain, which limits the use to very low frequencies. Decreasing cost of op amps and components has reduced the popularity of the phase shift oscillators. The quadrature oscillator only requires two op amps, has reasonable distortion, and offers both sine and cosine waveforms. The drawback is the low amplitude, which may require a higher gain and a reduction in bandwidth, or an additional gain stage.

May your oscillators always oscillate, and your amplifiers always amplify.

# **15.8 References**

[1] Gottlieb, Irving M., Practical Oscillator Handbook, Newnes, 1997.

[2] Kennedy, E. J., Operational Amplifier Circuits, Theory and Applications, Holt Rhienhart and Winston, 1988.

[3] Graeme, Jerald, Optimizing Op Amp Performance, McGraw Hill Book Company, 1997.

[4] Philbrick Researches, Inc., Applications Manual for Computing Amplifiers, Nimrod Press, Inc., 1966.

[5] Graf, Rudolf F., Oscillator Circuits, Newnes, 1997.

[6] Graeme, Jerald, Applications of Operational Amplifiers, Third Generation Techniques, McGraw Hill Book Company, 1973.

**Chapter 16**

# **Active Filter Design Techniques**

#### Thomas Kugelstadt

# **16.1 Introduction**

What is a filter?

A filter is a device that passes electric signals at certain frequencies or frequency ranges while preventing the passage of others. — Webster.

Filter circuits are used in a wide variety of applications. In the field of telecommunication, band-pass filters are used in the audio frequency range (0 kHz to 20 kHz) for modems and speech processing. High-frequency band-pass filters (several hundred MHz) are used for channel selection in telephone central offices. Data acquisition systems usually require anti-aliasing low-pass filters as well as low-pass noise filters in their preceding signal conditioning stages. System power supplies often use band-rejection filters to suppress the 60-Hz line frequency and high frequency transients.

In addition, there are filters that do not filter any frequencies of a complex input signal, but just add a linear phase shift to each frequency component, thus contributing to a constant time delay. These are called all-pass filters.

At high frequencies (> 1 MHz), all of these filters usually consist of passive components such as inductors (L), resistors (R), and capacitors (C). They are then called LRC filters.

In the lower frequency range (1 Hz to 1 MHz), however, the inductor value becomes very large and the inductor itself gets quite bulky, making economical production difficult.

In these cases, active filters become important. Active filters are circuits that use an operational amplifier (op amp) as the active device in combination with some resistors and capacitors to provide an LRC-like filter performance at low frequencies (Figure 16–1).

Here is the image describtion:
```
The image shows two different electrical circuits, each with distinct components and configurations.

**Left Circuit:**
1. **Components:**
   - **Inductor (L):** Represented by a coiled wire symbol.
   - **Resistor (R):** Represented by a zigzag line.
   - **Capacitor (C):** Represented by two parallel lines, one of which is curved, indicating a polarized capacitor.
2. **Configuration:**
   - The input voltage \( V_{IN} \) is applied to the series combination of the inductor (L) and the resistor (R).
   - The output voltage \( V_{OUT} \) is taken across the resistor (R).
   - The capacitor (C) is connected in parallel with the output, meaning one end of the capacitor is connected to the node between the resistor and the output, and the other end is connected to the ground.

**Right Circuit:**
1. **Components:**
   - **Resistors (R1 and R2):** Represented by zigzag lines.
   - **Capacitors (C1 and C2):** Represented by two parallel lines.
   - **Operational Amplifier (Op-Amp):** Represented by a triangle with a positive (+) and negative (-) input terminal.
2. **Configuration:**
   - The input voltage \( V_{IN} \) is applied to the series combination of resistor \( R1 \) and resistor \( R2 \).
   - The capacitor \( C1 \) is connected in parallel with \( R2 \), meaning one end of \( C1 \) is connected to the node between \( R1 \) and \( R2 \), and the other end is connected to the ground.
   - The non-inverting input (+) of the operational amplifier is connected to the node between \( R2 \) and \( C1 \).
   - The capacitor \( C2 \) is connected between the output of the operational amplifier and the inverting input (-).
   - The inverting input (-) of the operational amplifier is also connected to the node between \( R1 \) and \( R2 \).

**Summary:**
- The left circuit is a simple RLC (Resistor-Inductor-Capacitor) series circuit with the capacitor connected in parallel to the output.
- The right circuit is an active filter or amplifier circuit using an operational amplifier with feedback provided by \( C2 \) and \( R2 \), and \( C1 \) providing additional filtering or frequency response shaping.
```

Figure 16–1. Second-Order Passive Low-Pass and Second-Order Active Low-Pass

This chapter covers active filters. It introduces the three main filter optimizations (Butterworth, Tschebyscheff, and Bessel), followed by five sections describing the most common active filter applications: low-pass, high-pass, band-pass, band-rejection, and all-pass filters. Rather than resembling just another filter book, the individual filter sections are written in a cookbook style, thus avoiding tedious mathematical derivations. Each section starts with the general transfer function of a filter, followed by the design equations to calculate the individual circuit components. The chapter closes with a section on practical design hints for single-supply filter designs.

# **16.2 Fundamentals of Low-Pass Filters**

The most simple low-pass filter is the passive RC low-pass network shown in Figure 16–2.

Here is the image describtion:
```
The image depicts a simple RC (resistor-capacitor) low-pass filter circuit. Here is a detailed description:

1. **Components**:
   - **Resistor (R)**: This is represented by a zigzag line and is labeled "R".
   - **Capacitor (C)**: This is represented by two parallel lines with one line connected to ground. It is labeled "C".

2. **Connections**:
   - **Input Voltage (V_IN)**: This is the voltage source connected to the left side of the resistor.
   - **Output Voltage (V_OUT)**: This is the voltage measured across the capacitor, connected to the right side of the resistor.
   - **Ground**: The bottom terminal of the capacitor is connected to ground.

3. **Circuit Path**:
   - The input voltage (V_IN) is applied to the circuit.
   - The resistor (R) is connected in series with the input voltage.
   - The capacitor (C) is connected in parallel with the output voltage (V_OUT) and to ground.

4. **Function**:
   - This circuit acts as a low-pass filter, allowing low-frequency signals to pass through while attenuating high-frequency signals.
   - The resistor and capacitor together determine the cutoff frequency of the filter.

In summary, the image shows a basic RC low-pass filter circuit with an input voltage source, a resistor, a capacitor, and an output voltage point.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 16–2. First-Order Passive RC Low-Pass." This suggests that the image is part of a larger document, likely a textbook or technical manual, and is referring to a specific figure within Chapter 16. The figure itself is not visible in the provided image, but based on the caption, it is likely an illustration or diagram of a first-order passive RC (resistor-capacitor) low-pass filter. This type of filter allows low-frequency signals to pass through while attenuating high-frequency signals.
```

Its transfer function is:

$$\mathsf{A(s)} = \frac{\frac{1}{\mathsf{RC}}}{\mathsf{s} + \frac{1}{\mathsf{RC}}} = \frac{1}{\mathsf{1} + \mathsf{s}\mathsf{RC}}.$$

where the complex frequency variable, s = jω+σ , allows for any time variable signals. For pure sine waves, the damping constant, σ, becomes zero and s = jω .

For a normalized presentation of the transfer function, s is referred to the filter's corner frequency, or –3 dB frequency, ωC, and has these relationships:

$$\mathbf{Q}\mathbf{i} = \frac{\mathbf{j}}{\mathbf{3}}\mathbf{j} = \frac{\alpha \mathbf{j}}{\mathbf{3}^{\mathrm{co}}} = \frac{\mathbf{a}\mathbf{j}}{\mathbf{3}^{\mathrm{co}}} = \mathbf{s}\mathbf{s}$$

With the corner frequency of the low-pass in Figure 16–2 being f C = 1/2πRC, s becomes s = sRC and the transfer function A(s) results in:

$$\mathsf{A(s)} = \frac{\mathsf{1}}{\mathsf{1} + \mathsf{s}}.$$

The magnitude of the gain response is:

$$|\mathsf{A}| = \frac{\mathsf{1}}{\sqrt{\mathsf{1} + \mathsf{Q}^2}}$$

For frequencies Ω >> 1, the rolloff is 20 dB/decade. For a steeper rolloff, **n** filter stages can be connected in series as shown in Figure 16–3. To avoid loading effects, op amps, operating as impedance converters, separate the individual filter stages.

Here is the image describtion:
```
The image depicts a multi-stage active low-pass filter circuit. Here is a detailed description of the components and their configuration:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as V_IN.

2. **Resistors (R)**: There are four resistors in the circuit, each labeled as R. These resistors are connected in series with the input and between each stage of the filter.

3. **Capacitors (C)**: There are four capacitors in the circuit, each labeled as C. These capacitors are connected in parallel with the input and between each stage of the filter, going to the ground.

4. **Operational Amplifiers (Op-Amps)**: The circuit includes four operational amplifiers, each configured as a voltage follower (buffer). The non-inverting input (+) of each op-amp is connected to the node between the resistor and capacitor of the previous stage, while the inverting input (-) is connected to the output of the op-amp itself, creating a unity-gain configuration.

5. **Output Voltage (V_OUT)**: The circuit ends with an output voltage labeled as V_OUT, which is taken from the output of the last operational amplifier.

The overall configuration suggests a cascaded arrangement of four identical RC low-pass filter stages, each followed by a buffer stage to prevent loading effects and ensure proper signal transfer between stages. This design enhances the filtering characteristics, providing a steeper roll-off and better attenuation of high-frequency signals.
```

Figure 16–3. Fourth-Order Passive RC Low-Pass with Decoupling Amplifiers

The resulting transfer function is:

$$\mathsf{A(s)} = \frac{1}{(\mathsf{1} + \alpha\_1 \mathsf{s})(\mathsf{1} + \alpha\_2 \mathsf{s})\dots(\mathsf{1} + \alpha\_n \mathsf{s})}$$

In the case that all filters have the same cut-off frequency, fC, the coefficients become

 <sup>1</sup> <sup>2</sup> <sup>n</sup> <sup>2</sup> n 1, and fC of each partial filter is 1/α times higher than fC of the overall filter.

Figure 16–4 shows the results of a fourth-order RC low-pass filter. The rolloff of each partial filter (Curve 1) is –20 dB/decade, increasing the roll-off of the overall filter (Curve 2) to 80 dB/decade.

**Note:**

**Filter response graphs plot gain versus the normalized frequency axis** Ω **(**Ω **= f/fC).**

Here is the image describtion:
```
The image consists of two plots, one above the other, each displaying different characteristics of lowpass filters. 

### Top Plot: Gain vs. Frequency
- **Y-Axis (Vertical):** Represents the gain (|A|) in decibels (dB), ranging from 0 dB at the top to -80 dB at the bottom.
- **X-Axis (Horizontal):** Represents the frequency (Ω) on a logarithmic scale, ranging from 0.01 to 100.
- **Curves:**
  - **1st Order Lowpass:** This curve starts at 0 dB and gradually decreases, showing a gentle slope as the frequency increases.
  - **4th Order Lowpass:** This curve also starts at 0 dB but drops more steeply than the 1st order lowpass as the frequency increases.
  - **Ideal 4th Order Lowpass:** This curve starts at 0 dB and drops almost vertically at a certain frequency, indicating a very sharp cutoff.

### Bottom Plot: Phase vs. Frequency
- **Y-Axis (Vertical):** Represents the phase (ϕ) in degrees, ranging from 0 degrees at the top to -360 degrees at the bottom.
- **X-Axis (Horizontal):** Represents the frequency (Ω) on a logarithmic scale, ranging from 0.01 to 100.
- **Curves:**
  - **1st Order Lowpass:** This curve starts at 0 degrees and gradually decreases, showing a smooth transition as the frequency increases.
  - **4th Order Lowpass:** This curve starts at 0 degrees and decreases more steeply than the 1st order lowpass, showing a more rapid phase shift.
  - **Ideal 4th Order Lowpass:** This curve starts at 0 degrees and drops sharply, indicating a very abrupt phase shift at a certain frequency.

### General Observations:
- The **1st Order Lowpass** filter has the gentlest slope in both gain and phase plots, indicating a gradual attenuation and phase shift.
- The **4th Order Lowpass** filter has a steeper slope compared to the 1st order, indicating a more rapid attenuation and phase shift.
- The **Ideal 4th Order Lowpass** filter shows the sharpest cutoff in both gain and phase plots, representing an almost ideal filter with a very abrupt transition.

The plots effectively illustrate the differences in performance between 1st order, 4th order, and ideal 4th order lowpass filters in terms of gain and phase response across a range of frequencies.
```

Here is the image describtion:
```
The image contains a note that describes three different curves related to low-pass filters. The text is as follows:

"Note: Curve 1: 1st-order partial low-pass filter, Curve 2: 4th-order overall low-pass filter, Curve 3: Ideal 4th-order low-pass filter"

This note appears to be explaining the characteristics or types of low-pass filters represented by three different curves. Specifically:
- Curve 1 represents a first-order partial low-pass filter.
- Curve 2 represents a fourth-order overall low-pass filter.
- Curve 3 represents an ideal fourth-order low-pass filter.

The text is written in a standard font and is likely part of a larger document or presentation that includes graphical representations of these curves.
```

Figure 16–4. Frequency and Phase Responses of a Fourth-Order Passive RC Low-Pass Filter

The corner frequency of the overall filter is reduced by a factor of α ≈ 2.3 times versus the –3 dB frequency of partial filter stages.

In addition, Figure 16–4 shows the transfer function of an ideal fourth-order low-pass function (Curve 3).

In comparison to the ideal low-pass, the RC low-pass lacks in the following characteristics:

- The passband gain varies long before the corner frequency, fC, thus amplifying the upper passband frequencies less than the lower passband.
- The transition from the passband into the stopband is not sharp, but happens gradually, moving the actual 80-dB roll off by 1.5 octaves above fC.
- The phase response is not linear, thus increasing the amount of signal distortion significantly.

The gain and phase response of a low-pass filter can be optimized to satisfy one of the following three criteria:

- 1) A maximum passband flatness,
- 2) An immediate passband-to-stopband transition,
- 3) A linear phase response.

For that purpose, the transfer function must allow for complex poles and needs to be of the following type:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{A}\_{0}}{\left(\mathsf{1} + \mathsf{a}\_{1}\mathsf{s} + \mathsf{b}\_{1}\mathsf{s}^{2}\right)\left(\mathsf{1} + \mathsf{a}\_{2}\mathsf{s} + \mathsf{b}\_{2}\mathsf{s}^{2}\right)\dots\left(\mathsf{1} + \mathsf{a}\_{n}\mathsf{s} + \mathsf{b}\_{n}\mathsf{s}^{2}\right)} = \frac{\mathsf{A}\_{0}}{\prod\left(\mathsf{1} + \mathsf{a}\_{1}\mathsf{s} + \mathsf{b}\_{1}\mathsf{s}^{2}\right)}$$

where A0 is the passband gain at dc, and ai and bi are the filter coefficients.

Since the denominator is a product of quadratic terms, the transfer function represents a series of cascaded second-order low-pass stages, with aiand bi being positive real coefficients. These coefficients define the complex pole locations for each second-order filter stage, thus determining the behavior of its transfer function.

The following three types of predetermined filter coefficients are available listed in table format in Section 16.9:

- The Butterworth coefficients, optimizing the passband for maximum flatness
- The Tschebyscheff coefficients, sharpening the transition from passband into the stopband
- The Bessel coefficients, linearizing the phase response up to fC

The transfer function of a passive RC filter does not allow further optimization, due to the lack of complex poles. The only possibility to produce conjugate complex poles using passive components is the application of LRC filters. However, these filters are mainly used at high frequencies. In the lower frequency range (< 10 MHz) the inductor values become very large and the filter becomes uneconomical to manufacture. In these cases active filters are used.

Active filters are RC networks that include an active device, such as an operational amplifier (op amp).

Section 16.3 shows that the products of the RC values and the corner frequency must yield the predetermined filter coefficients ai and bi , to generate the desired transfer function.

The following paragraphs introduce the most commonly used filter optimizations.

### **16.2.1 Butterworth Low-Pass FIlters**

The Butterworth low-pass filter provides maximum passband flatness. Therefore, a Butterworth low-pass is often used as anti-aliasing filter in data converter applications where precise signal levels are required across the entire passband.

Figure 16–5 plots the gain response of different orders of Butterworth low-pass filters versus the normalized frequency axis, Ω (Ω = f / fC); the higher the filter order, the longer the passband flatness.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. The plot shows the gain (|A|) in decibels (dB) on the vertical axis and the frequency (Ω) on the horizontal axis. The frequency axis is logarithmic, ranging from 0.01 to 100.

The plot includes four different curves, each representing the gain response of filters of different orders: 1st Order, 2nd Order, 4th Order, and 10th Order. These curves illustrate how the gain decreases with increasing frequency for each filter order.

- The 1st Order filter has the shallowest slope, indicating a gradual decrease in gain with increasing frequency.
- The 2nd Order filter has a steeper slope than the 1st Order filter, showing a more rapid decrease in gain.
- The 4th Order filter has an even steeper slope, indicating an even faster decrease in gain.
- The 10th Order filter has the steepest slope among the four, showing the most rapid decrease in gain with increasing frequency.

The plot shows that higher-order filters have a sharper roll-off, meaning they attenuate high frequencies more quickly than lower-order filters. The gain starts at 0 dB for low frequencies and decreases as the frequency increases, with the rate of decrease depending on the filter order.
```

Figure 16–5. Amplitude Responses of Butterworth Low-Pass Filters

16-6

## **16.2.2 Tschebyscheff Low-Pass Filters**

The Tschebyscheff low-pass filters provide an even higher gain rolloff above fC. However, as Figure 16–6 shows, the passband gain is not monotone, but contains ripples of constant magnitude instead. For a given filter order, the higher the passband ripples, the higher the filter's rolloff.

Here is the image describtion:
```
The image is a Bode plot, which is a graph used to display the frequency response of a system. The plot shows the gain (|A|) in decibels (dB) on the vertical axis and the frequency (Ω) on the horizontal axis. The frequency axis is logarithmic, ranging from 0.01 to 100.

There are three curves on the plot, each representing the gain response of a system of different orders: 2nd order, 4th order, and 9th order. These curves illustrate how the gain decreases with increasing frequency for each system order.

- The 2nd order system curve shows a moderate slope, indicating a less steep decline in gain with increasing frequency.
- The 4th order system curve has a steeper slope compared to the 2nd order, indicating a faster decline in gain with increasing frequency.
- The 9th order system curve has the steepest slope, showing the most rapid decline in gain with increasing frequency.

The plot also shows that all three systems have a flat gain response (0 dB) at low frequencies, which starts to decline sharply around a frequency of 1 (Ω). The higher the order of the system, the steeper the decline in gain after this point. The gain for the 9th order system drops to -60 dB at a frequency of around 10, while the 2nd order system's gain is around -20 dB at the same frequency.
```

Figure 16–6. Gain Responses of Tschebyscheff Low-Pass Filters

With increasing filter order, the influence of the ripple magnitude on the filter rolloff diminishes.

Each ripple accounts for one second-order filter stage. Filters with even order numbers generate ripples above the 0-dB line, while filters with odd order numbers create ripples below 0 dB.

Tschebyscheff filters are often used in filter banks, where the frequency content of a signal is of more importance than a constant amplification.

#### **16.2.3 Bessel Low-Pass Filters**

The Bessel low-pass filters have a linear phase response (Figure 16–7) over a wide frequency range, which results in a constant group delay (Figure 16–8) in that frequency range. Bessel low-pass filters, therefore, provide an optimum square-wave transmission behavior. However, the passband gain of a Bessel low-pass filter is not as flat as that of the Butterworth low-pass, and the transition from passband to stopband is by far not as sharp as that of a Tschebyscheff low-pass filter (Figure 16–9).

Here is the image describtion:
```
The image is a graph that displays the phase response of three different types of filters: Bessel, Butterworth, and Tschebyscheff. The x-axis represents the frequency (Ω) on a logarithmic scale ranging from 0.01 to 100. The y-axis represents the phase in degrees, ranging from 0 to -360 degrees.

The graph shows three curves, each corresponding to one of the filter types. The Bessel filter curve is the least steep, indicating a more gradual phase shift. The Butterworth filter curve is steeper than the Bessel curve but less steep than the Tschebyscheff curve. The Tschebyscheff filter curve is the steepest, indicating a more abrupt phase shift.

The curves are labeled with arrows pointing to each respective filter type. The Bessel filter curve starts at 0 degrees and gradually decreases, crossing -90 degrees around a frequency of 0.1, -180 degrees around a frequency of 1, and -270 degrees around a frequency of 10. The Butterworth filter curve starts at 0 degrees and decreases more rapidly, crossing -90 degrees around a frequency of 0.3, -180 degrees around a frequency of 3, and -270 degrees around a frequency of 30. The Tschebyscheff filter curve starts at 0 degrees and decreases the most rapidly, crossing -90 degrees around a frequency of 0.5, -180 degrees around a frequency of 5, and -270 degrees around a frequency of 50.

Overall, the graph illustrates how the phase response varies with frequency for each type of filter, with the Bessel filter having the most gradual phase shift and the Tschebyscheff filter having the most abrupt phase shift.
```

Figure 16–7. Comparison of Phase Responses of Fourth-Order Low-Pass Filters

Here is the image describtion:
```
The image is a graph that plots the normalized group delay (Tgr) in seconds per second (s/s) against the frequency (Ω) on a logarithmic scale. The x-axis represents the frequency, ranging from 0.01 to 100, while the y-axis represents the normalized group delay, ranging from 0 to 1.4.

Three different filter responses are shown on the graph: Tschebyscheff, Butterworth, and Bessel. Each filter response is represented by a distinct curve:

1. **Tschebyscheff Filter**: This curve shows a significant peak in the group delay around the normalized frequency of 1. The group delay increases sharply to a value above 1.2 and then drops off rapidly as the frequency increases beyond 1.

2. **Butterworth Filter**: This curve also shows a peak in the group delay around the normalized frequency of 1, but the peak is less pronounced compared to the Tschebyscheff filter. The group delay reaches a value slightly above 0.8 before decreasing.

3. **Bessel Filter**: This curve has the smoothest response with no sharp peaks. The group delay remains relatively constant around 0.4 for frequencies below 1 and then gradually decreases as the frequency increases.

The graph uses a logarithmic scale for both axes, which is evident from the uneven spacing of the grid lines. The labels for each filter type are placed near their respective curves for easy identification. The overall purpose of the graph is to compare the group delay characteristics of these three different types of filters across a range of frequencies.
```

Figure 16–8. Comparison of Normalized Group Delay (Tgr) of Fourth-Order Low-Pass Filters

16-8

Here is the image describtion:
```
The image is a logarithmic plot showing the frequency response of three different types of filters: Butterworth, Chebyshev (labeled as Tschebyscheff), and Bessel. The x-axis represents the frequency (Ω) on a logarithmic scale ranging from 0.1 to 10. The y-axis represents the gain (|A|) in decibels (dB), ranging from -60 dB to 10 dB.

1. **Butterworth Filter**: The Butterworth filter is characterized by a maximally flat frequency response in the passband. The plot shows that the Butterworth filter has a smooth and flat response up to the cutoff frequency (Ω = 1), after which it starts to roll off. The roll-off rate is moderate compared to the other filters.

2. **Chebyshev Filter**: The Chebyshev filter, labeled as Tschebyscheff, exhibits ripples in the passband, indicating variations in gain before the cutoff frequency. This filter has a steeper roll-off rate after the cutoff frequency compared to the Butterworth filter, which means it attenuates frequencies outside the passband more quickly. The trade-off is the ripple in the passband.

3. **Bessel Filter**: The Bessel filter is known for its linear phase response, which preserves the wave shape of filtered signals. The plot shows that the Bessel filter has the slowest roll-off rate among the three filters. Its gain decreases more gradually after the cutoff frequency, resulting in a less steep attenuation of higher frequencies.

Overall, the plot illustrates the trade-offs between the different filter types: Butterworth for a flat passband, Chebyshev for a steeper roll-off with passband ripple, and Bessel for a linear phase response with the slowest roll-off.
```

Figure 16–9. Comparison of Gain Responses of Fourth-Order Low-Pass Filters

#### **16.2.4 Quality Factor Q**

The quality factor Q is an equivalent design parameter to the filter order n. Instead of designing an nth order Tschebyscheff low-pass, the problem can be expressed as designing a Tschebyscheff low-pass filter with a certain Q.

For band-pass filters, Q is defined as the ratio of the mid frequency, fm, to the bandwidth at the two –3 dB points:

$$\mathbf{Q} = \frac{\mathbf{f\_m}}{(\mathbf{f\_2} - \mathbf{f\_1})}$$

For low-pass and high-pass filters, Q represents the pole quality and is defined as:

$$\mathbf{O} = \frac{\sqrt{\mathbf{b}\_i}}{\mathbf{a}\_i}$$

High Qs can be graphically presented as the distance between the 0-dB line and the peak point of the filter's gain response. An example is given in Figure 16–10, which shows a tenth-order Tschebyscheff low-pass filter and its five partial filters with their individual Qs.

Active Filter Design Techniques 16-9

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. The plot shows the gain (|A|) in decibels (dB) on the vertical axis and the frequency (Ω) on the horizontal axis, which is plotted on a logarithmic scale ranging from 0.01 to 10.

The plot includes multiple curves, each representing the gain response of different stages of a filter, as well as the overall filter response. The stages are labeled as follows:
- 1st Stage
- 2nd Stage
- 3rd Stage
- 4th Stage
- 5th Stage

Each stage has a distinct curve, and the overall filter response is shown as a thicker curve that combines the effects of all the individual stages.

The gain for each stage starts at 0 dB at low frequencies and decreases as the frequency increases, showing a typical low-pass filter behavior. The overall filter response shows a peak gain of around 30 dB at a frequency close to 1 (Ω), indicating a resonant frequency where the filter has maximum gain.

The plot also includes an annotation labeled "Q5" with a double-headed arrow pointing vertically, indicating the quality factor (Q) of the 5th stage, which is a measure of the sharpness of the resonance peak.

Overall, the image provides a detailed view of the frequency response characteristics of a multi-stage filter, highlighting the individual contributions of each stage and the combined effect on the overall filter performance.
```

Figure 16–10. Graphical Presentation of Quality Factor Q on a Tenth-Order Tschebyscheff Low-Pass Filter with 3-dB Passband Ripple

The gain response of the fifth filter stage peaks at 31 dB, which is the logarithmic value of Q5:

$$\mathbf{Q}\_5[\mathbf{d}\mathbf{B}] = 2\mathbf{0}\text{-}\log\mathbf{Q}\_5$$

Solving for the numerical value of Q5 yields:

$$\mathbf{Q\_{5}} = \mathbf{10^{\frac{31}{20}}} = \mathbf{35.48}$$

which is within 1% of the theoretical value of Q = 35.85 given in Section 16.9, Table 16–9, last row.

The graphical approximation is good for Q > 3. For lower Qs, the graphical values differ from the theoretical value significantly. However, only higher Qs are of concern, since the higher the Q is, the more a filter inclines to instability.

# **16.2.5 Summary**

The general transfer function of a low-pass filter is :

$$\mathsf{A(s)} = \frac{\mathsf{A}\_0}{\prod\_{\mathsf{i}} (\mathsf{1} + \mathsf{a}\_{\mathsf{i}} \mathsf{s} + \mathsf{b}\_{\mathsf{i}} \mathsf{s}^2)}\tag{16-4}$$

The filter coefficients ai and bi distinguish between Butterworth, Tschebyscheff, and Bessel filters. The coefficients for all three types of filters are tabulated down to the tenth order in Section 16.9, Tables 16–4 through 16–10.

The multiplication of the denominator terms with each other yields an nth order polynomial of S, with n being the filter order.

While n determines the gain rolloff above fC with n·20 dBdecade, ai and bi determine the gain behavior in the passband.

In addition, the ratio bi ai <sup>Q</sup> is defined as the pole quality. The higher the Q value, the more a filter inclines to instability.

# **16.3 Low-Pass Filter Design**

Equation 16–1 represents a cascade of second-order low-pass filters. The transfer function of a single stage is:

$$\mathsf{A}\_{\mathsf{i}}(\mathsf{s}) = \frac{\mathsf{A}\_{\mathsf{0}}}{\left(\mathsf{1} + \mathsf{a}\_{\mathsf{i}}\mathsf{s} + \mathsf{b}\_{\mathsf{i}}\mathsf{s}^{2}\right)}\tag{16-2}$$

For a first-order filter, the coefficient b is always zero (b1=0), thus yielding:

$$\mathsf{A(s)} = \frac{\mathsf{A\_0}}{\mathsf{1} + \mathsf{a\_1s}} \tag{16-3}$$

The first-order and second-order filter stages are the building blocks for higher-order filters.

Often the filters operate at unity gain (A0=1) to lessen the stringent demands on the op amp's open-loop gain.

Figure 16–11 shows the cascading of filter stages up to the sixth order. A filter with an even order number consists of second-order stages only, while filters with an odd order number include an additional first-order stage at the beginning.

Here is the image describtion:
```
The image depicts a series of block diagrams representing different orders of systems, ranging from 1st order to 6th order. Each block is labeled with its respective order and the parameters associated with it. Here is a detailed description:

1. **1st Order System:**
   - The diagram shows a single block labeled "1st order" with the parameter "a=1". This indicates a first-order system with a specific parameter value.

2. **2nd Order System:**
   - The diagram shows a single block labeled "2nd order" with parameters "a1, b1". This indicates a second-order system with two parameters.

3. **3rd Order System:**
   - The diagram consists of two blocks in series:
     - The first block is labeled "1st order" with the parameter "a1".
     - The second block is labeled "2nd order" with parameters "a2, b2".
   - This configuration represents a third-order system composed of a first-order system followed by a second-order system.

4. **4th Order System:**
   - The diagram consists of two blocks in series:
     - The first block is labeled "2nd order" with parameters "a1, b1".
     - The second block is labeled "2nd order" with parameters "a2, b2".
   - This configuration represents a fourth-order system composed of two second-order systems in series.

5. **5th Order System:**
   - The diagram consists of three blocks in series:
     - The first block is labeled "1st order" with the parameter "a1".
     - The second block is labeled "2nd order" with parameters "a2, b2".
     - The third block is labeled "2nd order" with parameters "a3, b3".
   - This configuration represents a fifth-order system composed of a first-order system followed by two second-order systems in series.

6. **6th Order System:**
   - The diagram consists of three blocks in series:
     - The first block is labeled "2nd order" with parameters "a1, b1".
     - The second block is labeled "2nd order" with parameters "a2, b2".
     - The third block is labeled "2nd order" with parameters "a3, b3".
   - This configuration represents a sixth-order system composed of three second-order systems in series.

Each system order is represented by a combination of first-order and second-order blocks, with specific parameters indicating the characteristics of each block. The arrows between the blocks indicate the flow or connection from one block to the next, forming higher-order systems.
```

Figure 16–11. Cascading Filter Stages for Higher-Order Filters

Figure 16–10 demonstrated that the higher the corner frequency of a partial filter, the higher its Q. Therefore, to avoid the saturation of the individual stages, the filters need to be placed in the order of rising Q values. The Q values for each filter order are listed (in rising order) in Section 16–9, Tables 16–4 through 16–10.

#### **16.3.1 First-Order Low-Pass Filter**

Figures 16–12 and 16–13 show a first-order low-pass filter in the inverting and in the noninverting configuration.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangular symbol. The op-amp has two input terminals and one output terminal:
   - The non-inverting input (+) is connected to ground.
   - The inverting input (-) is connected to a network of resistors and a capacitor.

2. **Resistors**:
   - **R1**: This resistor is connected between the input voltage source (V_IN) and the junction point where it meets the capacitor (C1) and the inverting input of the op-amp.
   - **R2**: This resistor is connected between the output of the op-amp (V_OUT) and the inverting input (-) of the op-amp.
   - **R3**: This resistor is connected between the inverting input (-) of the op-amp and ground.

3. **Capacitor (C1)**: This capacitor is connected between the junction point (where R1, R2, and the inverting input of the op-amp meet) and ground.

4. **Voltage Sources**:
   - **V_IN**: The input voltage source is connected to one end of R1.
   - **V_OUT**: The output voltage is taken from the output terminal of the op-amp.

The configuration of this circuit suggests it is a type of active filter, likely a low-pass filter, given the presence of the capacitor (C1) and the feedback network involving R2 and R3. The op-amp is used to provide gain and improve the performance of the filter.
```

Figure 16–12. First-Order Noninverting Low-Pass Filter

16-12

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a configuration that appears to be a high-pass filter. Here are the detailed components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangular symbol. The op-amp has two input terminals and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+).

2. **Resistors (R1 and R2)**: 
   - **R1** is connected to the non-inverting input of the op-amp. The other end of R1 is connected to the input voltage source, \( V_{IN} \).
   - **R2** is connected between the inverting input of the op-amp and the output of the op-amp, \( V_{OUT} \).

3. **Capacitor (C1)**: 
   - **C1** is connected in parallel with R2, meaning one end of C1 is connected to the inverting input of the op-amp, and the other end is connected to the output of the op-amp.

4. **Ground Connection**: The non-inverting input of the op-amp is connected to the ground.

5. **Input and Output**:
   - The input voltage, \( V_{IN} \), is applied to the circuit through resistor R1.
   - The output voltage, \( V_{OUT} \), is taken from the output terminal of the op-amp.

In summary, the circuit consists of an op-amp with a feedback network comprising a resistor (R2) and a capacitor (C1) in parallel. The input signal is fed through a resistor (R1) to the non-inverting input of the op-amp, which is also grounded. The configuration suggests that the circuit is designed to function as a high-pass filter, allowing high-frequency signals to pass through while attenuating low-frequency signals.
```

Figure 16–13. First-Order Inverting Low-Pass Filter

The transfer functions of the circuits are:

$$\mathsf{A}\langle\mathsf{s}\rangle = \frac{\mathsf{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_3}}{\mathsf{1} + \mathsf{w}\_{\mathsf{C}}\mathsf{R}\_1\mathsf{C}\_1\mathsf{s}} \qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\frac{-\frac{\mathsf{R}\_2}{\mathsf{R}\_1}}{\mathsf{1} + \mathsf{w}\_{\mathsf{C}}\mathsf{R}\_2\mathsf{C}\_1\mathsf{s}}$$

The negative sign indicates that the inverting amplifier generates a 180° phase shift from the filter input to the output.

The coefficient comparison between the two transfer functions and Equation 16–3 yields:

A0 1 R2 R3 A0 R2 R1 and a1 cR1C1 a1 cR2C1 and

To dimension the circuit, specify the corner frequency (fC), the dc gain (A0), and capacitor C1, and then solve for resistors R1 and R2:

R1 a1 2 fcC1 R2 a1 2 fcC1 and R2 R3 A0 <sup>1</sup> R1 R2 A0 and

The coefficient a1 is taken from one of the coefficient tables, Tables 16–4 through 16–10 in Section 16.9.

Note, that all filter types are identical in their first order and a1 = 1. For higher filter orders, however, a1≠1 because the corner frequency of the first-order stage is different from the corner frequency of the overall filter.

#### Example 16–1. First-Order Unity-Gain Low-Pass Filter

For a first-order unity-gain low-pass filter with fC = 1 kHz and C1 = 47 nF, R1 calculates to:

$$\mathbf{R\_1} = \frac{\mathbf{a\_1}}{2\pi \mathbf{f\_c} \mathbf{C\_1}} = \frac{1}{2\pi \cdot 10^3 \mathsf{H} \cdot 47 \cdot 10^{-9} \mathsf{F}} = \text{3.38 } \mathsf{k}\Omega$$

However, to design the first stage of a third-order unity-gain Bessel low-pass filter, assuming the same values for fC and C1, requires a different value for R1. In this case, obtain a1 for a third-order Bessel filter from Table 16–4 in Section 16.9 (Bessel coefficients) to calculate R1:

$$\mathbf{R\_1} = \frac{\mathbf{a\_1}}{2\pi \mathbf{f\_c} \mathbf{C\_1}} = \frac{\mathbf{0.756}}{2\pi \cdot \mathbf{10^3} \mathbf{H} \mathbf{2} \cdot \mathbf{47} \cdot \mathbf{10^{-9} \mathbf{F}}} = \mathbf{2.56 \text{ k}\Omega}$$

When operating at unity gain, the noninverting amplifier reduces to a voltage follower (Figure 16–14), thus inherently providing a superior gain accuracy. In the case of the inverting amplifier, the accuracy of the unity gain depends on the tolerance of the two resistors, R1 and R2.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) configured as an integrator. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component in the diagram is an op-amp, represented by a triangle with two input terminals and one output terminal. The non-inverting input is marked with a "+" sign, and the inverting input is marked with a "−" sign.

2. **Resistor (R1)**: There is a resistor labeled R1 connected to the inverting input (−) of the op-amp. The other end of the resistor is connected to the input voltage source, labeled V_IN.

3. **Capacitor (C1)**: A capacitor labeled C1 is connected between the inverting input (−) of the op-amp and ground (the reference point for the circuit, usually 0V).

4. **Feedback Loop**: The output of the op-amp (V_OUT) is directly connected to the inverting input (−) of the op-amp, forming a feedback loop.

5. **Non-Inverting Input**: The non-inverting input (+) of the op-amp is connected to ground.

6. **Input Voltage (V_IN)**: The input voltage source, labeled V_IN, is connected to one end of the resistor R1.

7. **Output Voltage (V_OUT)**: The output voltage of the op-amp is labeled V_OUT.

In summary, this circuit is an integrator where the input voltage (V_IN) is integrated over time to produce the output voltage (V_OUT). The resistor R1 and capacitor C1 determine the integration time constant. The feedback loop ensures that the op-amp operates in the desired configuration.
```

Figure 16–14. First-Order Noninverting Low-Pass Filter with Unity Gain

#### **16.3.2 Second-Order Low-Pass Filter**

There are two topologies for a second-order low-pass filter, the Sallen-Key and the Multiple Feedback (MFB) topology.

#### **16.3.2.1 Sallen-Key Topology**

The general Sallen-Key topology in Figure 16–15 allows for separate gain setting via A0 = 1+R4/R3. However, the unity-gain topology in Figure 16–16 is usually applied in filter designs with high gain accuracy, unity gain, and low Qs (Q < 3).

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit has an input voltage labeled as V_IN on the left side.

2. **Resistors and Capacitors**:
   - **R1**: A resistor connected in series with the input voltage V_IN.
   - **R2**: Another resistor connected in series after R1.
   - **C1**: A capacitor connected from the junction between R1 and R2 to the ground.
   - **R3**: A resistor connected from the inverting input (-) of the op-amp to the ground.
   - **R4**: A resistor connected in the feedback loop from the output of the op-amp to the inverting input (-).
   - **C2**: A capacitor connected in parallel with R4 in the feedback loop.

3. **Operational Amplifier (Op-Amp)**:
   - The op-amp has two inputs: the non-inverting input (+) and the inverting input (-).
   - The non-inverting input (+) is connected to the junction between R2 and C2.
   - The inverting input (-) is connected to the junction between R3 and R4.
   - The output of the op-amp is labeled as V_OUT.

4. **Connections**:
   - The input voltage V_IN is applied to the circuit through R1.
   - The junction between R1 and R2 is connected to the capacitor C1, which is grounded.
   - The junction between R2 and the non-inverting input (+) of the op-amp is connected to the capacitor C2, which is part of the feedback loop.
   - The inverting input (-) of the op-amp is connected to the junction between R3 and R4.
   - The output of the op-amp (V_OUT) is connected back to the inverting input (-) through the resistor R4 and capacitor C2 in parallel.

This configuration suggests a specific type of filter or amplifier circuit, potentially a band-pass filter or a similar signal processing circuit, depending on the values of the resistors and capacitors.
```

Figure 16–15. General Sallen-Key Low-Pass Filter

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) configured in a specific arrangement. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The op-amp is represented by a triangular symbol with two input terminals and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+). The output is at the point of the triangle.

2. **Resistors (R1 and R2)**: 
   - **R1** is connected to the input voltage source \( V_{IN} \) on one side and to a node that connects to both \( R2 \) and \( C1 \) on the other side.
   - **R2** is connected between the node (shared with \( R1 \) and \( C1 \)) and the inverting input of the op-amp.

3. **Capacitors (C1 and C2)**:
   - **C1** is connected between the node (shared with \( R1 \) and \( R2 \)) and ground.
   - **C2** is connected between the output of the op-amp and the inverting input of the op-amp.

4. **Connections**:
   - The non-inverting input of the op-amp is connected to ground.
   - The output of the op-amp is labeled as \( V_{OUT} \).

5. **Ground**: The ground symbol is shown connected to the non-inverting input of the op-amp and one side of capacitor \( C1 \).

This circuit is likely a type of active filter, possibly a high-pass or low-pass filter, depending on the values and configuration of the components. The presence of both resistors and capacitors in this configuration suggests frequency-dependent behavior, which is typical in filter circuits.
```

Figure 16–16. Unity-Gain Sallen-Key Low-Pass Filter

The transfer function of the circuit in Figure 16–15 is:

$$\mathsf{A(s)} = \frac{\mathsf{A}\_0}{\mathsf{1} + \mathsf{w}\_{\mathsf{C}} \Big[ \mathsf{C}\_{\mathsf{1}} (\mathsf{R}\_{\mathsf{1}} + \mathsf{R}\_{\mathsf{2}}) + (\mathsf{1} - \mathsf{A}\_0) \mathsf{R}\_{\mathsf{1}} \mathsf{C}\_{\mathsf{2}} \Big] \mathsf{s} + \mathsf{w}\_{\mathsf{c}}^2 \mathsf{R}\_{\mathsf{1}} \mathsf{R}\_2 \mathsf{C}\_{\mathsf{1}} \mathsf{C}\_{\mathsf{2}} \mathsf{s}^2}$$

For the unity-gain circuit in Figure 16–16 (A0=1), the transfer function simplifies to:

$$\mathsf{A}\langle\mathsf{s}\rangle = \frac{1}{\mathsf{1} + \mathsf{o}\_{\mathsf{C}}\mathsf{C}\_{\mathsf{1}}\left(\mathsf{R}\_{\mathsf{1}} + \mathsf{R}\_{\mathsf{2}}\right)\mathsf{s} + \mathsf{o}\_{\mathsf{c}}^{2}\mathsf{R}\_{\mathsf{1}}\mathsf{R}\_{\mathsf{2}}\mathsf{C}\_{\mathsf{1}}\mathsf{C}\_{\mathsf{2}}\mathsf{s}^{2}}$$

The coefficient comparison between this transfer function and Equation 16–2 yields:

$$\begin{aligned} \mathsf{A}\_{0} &= \mathsf{1} \\ \mathsf{a}\_{1} &= \mathsf{a}\_{\mathsf{c}} \mathsf{C}\_{1} (\mathsf{R}\_{1} + \mathsf{R}\_{2}) \\ \mathsf{b}\_{1} &= \mathsf{a}\_{\mathsf{c}} \mathsf{c}^{2} \mathsf{R}\_{1} \mathsf{R}\_{2} \mathsf{C}\_{1} \mathsf{C}\_{2} \end{aligned}$$

Given C1 and C2, the resistor values for R1 and R2 are calculated through:

$$\mathbf{R\_{1,2}} = \frac{\mathbf{a\_1C\_2} \mp \sqrt{\mathbf{a\_1^2C\_2}^2 - 4\mathbf{b\_1C\_1C\_2}}}{4\pi \mathbf{f\_cC\_1C\_2}}$$

Active Filter Design Techniques 16-15

In order to obtain real values under the square root, C2 must satisfy the following condition:

$$\mathbf{C}\_2 \ge \mathbf{C}\_1 \frac{\mathbf{4b\_1}}{\mathbf{a\_1}^2}$$

Example 16–2. Second-Order Unity-Gain Tschebyscheff Low-Pass Filter

The task is to design a second-order unity-gain Tschebyscheff low-pass filter with a corner frequency of fC = 3 kHz and a 3-dB passband ripple.

From Table 16–9 (the Tschebyscheff coefficients for 3-dB ripple), obtain the coefficients a1 and b1 for a second-order filter with a1 = 1.0650 and b1 = 1.9305.

Specifying C1 as 22 nF yields in a C2 of:

$$\mathbf{C}\_2 \ge \mathbf{C}\_1 \frac{\mathbf{4b}\_1}{\mathbf{a}\_1^2} = 22 \cdot \mathbf{10^{-9}nF} \cdot \frac{\mathbf{4 \cdot 1.9305}}{\mathbf{1.065^2}} \cong \mathbf{150 nF}$$

Inserting a1 and b1 into the resistor equation for R1,2 results in:

$$\mathcal{R}\_1 = \frac{\text{7.065} \cdot \text{150} \cdot \text{10}^{-9} - \sqrt{\left(\text{7.065} \cdot \text{150} \cdot \text{10}^{-9}\right)^2 - 4 \cdot \text{1.9305} \cdot \text{22} \cdot \text{10}^{-9} \cdot \text{150} \cdot \text{10}^{-9}}}{4\pi \cdot \text{3} \cdot \text{10}^3 \cdot \text{22} \cdot \text{10}^{-9} \cdot \text{150} \cdot \text{10}^{-9}} = \text{1.26 k}\Omega$$

and

$$\mathcal{R}\_2 = \frac{\mathbb{1.065 \cdot 150 \cdot 10^{-9} + \sqrt{\left(\mathbb{1.065 \cdot 150 \cdot 10^{-9}\right)^2 - 4 \cdot \mathbb{1.9305 \cdot 22 \cdot 10^{-9} \cdot 150 \cdot 10^{-9}}{4\pi \cdot 3 \cdot 10^3 \cdot 22 \cdot 10^{-9} \cdot 150 \cdot 10^{-9}}}}{4\pi \cdot 3 \cdot 10^3 \cdot 22 \cdot 10^{-9} \cdot 150 \cdot 10^{-9}} = 1.30 \text{ k}\Omega$$

with the final circuit shown in Figure 16–17.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Input Voltage (VIN)**: The circuit starts with an input voltage labeled VIN.

2. **Resistors**:
   - A resistor with a value of 1.26k ohms is connected directly to the input voltage VIN.
   - Another resistor with a value of 1.30k ohms is connected in series with the first resistor.

3. **Capacitors**:
   - A capacitor with a value of 22nF (nanofarads) is connected to the junction between the two resistors and is grounded.
   - Another capacitor with a value of 150nF is connected between the output of the op-amp and the junction between the two resistors.

4. **Operational Amplifier (Op-Amp)**:
   - The op-amp is depicted with its standard symbol, showing the inverting input (-), non-inverting input (+), and output.
   - The non-inverting input (+) is connected to the junction between the two resistors.
   - The inverting input (-) is connected to the output of the op-amp, indicating a feedback loop.

5. **Output Voltage (VOUT)**: The output of the op-amp is labeled VOUT.

The configuration suggests a specific type of op-amp circuit, possibly a filter or integrator, given the presence of capacitors and resistors in this arrangement. The feedback loop involving the capacitor and the resistor indicates that the circuit is designed to process the input signal VIN and produce an output signal VOUT based on the op-amp's configuration and the values of the passive components.
```

Here is the image describtion:
```
The image is a caption or title for a figure, labeled as "Figure 16–17." The title describes the content of the figure, which is a "Second-Order Unity-Gain Tschebyscheff Low-Pass with 3-dB Ripple." This indicates that the figure likely illustrates a specific type of electronic filter, known as a Tschebyscheff (or Chebyshev) low-pass filter, which is designed to allow signals with a frequency lower than a certain cutoff frequency to pass through while attenuating signals with frequencies higher than the cutoff frequency. The filter is of the second order, meaning it has a quadratic response, and it has a unity gain, meaning the output signal has the same amplitude as the input signal within the passband. Additionally, the filter has a 3-dB ripple, which refers to the variation in the passband amplitude response, indicating that the amplitude can vary by up to 3 decibels within the passband.
```

A special case of the general Sallen-Key topology is the application of equal resistor values and equal capacitor values: R1 = R2 = R and C1 = C2 = C.

16-16

The general transfer function changes to:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{A}\_0}{\mathsf{1} + \mathsf{a}\mathsf{c}\mathsf{R}\mathsf{C}(\mathsf{3} - \mathsf{A}\_0)\mathsf{s} + \langle \mathsf{a}\mathsf{c}\mathsf{R}\mathsf{C}\rangle^2 \mathsf{s}^2} \qquad\qquad\text{with}\qquad \mathsf{A}\_0 = \mathsf{1} + \frac{\mathsf{R}\_4}{\mathsf{R}\_3}$$

The coefficient comparison with Equation 16–2 yields:

$$\mathbf{a\_1 = \(\mathbf{a\_c}\mathbf{R}\mathbf{C}\)^2}$$

$$\mathbf{b\_1 = \left(\mathbf{a\_c}\mathbf{R}\mathbf{C}\right)^2}$$

Given C and solving for R and A0 results in:

$$\mathsf{R} = \frac{\sqrt{\mathsf{b}\_{\mathsf{1}}}}{2\pi \mathsf{f}\_{\mathsf{C}} \mathsf{C}} \qquad \mathsf{and} \qquad \mathsf{A}\_{0} = \mathsf{3} - \frac{\mathsf{a}\_{\mathsf{1}}}{\sqrt{\mathsf{b}\_{\mathsf{1}}}} = \mathsf{3} - \frac{\mathsf{1}}{\mathsf{Q}}$$

Thus, A0 depends solely on the pole quality Q and vice versa; Q, and with it the filter type, is determined by the gain setting of A0:

$$\mathbf{Q} = \frac{\mathbf{1}}{\mathbf{3} - \mathbf{A}\_0}$$

The circuit in Figure 16–18 allows the filter type to be changed through the various resistor ratios R4/R3.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an op-amp, represented by a triangle with two input terminals (one marked with a minus sign for the inverting input and one with a plus sign for the non-inverting input) and one output terminal.

2. **Resistors (R)**: There are four resistors in the circuit:
   - Two resistors labeled "R" are connected in series with the input voltage \( V_{IN} \). The first resistor is connected directly to \( V_{IN} \), and the second resistor is connected to the first resistor.
   - A third resistor, labeled \( R_3 \), is connected between the inverting input of the op-amp and ground.
   - A fourth resistor, labeled \( R_4 \), is a variable resistor (potentiometer) connected between the output of the op-amp and the inverting input.

3. **Capacitors (C)**: There are two capacitors in the circuit:
   - One capacitor is connected in parallel with the second resistor (R) and the inverting input of the op-amp.
   - Another capacitor is connected between the junction of the two series resistors (R) and ground.

4. **Connections**:
   - The non-inverting input of the op-amp is connected to the junction of the second resistor (R) and the capacitor connected in parallel with it.
   - The output of the op-amp is connected to the junction of the variable resistor \( R_4 \) and the inverting input of the op-amp.
   - The inverting input of the op-amp is connected to the junction of the variable resistor \( R_4 \) and the resistor \( R_3 \), which is connected to ground.

5. **Voltage Inputs and Outputs**:
   - \( V_{IN} \) is the input voltage applied to the circuit.
   - \( V_{OUT} \) is the output voltage from the op-amp.

This configuration suggests a complex feedback network involving both resistive and capacitive components, which could be used for various signal processing applications such as filtering, amplification, or oscillation, depending on the specific values and arrangement of the components.
```

#### Figure 16–18. Adjustable Second-Order Low-Pass Filter

Table 16–1 lists the coefficients of a second-order filter for each filter type and gives the resistor ratios that adjust the Q.

#### Table 16–1. Second-Order FIlter Coefficients

| SECOND-ORDER | BESSEL | BUTTERWORTH | 3-dB TSCHEBYSCHEFF |
|--------------|--------|-------------|--------------------|
| a1           | 1.3617 | 1.4142      | 1.065              |
| b1           | 0.618  | 1           | 1.9305             |
| Q            | 0.58   | 0.71        | 1.3                |
| R4/R3        | 0.268  | 0.568       | 0.234              |

#### **16.3.2.2 Multiple Feedback Topology**

The MFB topology is commonly used in filters that have high Qs and require a high gain.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit has an input voltage labeled as \( V_{IN} \) on the left side.

2. **Resistor R1**: The input voltage \( V_{IN} \) is connected to a resistor labeled \( R_1 \).

3. **Capacitor C2**: After \( R_1 \), the circuit branches into two paths. One path goes through a capacitor labeled \( C_2 \) which is connected to the ground.

4. **Resistor R3**: The other path continues through a resistor labeled \( R_3 \).

5. **Operational Amplifier (Op-Amp)**: The output of \( R_3 \) is connected to the inverting input (marked with a minus sign) of an operational amplifier. The non-inverting input (marked with a plus sign) of the op-amp is connected to the ground.

6. **Feedback Network**: The circuit includes a feedback network from the output of the op-amp back to its inverting input. This network consists of:
   - A resistor labeled \( R_2 \) connected directly from the output to the inverting input.
   - A capacitor labeled \( C_1 \) in parallel with \( R_2 \).

7. **Output Voltage (V_OUT)**: The output of the op-amp is labeled as \( V_{OUT} \).

In summary, the circuit is a type of active filter using an operational amplifier with a combination of resistors and capacitors to shape the frequency response. The exact function (e.g., low-pass, high-pass, band-pass, or band-stop) would depend on the values and configuration of the components.
```

### Figure 16–19. Second-Order MFB Low-Pass Filter

The transfer function of the circuit in Figure 16–19 is:

$$\mathsf{A(s)} = -\frac{\frac{\mathsf{R}\_2}{\mathsf{R}\_1}}{\mathsf{1} + \mathsf{w}\_{\mathsf{C}} \mathsf{C}\_{\mathsf{f}} \Big(\mathsf{R}\_2 + \mathsf{R}\_3 + \frac{\mathsf{R}\_2 \mathsf{R}\_3}{\mathsf{R}\_1}\Big) \mathsf{s} + \mathsf{w}\_{\mathsf{c}}^2 \mathsf{C}\_{\mathsf{f}} \mathsf{C}\_2 \mathsf{R}\_2 \mathsf{R}\_3 \mathsf{s}^2}$$

Through coefficient comparison with Equation 16–2 one obtains the relation:

$$\begin{aligned} \mathsf{A}\_{0} &= -\frac{\mathsf{R}\_{2}}{\mathsf{R}\_{1}} \\ \mathsf{a}\_{1} &= \mathsf{w}\_{\mathsf{c}} \mathsf{C}\_{1} \Big( \mathsf{R}\_{2} + \mathsf{R}\_{3} + \frac{\mathsf{R}\_{2} \mathsf{R}\_{3}}{\mathsf{R}\_{1}} \Big) \\ \mathsf{b}\_{1} &= \mathsf{w}\_{\mathsf{c}} \,^{2} \mathsf{C}\_{1} \mathsf{C}\_{2} \mathsf{R}\_{2} \mathsf{R}\_{3} \end{aligned}$$

Given C1 and C2, and solving for the resistors R1–R3:

$$\begin{aligned} \mathsf{R}\_2 &= \frac{\mathsf{a}\_1 \mathsf{C}\_2 - \sqrt{\mathsf{a}\_1 \mathsf{2} \mathsf{C}\_2 \mathsf{2} - 4 \mathsf{b}\_1 \mathsf{C}\_1 \mathsf{C}\_2 (\mathsf{1} - \mathsf{A}\_0)}}{4 \pi \mathsf{f}\_c \mathsf{C}\_1 \mathsf{C}\_2} \\ \mathsf{R}\_1 &= \frac{\mathsf{R}\_2}{-\mathsf{A}\_0} \\ \mathsf{R}\_3 &= \frac{\mathsf{b}\_1}{4 \pi \mathsf{f}\_c^2 \mathsf{C}\_1 \mathsf{C}\_2 \mathsf{R}\_2} \end{aligned}$$

In order to obtain real values for R2, C2 must satisfy the following condition:

$$\mathbf{C}\_2 \ge \mathbf{C}\_1 \frac{\mathbf{4b\_1} \left(\mathfrak{1} - \mathfrak{A\_0}\right)}{\mathbf{a\_1}^2}$$

#### **16.3.3 Higher-Order Low-Pass Filters**

Higher-order low-pass filters are required to sharpen a desired filter characteristic. For that purpose, first-order and second-order filter stages are connected in series, so that the product of the individual frequency responses results in the optimized frequency response of the overall filter.

In order to simplify the design of the partial filters, the coefficients ai and bi for each filter type are listed in the coefficient tables (Tables 16–4 through 16–10 in Section 16.9), with each table providing sets of coefficients for the first 10 filter orders.

#### Example 16–3. Fifth-Order Filter

The task is to design a fifth-order unity-gain Butterworth low-pass filter with the corner frequency fC = 50 kHz.

First the coefficients for a fifth-order Butterworth filter are obtained from Table 16–5, Section 16.9:

|          | ai          | bi     |
|----------|-------------|--------|
| Filter 1 | a1 = 1      | b1 = 0 |
| Filter 2 | a2 = 1.6180 | b2 = 1 |
| Filter 3 | a3 = 0.6180 | b3 = 1 |

Then dimension each partial filter by specifying the capacitor values and calculating the required resistor values.

#### **First Filter**

Here is the image describtion:
```
The image depicts a simple electronic circuit diagram featuring an operational amplifier (op-amp) configured as an integrator. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component in the diagram is an op-amp, represented by a triangle with two input terminals (marked with "+" and "-") and one output terminal. The "+" terminal is the non-inverting input, and the "-" terminal is the inverting input.

2. **Resistor (R1)**: There is a resistor labeled R1 connected to the inverting input of the op-amp. The other end of the resistor is connected to the input voltage source, labeled as \( V_{IN} \).

3. **Capacitor (C1)**: A capacitor labeled C1 is connected between the inverting input of the op-amp and ground. This capacitor is responsible for the integration function in the circuit.

4. **Feedback Loop**: The output of the op-amp, labeled \( V_{OUT} \), is connected back to the inverting input of the op-amp, completing the feedback loop.

5. **Ground Connection**: The capacitor C1 is connected to ground, which is typically represented by a horizontal line with three downward-pointing lines.

6. **Voltage Labels**: The input voltage is labeled \( V_{IN} \), and the output voltage is labeled \( V_{OUT} \).

In summary, this circuit is an integrator where the input voltage \( V_{IN} \) is integrated over time to produce the output voltage \( V_{OUT} \). The resistor R1 and capacitor C1 determine the integration time constant.
```

Figure 16–20. First-Order Unity-Gain Low-Pass

$$
\mathsf{Miffh } \mathsf{C}\_1 = \mathsf{T} \mathsf{nF},
$$

$$\mathbf{R\_1} = \frac{\mathbf{a\_1}}{2\pi \mathbf{f\_c} \mathbf{C\_1}} = \frac{1}{2\pi \cdot 50 \cdot 10^3 \text{Hz} \cdot \mathbf{1} \cdot 10^{-9} \text{F}} = 3.18 \text{ k}\Omega$$

The closest 1% value is 3.16 kΩ.

Active Filter Design Techniques 16-19

#### **Second Filter**

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) configured with resistors and capacitors. Here is a detailed description of the components and their connections:

1. **Input Voltage (VIN)**: The circuit starts with an input voltage labeled VIN on the left side.

2. **Resistor R1**: Connected directly to VIN, there is a resistor labeled R1. The other end of R1 connects to a node that branches into two paths.

3. **Resistor R2**: One path from the node connects to another resistor labeled R2. The other end of R2 connects to the inverting input (marked with a minus sign) of the op-amp.

4. **Capacitor C1**: The second path from the node connects to a capacitor labeled C1, which is grounded (connected to the ground symbol).

5. **Operational Amplifier (Op-Amp)**: The op-amp has two inputs, the non-inverting input (marked with a plus sign) and the inverting input (marked with a minus sign). The non-inverting input is connected to the ground. The inverting input is connected to the node between R2 and C1.

6. **Capacitor C2**: There is a feedback loop from the output of the op-amp to the node between R2 and the inverting input. This feedback loop includes a capacitor labeled C2.

7. **Output Voltage (VOUT)**: The output of the op-amp is labeled VOUT, which is the final output voltage of the circuit.

The configuration suggests that the circuit is likely a type of active filter or integrator, utilizing the op-amp, resistors, and capacitors to process the input signal VIN and produce the output signal VOUT.
```

Figure 16–21. Second-Order Unity-Gain Sallen-Key Low-Pass Filter

With C1 = 820 pF,

$$\mathbf{C}\_2 \ge \mathbf{C}\_1 \frac{\mathbf{4b}\_2}{\mathbf{a}\_2^2} = \mathbf{820} \cdot \mathbf{10^{-12}} \mathbf{F} \cdot \frac{\mathbf{4 \cdot 1}}{\mathbf{1.618^2}} = \mathbf{1.26 nF}$$

The closest 5% value is 1.5 nF.

With C1 = 820 pF and C2 = 1.5 nF, calculate the values for R1 and R2 through:

$$\mathsf{R\_{\uparrow}} = \frac{\mathsf{a\_{2}}\mathsf{C\_{2}} - \sqrt{\mathsf{a\_{2}}^{2}\mathsf{C\_{2}}^{2} - 4\mathsf{b\_{2}}\mathsf{C\_{1}}\mathsf{C\_{2}}}{4\pi\mathsf{f\_{c}}\mathsf{C\_{1}}\mathsf{C\_{2}}} \qquad\_{\text{and}} \qquad \mathsf{R\_{\uparrow}} = \frac{\mathsf{a\_{2}}\mathsf{C\_{2}} + \sqrt{\mathsf{a\_{2}}^{2}\mathsf{C\_{2}}^{2} - 4\mathsf{b\_{2}}\mathsf{C\_{1}}\mathsf{C\_{2}}}{4\pi\mathsf{f\_{c}}\mathsf{C\_{1}}\mathsf{C\_{2}}}$$

and obtain

$$\mathbf{R}\_1 = \frac{\mathbf{1.618:1.5:10^{-9}} - \sqrt{\left(\mathbf{1.618:1.5:10^{-9}}\right)^2 - 4 \cdot \mathbf{1.620:10^{-12}:1.5:10^{-9}}}}{4\pi \mathbf{50} \cdot \mathbf{10^3} \mathbf{820} \cdot \mathbf{10^{-12}} \mathbf{1.5:10^{-9}}} = \mathbf{1.87} \,\mathbf{k}\Omega$$

$$\mathbf{R}\_2 = \frac{\mathbf{1.618:1.5:10^{-9}} + \sqrt{\left(\mathbf{1.618:1.5:10^{-9}}\right)^2 - 4 \cdot \mathbf{1.820:10^{-12}:1.5:10^{-9}}}}{4\pi \mathbf{50} \cdot \mathbf{10^3} \mathbf{820} \cdot \mathbf{10^{-12}} \mathbf{1.5:10^{-9}}} = \mathbf{4.42 \,\mathbf{k}\Omega$$

R1 and R2 are available 1% resistors.

#### **Third Filter**

The calculation of the third filter is identical to the calculation of the second filter, except that a2 and b2 are replaced by a3 and b3, thus resulting in different capacitor and resistor values.

Specify C1 as 330 pF, and obtain C2 with:

$$\mathbf{C}\_2 \succeq \mathbf{C}\_1 \frac{\mathbf{4b}\_3}{\mathbf{a}\_3^2} = \mathbf{330} \cdot \mathbf{10^{-12}}\\\mathbf{F} \cdot \frac{\mathbf{4 \cdot 1}}{\mathbf{0.618^2}} = \mathbf{3.46 nF}$$

The closest 10% value is 4.7 nF.

With C1 = 330 pF and C2 = 4.7 nF, the values for R1 and R2 are:

- R1 = 1.45 kΩ, with the closest 1% value being 1.47 kΩ
- R2 = 4.51 kΩ, with the closest 1% value being 4.53 kΩ

Figure 16–22 shows the final filter circuit with its partial filter stages.

Here is the image describtion:
```
The image depicts a multi-stage active filter circuit using operational amplifiers (op-amps). Here is a detailed description of the circuit:

1. **Input Stage:**
   - The input voltage is labeled as \( V_{IN} \).
   - The input signal first passes through a resistor with a value of 3.16kΩ.
   - After the resistor, there is a capacitor with a value of 1nF connected to the ground, forming a high-pass filter.

2. **First Op-Amp Stage:**
   - The signal then enters the non-inverting input of the first operational amplifier.
   - The op-amp is configured with a feedback loop, but the exact configuration is not fully visible in the image.
   - The output of this op-amp is connected to a resistor with a value of 1.87kΩ.

3. **Second Stage:**
   - The signal then passes through a resistor of 1.87kΩ.
   - After this resistor, there is a parallel combination of a capacitor (820pF) to ground and a series combination of a resistor (4.42kΩ) and a capacitor (1.5nF) to the next stage.
   - This forms a band-pass filter.

4. **Second Op-Amp Stage:**
   - The signal then enters the non-inverting input of the second operational amplifier.
   - Similar to the first op-amp, this one also has a feedback loop, but the exact configuration is not fully visible.
   - The output of this op-amp is connected to a resistor with a value of 1.47kΩ.

5. **Third Stage:**
   - The signal then passes through a resistor of 1.47kΩ.
   - After this resistor, there is a parallel combination of a capacitor (330pF) to ground and a series combination of a resistor (4.53kΩ) and a capacitor (4.7nF) to the next stage.
   - This forms another band-pass filter.

6. **Third Op-Amp Stage:**
   - The signal then enters the non-inverting input of the third operational amplifier.
   - This op-amp also has a feedback loop, but the exact configuration is not fully visible.
   - The output of this op-amp is labeled as \( V_{OUT} \).

Overall, the circuit appears to be a multi-stage active filter, likely designed to achieve a specific frequency response by combining high-pass and band-pass filtering stages. The use of operational amplifiers suggests that the circuit is designed to provide amplification and buffering between stages.
```

Figure 16–22. Fifth-Order Unity-Gain Butterworth Low-Pass Filter

# **16.4 High-Pass Filter Design**

By replacing the resistors of a low-pass filter with capacitors, and its capacitors with resistors, a high-pass filter is created.

Here is the image describtion:
```
The image shows two different configurations of an electronic circuit involving operational amplifiers (op-amps), resistors, and capacitors. Both configurations are used for signal processing, likely for filtering purposes.

### Left Circuit:
1. **Input Signal (V_IN)**: The input signal is applied to the circuit.
2. **Resistor R1**: The input signal first passes through a resistor labeled R1.
3. **Node 1**: After R1, the signal reaches a node where it splits into two paths.
4. **Resistor R2**: One path continues through another resistor labeled R2.
5. **Capacitor C1**: The other path goes through a capacitor labeled C1, which is connected to the ground.
6. **Op-Amp Configuration**: The signal then enters the inverting input (-) of an operational amplifier (op-amp). The non-inverting input (+) of the op-amp is connected to the ground.
7. **Feedback Loop**: A capacitor labeled C2 is connected from the output of the op-amp back to the node between R2 and the inverting input of the op-amp.
8. **Output Signal (V_OUT)**: The output of the op-amp is the output signal of the circuit.

### Right Circuit:
1. **Input Signal (V_IN)**: The input signal is applied to the circuit.
2. **Capacitor C1**: The input signal first passes through a capacitor labeled C1.
3. **Node 1**: After C1, the signal reaches a node where it splits into two paths.
4. **Capacitor C2**: One path continues through another capacitor labeled C2.
5. **Resistor R1**: The other path goes through a resistor labeled R1, which is connected to the ground.
6. **Op-Amp Configuration**: The signal then enters the inverting input (-) of an operational amplifier (op-amp). The non-inverting input (+) of the op-amp is connected to the ground.
7. **Feedback Loop**: A resistor labeled R2 is connected from the output of the op-amp back to the node between C2 and the inverting input of the op-amp.
8. **Output Signal (V_OUT)**: The output of the op-amp is the output signal of the circuit.

### Summary:
- Both circuits involve an op-amp with feedback components.
- The left circuit uses resistors and capacitors in a specific configuration, while the right circuit swaps the positions of the resistors and capacitors.
- These configurations are likely used for different types of filtering or signal processing applications, such as high-pass or low-pass filters.
```

Figure 16–23. Low-Pass to High-Pass Transition Through Components Exchange

To plot the gain response of a high-pass filter, mirror the gain response of a low-pass filter at the corner frequency, Ω=1, thus replacing Ω with 1/Ω and S with 1/S in Equation 16–1.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the gain (magnitude) in decibels (dB) on the vertical axis and the frequency on the horizontal axis, which is plotted on a logarithmic scale.

Key features of the plot include:

1. **Axes**:
   - The vertical axis is labeled "|A| — Gain — dB" and ranges from -30 dB to 10 dB.
   - The horizontal axis is labeled "Frequency — Ω" and ranges from 0.1 to 10 on a logarithmic scale.

2. **Curves**:
   - There are two curves on the plot: a solid line and a dashed line.
   - The solid line represents the gain of a lowpass filter. It starts at 0 dB for low frequencies (left side of the plot) and decreases as the frequency increases, eventually dropping below -20 dB.
   - The dashed line represents the gain of a highpass filter. It starts below -20 dB for low frequencies and increases as the frequency increases, eventually reaching 0 dB for high frequencies (right side of the plot).

3. **Labels**:
   - The lowpass filter region is labeled "Lowpass" near the left side of the plot.
   - The highpass filter region is labeled "Highpass" near the right side of the plot.
   - The gain at low frequencies for the lowpass filter is labeled "A₀".
   - The gain at high frequencies for the highpass filter is labeled "A∞".

4. **Frequency Markers**:
   - The plot includes vertical grid lines to indicate specific frequency points, with major markers at 0.1, 1, and 10.

Overall, the plot illustrates how the gain of the lowpass and highpass filters changes with frequency, showing that the lowpass filter allows low frequencies to pass with little attenuation while attenuating high frequencies, and the highpass filter allows high frequencies to pass with little attenuation while attenuating low frequencies.
```

Figure 16–24. Developing The Gain Response of a High-Pass Filter

The general transfer function of a high-pass filter is then:

$$\mathsf{A(s)} = \frac{\mathsf{A}\_{\infty}}{\prod\_{\mathbf{i}} \left( \mathsf{1} + \frac{\mathsf{a}\_{\mathbf{i}}}{\mathsf{s}} + \frac{\mathsf{b}\_{\mathbf{i}}}{\mathsf{s}^2} \right)} \tag{16-4}$$

with A∞ being the passband gain.

Since Equation 16–4 represents a cascade of second-order high-pass filters, the transfer function of a single stage is:

$$\mathsf{A}\_{\mathsf{i}}(\mathsf{s}) = \frac{\mathsf{A}\_{\infty}}{\left(\mathsf{1} + \frac{\mathsf{a}\_{\mathrm{i}}}{\mathsf{S}} + \frac{\mathsf{b}\_{\mathrm{i}}}{\mathsf{s}^{2}}\right)}\tag{16-5}$$

With b=0 for all first-order filters, the transfer function of a first-order filter simplifies to:

$$\mathsf{A(s)} = \frac{\mathsf{A}\_0}{\mathsf{1} + \frac{\mathsf{a}\_i}{\mathsf{s}}} \tag{16-6}$$

### **16.4.1 First-Order High-Pass Filter**

Figure 16–25 and 16–26 show a first-order high-pass filter in the noninverting and the inverting configuration.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit involving an operational amplifier (op-amp) configured as a non-inverting amplifier with additional components for signal conditioning. Here is a detailed description of the circuit:

1. **Input Signal (V_IN)**: The circuit starts with an input signal labeled as V_IN.

2. **Capacitor (C1)**: The input signal passes through a capacitor labeled C1. This capacitor is likely used for AC coupling, which blocks any DC component of the input signal, allowing only the AC component to pass through.

3. **Resistor (R1)**: After the capacitor, the signal encounters a resistor labeled R1, which is connected to ground. This resistor, in combination with the capacitor, forms a high-pass filter that allows signals above a certain frequency to pass through.

4. **Voltage Divider (R3)**: The node between the capacitor C1 and resistor R1 is connected to another resistor labeled R3, which is also connected to ground. This forms a voltage divider network that sets the bias point for the non-inverting input of the op-amp.

5. **Operational Amplifier (Op-Amp)**: The core component of the circuit is an operational amplifier. The non-inverting input (+) of the op-amp is connected to the junction between R1 and R3. The inverting input (-) is connected to the output through a feedback resistor R2.

6. **Feedback Resistor (R2)**: The resistor R2 is connected between the output of the op-amp (V_OUT) and the inverting input (-). This resistor provides negative feedback, which stabilizes the gain of the amplifier.

7. **Output Signal (V_OUT)**: The output of the op-amp is labeled as V_OUT, which is the amplified version of the input signal.

In summary, this circuit is a non-inverting amplifier with a high-pass filter at the input. The capacitor C1 and resistor R1 form the high-pass filter, while the op-amp with feedback resistor R2 provides amplification. The resistor R3 helps set the bias point for the non-inverting input of the op-amp.
```

Here is the image describtion:
```
The image contains a caption that reads "Figure 16–25. First-Order Noninverting High-Pass Filter." However, the actual diagram or visual representation of the high-pass filter is not visible in the provided image. The caption suggests that the figure is likely an electronic circuit diagram illustrating a first-order noninverting high-pass filter, which typically consists of components such as resistors, capacitors, and possibly an operational amplifier arranged to allow high-frequency signals to pass while attenuating low-frequency signals.
```

Here is the image describtion:
```
The image depicts a circuit diagram of an operational amplifier (op-amp) configured as a high-pass filter. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as \( V_{IN} \).

2. **Capacitor (C1)**: The input voltage \( V_{IN} \) is connected to a capacitor labeled \( C_1 \). This capacitor is in series with the input signal and serves to block any DC component, allowing only AC signals to pass through.

3. **Resistor (R1)**: After the capacitor \( C_1 \), the circuit continues with a resistor labeled \( R_1 \). This resistor is also in series with the input signal.

4. **Operational Amplifier (Op-Amp)**: The resistor \( R_1 \) is connected to the inverting input (marked with a minus sign) of an operational amplifier. The non-inverting input (marked with a plus sign) of the op-amp is connected to the ground.

5. **Feedback Resistor (R2)**: There is a feedback resistor labeled \( R_2 \) connected between the output of the op-amp (labeled \( V_{OUT} \)) and the inverting input of the op-amp. This feedback resistor determines the gain of the op-amp and is crucial for the filter's frequency response.

6. **Output Voltage (V_OUT)**: The output of the op-amp is labeled as \( V_{OUT} \), which is the filtered output signal of the circuit.

In summary, the circuit is a high-pass filter using an operational amplifier. The capacitor \( C_1 \) and resistor \( R_1 \) form the high-pass filter network, while the op-amp with feedback resistor \( R_2 \) amplifies the filtered signal. The non-inverting input of the op-amp is grounded, and the output voltage \( V_{OUT} \) is taken from the op-amp's output terminal.
```

Figure 16–26. First-Order Inverting High-Pass Filter

The transfer functions of the circuits are:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_3}}{\mathsf{1} + \frac{\mathsf{1}}{\mathsf{a} \mathsf{c}\_2 \mathsf{R}\_1 \mathsf{C}\_1} \cdot \frac{\mathsf{1}}{\mathsf{s}}} \qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\frac{\frac{\mathsf{R}\_2}{\mathsf{R}\_1}}{\mathsf{R}\_1}$$

The negative sign indicates that the inverting amplifier generates a 180° phase shift from the filter input to the output.

The coefficient comparison between the two transfer functions and Equation 16–6 provides two different passband gain factors:

$$\mathsf{A}\_{\varpi} = \mathsf{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_3} \qquad\qquad\qquad\qquad\qquad\text{and}\qquad\qquad\mathsf{A}\_{\varpi} = -\frac{\mathsf{R}\_2}{\mathsf{R}\_1}$$

while the term for the coefficient a1 is the same for both circuits:

$$\mathbf{a\_1} = \frac{1}{\mathbf{a\_c}\mathbf{R\_1}\mathbf{C\_1}}$$

Active Filter Design Techniques 16-23

To dimension the circuit, specify the corner frequency (fC), the dc gain (A∞), and capacitor (C1), and then solve for R1 and R2:

$$\mathsf{R}\_1 = \frac{1}{2\pi \mathsf{f}\_\mathsf{c} \mathbf{a}\_1 \mathbf{C}\_1}$$

$$\mathsf{R}\_2 = \mathsf{R}\_3 \mathsf{[A}\_x - \mathsf{T}\text{]} \qquad \qquad \qquad \qquad \qquad \qquad \qquad \mathsf{and} \qquad \qquad \qquad \mathsf{R}\_2 = -\mathsf{R}\_1 \mathsf{A}\_x$$

## **16.4.2 Second-Order High-Pass Filter**

High-pass filters use the same two topologies as the low-pass filters: Sallen-Key and Multiple Feedback. The only difference is that the positions of the resistors and the capacitors have changed.

#### **16.4.2.1 Sallen-Key Topology**

The general Sallen-Key topology in Figure 16–27 allows for separate gain setting via A0 = 1+R4/R3.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled V_IN on the left side.

2. **Capacitors (C1 and C2)**: 
   - C1 is connected in series with the input voltage V_IN.
   - C2 is connected in series after C1.

3. **Resistor (R1)**: 
   - One end of R1 is connected to the junction between C1 and C2.
   - The other end of R1 is connected to the ground.

4. **Operational Amplifier (Op-Amp)**: 
   - The op-amp has two input terminals: the inverting input (marked with a minus sign) and the non-inverting input (marked with a plus sign).
   - The non-inverting input is connected to the junction between C2 and R1.

5. **Resistors (R2, R3, and R4)**:
   - R2 is connected between the output of the op-amp and the inverting input of the op-amp.
   - R3 is connected between the inverting input of the op-amp and the ground.
   - R4 is connected between the output of the op-amp and the ground.

6. **Output Voltage (V_OUT)**: The output voltage is labeled V_OUT and is taken from the output terminal of the op-amp.

The configuration suggests a specific type of filter or amplifier circuit, possibly a high-pass filter or a band-pass filter, depending on the values of the capacitors and resistors. The op-amp is used to amplify the signal, and the arrangement of the components determines the frequency response of the circuit.
```

Here is the image describtion:
```
The image is a caption that reads "Figure 16–27. General Sallen-Key High-Pass Filter." This suggests that the figure is part of a larger document, likely a textbook or technical manual, and it is specifically referring to a diagram or illustration of a general Sallen-Key high-pass filter. The Sallen-Key topology is a popular electronic filter design used to implement second-order active filters. The caption indicates that the figure is likely showing the circuit configuration or schematic of this type of high-pass filter.
```

The transfer function of the circuit in Figure 16–27 is:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{a}}{\mathsf{1} + \frac{\mathsf{R}\_2(\mathsf{C}\_1 + \mathsf{C}\_2) + \mathsf{R}\_1\mathsf{C}\_2(\mathsf{t} - \mathsf{a})} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{a}\_\mathsf{c} \,^2 \mathsf{R}\_1 \mathsf{R}\_2 \mathsf{C}\_1 \mathsf{C}\_2} \cdot \frac{1}{\mathsf{s}^2}} \qquad\qquad\qquad\text{with}\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\qquad\square\_4 + \frac{\mathsf{R}\_4}{\mathsf{R}\_3 \,^2 \mathsf{R}\_4 \mathsf{R}\_3 \,^2 \mathsf{R}\_4 \,^2 \mathsf{R}\_5}{\mathsf{s}^2} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{s}} \,^2\mathsf{R}\_6 \,^2 \mathsf{R}\_7 \,^2 \mathsf{R}\_8 \,^2 \mathsf{R}\_9}{\mathsf{s}^2} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{s}} \,^2\mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10}}{\mathsf{s}^2} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{s}} \,^2\mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10} \,^2 \mathsf{R}\_{10}}{\mathsf{s}^2} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{s}} \,^$$

The unity-gain topology in Figure 16–28 is usually applied in low-Q filters with high gain accuracy.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the circuit:

1. **Input Signal (V_IN)**: The circuit starts with an input signal labeled as \( V_{IN} \) on the left side.

2. **Capacitors (C)**: The input signal \( V_{IN} \) first passes through a capacitor labeled \( C \). This is followed by another capacitor, also labeled \( C \), in series with the first capacitor. These capacitors are likely used for AC coupling, which blocks any DC component of the input signal and allows only the AC component to pass through.

3. **Resistor (R1)**: After the second capacitor, the circuit branches off to a resistor labeled \( R_1 \) that is connected to the ground. This resistor forms part of a high-pass filter with the capacitors, determining the cutoff frequency of the filter.

4. **Operational Amplifier (Op-Amp)**: The signal then enters the non-inverting input (marked with a "+") of an operational amplifier. The inverting input (marked with a "−") of the op-amp is connected to the output of the op-amp, indicating a voltage follower or buffer configuration. This configuration provides high input impedance and low output impedance, ensuring that the signal is not loaded by the next stage of the circuit.

5. **Feedback Resistor (R2)**: There is a resistor labeled \( R_2 \) connected between the output of the op-amp and the junction between the two capacitors. This resistor provides feedback and is part of the filter network, influencing the frequency response of the circuit.

6. **Output Signal (V_OUT)**: The output of the op-amp is labeled as \( V_{OUT} \), which is the final output signal of the circuit.

In summary, the circuit appears to be a high-pass filter followed by a buffer stage using an operational amplifier. The capacitors and resistor \( R_1 \) set the cutoff frequency of the high-pass filter, while the op-amp in a voltage follower configuration ensures that the output signal \( V_{OUT} \) is a buffered version of the filtered input signal.
```

Figure 16–28. Unity-Gain Sallen-Key High-Pass Filter

16-24

To simplify the circuit design, it is common to choose unity-gain (α = 1), and C1 = C2 = C. The transfer function of the circuit in Figure 16–28 then simplifies to:

$$\mathsf{A(s)} = \frac{1}{\mathsf{1} + \frac{2}{\mathsf{co}\_{\mathsf{C}} \mathsf{R}\_{\mathsf{1}} \mathsf{C}} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{co}\_{\mathsf{c}} \mathsf{2} \mathsf{R}\_{\mathsf{1}} \mathsf{R}\_{\mathsf{2}} \mathsf{C}^{2}} \cdot \frac{1}{\mathsf{s}^{2}}}$$

The coefficient comparison between this transfer function and Equation 16–5 yields:

$$\begin{aligned} \mathsf{A}\_{\infty} &= \mathsf{1} \\\\ \mathsf{a}\_{\mathsf{1}} &= \frac{\mathsf{2}}{\mathsf{a}\_{\mathsf{c}} \mathsf{R}\_{\mathsf{1}} \mathsf{C}} \\\mathsf{b}\_{\mathsf{1}} &= \frac{\mathsf{1}}{\mathsf{a}\_{\mathsf{c}} \mathsf{c}^{2} \mathsf{R}\_{\mathsf{1}} \mathsf{R}\_{\mathsf{2}} \mathsf{C}^{2}} \end{aligned}$$

Given C, the resistor values for R1 and R2 are calculated through:

$$\begin{aligned} \mathsf{R}\_1 &= \frac{1}{\mathsf{mf}\_c \mathsf{Ca}\_1} \\ \mathsf{R}\_2 &= \frac{\mathsf{a}\_1}{4\pi \mathsf{f}\_c \mathsf{C} \mathsf{b}\_1} \end{aligned}$$

#### **16.4.2.2 Multiple Feedback Topology**

The MFB topology is commonly used in filters that have high Qs and require a high gain.

To simplify the computation of the circuit, capacitors C1 and C3 assume the same value (C1 = C3 = C) as shown in Figure 16–29.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled V_IN on the left side.

2. **Capacitor C1**: The input voltage V_IN is connected to a capacitor labeled C1. The value of C1 is given as C.

3. **Resistor R2**: The other end of capacitor C1 is connected to a resistor labeled R2, which is connected to the ground.

4. **Capacitor C3**: The junction between C1 and R2 is also connected to another capacitor labeled C3, which has the same value as C1 (C).

5. **Operational Amplifier (Op-Amp)**: The other end of capacitor C3 is connected to the inverting input (marked with a minus sign) of an operational amplifier. The non-inverting input (marked with a plus sign) of the op-amp is connected to the ground.

6. **Capacitor C2**: The inverting input of the op-amp is also connected to a capacitor labeled C2, which has the same value as C1 and C3 (C). The other end of C2 is connected to the output of the op-amp.

7. **Resistor R1**: There is a resistor labeled R1 connected between the output of the op-amp and the junction where C2 and the inverting input of the op-amp meet.

8. **Output Voltage (V_OUT)**: The output of the op-amp is labeled V_OUT, which is the output voltage of the circuit.

In summary, the circuit consists of an op-amp with three capacitors (C1, C2, and C3) and two resistors (R1 and R2). The capacitors and resistors are arranged in a specific configuration to form a filter or amplifier circuit, with the op-amp providing the necessary gain and feedback.
```

Here is the image describtion:
```
The image appears to be a caption or title for a figure in a document or textbook. The caption reads "Figure 16–29. Second-Order MFB High-Pass Filter." This suggests that the figure is the 29th figure in the 16th chapter of the document, and it depicts a second-order Multiple Feedback (MFB) high-pass filter. The actual image of the filter circuit is not shown in the provided content, but based on the caption, it would likely include components such as resistors, capacitors, and possibly operational amplifiers arranged to form a high-pass filter with a second-order response.
```

The transfer function of the circuit in Figure 16–29 is:

$$\mathsf{A(s)} = \frac{-\frac{\mathsf{C}}{\mathsf{C}\_2}}{\mathsf{1} + \frac{2\mathsf{C}\_2 + \mathsf{C}}{\mathsf{w}\_c \mathsf{R}\_1 \mathsf{C}\_2 \mathsf{C}} \cdot \frac{1}{\mathsf{s}} + \frac{1}{\mathsf{w}\_c^2 \mathsf{R}\_2 \mathsf{R}\_1 \mathsf{C}\_2 \mathsf{C}} \cdot \frac{1}{\mathsf{s}^2}}$$

Active Filter Design Techniques 16-25

Through coefficient comparison with Equation 16–5, obtain the following relations:

$$\begin{aligned} \mathsf{A}\_{\infty} &= \frac{\mathsf{C}}{\mathsf{C}\_{2}} \\ \mathsf{a}\_{1} &= \frac{2\mathsf{C} + \mathsf{C}\_{2}}{\mathsf{a}\_{\mathsf{c}}\mathsf{R}\_{1}\mathsf{C}\mathsf{C}\_{2}} \\ \mathsf{b}\_{1} &= \frac{2\mathsf{C} + \mathsf{C}\_{2}}{\mathsf{a}\_{\mathsf{c}}\mathsf{R}\_{1}\mathsf{C}\mathsf{C}\_{2}} \end{aligned}$$

Given capacitors C and C2, and solving for resistors R1 and R2:

$$\begin{aligned} \mathsf{R}\_1 &= \frac{\mathsf{1} - 2\mathsf{A}\_{\times}}{2\pi \mathsf{f}\_{\mathsf{c}} \cdot \mathsf{C} \cdot \mathsf{a}\_{\mathsf{1}}} \\ \mathsf{R}\_2 &= \frac{\mathsf{a}\_{\mathsf{1}}}{2\pi \mathsf{f}\_{\mathsf{c}} \cdot \mathsf{b}\_{\mathsf{1}} \mathsf{C}\_2 (\mathsf{1} - 2\mathsf{A}\_{\times})} \end{aligned}$$

The passband gain (A∞) of a MFB high-pass filter can vary significantly due to the wide tolerances of the two capacitors C and C2. To keep the gain variation at a minimum, it is necessary to use capacitors with tight tolerance values.

#### **16.4.3 Higher-Order High-Pass Filter**

Likewise, as with the low-pass filters, higher-order high-pass filters are designed by cascading first-order and second-order filter stages. The filter coefficients are the same ones used for the low-pass filter design, and are listed in the coefficient tables (Tables 16–4 through 16–10 in Section 16.9).

# Example 16–4. Third-Order High-Pass Filter with fC = 1 kHz

The task is to design a third-order unity-gain Bessel high-pass filter with the corner frequency fC = 1 kHz. Obtain the coefficients for a third-order Bessel filter from Table 16–4, Section 16.9:

|          | ai          | bi          |
|----------|-------------|-------------|
| Filter 1 | a1 = 0.756  | b1 = 0      |
| Filter 2 | a2 = 0.9996 | b2 = 0.4772 |

and compute each partial filter by specifying the capacitor values and calculating the required resistor values.

#### **First Filter**

$$\text{Wift } \mathsf{C}\_1 = \mathsf{100} \text{ nF},$$

16-26

$$\mathsf{R}\_{\mathsf{T}} = \frac{\mathsf{1}}{2\pi \mathsf{f}\_{\mathsf{c}} \mathsf{a}\_{\mathsf{f}} \mathsf{C}\_{\mathsf{T}}} = \frac{\mathsf{1}}{2\pi \cdot \mathsf{10^3} \mathsf{H} \mathsf{z} \cdot \mathsf{0}.756 \cdot \mathsf{100} \cdot \mathsf{10^{-9}} \mathsf{F}} = \mathsf{2.105} \,\mathsf{k}\Omega$$

Closest 1% value is 2.1 kΩ.

#### **Second Filter**

With C = 100nF,

$$\mathbf{R\_1} = \frac{\mathbf{1}}{\pi \mathbf{f\_c} \mathbf{C} \mathbf{a\_1}} = \frac{\mathbf{1}}{\pi \cdot \mathbf{10^3} \cdot \mathbf{100} \cdot \mathbf{10^{-9}} \cdot \mathbf{0.756}} = \mathbf{3.18 } \mathbf{k} \Omega$$

Closest 1% value is 3.16 kΩ.

$$\mathbf{R}\_2 = \frac{\mathbf{a}\_1}{4\pi \mathbf{f}\_c \mathbf{C} \mathbf{b}\_1} = \frac{0.9996}{4\pi \cdot 10^3 \cdot 100 \cdot 10^{-9} \cdot 0.4772} = 1.67 \text{ k}\Omega$$

Closest 1% value is 1.65 kΩ.

Figure 16–30 shows the final filter circuit.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit consisting of two operational amplifiers (op-amps) configured as active filters. Here is a detailed description of the components and their connections:

1. **Input (VIN)**: The circuit starts with an input signal labeled VIN.

2. **Capacitor (100n)**: The input signal first passes through a capacitor with a capacitance of 100 nanofarads (100n). This capacitor is likely used for AC coupling, blocking any DC component of the input signal.

3. **Resistor (2.10k)**: After the capacitor, the signal encounters a resistor with a resistance of 2.10 kilo-ohms (2.10k) connected to ground. This resistor forms part of the input network for the first op-amp.

4. **First Operational Amplifier**: The signal then enters the first op-amp. The non-inverting input (+) of the op-amp is connected to the junction between the capacitor and the resistor. The inverting input (-) is connected to the output of the op-amp, indicating a voltage follower configuration.

5. **Capacitor (100n)**: The output of the first op-amp passes through another capacitor with a capacitance of 100 nanofarads (100n).

6. **Second Capacitor (100n)**: The signal then passes through a second capacitor with the same capacitance (100n).

7. **Resistor (3.16k)**: After the capacitors, the signal encounters a resistor with a resistance of 3.16 kilo-ohms (3.16k) connected to ground. This resistor forms part of the input network for the second op-amp.

8. **Second Operational Amplifier**: The signal then enters the second op-amp. The non-inverting input (+) of the op-amp is connected to the junction between the capacitors and the resistor. The inverting input (-) is connected to the output of the op-amp through a feedback resistor.

9. **Feedback Resistor (1.65k)**: The output of the second op-amp is fed back to its inverting input (-) through a resistor with a resistance of 1.65 kilo-ohms (1.65k). This configuration suggests that the second op-amp is set up as an active filter, possibly a low-pass or high-pass filter depending on the overall design.

10. **Output (VOUT)**: The final output signal is labeled VOUT.

Overall, the circuit appears to be a multi-stage active filter, utilizing op-amps, capacitors, and resistors to shape the frequency response of the input signal. The exact type of filter (e.g., low-pass, high-pass, band-pass) would depend on the specific arrangement and values of the components.
```

Figure 16–30. Third-Order Unity-Gain Bessel High-Pass

# **16.5 Band-Pass Filter Design**

In Section 16.4, a high-pass response was generated by replacing the term S in the lowpass transfer function with the transformation 1/S. Likewise, a band-pass characteristic is generated by replacing the S term with the transformation:

$$\frac{1}{\Delta\Omega} \left(\mathbf{s} + \frac{\mathbf{l}}{\mathbf{s}}\right) \tag{16-7}$$

In this case, the passband characteristic of a low-pass filter is transformed into the upper passband half of a band-pass filter. The upper passband is then mirrored at the mid frequency, fm (Ω=1), into the lower passband half.

Active Filter Design Techniques 16-27

Here is the image describtion:
```
The image consists of two graphs, each depicting the magnitude response of a filter in decibels (dB) versus normalized frequency (Ω).

### Left Graph:
1. **Axes**:
   - The vertical axis represents the magnitude response |A| in decibels (dB).
   - The horizontal axis represents the normalized frequency (Ω).

2. **Magnitude Response**:
   - The magnitude response starts at 0 dB for low frequencies.
   - It remains flat at 0 dB up to a certain cutoff frequency (Ω = 1).
   - At the cutoff frequency (Ω = 1), the magnitude response drops sharply.
   - The response decreases beyond the cutoff frequency, indicating a low-pass filter characteristic.
   - The -3 dB point is marked, indicating the cutoff frequency where the magnitude response falls to -3 dB.

### Right Graph:
1. **Axes**:
   - The vertical axis represents the magnitude response |A| in decibels (dB).
   - The horizontal axis represents the normalized frequency (Ω).

2. **Magnitude Response**:
   - The magnitude response starts at 0 dB for low frequencies.
   - It remains flat at 0 dB up to a certain cutoff frequency (Ω = 1).
   - At the cutoff frequency (Ω = 1), the magnitude response drops sharply.
   - The response decreases beyond the cutoff frequency, indicating a low-pass filter characteristic.
   - The -3 dB point is marked, indicating the cutoff frequency where the magnitude response falls to -3 dB.

3. **Additional Details**:
   - There is a dashed line representing a shifted version of the original magnitude response.
   - The shifted response is moved to the left by a certain amount (ΔΩ).
   - The new cutoff frequencies are marked as Ω1 and Ω2, indicating the range of frequencies affected by the shift.
   - An arrow indicates the direction of the shift, showing the movement of the magnitude response curve.

### Summary:
The image shows the magnitude response of a low-pass filter in two scenarios. The left graph depicts the original response, while the right graph shows the response after a frequency shift. The shift is indicated by a dashed line and the new cutoff frequencies (Ω1 and Ω2). The -3 dB points are marked in both graphs to indicate the cutoff frequencies.
```

Figure 16–31. Low-Pass to Band-Pass Transition

The corner frequency of the low-pass filter transforms to the lower and upper –3 dB frequencies of the band-pass, Ω1 and Ω2. The difference between both frequencies is defined as the normalized bandwidth ∆Ω:

$$
\Delta \Omega = \Omega\_2 - \Omega\_1
$$

The normalized mid frequency, where Q = 1, is:

$$
\Omega\_{\mathfrak{m}} = \mathfrak{1} = \Omega\_2 \mathfrak{Q}\_1
$$

In analogy to the resonant circuits, the quality factor Q is defined as the ratio of the mid frequency (fm) to the bandwidth (B):

$$\mathbf{Q} = \frac{\mathbf{f}\_m}{\mathbf{B}} = \frac{\mathbf{f}\_m}{\mathbf{f}\_2 - \mathbf{f}\_1} = \frac{\mathbf{f}}{\mathbf{Q}\_2 - \mathbf{Q}\_1} = \frac{\mathbf{f}}{\Delta \Omega} \tag{16-8}$$

The simplest design of a band-pass filter is the connection of a high-pass filter and a lowpass filter in series, which is commonly done in wide-band filter applications. Thus, a firstorder high-pass and a first-order low-pass provide a second-order band-pass, while a second-order high-pass and a second-order low-pass result in a fourth-order band-pass response.

In comparison to wide-band filters, narrow-band filters of higher order consist of cascaded second-order band-pass filters that use the Sallen-Key or the Multiple Feedback (MFB) topology.

### **16.5.1 Second-Order Band-Pass Filter**

To develop the frequency response of a second-order band-pass filter, apply the transformation in Equation 16–7 to a first-order low-pass transfer function:

$$\mathsf{A(s)} = \frac{\mathsf{A\_0}}{\mathsf{1} + \mathsf{s}}$$

$$\mathsf{1} \quad (\mathsf{.})$$

1 <sup>s</sup> <sup>1</sup> <sup>s</sup> Replacing s with

yields the general transfer function for a second-order band-pass filter:

$$\mathsf{A(s)} = \frac{\mathsf{A}\_0 \cdot \Delta \Omega \cdot \mathsf{s}}{\mathsf{1} + \Delta \Omega \cdot \mathsf{s} + \mathsf{s}^2} \tag{16-9}$$

When designing band-pass filters, the parameters of interest are the gain at the mid frequency (Am) and the quality factor (Q), which represents the selectivity of a band-pass filter.

Therefore, replace A0 with Am and ∆Ω with 1/Q (Equation 16–7) and obtain:

$$\mathsf{A}(\mathsf{s}) = \frac{\frac{\mathsf{A}\_{\mathsf{m}}}{\mathsf{Q}} \cdot \mathsf{s}}{\mathsf{1} + \frac{\mathsf{1}}{\mathsf{Q}} \cdot \mathsf{s} + \mathsf{s}^{2}} \tag{16-10}$$

Figure 16–32 shows the normalized gain response of a second-order band-pass filter for different Qs.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the gain (|A|) in decibels (dB) on the vertical axis and the frequency (Ω) on the horizontal axis. The frequency axis is logarithmic, ranging from 0.1 to 10.

There are two curves on the plot, each representing a different quality factor (Q). The first curve, labeled "Q = 1," has a broader peak and lower maximum gain. The second curve, labeled "Q = 10," has a narrower peak and higher maximum gain. Both curves peak at a frequency of 1 (Ω), where the gain is 0 dB.

The gain decreases as the frequency moves away from 1 (Ω) in both directions. For the "Q = 1" curve, the gain drops more gradually, while for the "Q = 10" curve, the gain drops more steeply. The plot illustrates how the quality factor (Q) affects the bandwidth and peak gain of the system's frequency response.
```

Figure 16–32. Gain Response of a Second-Order Band-Pass Filter

Active Filter Design Techniques 16-29

The graph shows that the frequency response of second-order band-pass filters gets steeper with rising Q, thus making the filter more selective.

#### **16.5.1.1 Sallen-Key Topology**

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled \( V_{IN} \) on the left side.

2. **Resistors and Capacitors**:
   - The input voltage \( V_{IN} \) is connected to a resistor \( R \).
   - After the resistor \( R \), the circuit splits into two branches:
     - One branch goes through a capacitor \( C \) to ground.
     - The other branch continues through another capacitor \( C \) and then connects to a node.
   - From this node, another resistor \( 2R \) is connected to ground.

3. **Operational Amplifier (Op-Amp)**:
   - The node after the second capacitor \( C \) is connected to the inverting input (marked with a minus sign) of an operational amplifier.
   - The non-inverting input (marked with a plus sign) of the op-amp is connected to a voltage divider formed by resistors \( R_1 \) and \( R_2 \). The top of \( R_2 \) is connected to the output of the op-amp, and the bottom of \( R_1 \) is connected to ground.

4. **Feedback Loop**:
   - The output of the op-amp is labeled \( V_{OUT} \).
   - There is a feedback resistor \( R \) connected from the output \( V_{OUT} \) back to the node between the second capacitor \( C \) and the inverting input of the op-amp.

5. **Ground Connections**:
   - The circuit has multiple ground connections: one after the first capacitor \( C \), one after the resistor \( 2R \), and one at the bottom of the voltage divider formed by \( R_1 \) and \( R_2 \).

This circuit appears to be a type of active filter, possibly a band-pass or band-stop filter, given the combination of resistors and capacitors along with the operational amplifier. The exact function would depend on the values of the components and the configuration of the op-amp.
```

#### Figure 16–33. Sallen-Key Band-Pass

The Sallen-Key band-pass circuit in Figure 16–33 has the following transfer function:

$$\mathsf{A(s)} = \frac{\mathsf{G} \cdot \mathsf{R} \mathsf{C} \mathsf{o}\_{\mathsf{m}} \cdot \mathsf{s}}{\mathsf{1} + \mathsf{R} \mathsf{C} \mathsf{o}\_{\mathsf{m}} (\mathsf{3} - \mathsf{G}) \cdot \mathsf{s} + \mathsf{R}^2 \mathsf{C}^2 \mathsf{o}\_{\mathsf{m}}^2 \mathsf{s}^2}$$

Through coefficient comparison with Equation 16–10, obtain the following equations:

$$\texttt{mid-frequency: } \texttt{f\_m} = \frac{1}{2\pi \mathsf{R} \mathsf{C}}$$

$$\text{inner gain:} \qquad \mathsf{G} = \mathsf{1} + \frac{\mathsf{R}\_2}{\mathsf{R}\_1}$$

$$\mathbf{gain} \text{ at } \mathbf{f\_m} \qquad \mathbf{A\_m} = \frac{\mathbf{G}}{\mathbf{3} - \mathbf{G}}$$

$$\text{filter quality:} \qquad \mathsf{O} = \frac{\mathsf{I}}{\mathsf{3} - \mathsf{G}}$$

The Sallen-Key circuit has the advantage that the quality factor (Q) can be varied via the inner gain (G) without modifying the mid frequency (fm). A drawback is, however, that Q and Am cannot be adjusted independently.

Care must be taken when G approaches the value of 3, because then Am becomes infinite and causes the circuit to oscillate.

To set the mid frequency of the band-pass, specify fm and C and then solve for R:

$$\mathsf{R} = \frac{1}{2\pi\mathsf{f\_mC}}$$

Because of the dependency between Q and Am, there are two options to solve for R2: either to set the gain at mid frequency:

$$\mathsf{R}\_2 = \frac{\mathsf{2A}\_{\mathsf{m}} - 1}{\mathsf{1} + \mathsf{A}\_{\mathsf{m}}}$$

or to design for a specified Q:

$$\mathsf{R}\_2 = \frac{\mathsf{2Q} - \mathsf{1}}{\mathsf{Q}}$$

#### **16.5.1.2 Multiple Feedback Topology**

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a configuration that appears to be a high-pass filter. Here is a detailed description of the components and their connections:

1. **Input Voltage (VIN)**: The circuit has an input voltage labeled as VIN on the left side.

2. **Resistor R1**: The input voltage VIN is connected to a resistor labeled R1. The other end of R1 is connected to a node that connects to several other components.

3. **Resistor R3**: From the same node where R1 connects, there is a resistor labeled R3 that is connected to the ground.

4. **Capacitor C (First)**: The same node also connects to a capacitor labeled C. The other end of this capacitor is connected to another node that leads to the inverting input (marked with a minus sign) of the op-amp.

5. **Operational Amplifier (Op-Amp)**: The op-amp has two inputs, the inverting input (connected as described above) and the non-inverting input (marked with a plus sign), which is connected to the ground.

6. **Resistor R2**: The output of the op-amp is connected to a resistor labeled R2. The other end of R2 is connected back to the node between the first capacitor C and the inverting input of the op-amp, forming a feedback loop.

7. **Capacitor C (Second)**: There is another capacitor labeled C connected between the output of the op-amp and the node where R1, R3, and the first capacitor C meet.

8. **Output Voltage (VOUT)**: The output voltage of the circuit is labeled as VOUT and is taken from the output of the op-amp.

In summary, the circuit consists of an op-amp with a feedback loop involving a resistor and a capacitor, and it includes additional resistors and capacitors to form a high-pass filter configuration. The input signal VIN is filtered and amplified, and the resulting output signal VOUT is taken from the op-amp's output.
```

Figure 16–34. MFB Band-Pass

The MFB band-pass circuit in Figure 16–34 has the following transfer function:

$$\mathsf{A}(\mathsf{s}) = \frac{-\frac{\mathsf{R}\_2\mathsf{R}\_3}{\mathsf{R}\_1 + \mathsf{R}\_3} \mathsf{C} \mathsf{o} \mathsf{o}\_{\mathsf{m}} \cdot \mathsf{s}}{1 + \frac{2\mathsf{R}\_1\mathsf{R}\_3}{\mathsf{R}\_1 + \mathsf{R}\_3} \mathsf{C} \mathsf{o} \mathsf{o}\_{\mathsf{m}} \cdot \mathsf{s} + \frac{\mathsf{R}\_1\mathsf{R}\_2\mathsf{R}\_3}{\mathsf{R}\_1 + \mathsf{R}\_3} \mathsf{C}^2 \mathsf{o} \mathsf{o}\_{\mathsf{m}}^2 \cdot \mathsf{s}^2}}$$

The coefficient comparison with Equation 16–9, yields the following equations:

fm <sup>1</sup> 2 C R1 R3 R1R2R3 mid-frequency: Am R2 2R1 gain at fm: filter quality: Q fmR2C <sup>B</sup> <sup>1</sup> R2C bandwidth:

The MFB band-pass allows to adjust Q, Am, and fm independently. Bandwidth and gain factor do not depend on R3. Therefore, R3 can be used to modify the mid frequency with-

Active Filter Design Techniques 16-31

out affecting bandwidth, B, or gain, Am. For low values of Q, the filter can work without R3, however, Q then depends on Am via:

$$-\mathbf{A}\_{\mathrm{m}} = 2\mathbf{Q}^{2}$$

Example 16–5. Second-Order MFB Band-Pass Filter with fm = 1 kHz

To design a second-order MFB band-pass filter with a mid frequency of fm = 1 kHz, a quality factor of Q = 10, and a gain of Am = –2, assume a capacitor value of C = 100 nF, and solve the previous equations for R1 through R3 in the following sequence:

$$\begin{aligned} \mathsf{R}\_2 &= \frac{\mathsf{Q}}{\mathsf{m}\mathsf{f}\_{\mathsf{m}}\mathsf{C}} = \frac{\mathsf{10}}{\mathsf{ $\pi$ \mathsf{1}}\mathsf{  $\mathsf{k}\mathsf{H}\mathsf{z}\cdot\mathsf{10}$  \mathsf{n}\mathsf{F}} = \mathsf{31.8 } \mathsf{k}\mathsf{Q}\mathsf{Z} \\\ \mathsf{R}\_1 &= \frac{\mathsf{R}\_2}{-\mathsf{2A}\_{\mathsf{m}}} = \frac{\mathsf{31.8 } \mathsf{k}\mathsf{Q}\mathsf{z}}{\mathsf{4}} = \mathsf{7.96 } \mathsf{k}\mathsf{Q} \\\ \mathsf{R}\_3 &= \frac{-\mathsf{A}\_{\mathsf{m}}\mathsf{R}\_1}{2\mathsf{Q}^2 + \mathsf{A}\_{\mathsf{m}}} = \frac{\mathsf{2.7}\mathsf{.96}\ \mathsf{k}\mathsf{Q}}{200 - \mathsf{2}} = \mathsf{80.4 } \mathsf{Q} \end{aligned}$$

#### **16.5.2 Fourth-Order Band-Pass Filter (Staggered Tuning)**

Figure 16–32 shows that the frequency response of second-order band-pass filters gets steeper with rising Q. However, there are band-pass applications that require a flat gain response close to the mid frequency as well as a sharp passband-to-stopband transition. These tasks can be accomplished by higher-order band-pass filters.

Of particular interest is the application of the low-pass to band-pass transformation onto a second-order low-pass filter, since it leads to a fourth-order band-pass filter.

Replacing the S term in Equation 16–2 with Equation 16–7 gives the general transfer function of a fourth-order band-pass:

$$\mathsf{A(s)} = \frac{\frac{\mathsf{s}^2 \mathsf{A}\_0 (\mathsf{A} \mathsf{Q})^2}{\mathsf{b}\_1}}{\mathsf{1} + \frac{\mathsf{a}\_1}{\mathsf{b}\_1} \Delta \mathsf{Q} \cdot \mathsf{s} + \left[ \mathsf{2} + \frac{\left( \mathsf{A} \mathsf{Q} \right)^2}{\mathsf{b}\_1} \right] \mathsf{s}^2 + \frac{\mathsf{a}\_1}{\mathsf{b}\_1} \Delta \mathsf{Q} \cdot \mathsf{s}^3 + \mathsf{s}^4}} \tag{16-11}$$

Similar to the low-pass filters, the fourth-order transfer function is split into two second-order band-pass terms. Further mathematical modifications yield:

$$\mathsf{A}(\mathsf{s}) = \frac{\frac{\mathsf{A}\_{\mathrm{mi}}}{\mathsf{Q}\_{\mathrm{i}}} \cdot \mathsf{c}\mathsf{s}\mathsf{s}}{\left[\mathsf{1} + \frac{\mathsf{c}\mathsf{s}}{\mathsf{Q}\_{\mathrm{i}}} + \left\{\mathsf{c}\mathsf{s}\right\}^{2}\right]} \cdot \frac{\frac{\mathsf{A}\_{\mathrm{mi}}}{\mathsf{Q}\_{\mathrm{i}}} \cdot \frac{\mathsf{s}}{\mathsf{c}}}{\left[\mathsf{1} + \frac{\mathsf{1}}{\mathsf{Q}\_{\mathrm{i}}} (\frac{\mathsf{s}}{\mathsf{a}}) + \left(\frac{\mathsf{s}}{\mathsf{a}}\right)^{2}\right]} \tag{16-12}$$

Equation 16–12 represents the connection of two second-order band-pass filters in series, where

16-32

- Ami is the gain at the mid frequency, fmi, of each partial filter
- Qi is the pole quality of each filter
- α and 1/α are the factors by which the mid frequencies of the individual filters, fm1 and fm2, derive from the mid frequency, fm, of the overall bandpass.

In a fourth-order band-pass filter with high Q, the mid frequencies of the two partial filters differ only slightly from the overall mid frequency. This method is called staggered tuning.

Factor α needs to be determined through successive approximation, using equation 16–13:

$$\alpha^2 + \left[\frac{\alpha \cdot \Delta \Omega \cdot \mathbf{a}\_1}{\mathbf{b}\_1(\mathfrak{l} + \alpha^2)}\right]^2 + \frac{1}{\alpha^2} - 2 - \frac{\left\langle \Delta \Omega \right\rangle^2}{\mathbf{b}^\dagger} = \mathbf{0} \tag{16-13}$$

with a1 and b1 being the second-order low-pass coefficients of the desired filter type.

To simplify the filter design, Table 16–2 lists those coefficients, and provides the α values for three different quality factors, Q = 1, Q = 10, and Q = 100.

Table 16–2. Values of α For Different Filter Types and Different Qs

| Bessel |        |        |       | Butterworth |        |       | Tschebyscheff |    |        |        |      |
|--------|--------|--------|-------|-------------|--------|-------|---------------|----|--------|--------|------|
| a1     | 1.3617 |        | a1    | 1.4142      |        | a1    | 1.0650        |    |        |        |      |
| b1     | 0.6180 |        | b1    | 1.0000      |        | b1    | 1.9305        |    |        |        |      |
| Q      | 100    | 10     | 1     | Q           | 100    | 10    | 1             | Q  | 100    | 10     | 1    |
| ∆Ω     | 0.01   | 0.1    | 1     | ∆Ω          | 0.01   | 0.1   | 1             | ∆Ω | 0.01   | 0.1    | 1    |
| α      | 1.0032 | 1.0324 | 1.438 | α           | 1.0035 | 1.036 | 1.4426        | α  | 1.0033 | 1.0338 | 1.39 |

After α has been determined, all quantities of the partial filters can be calculated using the following equations:

The mid frequency of filter 1 is:

$$\mathbf{f\_{m1}} = \frac{\mathbf{f\_m}}{\mathbf{G}} \tag{16-14}$$

the mid frequency of filter 2 is:

$$\mathfrak{f}\_{\mathfrak{m2}} = \mathfrak{f}\_{\mathfrak{m}} \cdot \mathfrak{a} \tag{16-45}$$

with fm being the mid frequency of the overall forth-order band-pass filter.

The individual pole quality, Qi , is the same for both filters:

$$\mathbf{Q}\_{\mathbf{i}} = \mathbf{Q} \cdot \frac{(\mathfrak{l} + \alpha^2)\mathbf{b}\_{\mathbf{l}}}{\alpha \cdot \mathbf{a}\_{\mathbf{l}}} \tag{16-16}$$

with Q being the quality factor of the overall filter.

The individual gain (Ami) at the partial mid frequencies, fm1 and fm2, is the same for both filters:

$$\mathsf{A}\_{\text{ml}} = \frac{\mathsf{Q}\_{\text{l}}}{\mathsf{Q}} \cdot \sqrt{\frac{\mathsf{A}\_{\text{m}}}{\mathsf{B}\_{\text{r}}}} \tag{16-17}$$

with Am being the gain at mid frequency, fm, of the overall filter.

#### Example 16–6. Fourth-Order Butterworth Band-Pass Filter

The task is to design a fourth-order Butterworth band-pass with the following parameters:

- mid frequency, fm = 10 kHz
- bandwidth, B = 1000 Hz
- and gain, Am = 1

From Table 16–2 the following values are obtained:

- a1 = 1.4142
- b1 = 1
- α = 1.036

In accordance with Equations 16–14 and 16–15, the mid frequencies for the partial filters are:

fmi 10 kHz 1.036 9.653 kHz f and m2 10 kHz·1.036 10.36 kHz

The overall Q is defined as Q fmB , and for this example results in Q = 10.

Using Equation 16–16, the Qi of both filters is:

$$\mathbf{Q}\_{i} = \mathbf{10} \cdot \frac{(\mathbf{1} + \mathbf{1.036}) \cdot \mathbf{1}}{\mathbf{1.036} \cdot \mathbf{1.4142}} = \mathbf{14.15}$$

With Equation 16–17, the passband gain of the partial filters at fm1 and fm2 calculates to:

$$\mathsf{A}\_{\mathsf{mi}} = \frac{\mathsf{14.15}}{\mathsf{10}} \cdot \sqrt{\frac{1}{1}} = \mathsf{1.415}$$

The Equations 16–16 and 16–17 show that Qi and Ami of the partial filters need to be independently adjusted. The only circuit that accomplishes this task is the MFB band-pass filter in Paragraph 16.5.1.2.

To design the individual second-order band-pass filters, specify C = 10 nF, and insert the previously determined quantities for the partial filters into the resistor equations of the MFB band-pass filter. The resistor values for both partial filters are calculated below.

#### R21 Qi fm1C 14.15 ·9.653 kHz·10 nF 46.7 k- R22 Qi fm2C 14.15 ·10.36 kHz·10 nF 43.5 k- **Filter 1: Filter 2:** R11 R21 2Ami 46.7 k- 2· 1.415 16.5 k- R12 R22 2Ami 43.5 k- 2· 1.415 15.4 k- R31 AmiR11 2Qi 2 Ami 1.415·16.5 k- 2·14.152 1.415 58.1 - R32 AmiR12 2Qi 2 Ami 1.415·15.4 k- 2·14.152 1.415 54.2 -

Figure 16–35 compares the gain response of a fourth-order Butterworth band-pass filter with Q = 1 and its partial filters to the fourth-order gain of Example 16–4 with Q = 10.

Active Filter Design Techniques 16-35

Here is the image describtion:
```
The image is a graph depicting the frequency response of a bandpass filter. The x-axis represents the frequency in Hertz (Hz), ranging from 100 Hz to 1 Megahertz (M). The y-axis represents the gain in decibels (dB), ranging from -35 dB to 5 dB.

There are multiple curves plotted on the graph, each representing different quality factors (Q) and gains (A). The curves are labeled as follows:

1. A1: This curve peaks at 0 dB gain and has a broader bandwidth, indicating a lower quality factor (Q = 1).
2. A2: This curve also peaks at 0 dB gain but has a narrower bandwidth, indicating a higher quality factor (Q = 10).

The curves show how the gain varies with frequency for different quality factors. The higher the quality factor, the narrower the bandwidth and the sharper the peak at the center frequency (around 10 kHz). The lower the quality factor, the broader the bandwidth and the less sharp the peak.

The graph is logarithmic in both axes, which is typical for frequency response plots to accommodate a wide range of values. The frequency axis spans several orders of magnitude, and the gain axis allows for detailed observation of changes in gain across the frequency spectrum.
```

Figure 16–35. Gain Responses of a Fourth-Order Butterworth Band-Pass and its Partial Filters

# **16.6 Band-Rejection Filter Design**

A band-rejection filter is used to suppress a certain frequency rather than a range of frequencies.

Two of the most popular band-rejection filters are the active twin-T and the active Wien-Robinson circuit, both of which are second-order filters.

To generate the transfer function of a second-order band-rejection filter, replace the S term of a first-order low-pass response with the transformation in 16–18:

$$\frac{\Delta\Omega}{\mathbf{s} + \frac{\mathbf{t}}{\mathbf{s}}}\tag{16-18}$$

which gives:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{A}\_0(\mathsf{1} + \mathsf{s}^2)}{\mathsf{1} + \Delta \mathsf{Q} \cdot \mathsf{s} + \mathsf{s}^2} \tag{16-19}$$

Thus the passband characteristic of the low-pass filter is transformed into the lower passband of the band-rejection filter. The lower passband is then mirrored at the mid frequency, fm (Ω=1), into the upper passband half (Figure 16–36).

Here is the image describtion:
```
The image depicts two frequency response plots, typically used in the context of filter design in signal processing. Both plots show the magnitude response |A| in decibels (dB) on the vertical axis against the normalized frequency Ω on the horizontal axis.

### Left Plot:
- The plot shows a low-pass filter response.
- The magnitude response starts at 0 dB for low frequencies (Ω close to 0).
- As the frequency increases, the response remains flat at 0 dB until it reaches a certain cutoff frequency (Ω = 1).
- Beyond the cutoff frequency, the response starts to drop off sharply, indicating attenuation of higher frequencies.
- The point where the response drops to -3 dB is marked, which is a common reference point for the cutoff frequency in filter design.

### Right Plot:
- The plot shows a modified or transformed version of the original low-pass filter response.
- The magnitude response again starts at 0 dB for low frequencies.
- The response remains flat until it reaches a new cutoff frequency (Ω1).
- Beyond Ω1, the response starts to drop off, but the transition band (ΔΩ) is highlighted, indicating the range over which the response changes from the passband to the stopband.
- The response continues to drop until it reaches another frequency (Ω2), where it is significantly attenuated.
- The dashed line suggests an idealized or target response, which is perfectly flat in the passband and drops off sharply at the cutoff frequency without any transition band.

### Additional Details:
- The arrow between the two plots suggests a transformation or mapping from the original low-pass filter to a new filter design.
- The transition band (ΔΩ) is explicitly marked in the right plot, indicating the range of frequencies over which the filter transitions from passband to stopband.
- The -3 dB point is used as a reference in both plots to indicate the cutoff frequency.

Overall, the image illustrates the concept of filter design, showing how a low-pass filter's frequency response can be transformed or modified, highlighting key parameters such as the cutoff frequency and transition band.
```

### Figure 16–36. Low-Pass to Band-Rejection Transition

The corner frequency of the low-pass transforms to the lower and upper –3-dB frequencies of the band-rejection filter Ω1 and Ω2. The difference between both frequencies is the normalized bandwidth ∆Ω:

$$
\Delta \Omega = \Omega\_{\text{max}} - \Omega\_{\text{min}}
$$

Identical to the selectivity of a band-pass filter, the quality of the filter rejection is defined as:

$$\mathbf{Q} = \frac{\mathbf{f\_m}}{\mathbf{B}} = \frac{\mathbf{1}}{\Delta \Omega}$$

Therefore, replacing ∆Ω in Equation 16–19 with 1/Q yields:

$$\mathsf{A(s)} = \frac{\mathsf{A}\_0(\mathsf{1} + \mathsf{s}^2)}{\mathsf{1} + \frac{\mathsf{1}}{\mathsf{Q}} \cdot \mathsf{s} + \mathsf{s}^2} \tag{16-20}$$

#### **16.6.1 Active Twin-T Filter**

The original twin-T filter, shown in Figure 16–37, is a passive RC-network with a quality factor of Q = 0.25. To increase Q, the passive filter is implemented into the feedback loop of an amplifier, thus turning into an active band-rejection filter, shown in Figure 16–38.

Here is the image describtion:
```
The image depicts an electrical circuit that appears to be a filter network. Here is a detailed description of the components and their configuration:

1. **Input and Output:**
   - The circuit has an input terminal labeled \( V_{IN} \) on the left side.
   - The output terminal is labeled \( V_{OUT} \) on the right side.

2. **Resistors:**
   - There are three resistors in the circuit.
   - Two resistors, each with resistance \( R \), are connected in series with the input and output terminals.
   - A third resistor with resistance \( R/2 \) is connected between the junction of the two capacitors (described below) and the ground.

3. **Capacitors:**
   - There are three capacitors in the circuit.
   - Two capacitors, each with capacitance \( C \), are connected in parallel with the resistors \( R \). One capacitor is connected between the input terminal \( V_{IN} \) and the junction of the resistors and the \( R/2 \) resistor. The other capacitor is connected between the output terminal \( V_{OUT} \) and the same junction.
   - A third capacitor with capacitance \( 2C \) is connected between the junction of the two resistors \( R \) and the ground.

4. **Connections:**
   - The input terminal \( V_{IN} \) is connected to one end of a resistor \( R \) and one end of a capacitor \( C \).
   - The other end of this resistor \( R \) is connected to the junction point where the \( R/2 \) resistor and the second capacitor \( C \) meet.
   - The other end of the first capacitor \( C \) is connected to the same junction point.
   - The output terminal \( V_{OUT} \) is connected to one end of the second resistor \( R \) and one end of the second capacitor \( C \).
   - The other end of this second resistor \( R \) is connected to the same junction point.
   - The \( R/2 \) resistor is connected between this junction point and the ground.
   - The third capacitor with capacitance \( 2C \) is connected between the junction of the two resistors \( R \) and the ground.

This configuration suggests a complex filter network, possibly a band-pass or band-stop filter, depending on the specific values of the resistors and capacitors. The arrangement of resistors and capacitors is designed to allow certain frequencies to pass while attenuating others.
```

#### Figure 16–37. Passive Twin-T Filter

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) and several passive components (resistors and capacitors). Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit has an input voltage labeled as V_IN on the left side.

2. **Capacitors (C)**: There are three capacitors in the circuit, each labeled with the value C. Two of these capacitors are connected in series with resistors, and one is connected to ground.

3. **Resistors (R)**: The circuit includes several resistors with different values:
   - Two resistors labeled R are connected in series with the capacitors.
   - One resistor labeled R/2 is connected in parallel with one of the capacitors.
   - One resistor labeled 2C is connected to ground.
   - Two resistors labeled R1 and R2 are connected to the op-amp.

4. **Operational Amplifier (Op-Amp)**: The op-amp is depicted with the standard triangular symbol. It has:
   - A non-inverting input (+) connected to the junction of the resistor R1 and ground.
   - An inverting input (-) connected to the junction of the resistor R2 and the output of the op-amp.
   - An output labeled V_OUT.

5. **Connections**:
   - The input voltage V_IN is connected to a series combination of a resistor R and a capacitor C.
   - The junction between the first resistor R and the first capacitor C is connected to another series combination of a resistor R and a capacitor C.
   - The junction between the second resistor R and the second capacitor C is connected to the inverting input of the op-amp.
   - The non-inverting input of the op-amp is connected to the ground through resistor R1.
   - The output of the op-amp is connected back to the inverting input through resistor R2.

6. **Ground Connections**: The circuit has multiple ground connections:
   - The junction between the first resistor R and the first capacitor C is connected to ground through a capacitor labeled 2C.
   - The non-inverting input of the op-amp is connected to ground through resistor R1.

This circuit appears to be a type of active filter, possibly a band-pass or band-stop filter, given the combination of resistors, capacitors, and the operational amplifier. The exact function would depend on the specific values of the components and the configuration of the circuit.
```

#### Figure 16–38. Active Twin-T Filter

The transfer function of the active twin-T filter is:

$$\mathsf{A(s)} = \frac{\mathsf{k(1+s2)}}{\mathsf{1} + 2\mathsf{2(2-k)}\cdot\mathsf{s} + \mathsf{s}^2} \tag{16-2\mathsf{1}}$$

Comparing the variables of Equation 16–21 with Equation 16–20 provides the equations that determine the filter parameters:

> fm <sup>1</sup> 2 RC mid-frequency: G 1 R2 R1 inner gain:

passband gain: A0 G

$$\text{rejection } \mathtt{quality} \colon \mathtt{O} = \frac{\mathtt{I}}{\mathtt{Z}(\mathtt{Z} - \mathtt{G})}$$

The twin-T circuit has the advantage that the quality factor (Q) can be varied via the inner gain (G) without modifying the mid frequency (fm). However, Q and Am cannot be adjusted independently.

To set the mid frequency of the band-pass, specify fm and C, and then solve for R:

$$\mathsf{R} = \frac{\mathsf{1}}{2\pi\mathsf{f}\_{\mathsf{m}}\mathsf{C}}$$

Because of the dependency between Q and Am, there are two options to solve for R2: either to set the gain at mid frequency:

$$\mathsf{R}\_2 = (\mathsf{A}\_0 - \mathsf{1})\mathsf{R}\_1$$

or to design for a specific Q:

$$\mathbf{R\_2 = R\_1} \left( \mathbf{1} - \frac{\mathbf{1}}{\mathbf{2Q}} \right)$$

#### **16.6.2 Active Wien-Robinson Filter**

The Wien-Robinson bridge in Figure 16–39 is a passive band-rejection filter with differential output. The output voltage is the difference between the potential of a constant voltage divider and the output of a band-pass filter. Its Q-factor is close to that of the twin-T circuit. To achieve higher values of Q, the filter is connected into the feedback loop of an amplifier.

Here is the image describtion:
```
The image depicts an electronic circuit diagram, specifically a type of filter circuit. Here is a detailed description of the components and their connections:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as V_IN on the left side.

2. **Resistors and Capacitors**:
   - There are two resistors labeled as R connected in series with two capacitors labeled as C. 
   - The first resistor R is connected to the input voltage V_IN.
   - The first capacitor C is connected to the node between the first resistor R and the second resistor R, and it is grounded.
   - The second resistor R is connected to the node between the first capacitor C and the second capacitor C.
   - The second capacitor C is connected to the node between the second resistor R and the resistor 2R_1, and it is also grounded.

3. **Output Voltage (V_OUT)**:
   - The node between the second capacitor C and the resistor 2R_1 is connected to another resistor labeled as R_1.
   - The resistor 2R_1 is connected in series with the resistor R_1.
   - The output voltage V_OUT is taken from the node between the resistor 2R_1 and the resistor R_1.
   - The resistor R_1 is grounded.

4. **Ground Connections**:
   - The bottom ends of both capacitors C are connected to the ground.
   - The bottom end of the resistor R_1 is also connected to the ground.

In summary, the circuit consists of a combination of resistors and capacitors arranged in a specific configuration to form a filter, with the output voltage V_OUT taken from a point between two resistors. The exact type of filter (e.g., low-pass, high-pass, band-pass, or band-stop) would depend on the values of the resistors and capacitors and their arrangement.
```

Figure 16–39. Passive Wien-Robinson Bridge

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring two operational amplifiers (op-amps) and various passive components such as resistors and capacitors. Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage labeled as \( V_{IN} \).

2. **Resistor (R4)**: The input voltage \( V_{IN} \) is connected to a resistor labeled \( R_4 \).

3. **First Operational Amplifier**: The resistor \( R_4 \) is connected to the non-inverting input (+) of the first operational amplifier. The inverting input (-) of this op-amp is connected to ground.

4. **Resistor Network (R2 and R3)**: The output of the first op-amp is connected to a node that splits into two paths:
   - One path goes through a resistor labeled \( R_2 \) and then connects to another resistor labeled \( R_3 \), which is connected back to the input node of \( R_4 \).
   - The other path goes through a capacitor labeled \( C \) and then connects to a resistor labeled \( R \).

5. **Capacitor and Resistor Network**: The node after the capacitor \( C \) and resistor \( R \) splits again:
   - One path goes through another capacitor labeled \( C \) and then connects to another resistor labeled \( R \), which is connected to ground.
   - The other path goes through a resistor labeled \( R_1 \) and then connects to the inverting input (-) of the second operational amplifier.

6. **Second Operational Amplifier**: The non-inverting input (+) of the second operational amplifier is connected to ground. The output of this op-amp is labeled as \( V_{OUT} \).

7. **Feedback Resistor (2R1)**: The output \( V_{OUT} \) is fed back to the inverting input (-) of the second op-amp through a resistor labeled \( 2R_1 \).

The circuit appears to be a complex filter or signal processing circuit, possibly a band-pass or band-stop filter, given the combination of resistors and capacitors. The exact function would depend on the values of the components and the configuration of the op-amps.
```

#### Figure 16–40. Active Wien-Robinson Filter

The active Wien-Robinson filter in Figure 16–40 has the transfer function:

$$\mathbf{A(s)} = -\frac{\frac{\beta}{1+\alpha}(\mathfrak{I} + \mathfrak{s}^2)}{\mathfrak{I} + \frac{\mathfrak{J}}{1+\alpha}\mathfrak{s} + \mathfrak{s}^2} \tag{16-22}$$
 
$$\text{with} \quad \alpha = \frac{\mathsf{R}\_2}{\mathsf{R}\_3} \qquad \text{and} \qquad \beta = \frac{\mathsf{R}\_2}{\mathsf{R}\_4}$$

Comparing the variables of Equation 16–22 with Equation 16–20 provides the equations that determine the filter parameters:

Active Filter Design Techniques 16-39

$$\begin{aligned} \text{mid-} & \mathsf{f}\texttt{eq}\texttt{query}: & \mathsf{f}\_{\mathsf{m}} &= \frac{1}{2\pi\mathsf{RC}} \\\\ \texttt{passband gain:} & \mathsf{A}\_{0} &= -\frac{\beta}{1+\alpha} \end{aligned}$$

$$\text{rejection } \mathtt{quality: } \mathtt{Q} = \frac{\mathtt{1} + \alpha}{\mathtt{3}}$$

To calculate the individual component values, establish the following design procedure:

1) Define fm and C and calculate R with:

$$\mathsf{R} = \frac{\mathsf{1}\_{\mathsf{R}}}{2\pi\mathsf{f}\_{\mathsf{m}}\mathsf{C}}$$

2) Specify Q and determine α via:

$$\alpha = \mathbf{3Q} - \mathbf{1}$$

3) Specify A0 and determine β via:

$$
\mathfrak{b} = -\mathsf{A}\_0 \mathsf{3Q}
$$

4) Define R2 and calculate R3 and R4 with:

$$\mathbf{R}\_3 = \frac{\mathbf{R}\_2}{\alpha}$$

and

$$\mathsf{R\_4} = \frac{\mathsf{R\_2}}{\mathsf{\circledast}}$$

In comparison to the twin-T circuit, the Wien-Robinson filter allows modification of the passband gain, A0, without affecting the quality factor, Q.

If fm is not completely suppressed due to component tolerances of R and C, a fine-tuning of the resistor 2R2 is required.

Figure 16–41 shows a comparison between the filter response of a passive band-rejection filter with Q = 0.25, and an active second-order filter with Q = 1, and Q = 10.

Here is the image describtion:
```
The image is a Bode plot that shows the gain (|A|) in decibels (dB) versus the frequency (Ω) on a logarithmic scale. The plot features three curves, each representing a different quality factor (Q) for a notch filter. The quality factors are Q = 10, Q = 1, and Q = 0.25, as indicated by the labels and arrows pointing to the respective curves.

- The x-axis represents the frequency (Ω) and spans from 1 to 10,000 (10k) on a logarithmic scale.
- The y-axis represents the gain (|A|) in decibels (dB) and ranges from 0 dB to -20 dB.

The curves show how the gain varies with frequency for each quality factor:
- The curve for Q = 10 is the narrowest and deepest, indicating a very selective notch filter with a sharp attenuation at the notch frequency.
- The curve for Q = 1 is wider and less deep than the Q = 10 curve, indicating a less selective filter with a broader attenuation range.
- The curve for Q = 0.25 is the widest and shallowest, indicating the least selective filter with the broadest attenuation range.

The notch frequency, where the gain is at its minimum, is the same for all three curves and occurs around the frequency of 100 Ω. The plot demonstrates how the quality factor affects the bandwidth and depth of the notch in the filter's frequency response.
```

Figure 16–41. Comparison of Q Between Passive and Active Band-Rejection Filters

# **16.7 All-Pass Filter Design**

In comparison to the previously discussed filters, an all-pass filter has a constant gain across the entire frequency range, and a phase response that changes linearly with frequency.

Because of these properties, all-pass filters are used in phase compensation and signal delay circuits.

Similar to the low-pass filters, all-pass circuits of higher order consist of cascaded first-order and second-order all-pass stages. To develop the all-pass transfer function from a low-pass response, replace A0 with the conjugate complex denominator.

The general transfer function of an allpass is then:

$$\mathsf{A(s)} = \frac{\prod\_{\mathsf{i}}^{\Pi} (\mathsf{1} - \mathsf{a}\_{\mathsf{i}}\mathsf{s} + \mathsf{b}\_{\mathsf{i}}\mathsf{s}^{2})}{\prod\_{\mathsf{i}}^{\Pi} (\mathsf{1} + \mathsf{a}\_{\mathsf{i}}\mathsf{s} + \mathsf{b}\_{\mathsf{i}}\mathsf{s}^{2})} \tag{16-23}$$

with ai and bi being the coefficients of a partial filter. The all-pass coefficients are listed in Table 16–10 of Section 16.9.

Expressing Equation 16–23 in magnitude and phase yields:

Active Filter Design Techniques 16-41

$$\mathsf{A(s)} = \frac{\prod\_{\mathsf{i}} \sqrt{\left(\mathsf{1} - \mathsf{b}\_{\mathsf{i}} \mathsf{Q} \mathsf{2}\right)^{2} + \mathsf{a}\_{\mathsf{i}}^{2} \mathsf{Q}^{2} \cdot \mathsf{e}^{-|\mathsf{a}|}}}{\prod\_{\mathsf{i}} \sqrt{\left(\mathsf{1} - \mathsf{b}\_{\mathsf{i}} \mathsf{Q} \mathsf{2}\right)^{2} + \mathsf{a}\_{\mathsf{i}}^{2} \mathsf{Q}^{2} \cdot \mathsf{e}^{+|\mathsf{a}|}}} \tag{16-24}$$

This gives a constant gain of 1, and a phase shift,φ, of:

$$\Phi = -\mathbf{2}\mathbf{a} = -\mathbf{2} \sum\_{\mathbf{i}} \arctan \frac{\mathbf{a}\_{\mathbf{i}} \Omega}{\mathbf{1} - \mathbf{b}\_{\mathbf{i}} \Omega^2} \tag{16-25}$$

To transmit a signal with minimum phase distortion, the all-pass filter must have a constant group delay across the specified frequency band. The group delay is the time by which the all-pass filter delays each frequency within that band.

The frequency at which the group delay drops to 1 2 –times its initial value is the corner frequency, fC.

The group delay is defined through:

$$\mathbf{t\_{gt}} = -\frac{\mathbf{d}\phi}{\mathbf{d}\phi} \tag{16-26}$$

To present the group delay in normalized form, refer tgr to the period of the corner frequency, TC, of the all-pass circuit:

$$\mathbf{T\_{g\_l} = \frac{\mathbf{t\_{g\_l}}{\mathbf{T\_c}}} = \mathbf{t\_{g\_l}} \cdot \mathbf{t\_c}} = \mathbf{t\_{g\_l}} \frac{\alpha\_{\mathbf{c}}}{2\pi} \tag{16-27}$$

Substituting tgr through Equation 16–26 gives:

$$\mathsf{T}\_{\mathsf{gf}} = -\frac{\mathsf{q}}{2\pi} \cdot \frac{\mathsf{d}\phi}{\mathsf{d}\Omega} \tag{16-28}$$

Inserting the ϕ term in Equation 16–25 into Equation 16–28 and completing the derivation, results in:

$$\mathsf{T}\_{\mathsf{gf}} = \frac{\mathsf{1}}{\pi} \sum\_{\mathsf{i}} \frac{\mathsf{a}\_{\mathsf{i}} (\mathsf{1} + \mathsf{b}\_{\mathsf{i}} \mathsf{Q}^{2})}{\mathsf{1} + \left(\mathsf{a}\_{\mathsf{i}} \mathsf{2} - \mathsf{2} \mathsf{b}\_{\mathsf{i}}\right) \mathsf{Q} \mathsf{2}^{2} + \mathsf{b}\_{\mathsf{i}} \mathsf{2} \mathsf{Q}^{4}} \tag{16-29}$$

Setting Ω = 0 in Equation 16–29 gives the group delay for the low frequencies, 0 < Ω < 1, which is:

$$\mathbf{T}\_{\mathbf{gr0}} = \frac{\mathfrak{q}}{\mathfrak{T}} \sum\_{\mathfrak{i}} \mathbf{a}\_{\mathfrak{i}} \tag{16-30}$$

The values for Tgr0 are listed in Table 16–10, Section 16.9, from the first to the tenth order.

In addition, Figure 16–42 shows the group delay response versus the frequency for the first ten orders of all-pass filters.

Here is the image describtion:
```
The image is a graph that displays the normalized group delay (Tgr) versus frequency (Ω) for filters of different orders, ranging from 1st order to 10th order. The x-axis represents the frequency on a logarithmic scale, spanning from 0.01 to 100. The y-axis represents the normalized group delay, also on a logarithmic scale, ranging from 0 to 3.5.

Each curve on the graph corresponds to a different filter order, with the 1st order filter having the lowest group delay and the 10th order filter having the highest group delay. The curves are labeled accordingly, with the 1st order curve at the bottom and the 10th order curve at the top.

As the frequency increases, the group delay for each filter order decreases. The higher the order of the filter, the higher the initial group delay at low frequencies. All curves converge towards a group delay of zero as the frequency approaches higher values, particularly beyond a frequency of 10.

The graph shows that higher-order filters have a more significant group delay at lower frequencies, but this delay diminishes rapidly as the frequency increases. The curves are smooth and exhibit a similar shape, with a steep decline in group delay occurring around a frequency of 1.
```

Figure 16–42. Frequency Response of the Group Delay for the First 10 Filter Orders

### **16.7.1 First-Order All-Pass Filter**

Figure 16–43 shows a first-order all-pass filter with a gain of +1 at low frequencies and a gain of –1 at high frequencies. Therefore, the magnitude of the gain is 1, while the phase changes from 0° to –180°.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with two input terminals and one output terminal.
   - The inverting input is marked with a minus sign (-) and the non-inverting input is marked with a plus sign (+).

2. **Resistors**:
   - There are three resistors in the circuit, labeled \( R_1 \) and \( R \).
   - Two resistors \( R_1 \) are connected in series, one between the input voltage (\( V_{IN} \)) and the inverting input of the op-amp, and the other between the inverting input and the output voltage (\( V_{OUT} \)).
   - The third resistor \( R \) is connected between the input voltage (\( V_{IN} \)) and the non-inverting input of the op-amp.

3. **Capacitor**:
   - A capacitor \( C \) is connected between the non-inverting input of the op-amp and ground.

4. **Voltage Sources**:
   - \( V_{IN} \) represents the input voltage applied to the circuit.
   - \( V_{OUT} \) represents the output voltage from the op-amp.

5. **Ground Connection**:
   - The ground symbol is shown connected to one terminal of the capacitor \( C \).

**Connections**:
- The input voltage \( V_{IN} \) is applied to the junction where \( R_1 \) and \( R \) meet.
- The inverting input of the op-amp is connected to the junction between the two \( R_1 \) resistors.
- The non-inverting input of the op-amp is connected to the junction between the resistor \( R \) and the capacitor \( C \).
- The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

This configuration suggests a specific type of op-amp circuit, potentially a filter or integrator, depending on the values of the components and the nature of the input signal.
```

#### Figure 16–43. First-Order All-Pass

The transfer function of the circuit above is:

$$\mathsf{A}(\mathsf{s}) = \frac{\mathsf{1} - \mathsf{R}\mathsf{C}\mathsf{o}\mathsf{o}\_{\mathsf{C}}\mathsf{s}}{\mathsf{1} + \mathsf{R}\mathsf{C}\mathsf{o}\mathsf{o}\_{\mathsf{C}}\mathsf{s}}$$

The coefficient comparison with Equation 16–23 (b1=1), results in:

$$\mathbf{a}\_{\parallel} = \mathsf{RC} \cdot 2\pi \mathbf{f}\_{\mathbb{C}} \tag{16-34}$$

To design a first-order all-pass, specify fC and C and then solve for R:

$$\mathbf{R} = \frac{\mathbf{a}\_{\parallel}}{2\pi \mathbf{f}\_{\mathbf{c}} \cdot \mathbf{C}} \tag{16-32}$$

Inserting Equation 16–31 into 16–30 and substituting ωC with Equation 16–27 provides the maximum group delay of a first-order all-pass filter:

$$\mathbf{t}\_{\rm gr0} = \mathbf{2RC} \tag{16-33}$$

#### **16.7.2 Second-Order All-Pass Filter**

Figure 16–44 shows that one possible design for a second-order all-pass filter is to subtract the output voltage of a second-order band-pass filter from its input voltage.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit involving operational amplifiers (op-amps) and passive components such as resistors and capacitors. Here is a detailed description of the circuit:

1. **Input Voltage (V_IN)**: The circuit starts with an input voltage source labeled as \( V_{IN} \).

2. **Resistor (R1)**: The input voltage \( V_{IN} \) is connected to a resistor labeled \( R_1 \).

3. **Capacitors (C)**: After \( R_1 \), the circuit splits into two paths. One path goes through a capacitor labeled \( C \), and the other path goes through another capacitor labeled \( C \). These capacitors are connected in parallel.

4. **First Operational Amplifier (Op-Amp)**: The output of the capacitors is connected to the non-inverting input (+) of the first operational amplifier. The inverting input (-) of this op-amp is connected to ground.

5. **Resistor (R2)**: The output of the first op-amp is connected to a resistor labeled \( R_2 \).

6. **Resistor (R3)**: The other end of \( R_2 \) is connected to another resistor labeled \( R_3 \).

7. **Second Operational Amplifier (Op-Amp)**: The output of \( R_3 \) is connected to the non-inverting input (+) of the second operational amplifier. The inverting input (-) of this op-amp is connected to ground.

8. **Resistor (R)**: The output of the second op-amp is connected to a resistor labeled \( R \).

9. **Output Voltage (V_OUT)**: The other end of the resistor \( R \) is connected to the output voltage labeled \( V_{OUT} \).

10. **Ground Connections**: Both operational amplifiers have their inverting inputs connected to ground.

This circuit appears to be a multi-stage filter or amplifier, utilizing operational amplifiers in a configuration that includes both capacitive and resistive components to shape the frequency response or amplify the input signal. The exact function would depend on the values of the resistors and capacitors used.
```

Figure 16–44. Second-Order All-Pass Filter

16-44

The transfer function of the circuit in Figure 16–44 is:

$$\mathsf{A(s)} = \frac{\mathsf{1} + (2\mathsf{R}\_1 - a\mathsf{R}\_2)\mathsf{C}\mathsf{o}\mathsf{o}\cdot\mathsf{s} + \mathsf{R}\_1\mathsf{R}\_2\mathsf{C}^2\mathsf{o}\mathsf{c}^2\mathsf{s}^2}{\mathsf{1} + 2\mathsf{R}\_1\mathsf{C}\mathsf{o}\mathsf{c}\cdot\mathsf{s} + \mathsf{R}\_1\mathsf{R}\_2\mathsf{C}^2\mathsf{o}\mathsf{c}^2\mathsf{s}^2}$$

The coefficient comparison with Equation 16–23 yields:

$$\mathbf{a}\_{\uparrow} = 4\pi \mathbf{f}\_{\mathbf{c}} \mathbf{R}\_{\uparrow} \mathbf{C} \tag{16-34}$$

$$\mathbf{b}\_1 = \mathbf{a}\_1 \pi \mathbf{f}\_\mathbf{c} \mathbf{R}\_2 \mathbf{C} \tag{16-35}$$

$$\alpha = \frac{\mathbf{a}\_1^2}{\mathbf{b}\_1} = \frac{\mathbf{R}}{\mathbf{R}\_3} \tag{16-36}$$

To design the circuit, specify fC, C, and R, and then solve for the resistor values:

$$\mathbf{R}\_1 = \frac{\mathbf{a}\_1}{4\pi \mathbf{f}\_\mathbf{c} \mathbf{C}} \tag{16-37}$$

$$\mathbf{R}\_2 = \frac{\mathbf{b}\_1}{\mathbf{a}\_1 \pi t\_\text{\textdegree C}} \tag{16-38}$$

$$\mathcal{R}\_3 = \frac{\mathcal{R}}{\mathcal{Q}} \tag{16-39}$$

Inserting Equation 16–34 into Equation16–30 and substituting ωC with Equation 16–27 gives the maximum group delay of a second-order all-pass filter:

$$\mathbf{t}\_{\text{gr0}} = \mathbf{4} \mathsf{R}\_1 \mathsf{C} \tag{16-40}$$

#### **16.7.3 Higher-Order All-Pass Filter**

Higher-order all-pass filters consist of cascaded first-order and second-order filter stages.

#### Example 16–7. 2-ms Delay All-Pass Filter

A signal with the frequency spectrum, 0 < f < 1 kHz, needs to be delayed by 2 ms. To keep the phase distortions at a minimum, the corner frequency of the all-pass filter must be fC ≥ 1 kHz.

Equation 16–27 determines the normalized group delay for frequencies below 1 kHz:

$$\mathsf{T\_{gro}} = \frac{\mathsf{t\_{gro}}}{\mathsf{T\_{C}}} = \mathsf{2} \,\mathsf{ms}\cdot\mathsf{1} \,\mathsf{kHz} = \mathsf{2.0}$$

Figure 16–42 confirms that a seventh-order all-pass is needed to accomplish the desired delay. The exact value, however, is Tgr0 = 2.1737. To set the group delay to precisely 2 ms, solve Equation 16–27 for fC and obtain the corner frequency:

$$\mathbf{f\_{C}} = \frac{\mathbf{\bar{\mathbf{\\_{Br0}}}}}{\mathbf{\bar{\mathbf{\\_{Br0}}}}} = \mathbf{\bar{\mathbf{\\_{005}}}} \text{ און} \mathbf{\bar{\mathbf{\\_{Br0}}}}$$

To complete the design, look up the filter coefficients for a seventh-order all-pass filter, specify C, and calculate the resistor values for each partial filter.

Cascading the first-order all-pass with the three second-order stages results in the desired seventh-order all-pass filter.

Here is the image describtion:
```
The image depicts a complex electronic circuit consisting of multiple operational amplifiers (op-amps), resistors, and capacitors. The circuit appears to be a multi-stage filter or amplifier network. Here is a detailed description of each section:

1. **First Stage:**
   - **Input:** The input voltage is labeled as \( V_{IN} \).
   - **Components:**
     - Two resistors \( R_{11} \) are connected in parallel to the non-inverting input of the first op-amp.
     - A resistor \( R_1 \) and a capacitor \( C_1 \) are connected in series to the inverting input of the first op-amp.
     - The output of the first op-amp is connected to a resistor \( R_{12} \).
   - **Op-Amp Configuration:** The first op-amp is configured with feedback through \( R_{11} \) and \( C_1 \), suggesting a possible integrator or low-pass filter configuration.

2. **Second Stage:**
   - **Components:**
     - The output from the first stage is connected to a resistor \( R_{12} \), which is then connected to a capacitor \( C_2 \) in parallel with another capacitor \( C_2 \).
     - This node is connected to the non-inverting input of the second op-amp.
     - The second op-amp has a feedback network consisting of resistors \( R_{22} \) and \( R_{32} \).
     - The output of the second op-amp is connected to a resistor \( R_2 \).
   - **Op-Amp Configuration:** The second op-amp is configured with feedback through \( R_{22} \) and \( R_{32} \), suggesting another filter stage.

3. **Third Stage:**
   - **Components:**
     - The output from the second stage is connected to a resistor \( R_{13} \), which is then connected to a capacitor \( C_3 \) in parallel with another capacitor \( C_3 \).
     - This node is connected to the non-inverting input of the third op-amp.
     - The third op-amp has a feedback network consisting of resistors \( R_{23} \) and \( R_{33} \).
     - The output of the third op-amp is connected to a resistor \( R_3 \).
   - **Op-Amp Configuration:** The third op-amp is configured similarly to the second stage, indicating another filter stage.

4. **Fourth Stage:**
   - **Components:**
     - The output from the third stage is connected to a resistor \( R_{14} \), which is then connected to a capacitor \( C_4 \) in parallel with another capacitor \( C_4 \).
     - This node is connected to the non-inverting input of the fourth op-amp.
     - The fourth op-amp has a feedback network consisting of resistors \( R_{24} \) and \( R_{34} \).
     - The output of the fourth op-amp is connected to a resistor \( R_4 \).
   - **Op-Amp Configuration:** The fourth op-amp is configured similarly to the previous stages, indicating another filter stage.

5. **Output:**
   - The final output voltage is labeled as \( V_{OUT} \).

Overall, the circuit appears to be a multi-stage active filter, possibly a cascade of low-pass or band-pass filters, each stage providing additional filtering to the input signal \( V_{IN} \) and producing the final output \( V_{OUT} \). The use of multiple op-amps, resistors, and capacitors suggests a design aimed at achieving a specific frequency response.
```

Figure 16–45. Seventh-Order All-Pass Filter

# **16.8 Practical Design Hints**

This section introduces dc-biasing techniques for filter designs in single-supply applications, which are usually not required when operating with dual supplies. It also provides recommendations on selecting the type and value range of capacitors and resistors as well as the decision criteria for choosing the correct op amp.

### **16.8.1 Filter Circuit Biasing**

The filter diagrams in this chapter are drawn for dual supply applications. The op amp operates from a positive and a negative supply, while the input and the output voltage are referenced to ground (Figure 16–46).

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit with a capacitor and resistors. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two input terminals and one output terminal. The non-inverting input (+) is connected to the input signal path, while the inverting input (-) is connected to a feedback network.

2. **Power Supply**: The op-amp is powered by a dual power supply, with +V_CC connected to the positive power rail and -V_CC connected to the negative power rail.

3. **Input Signal (V_IN)**: The input signal, V_IN, is applied to the circuit through a capacitor, C1.

4. **Capacitor (C1)**: C1 is connected in series with the input signal, V_IN. This capacitor blocks any DC component of the input signal, allowing only the AC component to pass through.

5. **Resistor (R1)**: After the capacitor, the signal passes through a resistor, R1, which is connected to the non-inverting input (+) of the op-amp.

6. **Ground Connection**: The junction between the capacitor C1 and resistor R1 is connected to ground through a node.

7. **Feedback Resistor (R2)**: A resistor, R2, is connected between the output of the op-amp (V_OUT) and the inverting input (-) of the op-amp. This resistor forms part of the feedback network that determines the gain of the amplifier.

8. **Output Signal (V_OUT)**: The output signal, V_OUT, is taken from the output terminal of the op-amp.

The configuration shown is a typical non-inverting amplifier setup, where the input signal is applied to the non-inverting input of the op-amp, and the feedback resistor R2 helps set the gain of the amplifier. The capacitor C1 ensures that only AC signals are amplified by blocking any DC component from the input signal.
```

Figure 16–46. Dual-Supply Filter Circuit

For the single supply circuit in Figure 16–47, the lowest supply voltage is ground. For a symmetrical output signal, the potential of the noninverting input is level-shifted to midrail.

Here is the image describtion:
```
The image depicts a non-inverting operational amplifier (op-amp) circuit with a capacitor and several resistors. Here is a detailed description of the circuit components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two input terminals (inverting and non-inverting) and one output terminal. The non-inverting input is marked with a "+" sign, and the inverting input is marked with a "-" sign.

2. **Power Supply**: The op-amp is powered by a positive voltage supply labeled as +Vcc. The ground connection is also shown, indicating the reference point for the circuit.

3. **Input Signal (VIN)**: The input signal, VIN, is applied to the circuit through a capacitor labeled CIN. This capacitor is connected in series with the input signal to block any DC component and allow only the AC component to pass through.

4. **Biasing Resistors (RB)**: Two resistors, both labeled RB, are connected in a voltage divider configuration. One end of the first RB is connected to the junction between CIN and R1, while the other end is connected to ground. The second RB is connected between the non-inverting input of the op-amp and ground. This configuration sets a midpoint voltage (VMID) at the non-inverting input of the op-amp.

5. **Feedback Resistors (R1 and R2)**: The resistor R1 is connected between the junction of CIN and the first RB and the inverting input of the op-amp. The resistor R2 is connected between the output of the op-amp (VOUT) and the inverting input of the op-amp. This forms a feedback loop that determines the gain of the amplifier.

6. **Output Signal (VOUT)**: The output signal, VOUT, is taken from the output terminal of the op-amp.

7. **Midpoint Voltage (VMID)**: The voltage at the non-inverting input of the op-amp is labeled as VMID, which is set by the voltage divider formed by the two RB resistors.

In summary, this is a non-inverting amplifier circuit with a capacitor for AC coupling at the input, a voltage divider for biasing the non-inverting input, and a feedback network to set the gain. The op-amp amplifies the input signal VIN, and the amplified output is available at VOUT.
```

Here is the image describtion:
```
The image is a caption or label for a figure in a document, likely a textbook or technical manual. The caption reads "Figure 16–47. Single-Supply Filter Circuit." This indicates that the figure is the 47th figure in Chapter 16 of the document, and it depicts a single-supply filter circuit. The text is in a standard, readable font, and it is likely positioned below or above the corresponding figure in the document. The figure itself is not shown in the image, so no details about the actual circuit can be provided.
```

The coupling capacitor, CIN in Figure 16–47, ac-couples the filter, blocking any unknown dc level in the signal source. The voltage divider, consisting of the two equal-bias resistors RB, divides the supply voltage to VMID and applies it to the inverting op amp input.

For simple filter input structures, passive RC networks often provide a low-cost biasing solution. In the case of more complex input structures, such as the input of a second-order low-pass filter, the RC network can affect the filter characteristic. Then it is necessary to either include the biasing network into the filter calculations, or to insert an input buffer between biasing network and the actual filter circuit, as shown in Figure 16–48.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit featuring two operational amplifiers (op-amps) configured in a specific arrangement. Here is a detailed description of the components and their connections:

1. **Input Section:**
   - **V_IN:** The input voltage signal is applied at the leftmost part of the circuit.
   - **C_IN:** A capacitor connected in series with the input signal, likely serving as a coupling capacitor to block DC components.
   - **R_B:** Two resistors connected to the input signal, one going to the positive supply voltage (+V_CC) and the other to ground. These resistors form a voltage divider to set the bias point for the input signal.

2. **First Op-Amp Stage:**
   - **Op-Amp:** The first operational amplifier is configured with its non-inverting input connected to the junction of the voltage divider formed by the two R_B resistors.
   - **V_MID:** The voltage at the non-inverting input of the op-amp, which is set by the voltage divider.
   - The output of the first op-amp is connected to a resistor (R_1).

3. **Intermediate Section:**
   - **R_1:** A resistor connected between the output of the first op-amp and the input to the next stage.
   - **C_1:** A capacitor connected from the junction between R_1 and R_2 to ground, likely serving as a filter or part of a frequency response network.
   - **R_2:** Another resistor connected in series with R_1, leading to the input of the second op-amp.

4. **Second Op-Amp Stage:**
   - **Op-Amp:** The second operational amplifier is configured similarly to the first, with its non-inverting input connected to the junction of another voltage divider formed by resistors (not shown in detail but implied to be similar to the first stage).
   - **V_MID:** The voltage at the non-inverting input of the second op-amp.
   - **C_2:** A capacitor connected from the output of the second op-amp to the positive supply voltage (+V_CC), likely serving as a feedback capacitor to stabilize the op-amp or set its frequency response.

5. **Output Section:**
   - **V_OUT:** The output voltage signal is taken from the output of the second op-amp, located at the rightmost part of the circuit.

6. **Power Supply:**
   - **+V_CC:** The positive supply voltage is provided to both op-amps and other components as needed.

The circuit appears to be a multi-stage amplifier with filtering elements, designed to process an input signal (V_IN) and produce an amplified output signal (V_OUT). The capacitors (C_IN, C_1, C_2) and resistors (R_B, R_1, R_2) are used to set the bias points, filter frequencies, and stabilize the operation of the op-amps.
```

Figure 16–48. Biasing a Sallen-Key Low-Pass

CIN ac-couples the filter, blocking any dc level in the signal source. VMID is derived from VCC via the voltage divider. The op amp operates as a voltage follower and as an impedance converter. VMID is applied via the dc path, R1 and R2, to the noninverting input of the filter amplifier.

Note that the parallel circuit of the resistors, RB , together with CIN create a high-pass filter. To avoid any effect on the low-pass characteristic, the corner frequency of the input highpass must be low versus the corner frequency of the actual low-pass.

The use of an input buffer causes no loading effects on the low-pass filter, thus keeping the filter calculation simple.

In the case of a higher-order filter, all following filter stages receive their bias level from the preceding filter amplifier.

Figure 16–49 shows the biasing of an multiple feedback (MFB) low-pass filter.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit involving operational amplifiers (op-amps) and various passive components. Here is a detailed description:

1. **Power Supply Connections**:
   - The circuit is powered by a positive voltage supply labeled as +V_CC.
   - Ground connections are indicated at the bottom of the circuit.

2. **Input Section**:
   - The input signal, V_IN, enters the circuit through a capacitor labeled C_IN.
   - The input signal then passes through a pair of resistors labeled R_B, which are connected to the positive voltage supply +V_CC and ground, respectively.
   - The point between the resistors R_B is labeled V_MID, which is connected to the non-inverting input (+) of the first op-amp.

3. **First Operational Amplifier Stage**:
   - The first op-amp has its non-inverting input connected to V_MID.
   - The inverting input (-) of the op-amp is connected to ground.
   - The output of the first op-amp is labeled V_MID and is connected to a resistor R_1.

4. **Intermediate Section**:
   - The resistor R_1 is connected to a capacitor C_2, which is grounded.
   - The other end of R_1 is connected to the non-inverting input (+) of the second op-amp.

5. **Second Operational Amplifier Stage**:
   - The second op-amp has its non-inverting input connected to the output of R_1.
   - The inverting input (-) of the second op-amp is connected to a network consisting of resistors R_2 and R_3, and a capacitor C_1.
   - R_2 is connected to the positive voltage supply +V_CC.
   - R_3 is connected between the inverting input (-) and the output of the second op-amp.
   - C_1 is connected between the inverting input (-) and the positive voltage supply +V_CC.
   - The output of the second op-amp is labeled V_OUT.

6. **Additional Section**:
   - There is another op-amp at the bottom of the diagram, which appears to be part of a voltage reference or biasing circuit.
   - This op-amp has its non-inverting input connected to a network of resistors R_B and a capacitor C_B.
   - The inverting input (-) of this op-amp is connected to ground.
   - The output of this op-amp is labeled V_MID and is connected to further filter stages.

Overall, the circuit appears to be a multi-stage amplifier with filtering components, designed to process an input signal V_IN and produce an output signal V_OUT. The op-amps are used to amplify and filter the signal, while the passive components (resistors and capacitors) set the frequency response and biasing conditions.
```

Figure 16–49. Biasing a Second-Order MFB Low-Pass Filter

The input buffer decouples the filter from the signal source. The filter itself is biased via the noninverting amplifier input. For that purpose, the bias voltage is taken from the output of a VMID generator with low output impedance. The op amp operates as a difference amplifier and subtracts the bias voltage of the input buffer from the bias voltage of the VMID generator, thus yielding a dc potential of VMID at zero input signal.

A low-cost alternative is to remove the op amp and to use a passive biasing network instead. However, to keep loading effects at a minimum, the values for RB must be significantly higher than without the op amp.

The biasing of a Sallen-Key and an MFB high-pass filter is shown in Figure 16–50.

The input capacitors of high-pass filters already provide the ac-coupling between filter and signal source. Both circuits use the VMID generator from Figure 16–50 for biasing. While the MFB circuit is biased at the noninverting amplifier input, the Sallen-Key high-pass is biased via the only dc path available, which is R1. In the ac circuit, the input signals travel via the low output impedance of the op amp to ground.

Here is the image describtion:
```
The image shows two different electronic circuit diagrams, each featuring operational amplifiers (op-amps) and various passive components such as resistors and capacitors. Below is a detailed description of each circuit:

### Left Circuit:
1. **Input and Capacitors:**
   - The input signal \( V_{IN} \) is fed into the circuit.
   - Two capacitors, each labeled \( C \), are connected in series with the input signal.

2. **Resistor and Op-Amp:**
   - A resistor \( R_1 \) is connected between the junction of the two capacitors and the ground.
   - The same junction is connected to the non-inverting input (+) of an operational amplifier (op-amp).
   - The inverting input (-) of the op-amp is connected to the output of the op-amp through a feedback resistor \( R_2 \).

3. **Power Supply:**
   - The op-amp is powered by a positive voltage supply \( +V_{CC} \).

4. **Output:**
   - The output of the op-amp is labeled \( V_{OUT} \).

5. **Midpoint Voltage:**
   - The junction between the resistor \( R_1 \) and the capacitors is labeled \( V_{MID} \).

### Right Circuit:
1. **Input and Capacitors:**
   - The input signal \( V_{IN} \) is fed into the circuit.
   - Three capacitors, labeled \( C_1 \), \( C_2 \), and \( C_3 \), are connected in the circuit. \( C_1 \) and \( C_3 \) are in series with the input signal, and \( C_2 \) is connected in parallel with the feedback resistor.

2. **Resistors and Op-Amp:**
   - A resistor \( R_2 \) is connected between the junction of \( C_1 \) and \( C_3 \) and the ground.
   - The same junction is connected to the non-inverting input (+) of an operational amplifier (op-amp).
   - The inverting input (-) of the op-amp is connected to the output of the op-amp through a feedback resistor \( R_1 \).

3. **Power Supply:**
   - The op-amp is powered by a positive voltage supply \( +V_{CC} \).

4. **Output:**
   - The output of the op-amp is labeled \( V_{OUT} \).

5. **Midpoint Voltage:**
   - The junction between the resistor \( R_2 \) and the capacitors is labeled \( V_{MID} \).

### Bottom Circuit:
1. **Voltage Divider and Capacitor:**
   - Two resistors \( R_B \) are connected in series between the positive voltage supply \( +V_{CC} \) and the ground.
   - A capacitor \( C_B \) is connected in parallel with the lower resistor \( R_B \).

2. **Op-Amp:**
   - The junction between the two resistors \( R_B \) is connected to the non-inverting input (+) of an operational amplifier (op-amp).
   - The inverting input (-) of the op-amp is connected to the output of the op-amp.

3. **Output:**
   - The output of the op-amp is labeled \( V_{MID} \).

4. **Connection to Other Circuits:**
   - The \( V_{MID} \) output from this circuit is connected to the \( V_{MID} \) points in both the left and right circuits.

### Summary:
- The left and right circuits are variations of active filter circuits using op-amps, resistors, and capacitors.
- The bottom circuit is a voltage divider with an op-amp buffer, providing a stable midpoint voltage \( V_{MID} \) to the other two circuits.
```

Figure 16–50. Biasing a Sallen-Key and an MFB High-Pass Filter

#### **16.8.2 Capacitor Selection**

The tolerance of the selected capacitors and resistors depends on the filter sensitivity and on the filter performance.

Sensitivity is the measure of the vulnerability of a filter's performance to changes in component values. The important filter parameters to consider are the corner frequency, fC, and Q.

For example, when Q changes by ± 2% due to a ± 5% change in the capacitance value, then the sensitivity of Q to capacity changes is expressed as: s <sup>Q</sup> <sup>C</sup> 2% 5% 0.4 % % . The following sensitivity approximations apply to second-order Sallen-Key and MFB filters:

 $\mathbf{s} \frac{\mathbf{Q}}{\mathbf{C}} \approx \mathbf{s} \frac{\mathbf{Q}}{\mathbf{R}} \approx \mathbf{s} \frac{\mathbf{f\_c}}{\mathbf{C}} \approx \mathbf{s} \frac{\mathbf{f\_c}}{\mathbf{R}} \approx \pm \text{ 0.5} \frac{\text{\textquotedblleft}\text{\textquotedblright}\text{\textquotedblright}\text{\textquotedblleft}\text{\textquotedblright}\text{\textquotedblleft}\text{\textquotedblright}\text{\textquotedblright}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblright}\text{\textquotedblright}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblright}\text{\textquotedblright}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedblleft}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textquotedbl}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu0}\text{\textqu$ 

Although 0.5 %/% is a small difference from the ideal parameter, in the case of higher-order filters, the combination of small Q and fC differences in each partial filter can significantly modify the overall filter response from its intended characteristic.

Figures 16.51 and 16.52 show how an intended eighth-order Butterworth low-pass can turn into a low-pass with Tschebyscheff characteristic mainly due to capacitance changes from the partial filters.

Figure 16–51 shows the differences between the ideal and the actual frequency responses of the four partial filters. The overall filter responses are shown in Figure 16–52.

Here is the image describtion:
```
The image is a graph that plots gain (in decibels, dB) against frequency (in Hertz, Hz) on a logarithmic scale. The x-axis represents frequency, ranging from 10 kHz to 100 kHz, while the y-axis represents gain, ranging from -3 dB to 9 dB.

Several curves are plotted on the graph, each labeled with identifiers such as A1, A1R, A2, A2R, A3, A3R, A4, and A4R. These curves represent different responses or configurations. The curves show varying behaviors across the frequency range:

1. **A1 and A1R**: These curves start below 0 dB and show a slight decrease in gain as frequency increases.
2. **A2 and A2R**: These curves start near 0 dB and show a slight increase in gain before leveling off.
3. **A3 and A3R**: These curves start near 0 dB, increase slightly, and then decrease as frequency increases.
4. **A4 and A4R**: These curves show a significant peak in gain, reaching up to approximately 8 dB around 50 kHz, before sharply decreasing.

The graph is divided into a grid with horizontal and vertical lines, aiding in the precise reading of values. The labels and arrows indicate the specific curves and their corresponding identifiers. The overall trend shows how different configurations or responses behave across the specified frequency range.
```

The difference between ideal and real response peaks with 0.35 dB at approximately 30 kHz, which is equivalent to an enormous 4.1% gain error can be seen.

Figure 16–51. Differences in Q and fC in the Partial Filters of an Eighth-Order Butterworth Low-Pass Filter

Here is the image describtion:
```
The image is a graph that displays the gain (|A|) in decibels (dB) versus frequency (f) in Hertz (Hz) on a logarithmic scale. The x-axis represents the frequency, ranging from 1 kHz to 100 kHz, while the y-axis represents the gain, ranging from -2.8 dB to 0.4 dB.

There are two curves plotted on the graph:
1. The "A - Real" curve, which represents the actual gain response of a system.
2. The "A - Ideal" curve, which represents the ideal gain response of the system.

The "A - Real" curve starts at 0 dB gain at 1 kHz and remains flat until around 10 kHz, where it begins to rise slightly, peaking just above 0.4 dB. After the peak, the gain drops sharply, crossing below 0 dB around 20 kHz and continuing to decrease steeply.

The "A - Ideal" curve also starts at 0 dB gain at 1 kHz and remains flat until around 10 kHz. Unlike the "A - Real" curve, it does not rise but stays flat until it begins to drop sharply around 20 kHz, similar to the "A - Real" curve, but without the initial rise and peak.

The grid lines on the graph help to visualize the changes in gain and frequency more clearly. The logarithmic scale on the x-axis allows for a wide range of frequencies to be displayed in a compact manner.
```

Figure 16–52. Modification of the Intended Butterworth Response to a Tschebyscheff-Type Characteristic

Active Filter Design Techniques 16-51

If this filter is intended for a data acquisition application, it could be used at best in a 4-bit system. In comparison, if the maximum full-scale error of a 12-bit system is given with LSB, then maximum pass-band deviation would be – 0.001 dB, or 0.012%.

To minimize the variations of fC and Q, NPO (COG) ceramic capacitors are recommended for high-performance filters. These capacitors hold their nominal value over a wide temperature and voltage range. The various temperature characteristics of ceramic capacitors are identified by a three-symbol code such as: COG, X7R, Z5U, and Y5V.

COG-type ceramic capacitors are the most precise. Their nominal values range from 0.5 pF to approximately 47 nF with initial tolerances from ± 0.25 pF for smaller values and up to ±1% for higher values. Their capacitance drift over temperature is typically 30ppm/°C.

X7R-type ceramic capacitors range from 100 pF to 2.2 µF with an initial tolerance of +1% and a capacitance drift over temperature of ±15%.

For higher values, tantalum electrolytic capacitors should be used.

Other precision capacitors are silver mica, metallized polycarbonate, and for high temperatures, polypropylene or polystyrene.

Since capacitor values are not as finely subdivided as resistor values, the capacitor values should be defined prior to selecting resistors. If precision capacitors are not available to provide an accurate filter response, then it is necessary to measure the individual capacitor values, and to calculate the resistors accordingly.

For high performance filters, 0.1% resistors are recommended.

#### **16.8.3 Component Values**

Resistor values should stay within the range of 1 kΩ to 100 kΩ. The lower limit avoids excessive current draw from the op amp output, which is particularly important for singlesupply op amps in power-sensitive applications. Those amplifiers have typical output currents of between 1 mA and 5 mA. At a supply voltage of 5 V, this current translates to a minimum of 1 kΩ.

The upper limit of 100 kΩ is to avoid excessive resistor noise.

Capacitor values can range from 1 nF to several µF. The lower limit avoids coming too close to parasitic capacitances. If the common-mode input capacitance of the op amp, used in a Sallen-Key filter section, is close to 0.25% of C1, (C1 / 400), it must be considered for accurate filter response. The MFB topology, in comparison, does not require input-capacitance compensation.

#### **16.8.4 Op Amp Selection**

The most important op amp parameter for proper filter functionality is the unity-gain bandwidth. In general, the open-loop gain (AOL) should be 100 times (40 dB above) the peak gain (Q) of a filter section to allow a maximum gain error of 1%.

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It shows the magnitude of the gain (|A|) in decibels (dB) on the vertical axis versus the frequency (f) in Hertz (Hz) on the horizontal axis.

Key features of the plot include:

1. **Vertical Axis (|A| [dB])**: This axis represents the magnitude of the gain in decibels. The gain starts from 0 dB at the bottom and increases upwards.

2. **Horizontal Axis (f / Hz)**: This axis represents the frequency in Hertz. The frequency starts from 0 Hz on the left and increases to the right.

3. **A_OL**: This is the open-loop gain of the system, shown as a horizontal line at a high gain level on the left side of the plot.

4. **A_0**: This is the initial gain level at low frequencies, shown as a horizontal line at a lower gain level.

5. **A_PEAK**: This is the peak gain level, indicated by a horizontal dashed line.

6. **f_P**: This is the frequency at which the peak gain (A_PEAK) occurs, marked by a vertical dashed line.

7. **f_T**: This is the transition frequency or the frequency at which the gain starts to roll off, shown at the far right of the plot.

8. **40 dB**: This indicates a specific gain difference, likely between the open-loop gain (A_OL) and another gain level.

9. **Gain Roll-off**: The plot shows a decrease in gain with increasing frequency, represented by a downward sloping line after the peak gain.

10. **Resonance Peak**: The plot shows a resonance peak at frequency f_P, where the gain temporarily increases before decreasing again.

Overall, the plot illustrates how the gain of the system varies with frequency, highlighting key points such as the open-loop gain, peak gain, and the frequencies at which these occur.
```

Here is the image describtion:
```
The image is a caption for a figure labeled "Figure 16–53." The caption describes the contents of the figure, which are the "Open-Loop Gain (A_OL) and Filter Response (A)." The text is formatted in a standard font and style, typically used in technical or academic documents to provide a clear and concise description of the figure's content. The use of subscripts in "A_OL" indicates a specific notation for open-loop gain, commonly used in engineering and electronics contexts.
```

The following equations are good rules of thumb to determine the necessary unity-gain bandwidth of an op amp for an individual filter section.

1) First-order filter:

fT 100·Gain·fc

2) Second-order filter (Q < 1):

fT 100·Gain·fc·ki ki fci fc with

3) Second-order filter (Q > 1):

$$\mathbf{f\_{\tau}} = \mathbf{100} \cdot \mathbf{G} \dot{\mathbf{a}} \dot{\mathbf{n}} \cdot \frac{\mathbf{f\_{\tilde{c}}}}{\mathbf{a\_{\parallel}}} \sqrt{\frac{\mathbf{Q\_{\parallel}}^2 - \mathbf{0.5}}{\mathbf{Q\_{\parallel}}^2 - \mathbf{0.25}}}$$

For example, a fifth-order, 10-kHz, Tschebyscheff low-pass filter with 3-dB passband ripple and a dc gain of A0 = 2 has its worst case Q in the third filter section. With Q3 = 8.82 and a3 = 0.1172, the op amp needs to have a unity-gain bandwidth of:

$$\mathbf{f\_{\tau}} = \texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\texttt{\cdots}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}$$
}

In comparison, a fifth-order unity-gain, 10-kHz, Butterworth low-pass filter has a worst case Q of Q3 = 1.62; a3 = 0.618. Due to the lower Q value, fT is also lower and calculates to only:

Active Filter Design Techniques 16-53

$$\mathfrak{f}\_{\mathsf{T}} = \mathsf{100} \cdot \frac{\mathsf{10} \,\mathsf{kHz}}{\mathsf{0}.6\mathsf{18}} \sqrt{\frac{\mathsf{1.62^2 - 0.5}}{\mathsf{1.62^2 - 0.25}}} = \mathsf{1.5} \,\mathsf{M}\mathsf{Hz}$$

Besides good dc performance, low noise, and low signal distortion, another important parameter that determines the speed of an op amp is the slew rate (SR). For adequate fullpower response, the slew rate must be greater than:

$$\mathsf{SR} = \pi \mathsf{\cdot V\_{\mathsf{PP}} \mathsf{f\_C}}$$

For example, a single-supply, 100-kHz filter with 5 VPP output requires a slew rate of at least:

$$\mathbf{SR} = \pi \mathbf{\dot{\*}} \mathbf{V} \mathbf{\dot{\*}} \mathbf{0} \mathbf{0} \text{ жďz = } \mathbf{1}. \mathbf{57} \frac{\mathbf{V}}{\mu \mathbf{S}}$$

Texas Instruments offers a wide range of op amps for high-performance filters in single supply applications. Table 16–3 provides a selection of single-supply amplifiers sorted in order of rising slew rate.

Table 16–3. Single-Supply Op Amp Selection Guide (TA = 25°C, VCC = 5 V)

| OP AMP          | BW<br>(MHz) | FPR<br>(kHz)   | SR<br>(V/µs) | VIO<br>(mV) | Noise<br>(nV/√Hz) |
|-----------------|-------------|----------------|--------------|-------------|-------------------|
| TLV2721<br>0.51 |             | 11             | 0.18         | 0.6         | 20                |
| TLC2201A<br>1.8 |             | 159            | 2.5          | 0.6         | 8                 |
| TLV2771A        | 4.8         | 572            | 9            | 1.9         | 21                |
| TLC071          | 10          | 1000           | 16           | 1.5         | 7                 |
| TLE2141         | 5.9         | 2800           | 45           | 0.5         | 10.5              |
| THS4001         | 270         | 127 MHz (1VPP) | 400          | 6           | 7.5               |

# **16.9 Filter Coefficient Tables**

The following tables contain the coefficients for the three filter types, Bessel, Butterworth and Tschebyscheff. The Tschebyscheff tables (Table 16–9) are split into categories for the following passband ripples: 0.5 dB, 1 dB, 2 dB, and 3 dB.

The table headers consist of the following quantities:

- n is the filter order
- i is the number of the partial filter.
- ai , bi are the filter coefficients.
- ki is the ratio of the corner frequency of a partial filter, fCi , to the corner frequency of the overall filter, fC. This ratio is used to determine the unity-gain bandwidth of the op amp, as well as to simplify the test of a filter design by measuring fCi and comparing it to fC.
- Qi is the quality factor of the partial filter.
- fi / fC this ratio is used for test purposes of the allpass filters, where fi is the frequency, at which the phase is 180° for a second-order filter, respectively 90° for a first-order all-pass.
- Tgr0 is the normalized group delay of the overall all-pass filter.

| n  | i      | a i              | b i              | ki =<br>fCi / fC | Q i       |
|----|--------|------------------|------------------|------------------|-----------|
| 1  | 1      | 1.0000           | 0.0000           | 1.000            |          |
| 2  | 1      | 1.3617           | 0.6180           | 1.000            | 0.58      |
| 3  | 1<br>2 | 0.7560<br>0.9996 | 0.0000<br>0.4772 | 1.323<br>1.414   | <br>0.69 |
| 4  | 1      | 1.3397           | 0.4889           | 0.978            | 0.52      |
|    | 2      | 0.7743           | 0.3890           | 1.797            | 0.81      |
| 5  | 1      | 0.6656           | 0.0000           | 1.502            |          |
|    | 2      | 1.1402           | 0.4128           | 1.184            | 0.56      |
|    | 3      | 0.6216           | 0.3245           | 2.138            | 0.92      |
| 6  | 1      | 1.2217           | 0.3887           | 1.063            | 0.51      |
|    | 2      | 0.9686           | 0.3505           | 1.431            | 0.61      |
|    | 3      | 0.5131           | 0.2756           | 2.447            | 1.02      |
| 7  | 1      | 0.5937           | 0.0000           | 1.648            |          |
|    | 2      | 1.0944           | 0.3395           | 1.207            | 0.53      |
|    | 3      | 0.8304           | 0.3011           | 1.695            | 0.66      |
|    | 4      | 0.4332           | 0.2381           | 2.731            | 1.13      |
| 8  | 1      | 1.1112           | 0.3162           | 1.164            | 0.51      |
|    | 2      | 0.9754           | 0.2979           | 1.381            | 0.56      |
|    | 3      | 0.7202           | 0.2621           | 1.963            | 0.71      |
|    | 4      | 0.3728           | 0.2087           | 2.992            | 1.23      |
| 9  | 1      | 0.5386           | 0.0000           | 1.857            |          |
|    | 2      | 1.0244           | 0.2834           | 1.277            | 0.52      |
|    | 3      | 0.8710           | 0.2636           | 1.574            | 0.59      |
|    | 4      | 0.6320           | 0.2311           | 2.226            | 0.76      |
|    | 5      | 0.3257           | 0.1854           | 3.237            | 1.32      |
| 10 | 1      | 1.0215           | 0.2650           | 1.264            | 0.50      |
|    | 2      | 0.9393           | 0.2549           | 1.412            | 0.54      |
|    | 3      | 0.7815           | 0.2351           | 1.780            | 0.62      |
|    | 4      | 0.5604           | 0.2059           | 2.479            | 0.81      |
|    | 5      | 0.2883           | 0.1665           | 3.466            | 1.42      |

Table 16–4. Bessel Coefficients

| n  | i | a i    | b i    | ki =<br>fCi / fC | Q i  |
|----|---|--------|--------|------------------|------|
| 1  | 1 | 1.0000 | 0.0000 | 1.000            |     |
| 2  | 1 | 1.4142 | 1.0000 | 1.000            | 0.71 |
| 3  | 1 | 1.0000 | 0.0000 | 1.000            |     |
|    | 2 | 1.0000 | 1.0000 | 1.272            | 1.00 |
| 4  | 1 | 1.8478 | 1.0000 | 0.719            | 0.54 |
|    | 2 | 0.7654 | 1.0000 | 1.390            | 1.31 |
| 5  | 1 | 1.0000 | 0.0000 | 1.000            |     |
|    | 2 | 1.6180 | 1.0000 | 0.859            | 0.62 |
|    | 3 | 0.6180 | 1.0000 | 1.448            | 1.62 |
| 6  | 1 | 1.9319 | 1.0000 | 0.676            | 0.52 |
|    | 2 | 1.4142 | 1.0000 | 1.000            | 0.71 |
|    | 3 | 0.5176 | 1.0000 | 1.479            | 1.93 |
| 7  | 1 | 1.0000 | 0.0000 | 1.000            |     |
|    | 2 | 1.8019 | 1.0000 | 0.745            | 0.55 |
|    | 3 | 1.2470 | 1.0000 | 1.117            | 0.80 |
|    | 4 | 0.4450 | 1.0000 | 1.499            | 2.25 |
| 8  | 1 | 1.9616 | 1.0000 | 0.661            | 0.51 |
|    | 2 | 1.6629 | 1.0000 | 0.829            | 0.60 |
|    | 3 | 1.1111 | 1.0000 | 1.206            | 0.90 |
|    | 4 | 0.3902 | 1.0000 | 1.512            | 2.56 |
| 9  | 1 | 1.0000 | 0.0000 | 1.000            |     |
|    | 2 | 1.8794 | 1.0000 | 0.703            | 0.53 |
|    | 3 | 1.5321 | 1.0000 | 0.917            | 0.65 |
|    | 4 | 1.0000 | 1.0000 | 1.272            | 1.00 |
|    | 5 | 0.3473 | 1.0000 | 1.521            | 2.88 |
| 10 | 1 | 1.9754 | 1.0000 | 0.655            | 0.51 |
|    | 2 | 1.7820 | 1.0000 | 0.756            | 0.56 |
|    | 3 | 1.4142 | 1.0000 | 1.000            | 0.71 |
|    | 4 | 0.9080 | 1.0000 | 1.322            | 1.10 |
|    | 5 | 0.3129 | 1.0000 | 1.527            | 3.20 |

Table 16–5. Butterworth Coefficients

#### Filter Coefficient Tables

| n  | i | a i    | b i         | ki =<br>fCi / fC | Q i   |
|----|---|--------|-------------|------------------|-------|
| 1  | 1 | 1.0000 | 0.0000      | 1.000            |      |
| 2  | 1 | 1.3614 | 1.3827      | 1.000            | 0.86  |
| 3  | 1 | 1.8636 | 0.0000      | 0.537            |      |
|    | 2 | 0.0640 | 1.1931      | 1.335            | 1.71  |
| 4  | 1 | 2.6282 | 3.4341      | 0.538            | 0.71  |
|    | 2 | 0.3648 | 1.1509      | 1.419            | 2.94  |
| 5  | 1 | 2.9235 | 0.0000      | 0.342            |      |
|    | 2 | 1.3025 | 2.3534      | 0.881            | 1.18  |
|    | 3 | 0.2290 | 1.0833      | 1.480            | 4.54  |
| 6  | 1 | 3.8645 | 6.9797      | 0.366            | 0.68  |
|    | 2 | 0.7528 | 1.8573      | 1.078            | 1.81  |
|    | 3 | 0.1589 | 1.0711      | 1.495            | 6.51  |
| 7  | 1 | 4.0211 | 0.0000      | 0.249            |      |
|    | 2 | 1.8729 | 4.1795      | 0.645            | 1.09  |
|    | 3 | 0.4861 | 1.5676      | 1.208            | 2.58  |
|    | 4 | 0.1156 | 1.0443      | 1.517            | 8.84  |
| 8  | 1 | 5.1117 | 11.960<br>7 | 0.276            | 0.68  |
|    | 2 | 1.0639 | 2.9365      | 0.844            | 1.61  |
|    | 3 | 0.3439 | 1.4206      | 1.284            | 3.47  |
|    | 4 | 0.0885 | 1.0407      | 1.521            | 11.53 |
| 9  | 1 | 5.1318 | 0.0000      | 0.195            |      |
|    | 2 | 2.4283 | 6.6307      | 0.506            | 1.06  |
|    | 3 | 0.6839 | 2.2908      | 0.989            | 2.21  |
|    | 4 | 0.2559 | 1.3133      | 1.344            | 4.48  |
|    | 5 | 0.0695 | 1.0272      | 1.532            | 14.58 |
| 10 | 1 | 6.3648 | 18.369<br>5 | 0.222            | 0.67  |
|    | 2 | 1.3582 | 4.3453      | 0.689            | 1.53  |
|    | 3 | 0.4822 | 1.9440      | 1.091            | 2.89  |
|    | 4 | 0.1994 | 1.2520      | 1.381            | 5.61  |
|    | 5 | 0.0563 | 1.0263      | 1.533            | 17.99 |

Table 16–6. Tschebyscheff Coefficients for 0.5-dB Passband Ripple

| n  | i      | a i              | b i              | ki =<br>fCi / fC | Q i          |
|----|--------|------------------|------------------|------------------|--------------|
| 1  | 1      | 1.0000           | 0.0000           | 1.000            |             |
| 2  | 1      | 1.3022           | 1.5515           | 1.000            | 0.96         |
| 3  | 1<br>2 | 2.2156<br>0.5442 | 0.0000<br>1.2057 | 0.451<br>1.353   | <br>2.02    |
| 4  | 1      | 2.5904           | 4.1301           | 0.540            | 0.78         |
|    | 2      | 0.3039           | 1.1697           | 1.417            | 3.56         |
| 5  | 1      | 3.5711           | 0.0000           | 0.280            |             |
|    | 2<br>3 | 1.1280<br>0.1872 | 2.4896<br>1.0814 | 0.894<br>1.486   | 1.40<br>5.56 |
| 6  | 1      | 3.8437           | 8.5529           | 0.366            | 0.76         |
|    | 2<br>3 | 0.6292<br>0.1296 | 1.9124<br>1.0766 | 1.082<br>1.493   | 2.20<br>8.00 |
| 7  | 1      | 4.9520           | 0.0000           | 0.202            |             |
|    | 2<br>3 | 1.6338<br>0.3987 | 4.4899<br>1.5834 | 0.655<br>1.213   | 1.30<br>3.16 |
|    | 4      | 0.0937           | 1.0432           | 1.520            | 10.90        |
| 8  | 1      | 5.1019           | 14.760<br>8      | 0.276            | 0.75         |
|    | 2      | 0.8916           | 3.0426           | 0.849            | 1.96         |
|    | 3      | 0.2806           | 1.4334           | 1.285            | 4.27         |
|    | 4      | 0.0717           | 1.0432           | 1.520            | 14.24        |
| 9  | 1      | 6.3415           | 0.0000           | 0.158            |             |
|    | 2      | 2.1252           | 7.1711           | 0.514            | 1.26         |
|    | 3      | 0.5624           | 2.3278           | 0.994            | 2.71         |
|    | 4      | 0.2076           | 1.3166           | 1.346            | 5.53         |
|    | 5      | 0.0562           | 1.0258           | 1.533            | 18.03        |
| 10 | 1      | 6.3634           | 22.746<br>8      | 0.221            | 0.75         |
|    | 2      | 1.1399           | 4.5167           | 0.694            | 1.86         |
|    | 3      | 0.3939           | 1.9665           | 1.093            | 3.56         |
|    | 4      | 0.1616           | 1.2569           | 1.381            | 6.94         |
|    | 5      | 0.0455           | 1.0277           | 1.532            | 22.26        |

Table 16–7. Tschebyscheff Coefficients for 1-dB Passband Ripple

Active Filter Design Techniques 16-59

#### Filter Coefficient Tables

| n  | i      | a i              | b i                   | ki =<br>fCi / fC | Q i          |
|----|--------|------------------|-----------------------|------------------|--------------|
| 1  | 1      | 1.0000           | 0.0000                | 1.000            |             |
| 2  | 1      | 1.1813           | 1.7775                | 1.000            | 1.13         |
| 3  | 1      | 2.7994           | 0.0000                | 0.357            |             |
|    | 2      | 0.4300           | 1.2036                | 1.378            | 2.55         |
| 4  | 1      | 2.4025           | 4.9862                | 0.550            | 0.93         |
|    | 2      | 0.2374           | 1.1896                | 1.413            | 4.59         |
| 5  | 1      | 4.6345           | 0.0000                | 0.216            |             |
|    | 2      | 0.9090           | 2.6036                | 0.908            | 1.78         |
|    | 3      | 0.1434           | 1.0750                | 1.493            | 7.23         |
| 6  | 1      | 3.5880           | 10.464<br>8           | 0.373            | 0.90         |
|    | 2      | 0.4925           | 1.9622                | 1.085            | 2.84         |
|    | 3      | 0.0995           | 1.0826                | 1.491            | 10.46        |
| 7  | 1      | 6.4760           | 0.0000                | 0.154            |             |
|    | 2      | 1.3258           | 4.7649                | 0.665            | 1.65         |
|    | 3      | 0.3067           | 1.5927                | 1.218            | 4.12         |
|    | 4      | 0.0714           | 1.0384                | 1.523            | 14.28        |
| 8  | 1<br>2 | 4.7743<br>0.6991 | 18.151<br>0<br>3.1353 | 0.282<br>0.853   | 0.89<br>2.53 |
|    | 3      | 0.2153           | 1.4449                | 1.285            | 5.58         |
|    | 4      | 0.0547           | 1.0461                | 1.518            | 18.39        |
| 9  | 1      | 8.3198           | 0.0000                | 0.120            |             |
|    | 2      | 1.7299           | 7.6580                | 0.522            | 1.60         |
|    | 3      | 0.4337           | 2.3549                | 0.998            | 3.54         |
|    | 4      | 0.1583           | 1.3174                | 1.349            | 7.25         |
|    | 5      | 0.0427           | 1.0232                | 1.536            | 23.68        |
| 10 | 1      | 5.9618           | 28.037<br>6           | 0.226            | 0.89         |
|    | 2      | 0.8947           | 4.6644                | 0.697            | 2.41         |
|    | 3      | 0.3023           | 1.9858                | 1.094            | 4.66         |
|    | 4      | 0.1233           | 1.2614                | 1.380            | 9.11         |
|    | 5      | 0.0347           | 1.0294                | 1.531            | 29.27        |

|  | Table 16–8. | Tschebyscheff Coefficients for 2-dB Passband Ripple |  |
|--|-------------|-----------------------------------------------------|--|
|--|-------------|-----------------------------------------------------|--|

| n  | i | a i         | b i         | ki =<br>fCi / fC | Q i   |
|----|---|-------------|-------------|------------------|-------|
| 1  | 1 | 1.0000      | 0.0000      | 1.000            |      |
| 2  | 1 | 1.0650      | 1.9305      | 1.000            | 1.30  |
| 3  | 1 | 3.3496      | 0.0000      | 0.299            |      |
|    | 2 | 0.3559      | 1.1923      | 1.396            | 3.07  |
| 4  | 1 | 2.1853      | 5.5339      | 0.557            | 1.08  |
|    | 2 | 0.1964      | 1.2009      | 1.410            | 5.58  |
| 5  | 1 | 5.6334      | 0.0000      | 0.178            |      |
|    | 2 | 0.7620      | 2.6530      | 0.917            | 2.14  |
|    | 3 | 0.1172      | 1.0686      | 1.500            | 8.82  |
| 6  | 1 | 3.2721      | 11.677<br>3 | 0.379            | 1.04  |
|    | 2 | 0.4077      | 1.9873      | 1.086            | 3.46  |
|    | 3 | 0.0815      | 1.0861      | 1.489            | 12.78 |
| 7  | 1 | 7.9064      | 0.0000      | 0.126            |      |
|    | 2 | 1.1159      | 4.8963      | 0.670            | 1.98  |
|    | 3 | 0.2515      | 1.5944      | 1.222            | 5.02  |
|    | 4 | 0.0582      | 1.0348      | 1.527            | 17.46 |
| 8  | 1 | 4.3583      | 20.294<br>8 | 0.286            | 1.03  |
|    | 2 | 0.5791      | 3.1808      | 0.855            | 3.08  |
|    | 3 | 0.1765      | 1.4507      | 1.285            | 6.83  |
|    | 4 | 0.0448      | 1.0478      | 1.517            | 22.87 |
| 9  | 1 | 10.175<br>9 | 0.0000      | 0.098            |      |
|    | 2 | 1.4585      | 7.8971      | 0.526            | 1.93  |
|    | 3 | 0.3561      | 2.3651      | 1.001            | 4.32  |
|    | 4 | 0.1294      | 1.3165      | 1.351            | 8.87  |
|    | 5 | 0.0348      | 1.0210      | 1.537            | 29.00 |
| 10 | 1 | 5.4449      | 31.378<br>8 | 0.230            | 1.03  |
|    | 2 | 0.7414      | 4.7363      | 0.699            | 2.94  |
|    | 3 | 0.2479      | 1.9952      | 1.094            | 5.70  |
|    | 4 | 0.1008      | 1.2638      | 1.380            | 11.15 |
|    | 5 | 0.0283      | 1.0304      | 1.530            | 35.85 |

Table 16–9. Tschebyscheff Coefficients for 3-dB Passband Ripple

Active Filter Design Techniques 16-61

| n  | i | a i    | b i    | fi / fC | Q i  | Tgr0       |
|----|---|--------|--------|---------|------|------------|
|    |   |        |        |         |      |            |
| 1  | 1 | 0.6436 | 0.0000 | 1.554   |     | 0.204<br>9 |
|    |   |        |        |         |      |            |
| 2  | 1 | 1.6278 | 0.8832 | 1.064   | 0.58 | 0.518      |
|    |   |        |        |         |      | 1          |
| 3  | 1 | 1.1415 | 0.0000 | 0.876   |     | 0.843      |
|    |   |        |        |         |      | 7          |
|    | 2 | 1.5092 | 1.0877 | 0.959   | 0.69 |            |
|    |   |        |        |         |      |            |
| 4  | 1 | 2.3370 | 1.4878 | 0.820   | 0.52 | 1.173<br>8 |
|    | 2 | 1.3506 | 1.1837 | 0.919   | 0.81 |            |
|    |   |        |        |         |      |            |
| 5  | 1 | 1.2974 | 0.0000 | 0.771   |     | 1.506      |
|    | 2 | 2.2224 | 1.5685 | 0.798   | 0.56 | 0          |
|    | 3 | 1.2116 | 1.2330 | 0.901   | 0.92 |            |
|    |   |        |        |         |      |            |
| 6  | 1 | 2.6117 | 1.7763 | 0.750   | 0.51 | 1.839      |
|    |   |        |        |         |      | 5          |
|    | 2 | 2.0706 | 1.6015 | 0.790   | 0.61 |            |
|    | 3 | 1.0967 | 1.2596 | 0.891   | 1.02 |            |
| 7  | 1 | 1.3735 | 0.0000 | 0.728   |     | 2.173      |
|    |   |        |        |         |      | 7          |
|    | 2 | 2.5320 | 1.8169 | 0.742   | 0.53 |            |
|    | 3 | 1.9211 | 1.6116 | 0.788   | 0.66 |            |
|    | 4 | 1.0023 | 1.2743 | 0.886   | 1.13 |            |
| 8  | 1 | 2.7541 | 1.9420 | 0.718   | 0.51 | 2.508      |
|    |   |        |        |         |      | 4          |
|    | 2 | 2.4174 | 1.8300 | 0.739   | 0.56 |            |
|    | 3 | 1.7850 | 1.6101 | 0.788   | 0.71 |            |
|    | 4 | 0.9239 | 1.2822 | 0.883   | 1.23 |            |
| 9  | 1 | 1.4186 | 0.0000 | 0.705   |     | 2.843      |
|    |   |        |        |         |      | 4          |
|    | 2 | 2.6979 | 1.9659 | 0.713   | 0.52 |            |
|    | 3 | 2.2940 | 1.8282 | 0.740   | 0.59 |            |
|    | 4 | 1.6644 | 1.6027 | 0.790   | 0.76 |            |
|    | 5 | 0.8579 | 1.2862 | 0.882   | 1.32 |            |
|    |   |        |        |         |      |            |
| 10 | 1 | 2.8406 | 2.0490 | 0.699   | 0.50 | 3.178<br>6 |
|    | 2 | 2.6120 | 1.9714 | 0.712   | 0.54 |            |
|    | 3 | 2.1733 | 1.8184 | 0.742   | 0.62 |            |
|    | 4 | 1.5583 | 1.5923 | 0.792   | 0.81 |            |
|    | 5 | 0.8018 | 1.2877 | 0.881   | 1.42 |            |

# **16.10 References**

D.Johnson and J.Hilburn, *Rapid Practical Designs of Active Filters*, John Wiley & Sons, 1975.

U.Tietze and Ch.Schenk, *Halbleiterschaltungstechnik*, Springer–Verlag, 1980.

H.Berlin, *Design of Active Filters with Experiments*, Howard W.Sams & Co., 1979.

M.Van Falkenburg, *Analog Filter Design*, Oxford University Press, 1982.

S.Franko, *Design with Operational Amplifiers and Analog Integrated Circuits*, McGraw–Hill, 1988

# **Chapter 17**

# **Circuit Board Layout Techniques**

Bruce Carter

# **17.1 General Considerations**

Prior discussions have focused on how to design op amp circuitry, how to use ICs, and the usage of associated passive components. There is one additional circuit component that must be considered for the design to be a success — the printed circuit board on which the circuit is to be located.

#### **17.1.1 The PCB is a Component of the Op Amp Design**

Op amp circuitry is analog circuitry, and is very different from digital circuitry. It must be partitioned in its own section of the board, using special layout techniques.

Printed circuit board effects become most apparent in high-speed analog circuits, but common mistakes described in this chapter can even affect the performance of audio circuits. The purpose of this chapter is to discuss some of the more common mistakes made by designers and how they degrade performance, and provide simple fixes to avoid the problems.

In all but very rare cases, the PCB layout for analog circuitry must be designed such that the effect of the PCB is transparent to the circuit. Any effect caused by the PCB itself should be minimized, so that the operation of the analog circuitry in production will be the same as the performance of the design and prototype.

#### **17.1.2 Prototype, Prototype, PROTOTYPE!**

Normal design cycles, particularly of large digital boards, dictate layout of the PCB as soon as possible. The digital circuitry has been simulated, but in most cases, the production PCB itself is the prototype, and may even be sold to a customer. Digital designers can correct small mistakes by implementing cuts and jumpers, reprogramming gate arrays or flash memories, and go on to the next project. This is not the case with analog circuitry. Some of the common design mistakes discussed in this chapter cannot be corrected by the cut and jumper method. They can and will render the entire PCB unusable. It is very important for the digital designer, who is used to cuts and jumpers, to read and understand this chapter prior to releasing a board to a layout service.

A little care, taken up front, can save a board worth thousands of dollars from becoming scrap because of blunders in a tiny section of analog circuitry. This author has been the unfortunate recipient of a simple analog circuit designed by another engineer, who was accustomed to the cut and jumper method of correcting his mistakes. This resulted in a design that was full of mistakes. Not only was the op amp hooked up with inverting and noninverting inputs reversed, but an RC time constant had to be added to prevent a race condition. Repercussions from these mistakes, and associated rework problems, caused literally hundreds of hours to be lost from a tight production schedule. Prototyping this circuit would have taken less than a day. PROTOTYPE ALL ANALOG CIRCUITRY!

### **17.1.3 Noise Sources**

Noise is the primary limitation on analog circuitry performance. Internal op amp noise is covered in Chapter 10. Other types of noise include:

- Conducted Emissions — noise that the analog circuitry generates through its connections to other circuits. This is usually negligible in analog circuitry, unless it is high power (such as an audio amplifier that draws heavy currents from its power supply).
- Radiated Emissions — noise that the analog circuitry generates, or transmits, through the air. This is also usually negligible in analog circuitry, unless it is high frequency such as video.
- Conducted Susceptibility — noise from external circuitry that is conducted into the analog circuit through its connections to other circuits. Analog circuitry must be connected to the "outside world" by at least a ground connection, a power connection, an input, and an output. Noise can be conducted into the circuit through all of these paths, as well as any others that are present.
- Radiated Susceptibility — noise that is received through the air (or transmitted into the analog circuitry) from external sources. Analog circuitry, in many cases, resides on a PCB that may have high-speed digital logic including DSP chips. High-speed clocks and switching digital signals create considerable radio frequency interference (RFI). Other sources of radiated noise are endless: the switching power supply in a digital system, cellular telephones, broadcast radio and TV, fluorescent lighting, nearby PCs, lightning in thunderstorms, and so on. Even if the analog circuitry is primarily audio in frequency, RFI may produce noticeable noise in the output.

# **17.2 PCB Mechanical Construction**

It is important to choose a PCB with the right mechanical characteristics for the application.

# **17.2.1 Materials — Choosing the Right One for the Application**

PC Board materials are available in various grades, as defined by the National Electrical Manufacturers Association (NEMA). It would be very convenient for designers if this organization was closely allied with the electronics industry — controlling parameters such as resistivity and dielectric constant of the material. Unfortunately, that is not the case. NEMA is an electrical safety organization, and the different PCB grades primarily describe the flammability, high temperature stability, and moisture absorption of the board. Therefore, specifying a given NEMA grade does not guarantee electrical parameters of the material. If this becomes critical for an application, consult the manufacturer of the raw board stock.

Laminated materials are designated with FR (flame resistant) and G grades. FR–1 is the least flame resistant, and FR–5 is the most. G10 and G11 have special characteristics as described in Table 17–1.

| GRADE DESIGNATION | MATERIAL/COMMENTS                                                                                                     |
|-------------------|-----------------------------------------------------------------------------------------------------------------------|
| FR–1              | Paper/phenolic: room temperature punchable, poor moisture resistance.                                                 |
| FR–2              | Paper/phenolic: suitable for single-sided PCB consumer equipment, good moisture re<br>sistance.                       |
| FR–3              | Paper/epoxy: designed for balance of good mechanical and electrical characteristics.                                  |
| FR–4              | Glass cloth/epoxy: excellent mechanical and electrical properties.                                                    |
| FR–5              | Glass cloth/epoxy: high strength at elevated temperatures, self-extinguishing.                                        |
| G10               | Glass cloth/epoxy: high insulation resistance, highest bond strength of glass laminates,<br>high humidity resistance. |
| G11               | Glass cloth/epoxy: high flexural strength retention at high temperature, extreme resist<br>ance to solvents.          |

Table 17–1. PCB Materials

Do not use FR–1. There are many examples of boards with burned spots, where high wattage components have heated a section of the board for a period of time. This grade of PCB material has more in common with cardboard than anything else.

FR–4 is commonly used in industrial-quality equipment, while FR–2 is used in high-volume consumer applications. These two board materials appear to be industry standards. Deviating from these standards can limit the number of raw board material suppliers and PCB houses that can fabricate the board because their tooling is already set up for these materials. Nevertheless, there are applications in which one of the other grades may make sense. For very high frequency applications, it may even be necessary to consider Teflon or even ceramic board substrate. One thing can be counted on, however: the more exotic the board substrate, the more expensive it will be.

In selecting a board material, pay careful attention to the moisture absorption. Just about every desirable performance characteristic of the board will be negatively impacted by moisture. This includes surface resistance of the board, dielectric leakage, high-voltage breakdown and arcing, and mechanical stability. Also, pay attention to the operating temperature. High operating temperatures can occur in unexpected places, such as in proximity to large digital ICs that are switching at high speeds. Be aware that heat rises, so if one of those 500-pin monster ICs is located directly under a sensitive analog circuit, both the PCB and circuit characteristics may vary with the temperature.

After the board substrate material has been selected, the next decision is how thick to make the copper foil laminated to it. For most applications, 1-ounce copper is sufficient. If the circuit consumes a lot of power, 2-ounce may be better. Avoid -ounce copper, because it tends to break between the trace and the pad.

### **17.2.2 How Many Layers are Best?**

Depending on the complexity of the overall circuitry being designed, a designer must decide how many layers the PCB should be.

#### **17.2.2.1 Single-Sided**

Very simple consumer electronics are sometimes fabricated on single-sided PCBs, keeping the raw board material inexpensive (FR–1 or FR–2) with thin copper cladding. These designs frequently include many jumper wires, simulating the circuit routing on a doublesided board. This technique is only recommended for low-frequency circuitry. For reasons described below, this type of design is extremely susceptible to radiated noise. It is harder to design a board of this type, because of the many things can go wrong. Many complex designs have been successfully implemented with this technique, but they require a lot of forethought. An example is a television set that puts all of the analog circuitry on a single-sided board at the bottom of the case, and uses the metallized CRT itself to shield the board from a separate digital tuning board near the top of the set. Be prepared to get creative if the design demands high volume, low cost PCBs.

If a single-sided PCB is a requirement, remember the trace resistance! The op amp is not a 3-terminal device (inverting input, noninverting input, and output). It is a 7-terminal device as shown in Figure 17–1.

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and connections shown in the diagram:

1. **Operational Amplifier (Op-Amp) Symbol**: 
   - The central component is a triangle, which represents the op-amp. The triangle has three main terminals: two inputs and one output.
   - The input terminals are labeled as "IN-" and "IN+".
     - "IN-" is the inverting input, located at the top left of the triangle.
     - "IN+" is the non-inverting input, located at the bottom left of the triangle.
   - The output terminal is labeled as "OUT" and is located at the right side of the triangle.

2. **Power Supply Connections**:
   - The op-amp has two power supply connections:
     - "V+" is the positive power supply, connected to the top of the op-amp symbol.
     - "V-" is the negative power supply, connected to the bottom of the op-amp symbol.
   - These power supply connections are typically used to power the op-amp and are essential for its operation.

3. **Ground and Load Return**:
   - At the bottom of the diagram, there is a horizontal line labeled "GROUND". This represents the common ground connection for the circuit.
   - To the right of the ground line, there is a resistor symbol connected to a line labeled "LOAD RETURN". This indicates that the load connected to the output of the op-amp returns to ground through this resistor.

In summary, the diagram shows an op-amp with its inverting and non-inverting inputs, output, power supply connections, and a load return path to ground. This is a typical representation of an op-amp circuit used in various electronic applications.
```

### Figure 17–1. Op Amp Terminal Model

Resistance in the power leads of the device must be taken into account, as well as resistance between the return for the inputs and the load. Both the input and load must return somewhere. If these are at different potentials due to trace resistance, there can be problems.

#### **17.2.2.2 Double-Sided**

The next level of complexity is double-sided. Although there are some double-sided FR–2 boards, they are more commonly fabricated with FR–4 material. The increased strength of FR–4 material supports vias better. Doubled-sided boards are easier to route because there are two layers of foil, and it is possible to route signals by crossing traces on different layers. Crossing traces, however, is not recommended for analog circuitry. Wherever possible, the bottom layer should be devoted to a ground plane, and all other signals routed on the top layer. A ground plane provides several benefits:

- Ground is frequently the most common connection in the circuit. Having it continuous on the bottom layer usually makes the most sense for circuit routing.
- It increases mechanical strength of the board.
- It lowers the impedance of all ground connections in the circuit, which reduces undesirable conducted noise.
- It adds a distributed capacitance to every net in the circuit — helping to suppress radiated noise.
- It acts a shield to radiated noise coming from underneath the board.

#### **17.2.2.3 Multi-Layer**

Double-sided boards, in spite of their benefits, are not the best method of construction, especially for sensitive or high-speed designs. The most common board thickness is 1.5 mm. This separation is too great for full realization of some of the benefits listed above. Distributed capacitance, for example, is very low due to the separation.

Critical designs call for multi-layer boards. Some of the reasons are obvious:

- Better routing for power as well as ground connections. If the power is also on a plane, it is available to all points in the circuit simply by adding vias.
- Other layers are available for signal routing, making routing easier.
- There will be distributed capacitance between the power and ground planes, reducing high frequency noise.

There are other reasons for multi-layer boards, however, that may not be obvious or intuitive.

- Better EMI/RFI rejection. There is due to the image plane effect, which has been known since the time of Marconi. When a conductor is placed close to a parallel conductive surface, most of the high frequency currents will return directly under the conductor, flowing in the opposite direction. This mirror image of the conductor within the plane creates a transmission line. Since currents are equal and opposite in the transmission line, it is relatively immune to radiated noise. It also couples the signal very efficiently. The image plane effect works equally well with ground and power planes, but they must be continuous. Any gap or discontinuity causes the beneficial effects to quickly vanish. There is more on this in the following paragraphs.
- Reduced overall project cost for small production runs. Although multi-layer boards are more expensive to manufacture, EMI/RFI requirements from the FCC or other agencies may require expensive testing of the design. If there are problems, it can force a complete redesign of the PCB, leading to additional rounds of testing. A multi-layer PCB can have as much as 20-dB better EMI/RFI performance over a 2-layer PCB. If production volumes are going to be small, it makes sense to make a better PCB to begin with, than try to cut costs and take the risk of failing \$25,000 to \$50,000 tests.

#### **17.2.3 Board Stack-Up — The Order of Layers**

There has been a lot of confusion in the past over what is the optimum order for PCB layers. Take, for example, a 4-layer board consisting of two signal layers, a power plane, and a ground plane. Is it better to route the signal traces between the layers, thus providing shielding for the signal traces – or is it better to make the ground and power planes the two inner planes?

In considering this question, it is important to remember that no matter what is decided, there will still be signals exposed on one or both of the top and bottom planes. The leads of the op amp PCB package, and the traces on the board leading to nearby passive components and feed-throughs will be exposed. Therefore, any shielding effects are compromised. It is far better to take advantage of the distributed capacitance between the power and ground plane by making them internal.

Another advantage of placing the planes internally is that the signal traces are available for probing and modification on the top and bottom layers. Anyone who has had to change connections on buried traces will appreciate this feature.

For more than four layers, it is a general rule to shield higher speed signals between the ground and power planes, and route slower signals on the outer layers.

# **17.3 Grounding**

Good grounding is a system-level design consideration. It should be planned into the product from the first conceptual design reviews.

### **17.3.1 The Most Important Rule: Keep Grounds Separate**

Separate grounding for analog and digital portions of circuitry is one of the simplest and most effective methods of noise suppression. One or more layers on multi-layer PCBs are usually devoted to ground planes. If the designer is not careful, the analog circuitry will be connected directly to these ground planes. The analog circuitry return, after all, is the same net in the netlist as digital return. Autorouters respond accordingly and connect all of the grounds together, creating a disaster.

After the fact separation of grounds on a mixed digital and analog board is almost impossible. Every ground connection in the analog circuitry must be lifted from the board and connected together. For surface mount boards, this results in a colossal mess of "tombstoned" passive components and floating IC leads.

### **17.3.2 Other Ground Rules**

- Ground and power planes are at the same ac potential, due to decoupling capacitors and distributed capacitance. Therefore, it is important to isolate the power planes as well.
- Do not overlap digital and analog planes (Figure 17–2). Place analog power coincident with analog ground, and digital power coincident with digital ground. If any portion of analog and digital planes overlap, the distributed capacitance between the overlapping portions will couple high-speed digital noise into the analog circuitry. This defeats the purpose of isolated planes.

Here is the image describtion:
```
The image is a diagram illustrating the correct and incorrect ways to route digital and analog signals through a shared cable or conduit. 

On the left side, labeled "RIGHT," the diagram shows a cross-section of a cable with four conductors. The conductors are labeled as follows:
- DIGITAL +
- DIGITAL -
- ANALOG +
- ANALOG -

The digital and analog conductors are separated by a gray area, which likely represents insulation or shielding to prevent interference between the digital and analog signals. The digital signals are on one side of the cable, and the analog signals are on the other side, ensuring minimal interference.

On the right side, labeled "WRONG," the diagram shows a similar cross-section of a cable with the same four conductors. However, in this case, the conductors are not properly separated:
- DIGITAL +
- ANALOG +
- DIGITAL -
- ANALOG -

The digital and analog conductors are adjacent to each other, which can lead to interference between the signals. The diagram also includes a visual representation of signal interference, with wavy lines indicating noise or distortion affecting the signals.

In summary, the image emphasizes the importance of proper separation and shielding of digital and analog signals within a cable to prevent interference and ensure signal integrity.
```

Figure 17–2. Digital and Analog Plane Placement

 Separate grounds does not mean that the grounds are electrically separate in the system. They have to be common at some point, preferably a single, low-impedance point. System-wise, there is only one ground, and it is the electrical safety ground in an ac-powered system or battery ground in a dc-powered system. Everything else "returns" to that ground. It would be a good idea to develop the discipline to refer to everything that is not a ground as a return. All returns should be connected together at a single point, which is system ground. At some point, this will be the chassis. It is important to avoid ground loops by multiple connections to the chassis. Ensuring only one chassis ground point is one of the most difficult aspects of system design.

Here is the image describtion:
```
The image depicts a schematic representation of a power supply system that serves both digital and analog circuitry. Here is a detailed description:

1. **Power Source**: On the left side of the image, there is a power plug connected to a power supply unit. This unit is grounded, as indicated by the ground symbol connected to it.

2. **Power Supply Unit**: The power supply unit has two output terminals, marked with a plus (+) and a minus (-) sign, indicating the positive and negative outputs, respectively.

3. **Digital Circuitry**: 
   - Above the power supply unit, there is a section labeled "DIGITAL CIRCUITRY."
   - This section contains a logic gate symbol, specifically an AND gate with a bubble on the output, indicating a NAND gate.
   - The digital circuitry is connected to the power supply unit through a wire that connects to the ground symbol.

4. **Analog Circuitry**: 
   - To the right of the digital circuitry, there is a section labeled "ANALOG CIRCUITRY."
   - This section contains an operational amplifier symbol, with the positive and negative input terminals marked.
   - The analog circuitry is also connected to the power supply unit through a wire that connects to the ground symbol.

5. **Ground Connections**: 
   - Both the digital and analog circuitry sections have their own ground symbols, which are connected to the common ground point of the power supply unit.

6. **Additional Box**: 
   - To the right of the power supply unit, there is another box with two terminals marked with a plus (+) and a minus (-) sign, similar to the power supply unit.
   - This box is connected to the power supply unit, indicating that it might be another power source or a load.

The image illustrates the separation of digital and analog circuitry, each with its own ground connection, and how they are powered by a common power supply unit.
```

**POWER SUPPLY and/or BATTERY**

Figure 17–3. Separate Grounds

- If at all possible, dedicate separate connector pins to separate returns, and combine the returns only at system ground. Aging and repeated mating causes connector pins to increase in contact resistance, so several pins are needed. Many digital boards consist of many layers and hundreds or thousands of nets. The addition of one more net is seldom an issue, but the addition of several connector pins almost always is. If this cannot be done, then it will be necessary to make the two returns a single net on the PCB — with very special routing precautions.
- It is important to keep digital signals away from analog portions of the circuit. It makes little sense to isolate planes, keep analog traces short, and place passive

components carefully if there are high-speed digital traces running right next to the sensitive analog traces. Digital signals must be routed around analog circuitry, and not overlap analog ground and power planes. If not, the design will include a new schematic symbol shown in Figure 17–4 — the broadcasting antenna!

Most digital clocks are high enough in frequency that even small capacitances between traces and planes can couple significant noise. Remember that it is not only the fundamental frequency of the clock that can cause a potential problem, but also the higher frequency harmonics.

Here is the image describtion:
```
The image depicts a schematic representation of an electronic circuit layout, focusing on the separation of analog and digital ground planes to minimize interference. 

1. **Analog Ground Plane**: 
   - Located at the top section of the image.
   - Contains a high-impedance analog input, represented by a triangle symbol (typically an operational amplifier or similar analog component).
   - There is an illustration of a radio tower emitting signals, indicating the presence of high-frequency analog signals.

2. **Digital Ground Plane**: 
   - Located at the bottom section of the image.
   - Contains a digital component, represented by a logic gate symbol (possibly an AND gate).
   - The digital ground plane is separated from the analog ground plane to prevent noise and interference from the high-speed digital signals affecting the sensitive analog inputs.

3. **High-Speed Digital Signal**:
   - A line runs horizontally across the image, connecting the analog and digital sections.
   - This line represents a high-speed digital signal that crosses between the analog and digital ground planes.

The separation of ground planes is a common practice in circuit design to ensure that digital noise does not interfere with analog signal integrity, especially in high-impedance and high-frequency applications.
```

Figure 17–4. Broadcasting From PCB Traces

 It is a good idea to locate analog circuitry as close as possible to the I/O connections of the board. Digital designers, used to high current ICs, will be tempted to make a 50-mil trace run several inches to the analog circuitry thinking that reducing the resistance in the trace will help get rid of noise. What they have actually done is create a long, skinny capacitor that couples noise from digital ground and power planes into the op amp, making the problem worse!

## **17.3.3 A Good Example**

Figure 17–5 shows one possible board layout. In this system, all electronics, including the power supply, reside on one PCB. Three separate and isolated ground/power planes are employed: one for power, one for digital, and one for analog. Power and ground connections from digital and analog sections of the board are combined only in the supply section, and are combined in close proximity. High-frequency conducted noise on the power lines is limited by inductors (chokes). In this case, the designer has even located low frequency analog circuitry close to low speed digital, keeping high frequency digital and analog physically apart on the board. This is a good, careful design that has a high likelihood of success — providing that good layout and decoupling rules are also followed.

Here is the image describtion:
```
The image appears to be a block diagram of an electronic circuit layout, possibly for a printed circuit board (PCB). The layout is divided into four main sections: POWER SUPPLY, DIGITAL, ANALOG, and a central area where these sections intersect.

1. **POWER SUPPLY Section:**
   - Located in the top-left quadrant of the diagram.
   - Contains a label "POWER SUPPLY."
   - There are connectors indicated on the left side of this section, with arrows pointing up and down, suggesting connections for power input or output.

2. **DIGITAL Section:**
   - Located in the top-right quadrant of the diagram.
   - Contains a label "DIGITAL."
   - There is a connector indicated on the right side of this section, with an arrow pointing to the right, suggesting a connection for digital signals.
   - The frequency range in this section is indicated with an arrow pointing upwards labeled "HIGH" at the top and "LOW" at the bottom, suggesting that the frequency increases as you move up.

3. **ANALOG Section:**
   - Located in the bottom-left quadrant of the diagram.
   - Contains a label "ANALOG."
   - The frequency range in this section is indicated with an arrow pointing to the right labeled "HIGH" on the left and "LOW" on the right, suggesting that the frequency decreases as you move to the right.

4. **Central Area:**
   - This area is where the POWER SUPPLY, DIGITAL, and ANALOG sections intersect.
   - There is a symbol representing a transistor or a similar component, with a label "Vcc" indicating the supply voltage.
   - The component is connected to an inductor (represented by a coil symbol) and has multiple arrows pointing outwards, indicating connections to other parts of the circuit.

Overall, the diagram seems to illustrate the layout and connections of different sections of an electronic circuit, with specific emphasis on the power supply, digital, and analog areas, and how they are interconnected.
```

Figure 17–5. A Careful Board Layout

## **17.3.4 A Notable Exception**

There is one case where it is necessary to combine analog and digital signals on the analog ground plane. Analog to digital (A/D) and digital to analog (D/A) converters are packaged as ICs with analog and digital ground pins coming out of the package. One might assume, based on the previous discussion, that the digital ground pin should be connected to digital ground and the analog ground pin to analog ground. That, however, is not correct.

The pin names analog ground and digital ground refer to internal connections in the IC, not the plane to which they should be connected. Both should connect to the analog ground plane. The connection would have been made inside the IC, but it is impossible to get low enough impedance at the typical geometries inside ICs. The IC designer actually counts on the end user to supply a low impedance connection outside the IC. Otherwise, the performance of the converter will be worse than specified.

One might suspect that the digital portions of the converter would make circuit performance worse by coupling digital switching noise onto the analog ground and power plane. Converter designers realize this, and design digital portions without a lot of output power to minimize switching transients. If the converter does not drive large fanouts, this should not be a problem. Be sure to properly decouple the logic supply for the converter to analog ground (see the following paragraphs).

# **17.4 The Frequency Characteristics of Passive Components**

Choosing the right passive components for an analog design is important. In most cases, a right passive component will fit on the same pads as a wrong passive component, but not always. Start the design process by carefully considering the high frequency characteristics of passive components, and putting the correct part outline on the board from the start.

Most designers are totally ignorant of the frequency limitations of the passive components they use in analog circuitry. Passive components have limited frequency ranges, and operation of the part outside of that range can have some very unexpected results. One might think that this discussion only applies to high-speed analog circuits. But high frequencies that are radiated or conducted into a low-speed circuit will affect passive components as well. For example: a simple op amp low-pass filter may well turn into a high-pass filter at RF frequencies.

### **17.4.1 Resistors**

High-frequency performance of resistors is approximated by the schematic shown in Figure 17–6.

Here is the image describtion:
```
The image depicts an electrical circuit diagram consisting of three components: an inductor (L_L), a resistor (R), and a capacitor (C_P). 

- The inductor (L_L) is represented by a coiled wire symbol and is placed in series with the resistor.
- The resistor (R) is represented by a zigzag line and is connected in series with the inductor.
- The capacitor (C_P) is represented by two parallel lines and is connected in parallel with the series combination of the inductor and the resistor.

The circuit starts from the left with an open terminal, followed by the inductor (L_L), then the resistor (R), and finally another open terminal on the right. The capacitor (C_P) bridges the connection between the two points where the inductor and resistor meet, forming a parallel branch.
```

Here is the image describtion:
```
The image is a text label that reads "Figure 17–6. Resistor High-Frequency Performance." The text is in a black font on a white background. The label appears to be a caption or title for a figure in a document, likely a technical or academic paper, that discusses the performance characteristics of resistors when subjected to high-frequency signals. The figure number "17–6" suggests that it is part of a larger series of figures in a chapter or section of the document.
```

Resistors are typically one of three types: wire-wound, carbon composition, and film. It does not take a lot of imagination to understand how wire-wound resistors can become inductive because they are coils of resistive wire. Most designers are not aware of the internal construction of film resistors, which are also coils of thin metallic film. Therefore, film resistors are also inductive at high frequencies. The inductance of film resistors is lower, however, and values under 2 kΩ are usually suitable for high frequency work.

The end caps of resistors are parallel, and there will be an associated capacitance. Usually, the resistance will make the parasitic capacitor so "leaky" that the capacitance does not matter. For very high resistances, the capacitance will appear in parallel with the resistance, lowering its impedance at high frequencies.

### **17.4.2 Capacitors**

High-frequency performance of capacitors is approximated by the schematic shown in FIgure 17–7.

Here is the image describtion:
```
The image depicts an electrical circuit that includes a combination of passive components: an inductor (L), a capacitor (C), and resistors. The circuit can be described as follows:

1. **Inductor (L)**: This is represented by a coiled symbol and is placed in series with the capacitor (C).

2. **Capacitor (C)**: This is represented by two parallel lines and is connected in series with the inductor (L).

3. **ESR (Equivalent Series Resistance)**: This is a resistor symbol placed in series with the capacitor (C). It represents the inherent resistance within the capacitor.

4. **Parallel Resistor (RP)**: This resistor is connected in parallel with the series combination of the inductor (L), capacitor (C), and ESR. It is represented by a standard resistor symbol.

The circuit can be interpreted as an RLC circuit with an additional parallel resistor (RP) and the ESR of the capacitor taken into account. The inductor (L) and capacitor (C) form a series resonant circuit, and the ESR represents the non-ideal characteristics of the capacitor. The parallel resistor (RP) could be used to model losses or other parallel resistive effects in the circuit.
```

#### Figure 17–7. Capacitor High-Frequency Performance

Capacitors are used in analog circuitry for power supply decoupling and as filter components. For an ideal capacitor, reactance decreases by the formula:

$$\mathbf{X\_{C}} = \frac{\mathbf{1}}{\langle 2\pi \mathbf{fC} \rangle} \tag{17-4}$$

Where:

XC capacitive reactance in Ohms

F frequency in Hz

C capacitance in microfarads

Therefore, a 10-µF electrolytic capacitor has a reactance of 1.6 Ω at 10 kHz, and 160-µΩ at 100 MHz. Right?

In reality, one will never see the 160 µΩ with the electrolytic capacitor. Film and electrolytic capacitors have layers of material wound around each other, which creates a parasitic inductance. Self-inductance effects of ceramic capacitors are much smaller, giving them a higher operating frequency. There is also some leakage current from plate to plate, which appears as a resistance in parallel with the capacitor, as well as resistance within the plates themselves, which add a parasitic series resistance. The electrolyte itself in electrolytic capacitors is not perfectly conductive (to reduce leakage current). These resistances combine to create the equivalent series resistance (ESR). The capacitors used for decoupling should be low ESR types, as any series resistance limits the effectiveness of the capacitor for ripple and noise rejection. Elevated temperatures also severely increase ESR, and can be permanently destructive to capacitors. Therefore, if an aluminum electrolytic will be subjected to high temperatures, use the high-temperature grade (105-C), not the low temperature grade (85-C).

For leaded parts, the leads themselves also add a parasitic inductance. For small values of capacitance, it is important to keep the lead lengths short. The combination of parasitic inductance and capacitance can produce resonant circuits! Assuming a lead self-inductance of 8 nH/cm (see the following paragraphs), a 0.01-µF capacitor with two 1-cm leads will resonate at 12.5 MHz. This effect was well known to engineers many decades ago, who designed vacuum tube-based products with leaded components. Woe be to any hobbyist restoring antique radios that is unaware of this effect!

If electrolytic capacitors are used in a design, make sure that the polarity is correctly observed. The positive terminal of the capacitor must be connected to the more positive of two dc potentials. If there is any doubt whatsoever which polarity is correct, design calculations must continue until it is known, or a prototype must be built. Incorrect polarity of electrolytic capacitors will cause them to conduct dc current, in most cases destroying the part — and probably the rest of the circuit as well. If there is a rare case in which there will be both polarities present, use a nonpolarized electrolytic (which is constructed by connecting two polarized electrolytic capacitors in series). Of course, one can always connect two capacitors in series on the PCB, keeping in mind that the effective capacitance will be cut in half for equal values of capacitor.

### **17.4.3 Inductors**

High frequency performance of inductors is approximated by the schematic shown in Figure 17–8.

Here is the image describtion:
```
The image depicts an electrical circuit diagram consisting of three components: an inductor (L), a resistor (R_S), and a capacitor (C_P). 

- The inductor (L) is represented by a coiled wire symbol and is placed in series with the resistor.
- The resistor (R_S) is represented by a zigzag line and is also in series with the inductor.
- The capacitor (C_P) is represented by two parallel lines and is connected in parallel with the series combination of the inductor and the resistor.

The circuit has two terminals, one on the left and one on the right, indicating points where the circuit can be connected to an external power source or another circuit. The inductor and resistor are connected in series between these two terminals, while the capacitor is connected across (in parallel with) the series combination of the inductor and resistor.
```

#### Figure 17–8. Inductor High-Frequency Performance

Inductive reactance is described by the formula:

$$\mathbb{X}\_{\mathsf{L}} = 2\pi\mathsf{L} \tag{17-2}$$

Where:

XL inductive reactance in Ohms F frequency in Hz L inductance in Henrys

Therefore, a 10-mH inductor has a reactance of 628 Ω at 10 kHz, which increases to 6.28 MΩ at 100 MHz. Right?

In reality, one will never see the 6.28 MΩ with this inductor. Parasitic resistances are easy to understand — the inductor is constructed of wire, which has a given resistance per unit length. Parasitic capacitance is harder to visualize, unless one considers the fact that each turn of wire in the inductor is located next to adjacent turns, forming a capacitor. This parasitic capacitance limits the upper frequency of this inductor to under 1 MHz. Even small wire-wound inductors start to become ineffective in the 10 MHz to 100 MHz range.

### **17.4.4 Unexpected PCB Passive Components**

In addition to the obvious passive components above, the PCB itself has characteristics that form components every bit as real as those discussed previously — just not as obvious.

#### **17.4.4.1 PCB Trace Characteristics**

The layout pattern on a PCB can make it susceptible to radiated noise. A good layout is one that minimizes the susceptibility of analog circuitry to as many radiated noise sources as possible. Unfortunately, there is always a level of RF energy that will be able to upset the normal operation of the circuit. If good design techniques are followed, that level will be one that the circuit never encounters in normal operation.

#### **17.4.4.1.1 Trace Antennas**

A board is susceptible because the pattern of traces and component leads form antennas. Antenna theory is a complex subject, well beyond the scope of this book. Nevertheless, a few basics are presented here.

One basic type of antenna is the whip, or straight conductor. This antenna works because a straight conductor has parasitic inductance, and therefore can concentrate flux from external sources. The impedance of any straight conductor has a resistive and an inductive component:

$$
\mathsf{Z} = \mathsf{R} + \mathsf{j}\mathsf{o}\mathsf{L} \tag{7-3}
$$

For dc and low frequencies, resistance is the major factor. As the frequency increases, however, the inductance becomes more important. Somewhere in the range of 1 kHz to 10 kHz, the inductive reactance exceeds the resistance, so the conductor is no longer a low resistance connection, but rather an inductor.

The formula for the inductance of a PCB trace is:

$$\mathsf{L}\langle\mu\mathsf{H}\rangle = \mathsf{0.0002X} \cdot \left[ \ln\left(\frac{2\mathsf{X}}{\mathsf{W}+\mathsf{H}}\right) + \mathsf{0.2235}\left(\frac{\mathsf{W}+\mathsf{H}}{\mathsf{X}}\right) + \mathsf{0.5} \right] \tag{17-4}$$

Where:

X length of the trace

W width of the trace

H thickness of the trace

The inductance is relatively unaffected by the diameter, since it varies as the logarithm of the circumference. Common wires and PCB traces vary between 6 nH and 12 nH per centimeter.

For example, a 10 cm PCB trace has a resistance of 57 mΩ and an inductance of 8 nH per cm. At 100 kHz, the inductive reactance reaches 50 mΩ. At frequencies above 100 kHz, the trace is inductive — not resistive.

A rule of thumb for whip antennas is that they begin to couple significant energy at about 1/20 of the wavelength of the received signal, peaking at the wavelength. Therefore, the 10-cm conductor of the previous paragraph will begin to be a fairly good antenna at frequencies above 150 MHz. Remember that although the clock generator on a digital PCB may not be operating at a frequency as high as 150 MHz, it approximates a square wave. Square waves will have harmonics throughout the frequency range where PCB conductors become efficient antennas. If through-hole components are mounted in a way that leaves significant lead length, those component leads also become antennas, particularly if they are bent.

Another major type of antenna is the loop. The inductance of a straight conductor is dramatically increased by bending it into partial or complete loops. Increased inductance lowers the frequency at which the conductor couples radiated signals into the circuit.

Without realizing it, most digital designers are well versed in loop antenna theory. They know not to make loops in critical signal pathways. Some designers, however, that would never think of making a loop with a high speed clock or reset signal will turn right around and create a loop by the technique they use for layout of the analog section of the board. Loop antennas constructed as loops of wire are easy to visualize. What is not as obvious is that slot antennas are just as efficient. Consider the three cases shown in Figure 17–9.

Here is the image describtion:
```
The image consists of three diagrams labeled as Version A, Version B, and Version C. Each diagram illustrates a different configuration of a signal and return path in an electronic circuit, specifically focusing on the layout of the signal and ground lines.

**Version A:**
- This version shows a simple circuit with a signal line and a return path.
- The signal line runs from the top component to the bottom component.
- The return path runs parallel to the signal line but is separated by a significant distance, creating a large loop area.
- The diagram highlights the presence of electric (E) and magnetic (H) fields within the loop area, indicating potential electromagnetic interference (EMI) issues due to the large loop area.

**Version B:**
- This version shows an improved layout with a ground plane.
- The signal line runs from the top component to the bottom component, similar to Version A.
- The return path is now directly underneath the signal line, following the same path but on a different layer, effectively minimizing the loop area.
- The ground plane is shown as a shaded area, providing a continuous return path for the signal.
- The reduced loop area helps in minimizing EMI.

**Version C:**
- This version shows an even more optimized layout with a ground plane.
- The signal line runs from the top component to the bottom component, similar to the previous versions.
- The return path is directly underneath the signal line, following the same path on the ground plane, ensuring the smallest possible loop area.
- The ground plane is shown as a shaded area, providing a continuous and close return path for the signal.
- This configuration further minimizes EMI and is considered the best practice for signal integrity.

Overall, the image illustrates the importance of minimizing the loop area between the signal and return paths to reduce electromagnetic interference and improve signal integrity in electronic circuit design.
```

Figure 17–9. Loop and Slot Antenna Board Trace Layouts

Version **A** is a poor design. It does not use an analog ground plane at all. A loop is formed by the ground and signal traces. An electric field E and perpendicular magnetic field H are created, and form the basis of a loop antenna. A rule of thumb for loop antennas is that the length of each leg is equal to half the most efficiently received wavelength. Remember, however, that even at 1/20 of the wavelength, the loop will still be a fairly efficient antenna. Version **B** is a better design, but there is intrusion into the ground plane, presumably to make room for a signal trace. A much smaller slot antenna is formed by the difference in pathways between signal and return. A second loop is created by the cutout for the IC.

Version **C** is the best design. Signal and return are coincident with each other, eliminating loop antenna effects completely. Note that there is still a cutout for the IC, but it is located away from the return path for the signal.

#### **17.4.4.1.2 Trace Reflections**

Reflections and matching are closely related to loop antenna theory, but different enough to warrant their own discussion.

When a PCB trace turns a corner at a 90 angle, a reflection can occur. This is primarily due to the change of width of the trace. At the apex of the turn, the trace width is increased to 1.414 times its width. This upsets the transmission line characteristics, especially the distributed capacitance and self–inductance of the trace — resulting in the reflection. It is a given that not all PCB traces can be straight, and so they will have to turn corners. Most CAD systems give some rounding effect on the trace. Sharp 90 corners in traces are a relic of the tape up days of PCB layout. The rounding effects of CAD programs, however, still do not necessarily maintain constant width as the trace rounds the corner. Figure 17–10 shows progressively better techniques of rounding corners. Only the last example maintains constant trace width and minimizes reflections. Most CAD programs now support these methods, but they can entail a little more work to master.

Here is the image describtion:
```
The image shows three different design approaches for creating a corner in a structure, likely related to printed circuit board (PCB) design or similar engineering contexts. The three approaches are labeled "WORST," "BETTER," and "BEST," indicating a progression from a less optimal to a more optimal design.

1. **WORST**:
   - The corner is a sharp 90-degree angle.
   - The lines forming the corner meet directly without any rounding or additional features.
   - This design is likely considered the worst due to potential issues such as stress concentration, signal integrity problems, or manufacturing difficulties.

2. **BETTER**:
   - The corner is still a 90-degree angle but has been modified to include a chamfer.
   - The chamfer is created by cutting off the corner at an angle, forming two new edges.
   - The dimensions of the chamfer are indicated: the length of the chamfer is 2W, and the width of the chamfer is 1W minimum, where W represents the width of the lines forming the corner.
   - This design is an improvement over the sharp corner as it helps to reduce stress concentration and may improve manufacturability and performance.

3. **BEST**:
   - The corner is rounded, forming a smooth curve instead of a sharp angle.
   - This rounded design is considered the best as it further reduces stress concentration, improves signal integrity, and enhances manufacturability.
   - The exact radius of the curve is not specified, but the smooth transition is visually evident.

Overall, the image illustrates the importance of corner design in engineering, showing how progressively refining the corner from a sharp angle to a rounded curve can lead to better performance and reliability.
```

## Figure 17–10. PCB Trace Corners

A suggestion for the advanced PCB layout engineer: leave rounding to the last step before tear-dropping and flood-filling. Otherwise, the CAD program will slow down doing numerical calculations as the traces are moved around during routing.

#### **17.4.4.2 Trace-to-Plane Capacitors**

PCB traces, being composed of foil, form capacitance with other traces that they cross on other layers. For two traces crossing each other on adjacent planes, this is seldom a problem. Coincident traces (those that occupy the same routing on different layers), form a long, skinny capacitor. The formula for capacitance is shown in Figure 17–11.

Here is the image describtion:
```
The image consists of two main parts: a diagram on the left and a formula with its explanation on the right.

**Diagram:**
- The diagram on the left shows a side view of a parallel plate capacitor.
- It consists of two parallel plates, one above the other.
- The top plate is labeled "AREA A," indicating that the area of the plate is denoted by the variable \( A \).
- The distance between the two plates is labeled \( d \), which represents the separation between the plates.

**Formula and Explanation:**
- On the right side, there is a formula for calculating the capacitance \( C \) of the parallel plate capacitor.
- The formula is given as:
  \[
  C = 0.0085 \times \epsilon_R \times \frac{A}{d}
  \]
- The variables in the formula are explained as follows:
  - \( C \) is the capacitance measured in picofarads (pF).
  - \( \epsilon_R \) is the dielectric constant of the material between the plates.
  - \( A \) is the area of one of the plates measured in square millimeters (mm²).
  - \( d \) is the separation between the plates measured in millimeters (mm).

The constant 0.0085 is a proportionality factor used in the formula to relate the physical dimensions and properties of the capacitor to its capacitance.
```

# Figure 17–11. PCB Trace-to-Plane Capacitance Formula

For example, if the capacitance formula is applied to the following trace:

- 4 Layer board — signal routing next to ground plane
- Board layer thickness: 0.188 mm
- Trace Width: 0.75 mm
- Trace Length: 7.5 mm

A typical value for ER of FR–4 PCB material is 4.5. Due to the variations of material from which an FR–4 board can be fabricated, this value is not guaranteed, but should be in the range of 4 to 5.

The capacitance between these traces would be 1.1 pF. Of course, the antenna effect on a 7.5-mm trace would be devastating, so this example is a bit extreme. Ignoring the antenna effects for now, there are cases in which even a very small parasitic capacitance like 1 pF is unacceptable. Figure 17–12 dramatically illustrates the effect of 1 pF capacitance occurring at the inverting input of the op amp. It causes a doubling of the output amplitude near the bandwidth limit of the op amp. This is an invitation to oscillation, especially since the trace is an efficient antenna above 180 MHz.

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a frequency response graph on the right.

### Circuit Diagram (Left Side):
1. **Components**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, depicted with the standard triangle symbol.
   - **Capacitor (C_I)**: Connected in parallel with the feedback resistor. The capacitor is shown in a dashed box, indicating it might be an optional or variable component.
   - **Resistors**: 
     - A resistor in the feedback loop of the op-amp.
     - A 50-ohm resistor connected to the output (V_OUT).
     - A 50-ohm resistor connected to the input signal source.
   - **Signal Source**: Depicted as a sine wave symbol, indicating an AC input signal.

2. **Connections**:
   - The input signal passes through a 50-ohm resistor and is fed into the non-inverting input (+) of the op-amp.
   - The inverting input (-) of the op-amp is connected to the junction of the feedback resistor and the capacitor (C_I).
   - The output of the op-amp is connected to a 50-ohm resistor, which then leads to the output terminal (V_OUT).
   - The other end of the feedback resistor and capacitor is connected to the output of the op-amp.

### Frequency Response Graph (Right Side):
1. **Axes**:
   - **X-Axis (Horizontal)**: Represents the frequency (f) in Hertz (Hz), ranging from 100K (100,000) Hz to 1G (1,000,000,000) Hz.
   - **Y-Axis (Vertical)**: Represents the output amplitude (V_OUT) in decibels (dB), ranging from -3 dB to +7 dB.

2. **Curves**:
   - **Two Curves**:
     - **C_I = 0 pF (Stray Capacitance Only)**: This curve shows the frequency response when only stray capacitance is present. It remains relatively flat until around 100M Hz, where it dips slightly before rising again.
     - **C_I = 1 pF**: This curve shows the frequency response with an additional 1 pF capacitor in the circuit. It starts flat but begins to rise significantly around 10M Hz, peaking at around 6 dB near 1G Hz before dropping off.

3. **Observations**:
   - The presence of the 1 pF capacitor (C_I) significantly affects the frequency response, causing a peak in the output amplitude at higher frequencies.
   - Without the additional capacitor (only stray capacitance), the frequency response is much flatter, with a slight dip and rise at higher frequencies.

### Summary:
The image illustrates how the addition of a small capacitance (1 pF) in the feedback loop of an op-amp circuit can dramatically alter the frequency response, leading to a significant peak in output amplitude at high frequencies. The circuit diagram provides the setup for this analysis, while the graph visually represents the impact on the output amplitude across a wide frequency range.
```

Figure 17–12. Effect of 1-pF Capacitance on Op Amp Inverting Input

There are numerous fixes to the problem above. The most obvious would be to shorten the length of the traces. Another not-so-obvious fix would be to use a different trace width. There is no reason why an inverting op amp trace has to be 0.75 mm wide — it carries almost no current. If the trace length is reduced to 2.5 mm (one third as long) and the trace width is changed to 0.188 mm (1/4 as wide), the capacitance becomes 0.1 pF — much less significant in the example above. Another fix is to remove the ground plane under the inverting input and the traces leading to it.

The inverting input of op amps, particularly high-speed op amps, is especially prone to oscillation in high gain circuits. This is due to unwanted capacitance on the input stage. It is important to minimize capacitance on this input by reducing trace width and placing components as close as possible to this input. If this input still oscillates, it may be necessary to scale the input and feedback resistors lower by a decade or two to change the resonance of the circuit. Scaling the resistors up will seldom help, as the problem is also related to the impedance of the circuit. If filter components are involved, they will also have to be scaled to avoid changing the filter characteristics of the circuit. The power consumption of the circuit will also increase if resistors are lowered.

#### **17.4.4.3 Trace-to-Trace Capacitors and Inductors**

PCB traces are not infinitely thin. They have some finite thickness, as defined by the ounce parameter of the copper clad foil. The higher the number of ounces, the thicker the copper. If two traces run side-by-side, then there will be capacitive and inductive coupling

Here is the image describtion:
```
The image appears to be a schematic representation of a physical phenomenon, likely related to electromagnetism or electrical engineering. It consists of two horizontal rows of symbols, each row containing repeating patterns.

1. **Horizontal Rows**: There are two distinct horizontal rows, one at the top and one at the bottom. Both rows contain identical repeating patterns.

2. **Symbols**:
   - **Coils**: Each row has a series of coil-like symbols, which are typically used to represent inductors in electrical schematics. These coils are depicted as loops or spirals.
   - **Capacitors**: Between each pair of coils, there is a symbol that resembles a capacitor. This is represented by two parallel lines with a gap between them.
   - **Arrows**: There are curved arrows between the coils and capacitors, indicating the direction of current flow or magnetic field lines. The arrows are oriented in a circular manner, suggesting a rotational or cyclical process.

3. **Pattern**: The pattern repeats consistently across the entire length of the image. Each segment consists of a coil, a capacitor, and arrows indicating a circular motion.

4. **Connections**: The coils and capacitors are connected in series along the horizontal rows, forming a continuous chain of components.

Overall, the image likely represents a series of inductors and capacitors connected in a specific configuration, with arrows indicating the direction of current or magnetic field. This could be a depiction of a resonant circuit, a filter, or another type of electrical network.
```

between them (Figure 17–13). The formulas for these parasitic effects can be found in transmission line and/or microstrip references, but are too complex for inclusion here.

# Figure 17–13. Coupling Between Parallel Signal Traces

Signal lines should not be routed parallel to each other, unless transmission line or microstrip effects are desired. Otherwise, a gap of at least three times the signal trace width should be maintained.

Capacitance between traces in an analog design can become a problem if fixed resistors in the design are large (several MΩ). Capacitance between the inverting and noninverting inputs of an op amp could easily cause oscillation.

#### **17.4.4.4 Inductive Vias**

Whenever routing constraints force a via (connection between layers of a PCB, FIgure 17–14), a parasitic inductor is also formed. At a given diameter (d) the approximate inductance (L) of an via at a height of (h) may be calculated as follows:

$$\mathsf{TL} = \approx \frac{\mathsf{h}}{\mathsf{5}} \times \left(\mathsf{1} + \mathsf{ln}\left(\frac{\mathsf{4h}}{\mathsf{6}}\right)\right) \mathsf{nH} \tag{17-5}$$

Here is the image describtion:
```
The image depicts a cross-sectional view of a through-hole via in a printed circuit board (PCB). Here is a detailed description of the image:

1. **Layers**:
   - There are two horizontal layers shown, labeled as the "TOP LAYER" and the "BOTTOM LAYER". These layers represent the conductive layers of the PCB.

2. **Via**:
   - A cylindrical structure, referred to as a via, connects the top and bottom layers. This via is used to electrically connect traces on different layers of the PCB.
   - The via is shown as a solid cylinder, indicating it is filled, possibly with conductive material.

3. **Dimensions**:
   - The height of the via is labeled as "h (mm)", which represents the distance between the top and bottom layers.
   - The diameter of the via is labeled as "d (mm)", which represents the width of the cylindrical via.

4. **Traces**:
   - On both the top and bottom layers, there are traces (conductive paths) that connect to the via. These traces are shown as black lines extending from the via on both layers.

5. **Labels**:
   - The image includes labels for the top and bottom layers, the via, and the dimensions (height and diameter) of the via.

Overall, the image provides a clear representation of a through-hole via in a PCB, showing how it connects the top and bottom conductive layers and the associated dimensions.
```

Figure 17–14. Via Inductance Measurements

For example, a 0.4-mm diameter via through a 1.5-mm thick PCB has an inductance of 1.1 nH.

Keep in mind that inductive vias combined with parasitic capacitance can form resonant circuits. The self-inductance of a via is small enough that these resonances are in the GHz range, but inductors add in series, lowering the resonant frequency. Do not put several vias on a critical trace of a high-speed analog circuit! Another concern is that the vias put holes in ground planes, potentially creating ground loops. They should be avoided — the best analog layout is one that routes all signal traces on the top layer of the PCB.

#### **17.4.4.5 Flux Residue Resistance**

Yes, even an unclean board can affect analog circuit performance.

Be aware that if the circuit has very high resistances — even in the low MΩ — special attention may need to be paid to cleaning. A finished assembly may be adversely affected by flux or cleansing residue. The electronics industry in the past few years has joined the rest of the world in becoming environmentally responsible. Hazardous chemicals are being removed from the manufacturing process — including flux that has to be cleaned with organic solvents. Water-soluble fluxes are becoming more common, but water itself can become contaminated easily with impurities. These impurities will lower the insulation characteristics of the PCB substrate. It is vitally important to clean with freshly distilled water every time a high-impedance circuit is cleaned. There are applications that may call for the older organic fluxes and solvents, such as very low power battery powered equipment with resistors in the 10s of MΩ range. Nothing can beat a good vapor defluxing machine for ensuring that the board is clean.

# **17.5 Decoupling**

Noise, of course, can propagate into analog circuitry through the power pins of the circuit as a whole and op amp itself. Bypass capacitors are used to reduce the coupled noise by providing low impedance power sources local to the analog circuitry.

#### **17.5.1 Digital Circuitry — A Major Problem for Analog Circuitry**

If analog circuitry is located on the same board with digital circuitry, it is important to understand a little about the electrical characteristics of digital gates.

A typical digital output consists of two transistors connected in series between power and ground (Figure 17–15). One transistor is turned on and the other turned off to produce logic high and vice versa for logic low. Because one transistor is turned off for either logic state, the power consumption for either logic state is low, while the gate is static at that level.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit. Here is a detailed description of the components and their connections:

1. **Power Supply**: At the top of the diagram, there is a symbol for a positive voltage supply, indicated by a circle with a plus sign inside it.

2. **Resistor**: Connected directly below the positive voltage supply is a resistor, represented by a zigzag line.

3. **Transistor**: Below the resistor, there is an NPN bipolar junction transistor (BJT). The transistor has three terminals: the collector (top), the base (left), and the emitter (bottom).

4. **Diodes**: There are two diodes connected in series with the transistor:
   - The first diode is connected between the collector and the base of the transistor, with the anode connected to the base and the cathode connected to the collector.
   - The second diode is connected between the emitter and ground, with the anode connected to the emitter and the cathode connected to ground.

5. **Inverter (NOT Gate)**: To the left of the transistor, there is an inverter (NOT gate), represented by a triangle with a small circle at the output. The input of the inverter is connected to the base of the transistor.

6. **Feedback Loop**: There is a feedback loop from the output of the inverter back to the input of the inverter. This loop is connected to the base of the transistor.

7. **Ground**: The bottom of the diagram shows a ground symbol, indicating the reference point for the circuit.

8. **Output**: The output of the circuit is taken from the emitter of the transistor, which is connected to the ground through the second diode.

In summary, the circuit appears to be a simple transistor-based switching circuit with feedback, possibly used for amplification or oscillation purposes. The inverter and feedback loop suggest that it might be part of a more complex logic or timing circuit.
```

Figure 17–15. Logic Gate Output Structure

The situation changes dramatically whenever the output switches from one logic state to the other. There may be a brief period of time when both transistors conduct simultaneously. During this period of time, current drawn from the power supply increases dramatically — since there is now a low impedance path through the two transistors from power to ground. Power consumption rises dramatically and then falls, creating a droop on the power supply voltage, and a corresponding current spike. The current spike will radiate radio frequency (RF) energy. There may be dozens, or even hundreds of such outputs on a digital IC, so the aggregate effect may be quite dramatic.

It is impossible to predict the frequencies of these spikes, because the frequencies are affected by the propagation delays of the transistors in the gate. Propagation delay is affected by random factors that occur during manufacture. Digital switching noise will be broadband, with harmonics throughout the spectrum. A general rejection technique is required, rather than one that rejects a specific frequency.

## **17.5.2 Choosing the Right Capacitor**

Table 17–2 is a rough guideline describing the maximum useful frequencies of common capacitor types.

| TYPE                  | MAX FREQUENCY |
|-----------------------|---------------|
| Aluminum Electrolytic | 100 kHz       |
| Tantalum Electrolytic | 1 MHz         |
| Mica                  | 500 MHz       |
| Ceramic               | 1 GHz         |

Table 17–2. Recommended Maximum Frequencies for Capacitors

Obviously from the table, tantalum electrolytic capacitors are useless for frequencies above 1 MHz. Effective high frequency decoupling at higher frequencies demands a ceramic capacitor. Self-resonances of the capacitor must be known and avoided or the capacitor may not help, or even make the problem worse. Figure 17–16 illustrates the typical self-resonance of two capacitors commonly used for bypassing — 10 µF tantalum electrolytic and 0.01 µF ceramic.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram with an associated impedance formula and a graph showing impedance versus frequency for two different capacitors.

1. **Circuit Diagram and Impedance Formula:**
   - The circuit diagram represents an equivalent series circuit consisting of three components: an inductance (L), a resistance (R), and a capacitance (C).
   - The inductance (L) is labeled as "EQUIVALENT SERIES INDUCTANCE."
   - The resistance (R) is labeled as "EQUIVALENT SERIES RESISTANCE."
   - The capacitance (C) is not specifically labeled but is part of the circuit.
   - Below the circuit diagram, there is a box labeled "Z," which represents the impedance of the circuit.
   - The impedance formula is given as:
     \[
     Z = \sqrt{R + \omega L - \frac{1}{\omega C}}
     \]
     where \( \omega \) is the angular frequency.

2. **Graph of Impedance vs. Frequency:**
   - The graph plots impedance (in ohms, Ω) on the vertical axis and frequency (in hertz, Hz) on the horizontal axis.
   - The vertical axis is logarithmic, ranging from 0.001 Ω to 100,000 Ω.
   - The horizontal axis is also logarithmic, ranging from 100 kHz to 1 GHz.
   - Two curves are plotted on the graph, representing the impedance behavior of two different capacitors:
     - One curve is labeled "10 μF" (microfarads).
     - The other curve is labeled "10 nF" (nanofarads).
   - The curve for the 10 μF capacitor starts at a higher impedance at lower frequencies, decreases to a minimum impedance at a certain frequency, and then increases again at higher frequencies.
   - The curve for the 10 nF capacitor follows a similar pattern but starts at a lower impedance at lower frequencies, reaches a minimum impedance at a higher frequency compared to the 10 μF capacitor, and then increases again at higher frequencies.

Overall, the image illustrates the concept of impedance in an equivalent series circuit with inductance, resistance, and capacitance, and shows how the impedance varies with frequency for two different capacitors.
```

Figure 17–16. Capacitor Self Resonance

Consider these resonances to be typical values, the characteristics of actual capacitors can vary from manufacturer to manufacturer and grade of part to grade of part. The important thing is to make sure that the self-resonance of the capacitor occurs at a frequency above the range of the noise that must be rejected. Otherwise, the capacitor will enter a region where it is inductive.

Do not assume that a single 0.1-µF capacitor will decouple all frequencies. Smaller capacitors may work better at higher frequencies than larger ones. When poor decoupling at higher frequencies is suspected, try a smaller capacitor rather than a larger one.

### **17.5.3 Decoupling at the IC Level**

The method most often used to decouple the high-frequency noise is to include a capacitor, or multiple capacitors connected from the op amp power pin to the op amp ground pin. It is important to keep the traces on this decoupling capacitor short. If not, the traces on the PCB will have significant self-inductance, defeating the purpose of the capacitor.

A decoupling capacitor must be included on every op amp package — whether it contains 1, 2 or 4 devices per package. The value of capacitor must be picked carefully to reject the type of noise present in the circuit.

In particularly troublesome cases, it may be necessary to add a series inductor into the power supply line connecting to the op amp. This inductor is in addition to the decoupling capacitors, which are the first line of defense. The inductor should be located before, not after the capacitors.

Another technique that is lower in cost is to replace the series inductor with a small resistor in the 10-Ω to 100-Ω range. The resistor forms a low-pass filter with the decoupling capacitors. There is a penalty to pay for this technique — depending on the power consumption of the op amp, it will reduce the rail-to-rail voltage range. The resistor forms a voltage divider with the op amp as a resistive active component in the lower leg of the divider. Depending on the application, this may or may not be acceptable.

## **17.5.4 Decoupling at the Board Level**

There is usually enough low frequency ripple on the power supply at the board input to warrant a bulk decoupling capacitor at the power input. This capacitor is used primarily to reject low frequency signals, so an aluminum or tantalum capacitor is acceptable. An additional ceramic cap at the power input will decouple any stray high frequency switching noise that may be coupled off of the other boards.

# **17.6 Input and Output Isolation**

Many noise problems are the result of noise being conducted into the circuit through its input and output pins. Due to the high-frequency limitations of passive components, the response of the circuit to high frequency noise may be quite unpredictable.

In situations in which conducted noise is substantially different in frequency from the normal operating range of the circuit, the solution may be as simple as a passive RC low-pass filter that rejects RF frequencies while having negligible effect at audio frequencies. A good example is RF noise being conducted into an audio op amp circuit. Be careful, though. A low pass filter loses its characteristics at 100 to 1000 times f3db. More stages may be required to cover different frequency ranges. If this is the case, make the highest frequency filter the one nearest to the source of noise. Inductors or ferrite beads can also be used in a noise rejection filter network to eliminate conducted noise. Ferrite beads are inductive up to a specified frequency, and then become resistive.

The effect of radiated energy coupling into an analog circuit can be so bad that the only solution to the problem may be to completely shield the circuit from radiated energy. This shield is called a Faraday Cage, and must be carefully designed so that frequencies that are causing the problem are not allowed to enter the circuit. This means that the shield must have no holes or slots larger that 1/20 the wavelength of the offending frequency. This can be a demanding requirement. It is a good idea to design a PCB from the beginning to have enough room to add a metal shield if it becomes necessary. If a shield is used, frequently the problem will be severe enough that ferrite beads will also be required on all connections to the circuit.

# **17.7 Packages**

Op amps are commonly supplied one, two, or four per package. Single op amps often contain additional inputs for features such as offset nulling. Op amps supplied two and four per package only offer inverting and noninverting inputs, and the output. If the additional features are important, the only package choice is single. Be aware, though, that the offset-nulling pins on a single op amp package can act as secondary inputs, and must be treated carefully. Consult the data sheet on the particular device being used.

Here is the image describtion:
```
The image shows the pin configurations for three different types of operational amplifier (op-amp) integrated circuits: single, dual, and quad op-amps. Each type is depicted with a diagram of the IC package and the corresponding pin functions.

1. **Single Op-Amp:**
   - The single op-amp IC has 8 pins.
   - Pin 1 (N1) and Pin 5 (N2) are labeled as OFFSET.
   - Pin 2 is the inverting input (IN-).
   - Pin 3 is the non-inverting input (IN+).
   - Pin 4 is the negative power supply (Vcc-).
   - Pin 6 is the output (OUT).
   - Pin 7 is the positive power supply (Vcc+).
   - Pin 8 is labeled as SHDN (shutdown).

2. **Dual Op-Amp:**
   - The dual op-amp IC has 8 pins.
   - Pin 1 is the output of the first op-amp (1OUT).
   - Pin 2 is the inverting input of the first op-amp (1IN-).
   - Pin 3 is the non-inverting input of the first op-amp (1IN+).
   - Pin 4 is the negative power supply (Vcc-).
   - Pin 5 is the non-inverting input of the second op-amp (2IN+).
   - Pin 6 is the inverting input of the second op-amp (2IN-).
   - Pin 7 is the output of the second op-amp (2OUT).
   - Pin 8 is the positive power supply (Vcc+).

3. **Quad Op-Amp:**
   - The quad op-amp IC has 14 pins.
   - Pin 1 is the output of the first op-amp (1OUT).
   - Pin 2 is the inverting input of the first op-amp (1IN-).
   - Pin 3 is the non-inverting input of the first op-amp (1IN+).
   - Pin 4 is the positive power supply (Vcc+).
   - Pin 5 is the non-inverting input of the second op-amp (2IN+).
   - Pin 6 is the inverting input of the second op-amp (2IN-).
   - Pin 7 is the output of the second op-amp (2OUT).
   - Pin 8 is the output of the third op-amp (3OUT).
   - Pin 9 is the inverting input of the third op-amp (3IN-).
   - Pin 10 is the non-inverting input of the third op-amp (3IN+).
   - Pin 11 is the negative power supply (Vcc-).
   - Pin 12 is the non-inverting input of the fourth op-amp (4IN+).
   - Pin 13 is the inverting input of the fourth op-amp (4IN-).
   - Pin 14 is the output of the fourth op-amp (4OUT).

Each diagram includes a small triangle symbol representing the op-amp itself, with the appropriate connections to the pins. The single op-amp has additional pins for offset adjustment and shutdown functionality, while the dual and quad op-amps do not include these features.
```

Here is the image describtion:
```
The image is a caption or label that reads "Figure 17–17. Common Op Amp Pinouts." The text is in a black font on a white background. The figure number "17–17" suggests that this is part of a larger document, likely a textbook or technical manual, and it is specifically referring to a figure that illustrates common pin configurations for operational amplifiers (op amps). The text is clear and straightforward, indicating that the accompanying figure (not shown in the image) would provide detailed information about the pinouts of various op amps.
```

The single op amp package places the output on the opposite side from the inputs. This can be a disadvantage at high speeds, because it forces longer PCB traces. One way to overcome this difficulty is to use a surface-mount package, and mount the feedback components on the rear of the board. This, however, adds at least two vias to the design, and places a hole in the ground plane for a 2-layer design. It may make more sense to use a dual op amp package, even if the second op amp is unused (remember to terminate it properly — see paragraph 17.7.3). Figure 17–18 is an illustration of trace length for an inverting op amp stage.

Here is the image describtion:
```
The image shows two different configurations of integrated circuits (ICs) with associated resistors and traces. 

On the left side, labeled "SINGLE," there is a single operational amplifier (op-amp) IC. The IC has a total of 8 pins, with a triangle symbol inside representing the op-amp. There is a resistor connected to the input pin of the IC, and the trace leading from this resistor to the IC is labeled "LONG TRACES." This suggests that the electrical path from the resistor to the IC is relatively long.

On the right side, labeled "DUAL," there is a dual op-amp IC, also with 8 pins. This IC contains two op-amps, each represented by a triangle symbol inside the IC. Similar to the single op-amp configuration, there is a resistor connected to the input pin of the IC. However, the trace leading from this resistor to the IC is labeled "SHORT TRACES," indicating that the electrical path from the resistor to the IC is relatively short.

The key difference between the two configurations is the length of the traces connecting the resistors to the ICs and the number of op-amps within each IC. The single op-amp IC has longer traces, while the dual op-amp IC has shorter traces.
```

Figure 17–18. Trace Length for an Inverting Op Amp Stage

It is popular to use dual op amps for stereophonic circuits, and quad op amps for filter stages with many sections. There is a penalty for doing so, however. Although modern processing techniques provide high levels of isolation between amplifiers on the same piece of silicon, there will be some crosstalk. If isolation between amplifiers is important, then single packages should be considered. Crosstalk problems are not limited to the IC – the dual and quad packages place a high density of passive components in close proximity to each other. This proximity will lead to some crosstalk.

Dual and quad op amp packages offer some additional benefits beyond density. The amplifier stages tend to be mirror images of each other. If similar stages are to be laid out on the PCB, the layout only needs to be done once, then it can be mirror-imaged to form the other stage. Figure 17–19 illustrates this effect for four inverting op amp stages implemented in a quad package:

Here is the image describtion:
```
The image depicts a schematic diagram of a quad operational amplifier (op-amp) integrated circuit (IC). The IC package is shown in a rectangular shape with pins on both sides. The term "QUAD" at the top indicates that the IC contains four op-amps within a single package.

Each op-amp is represented by a triangular symbol with two inputs and one output. The inputs are marked with a plus (+) and minus (-) sign, indicating the non-inverting and inverting inputs, respectively. The output is shown at the point of the triangle.

The IC has a total of 14 pins, with 7 pins on each side. The pins are connected to external resistors and other components, which are part of the circuit in which the op-amps are used. The resistors are depicted as zigzag lines, and they are connected to the pins of the IC, indicating their role in the circuit configuration.

The internal connections of the op-amps are not shown in detail, but the general layout suggests that each op-amp has its own set of input and output pins. The op-amps are arranged symmetrically within the IC package.

Overall, the image provides a high-level view of a quad op-amp IC and its external connections, commonly used in various analog signal processing applications.
```

Figure 17–19. Mirror-Image Layout for Quad Op Amp Package

These illustrations, however, do not show all connections required for operation, in particular, the half-supply generator for single-supply operation. Modifying the diagram of Figure 17–19 to use the fourth op amp as a half supply generator is shown in Figure 17–20.

Here is the image describtion:
```
The image depicts a schematic diagram of an integrated circuit (IC) with multiple input and output connections. The IC appears to be an operational amplifier or a similar analog device, given the configuration of the components around it. Here is a detailed description of the image:

1. **IC Package**: The central component is a rectangular IC package with multiple pins on both sides. The IC has a notch or a marking at the top, indicating the orientation of the IC.

2. **Pins and Connections**:
   - **IN1+**: The top left pin is labeled "IN1+" and is connected to a resistor, which then connects to a node that branches out to a capacitor and another resistor leading to the "OUT1" pin.
   - **OUT1**: The top right pin is labeled "OUT1" and is connected to a resistor that leads to the node mentioned above.
   - **IN2**: The middle left pin is labeled "IN2" and is connected to a resistor, which then connects to a node that branches out to a capacitor and another resistor leading to the "OUT2" pin.
   - **OUT2**: The bottom left pin is labeled "OUT2" and is connected to a resistor that leads to the node mentioned above.
   - **IN3**: The middle right pin is labeled "IN3" and is connected to a resistor, which then connects to a node that branches out to a capacitor and another resistor leading to the "OUT3" pin.
   - **OUT3**: The bottom right pin is labeled "OUT3" and is connected to a resistor that leads to the node mentioned above.

3. **Capacitors and Resistors**:
   - Each input pin (IN1+, IN2, IN3) is connected to a resistor, which then connects to a node that branches out to a capacitor and another resistor leading to the corresponding output pin (OUT1, OUT2, OUT3).
   - The capacitors are connected between the nodes and ground, providing filtering or stabilization.

4. **Internal Structure**: The IC's internal structure is represented by a shaded area with some internal lines and blocks, indicating the internal circuitry of the IC.

Overall, the image shows a typical configuration for an operational amplifier or a similar analog IC with multiple inputs and outputs, along with external passive components (resistors and capacitors) for signal conditioning.
```

Figure 17–20. Quad Op Amp Package Layout with Half-Supply Generator

This example shows all of the connections actually required to produce three independent inverting stages. Note that the half-supply connection can be made entirely under the IC, keeping the trace length short. This example is not meant to be used as a suggested PCB layout, it merely illustrates what can be done. The half-supply op amp, for example, could be any one of the four. The passive components can be selected so that they span the lead pitch. Surface-mount 0402 packages, for example, span a width equal to or less than a standard SO package. This can keep traces lengths extremely short for high frequency applications.

Package styles for op amps include the dual-in-line (DIP) and small-outline (SO). Lead pitches for op amps have been continually decreasing, as has been the case for all ICs in general. Decreasing lead pitches have been accompanied by a decrease in the size of passive components as well. Decreasing the overall circuit dimensions reduces parasitic inductance, which should allow higher frequency circuits, but it also increases the potential for crosstalk by placing conductors closer to each other where capacitive effects increase.

# **17.7.1 Through-Hole Considerations**

The older technology for op amps and other components is through-hole. Components are constructed with leads that insert through holes in the board — hence the name.

Through-hole components, due to their size, are more suited to applications where space is not an issue. The components themselves are frequently lower in cost, but the PCB is more expensive due to the fact that the PCB fabrication house has to drill holes for component leads. PCBs are primarily a mechanical fabrication — the number of holes and number of different drills have a big impact on the price.

The leads on a through-hole op amp are arranged on a 0.1-inch grid. Many PCB layout people like to maintain the 0.1-inch grid for the rest of the components as well. Resistors and other passive components can even be purchased with leads pre-bent to land on a 0.1 inch grid. Some electrolytic capacitors have leads that are on a 0.025-inch grid.

These component sizes may force a lot of wasted area on the PCB. Components that ideally should be placed close to the op amp itself may be forced several tenths of an inch away, due to intervening components. Therefore, through hole circuitry is not recommended for high speed analog circuitry, or for analog circuitry in proximity to high speed digital.

Some designers attempt to overcome the long trace length caused by resistors by placing the resistors on the board vertically, one lead of the resistor bent close to the body of the part. This is common in older consumer electronics. This allows for denser placement of parts, and may help some with trace length — but each resistor exposes almost 1 cm of one component lead to radiated signals, and lead self-inductance.

An advantage of the through-hole approach of PCB layout is that the through-holes themselves can serve as feedthroughs, reducing the number of vias in complex circuits.

### **17.7.2 Surface Mount**

Surface-mount circuitry does not require a hole for each component lead. Automated testing, however, may require vias on every node. The holes were never an issue with through-hole circuitry, because every component lead made a hole in the board. The PCB layout designer, who is used to designing a board with a minimum number of vias, now has to put a via on EVERY node of the circuit. This can make a Swiss cheese out of a nice continuous ground plane — negating many of the advantages it provides.

Fortunately, there is a close variation of the "via on every node" requirement. This requirement can often be met by putting a test pad on every node. The automated test station can then access the analog circuitry from the top of the board. A clamshell test fixture is significantly more expensive than one that accesses only one side of the board. The extra cost can be justified if there is documentation that circuit performance will be unacceptable with vias.

Signal connections to ground or the power supply may have to be made through a small fixed resistor instead, so the automated equipment can access that pin of the IC and test its function.

#### **17.7.3 Unused Sections**

In many op amp designs, one or more op amps may be unused. If this is the case, the unused section must be terminated properly. Improper termination can result in greater power consumption, more heat, and more noise in op amps on the same physical IC. If the unused section of the op amp is connected as shown in the **better** side of Figure 17–21, it will be easier to use it for design changes.

Here is the image describtion:
```
The image shows two different configurations of operational amplifier (op-amp) circuits, labeled "GOOD" and "BETTER."

1. **GOOD Configuration:**
   - The op-amp is configured as a voltage follower (buffer).
   - The non-inverting input (+) is connected to a voltage labeled "HALF SUPPLY."
   - The output of the op-amp is directly connected to its inverting input (-), creating a unity-gain buffer.
   - This configuration ensures that the output voltage follows the input voltage applied to the non-inverting input.

2. **BETTER Configuration:**
   - This is an improved version of the voltage follower with additional components for stability and protection.
   - The non-inverting input (+) is connected to a voltage labeled "HALF SUPPLY."
   - The inverting input (-) is connected to the output through a resistor.
   - There is a resistor connected between the inverting input (-) and ground (labeled "ZERO").
   - The point between the two resistors connected to the inverting input is labeled "OPEN."
   - This configuration provides better stability and noise immunity compared to the "GOOD" configuration by adding resistors to the feedback loop and to ground.

Both configurations aim to buffer the "HALF SUPPLY" voltage, but the "BETTER" configuration includes additional resistors to improve performance.
```

Figure 17–21. Proper Termination of Unused Op Amp Sections

# **17.8 Summary**

Keep the following points in mind when designing a PCB for analog circuitry:

# **17.8.1 General**

- Think of the PCB as a component of the design.
- Know and understand the types of noise the circuit will be subjected to.
- Prototype the circuit.

# **17.8.2 Board Structure**

- Use a high-quality board material such as FR–4.
- Multi-layer boards are as much as 20-dB better than double-sided boards.
- Use separate, nonoverlapping ground and power planes.
- Place power and ground planes to the interior of the board instead of exterior.

# **17.8.3 Components**

- Be aware of frequency limitations of traces and other passive components.
- Avoid vertical mounting of through-hole passive components in high-speed circuits.
- Use surface mount for high-speed analog circuitry.
- Keep traces as short as possible.
- Use narrow traces if long traces are required.
- Terminate unused op amp sections properly.

### **17.8.4 Routing**

- Keep analog circuitry close to the power connector of the board.
- Never route digital traces through analog sections of the board, or vice versa.
- Make sure that traces to the inverting input of the op amp are short.
- Make sure that traces to the inverting and noninverting inputs of the op amp do not parallel each other for any significant length.
- It is better to avoid vias, but the self-inductance of vias is small enough that a few should cause few problems.
- Do not use right angle traces, use curves if at all possible.

#### **17.8.5 Bypass**

- Use the correct type of capacitor to reject the conducted frequency range.
- Use tantalum capacitors at power input connectors for filtering power supply ripple.
- Use ceramic capacitors at power input connectors for high frequency conducted noise.
- Use ceramic capacitors at the power connections of every op amp IC package. More than one capacitor may be necessary to cover different frequency ranges.
- Change the capacitor to a smaller value — not larger — if oscillation occurs.
- Add series inductors or resistors for stubborn cases.
- Bypass analog power only to analog return, never to digital return.

# **17.9 References**

1. Analog Dialog 30th Anniversary Issue, Analog Devices, Ask the Applications Engineer –10, James Bryant

2. High-Speed Operational Amplifier Layout Made Easy, Texas Instruments, Andy Hahn, SLOA046

# **Chapter 18**

# **Designing Low-Voltage Op Amp Circuits**

#### Ron Mancini

# **18.1 Introduction**

In one respect, voltage is like water: you don't appreciate its value until your supply runs low. Low-voltage systems, defined here as a single power supply less than 5 V, teach us to appreciate voltage. We aren't the first electronic types to learn how valuable voltage is; about 15 years ago the audio console design engineers appreciated the relationship between voltage and dynamic range. They needed more dynamic range to satisfy their customers; thus, they ran op amps at the full rated voltage, not the recommended operating voltage, so they could squeeze a few more dB of dynamic range from the op amp. These engineers were willing to take a considerable risk running op amps at the full rated voltage; but their customers demanded more dynamic range. The moral of this story is that dynamic range is an important parameter, and supply voltage is tied directly to dynamic range.

Knowing how to obtain and use the maximum dynamic range and input/output voltage range is critical to achieving success in low voltage design. We will investigate these subjects in detail later, but for now it is useful to review the history of op amps. Knowing how op amps evolved into the today's marvels is interesting, and it gives designers an insight into system problems that they encounter as they design in the low voltage world.

When power supplies were ±15 V, the output voltage swing of an op amp didn't seem important. When the power supply was 30 V the typical circuit designer could afford to sacrifice 3 V from each end of the output voltage swing (this was because of transistor saturation or cutoff). The transistors in the op amp need enough voltage across them to operate correctly, so why worry about 6 V out of 30 V. Also, the input transistors required base bias, so an op amp with 30-V supplies often offered a common-mode input voltage range of 24 V or less. These numbers come from the µA741 data sheet; the µA741 (about 1969) is the first internally compensated op amp to achieve wide popularity.

A later generation op amp, the LM324, had better dynamic range characteristics than the µA741. The LM324's output voltage swing is 26 V when operated from a 30-V power supply, and the common-mode input voltage range is 28.5 V. The LM324 was big news because it was specified to operate with a 5-V power supply. The LM324's output voltage swing at VCC = 5 V is 3.48 V, and this presented problems for the early low voltage circuit designers because the output voltage swing was smaller than most analog-to-digital converter (ADC) input voltage ranges. You must fill the ADC input voltage range to obtain its full dynamic range. The LM324 had an input voltage common-mode range of (VCC–1.5 V) to 0 V; at least this op amp could work with transducers connected to the lower power supply rail if the transducer did not have an ac output voltage swing.

The next incremental improvement in op amps was the LM10 because it operated on 1.1-V power supplies. It was introduced almost as an afterthought because there was no pressing demand for it. Its brilliant designer, Robert J. Widlar, wrote "IC op amps have reached a certain maturity in that there no longer seems to be a pressing demand for better performance." There were no pressing demands for a low voltage op amp in 1978 because portable (portable means battery applications that are almost always single supply) did not become popular until the late 1980s or early 1990s.

Cell phones, calculators, and portable instruments — not new battery technology opened the market for low-voltage op amps, and when the portable concept caught on, the demand for low-voltage op amps increased. The increasing demand did not breed new companies committed to low-voltage IC design; rather, the established IC manufacturers threw a few low voltage op amps into their portfolio. These op amps, like the LM324, could operate on a low voltage, but they were severely lacking in input common-mode voltage range and output voltage swing. Circuit designers had to be satisfied with this generation of op amps until something better came along. Well, something better is here now!

The next generation of low-voltage op amps has much better specifications. The TLV278X operates off a power supply ranging from 1.8 V to 3.6 V, and it has an output voltage swing of 1.63 V (when the power supply is 1.8 V) coupled with an input commonmode voltage range of –0.2 V to 2 V. The TLV240X operates off a power supply ranging from 2.5 V to 16 V, and it has an output voltage swing of 2.53 V when the power supply voltage is 2.7 V. Also, when it is operated off a 2.7-V power supply, it has an input commonmode voltage range of –0.1 V to 7.7 V. These new op amps are far superior to their predecessors when evaluated on the their merits, which are extended output voltage swing and input common voltage range.

The latest op amps make it possible to design more accurate and cost effective electronic equipment, but there is one problem that they don't solve. Low-voltage applications are defined here as single-supply applications, and in single-supply design, the op amp input voltage and output voltage is referenced to the midpoint of the power supply (VCC/2). Unfortunately, most transducers are not connected to the midpoint of the power supply because, in the majority of cases, this requires a third wire beyond VCC and ground. It doesn't help to create VCC/2 at the transducer location (to save a wire) because it is not identical to the midpoint of the power supply (unresolved errors enter because of the reference voltage difference). When the transducer in a single supply design is referenced to any voltage other than the midpoint of the power supply, the reference voltage is amplified with the transducer voltage.

The trick to designing single supply op amp circuits is using external biasing to strip off or null out the reference voltage. Designing op amp circuits with biasing normally involves an iterative cut and try approach where the designer assumes a circuit configuration, solves equations, changes the configuration, and repeats the process until a solution is found. A technique that solves the problem the first time is presented later.

# **18.2 Dynamic Range**

It is extremely hard to define dynamic range (DR) for an op amp, so lets start with a digitalto-analog converter (DAC) where DR is defined as the ratio of the maximum output voltage to the smallest output voltage the DAC can produce (least significant bit or LSB). Dynamic range is usually expressed in dB using the formula given in Equation 18–1.

$$\mathsf{DR} = \mathsf{2O}\,\mathsf{Log}\_{\mathsf{10}}\left(\frac{\mathsf{V}\_{\mathsf{OUT(MAX)}}}{\mathsf{V}\_{\mathsf{OUT(MIN)}}}\right) \tag{18-4}$$

The same definition of DR can be used for an op amp, and the maximum output voltage swing equals VOUTMAX. This output voltage swing is defined as the maximum output voltage the op amp can achieve (VOH) minus the minimum output voltage the op amp can achieve (VOL). VOH and VOL are easily obtainable from an op amp IC data sheet. Normally, VOH and VOL are guaranteed minimum and maximum parameters respectively. This yields Equation 18–2.

$$\mathsf{V}\_{\mathsf{OUE(MAX)}} = \mathsf{V}\_{\mathsf{O}\models\mathsf{(MIN)}} - \mathsf{V}\_{\mathsf{O}\models\mathsf{(MAX)}}\tag{18-2}$$

Equation 18–2 can be used to illustrate the role that power supply voltage plays in limiting the DR. VOH(MIN) is the most positive power supply voltage minus the voltage drop across the upper output transistor, thus VOH(MIN) is directly proportional to the most positive power supply voltage. For any op amp, the output voltage swing is directly proportional to the power supply voltage, thus, in the same op amp, the DR is directly proportional to the power supply voltage.

At first thought, one might think that the smallest output voltage that an op amp can have is zero, and the natural conclusion based on this assumption is that the DR is equal to infinity. This is never the case because op amp and external circuit imperfections ensure that the smallest op amp output voltage is greater than zero. It turns out that VOUT(MIN) is actually determined by a series of error terms. These error terms are the op amp's internal noise (Vn and In), external resistor noise (VnR), power supply rejection ratio (kSVR), voltage offset (VIO), current offset (IIO), common-mode rejection ratio (CMRR), and closed loop gain (G). Each of these error terms is referred to the input of the op amp, so they must be multiplied by the closed loop gain to be referred to the output (see Figure 18–1).

Designing Low-Voltage Op Amp Circuits 18-3

Here is the image describtion:
```
The image depicts a detailed schematic of an operational amplifier (op-amp) circuit with various noise and bias current sources included. Here is a detailed description of the components and their connections:

1. **Input Voltage (VIN)**: The circuit starts with an input voltage source labeled VIN, which is connected to the non-inverting input of the op-amp through a resistor RS.

2. **Resistor (RS)**: This resistor is connected between the input voltage source (VIN) and the non-inverting input of the op-amp. It is labeled RS.

3. **Noise Sources**:
   - **VnR**: This represents the thermal noise voltage associated with the resistor RS.
   - **IIB+ and IIB-**: These are the bias currents for the non-inverting and inverting inputs of the op-amp, respectively.
   - **IIO**: This is the input offset current of the op-amp.
   - **VIB**: This represents the input bias voltage noise.
   - **Vn**: This is the voltage noise of the op-amp itself.
   - **In**: These are the current noise sources at both the non-inverting and inverting inputs of the op-amp.

4. **Operational Amplifier (Op-Amp)**: The op-amp is depicted with its non-inverting input (+) connected to the node where RS, VnR, IIB+, IIO, and VIB converge. The inverting input (-) is connected to the node where IIB-, In, and Vn converge. The op-amp is powered by a supply voltage labeled VCC+ with a variation of ±ΔV.

5. **Feedback Network**:
   - **R1 and R2**: These resistors form a voltage divider network connected from the output (VO) of the op-amp to the inverting input (-) and ground. This network sets the gain of the op-amp circuit.

6. **Output Voltage (VO)**: The output of the op-amp is labeled VO, which is connected to the feedback network consisting of resistors R1 and R2.

The schematic includes various noise sources and bias currents that affect the performance of the op-amp circuit, providing a comprehensive view of the factors influencing the circuit's behavior.
```

Figure 18–1. Op Amp Error Sources

The error sources are taken into account in Equation 18–3, and this equation refers them to the op amp output by multiplying them by the op amp's closed loop gain.

$$\mathbf{v}\_{\mathbf{O}\bullet\mathbf{T}(\mathbf{M}\mathbf{N})} = $$

$$\mathbf{S} = \mathbf{G}\_{\mathsf{C}\mathsf{L}} \left( \mathsf{V}\_{\mathsf{l}\mathsf{O}} + \mathsf{l}\_{\mathsf{l}\mathsf{O}} \mathsf{R}\_{\mathsf{S}} + \alpha \mathsf{V}\_{\mathsf{l}\mathsf{O}} \,\Delta\mathsf{T} + \frac{\mathsf{V}\_{\mathsf{l}\mathsf{N}} + \mathsf{l}\_{\mathsf{l}\mathsf{B}} \mathsf{R}\_{\mathsf{P}}}{\mathsf{C}\mathsf{M}\mathsf{R}\mathsf{R}} + \frac{\Delta\mathsf{V}}{\mathsf{K}\_{\mathsf{S}\mathsf{N}\mathsf{R}}} + \mathsf{V}\_{\mathsf{l}\mathsf{I}} + \mathsf{l}\_{\mathsf{l}\mathsf{B}} \mathsf{R}\_{\mathsf{E}\mathsf{Q}} + \mathsf{l}\_{\mathsf{n}\mathsf{B}} \mathsf{R} \right) \tag{16-3}$$

The maximum DR that can be achieved by an op amp is given in Equation 18–4.

$$\mathsf{DR} = \mathsf{20}\,\mathsf{Log}\_{10}\left(\frac{\mathsf{V}\_{\mathsf{O\#\{\mathsf{MIN\}}}}-\mathsf{V}\_{\mathsf{OL\{\mathsf{MAX}\}}}}{\mathsf{V}\_{\mathsf{O\#\mathsf{T}\}\text{\#}\mathsf{N}}}\right) = \mathsf{20}\,\mathsf{Log}\_{10}\frac{\mathsf{V}\_{\mathsf{O\#\mathsf{T}\}\text{\#}\mathsf{N}\text{\#}\mathsf{}}}{\mathsf{V}\_{\mathsf{O\#\mathsf{T}\}\text{\#}\mathsf{N}}} \qquad \text{(18-4)}$$

The DR is reduced by the sum of the error terms, so it is proper to conclude that the maximum power supply voltage and the op amp choice (this defines the error magnitude) both establish the DR of an op amp. The first two terms in Equation 18–3 are dc error terms, thus, they can be adjusted to zero by one of several methods not mentioned here. The input offset current and input bias current error terms were big factors with older generation ICs, but today's technology render them much less significant (see Table 18–1).

| PARAMETER | LM324   | TLV278X     | TLV240X      | UNITS            |
|-----------|---------|-------------|--------------|------------------|
| VIO       | 9       | 1.5         | 4.5          | mV               |
| αVIO      | No spec | 8           | 3            | µV               |
| IIB       | 500,000 | 100         | 350          | pA               |
| IIO       | 50,000  | 100         | 300          | pA               |
| CMMR      | 50      | 50          | 65           | dB               |
| kSVR      | 65      | 70          | 100          | dB               |
| Vn        | No spec | 18 (1 kHz)  | 500 (100 Hz) | nV<br>12<br>(Hz) |
| In        | No spec | 0.9 (1 kHz) | 8 (100 Hz)   | fA<br>12<br>(Hz) |

| Comparison of Op Amp Error Terms | Table 18–1. |  |  |  |
|----------------------------------|-------------|--|--|--|
|----------------------------------|-------------|--|--|--|

The data in Table 18–1 indicates that older low voltage op amps are not capable of yielding the DR that that later technology op amps are.

# **18.3 Signal-to-Noise Ratio**

Noise sets a limit on the information and signals that can be handled by a system. The ability of an amplifier, receiver, or other device to discern a signal is degraded by noise. Noise mixed with the incoming signal, noise generated by the op amp, resistor noise, and power supply noise ultimately determine the size of the signal that can be recovered and measured.

Noise fluctuates randomly over a period of time, so instantaneous signal or noise levels don't describe the situation adequately. Averages over a long period of time (root mean squared or RMS) are used to describe both the signal and the noise. Signal-to-noise ratio (SNR) was initially established as a measure of the quality of the signal that exists in the presence of noise. This SNR was a power ratio, and it was established at the output of a circuit. The SNR that we are interested in is a voltage ratio because the impedance is constant, and it is established at the input to the op amp. This means that all noise voltages, including resistor noise voltage, must be calculated in RMS volts at the op amp input. The SNR is given in Equation 18–5.

$$\text{SNR} = 20 \log\_{10} \left( \frac{\mathsf{V}\_{\text{SIGN}}}{\mathsf{V}\_{\text{NOMSE}}} \right) \tag{18-5}$$

The signal is established by a transducer; a device that senses a change in a variable and converts that change into a voltage change. Transducers also convert some of their physical surroundings into a noise voltage that is combined with the signal. Noise from the physical surroundings of the transducer, unless its nature is well known, is almost impos-

Designing Low-Voltage Op Amp Circuits 18-5

sible to separate from the transducer signal. When transducers are connected to the electronics, cabling picks up noise, and some transducers like thermocouples can pick up noise from the connecting junctions. Thus, the signal is never clean as it enters the electronics. The noise generated by the op amp was defined in the previous section as Vn, InREQ, InRR, and ∆V/kSVR, and this noise is added to the signal.

The transducer often has a very small output voltage swing, so when the transducer output voltage swing is converted to least significant bits (LSB) the noise voltage should be very small compared to an LSB. Consider a temperature transducer that has a 10-mV swing over its range. When the transducer output voltage swing is considered to be the full-scale voltage (FSV) of an ADC, the LSB is very small as is shown in Equation 18–6 for a 12-bit (N) ADC.

$$\mathsf{LSSB} = \frac{\mathsf{FSSV}}{\mathsf{2^{N}}} = \frac{\mathsf{10}\ \mathsf{mV}}{\mathsf{2^{12}}} = \frac{\mathsf{10}\ \mathsf{mV}}{\mathsf{4096}} = \mathsf{2.44}\ \mathsf{\muV} \tag{\mathsf{18-6}}$$

The op amp for this application must be a very low noise op amp because an op amp with a 20-nV/(Hz)1/2 equivalent input noise voltage and a bandwidth of 4 MHz contributes 40 µV of noise. This high noise contribution is why extensive filtering and "optimally" low bandwidth is found desirable in the input stages of some electronic systems. If there is power supply noise, some of that noise passes through the op amp to its input. The power supply noise is divided by the power supply rejection ratio, but there is always a residual noise component of the power supply on the op amp input as shown in Equation 18–7 where kSVR is 60 dB.

$$
\lambda\_{\text{PS(INPUT)}} = \frac{\lambda\_{\text{PS}}}{\lambda\_{\text{SVR}}} = \frac{10 \text{ mV}}{1000} = \text{ } \text{10 } \mu\text{V} \tag{18-7}
$$

# **18.4 Input Common-Mode Range**

Years ago the op amp's input common-mode voltage range (VICR) did not include the power supply rails. The best VICR that was available was (VCC +|VEE|–6 V), and when the input voltage approached VICR, distortion occurred. If the input voltage exceeded the power supply rails, the output stage might invert phase (it sometimes latched in the inverted position causing control problems) or the IC might self destruct. The vast majority of transducers were connected to ground (0 V) because it was easy to make a ground connection and because a split supply op amp has inputs referenced to ground. In a split supply application with the transducer connected to ground, latch-up or self destruction is unlikely.

In special cases, transducers are connected to a power supply rail (usually VCC when power supply current sensing) or some other voltage, and in this special case, additional bias circuitry was added to split power supply designs to keep the input voltage swing within VICR. Bias circuitry in conjunction with external components removed the effects of the power supply rail connection.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit configured as a differential amplifier. Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component of the circuit is an op-amp, represented by a triangle with two input terminals (inverting and non-inverting) and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+). The output is labeled as \( V_{OUT} \).

2. **Power Supply**: The op-amp is powered by a positive voltage supply \( +V_{CC} \), which is connected to the top of the op-amp symbol.

3. **Input Voltages**: There are two input voltage sources:
   - \( V_1 \): Connected to the inverting input (-) of the op-amp through a resistor \( R_G \).
   - \( V_2 \): Connected to the non-inverting input (+) of the op-amp through a resistor \( R_F \parallel R_G \) (indicating a parallel combination of \( R_F \) and \( R_G \)).

4. **Resistors**:
   - \( R_G \): A resistor connected between the inverting input (-) and the voltage source \( V_1 \).
   - \( R_F \): A feedback resistor connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
   - \( R_F \parallel R_G \): A resistor representing the parallel combination of \( R_F \) and \( R_G \), connected between the non-inverting input (+) and the voltage source \( V_2 \).

5. **Ground Connections**: Both input voltage sources \( V_1 \) and \( V_2 \) have their negative terminals connected to the ground.

6. **Output Voltage**: The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

In summary, this circuit is a differential amplifier where the output voltage \( V_{OUT} \) is a function of the difference between the input voltages \( V_1 \) and \( V_2 \), scaled by the resistors \( R_G \) and \( R_F \).
```

Many low voltage op amp input signals come from transducers connected to a power supply rail like the circuit shown in Figure 18–2.

Figure 18–2. Noninverting Op Amp

When V1 = 0 and V2 is the transducer input, the op amp must be capable of handling input voltages that go to 0 V. Furthermore, the transducer voltage may be ac, so it swings above and below ground, thus the transducer voltage drops below the low power supply rail. This situation requires that the op amp's VICR exceed the power supply voltage. Rail-to-rail input (RRI) voltage capability is a necessary requirement for a low-voltage op amp that handles transducers connected to a power supply rail.

When the input voltage is connected to ground and the input voltage swing is very small, a standard op amp like the LM324 suffices. Referring to Figure 18–3 it can be seen that the PNP input transistors are biased by the emitter current source. If the positive input is connected to ground bias current still flows and the transistor stays active. If the input transistors are selected very carefully for operation with low collector-base junction reverse bias, the input voltage can go slightly below ground (–200 mV for the TLV278X) and the op amp will still operate correctly. The circuit operation is one sided though because when the input voltage approaches the positive supply rail, the emitter current source and input transistors turn off. This type of circuit does not offer rail-to-rail operation, but it does offer from rail to (VCC –1.5V) operation.

Here is the image describtion:
```
The image depicts a differential amplifier circuit using bipolar junction transistors (BJTs). Here is a detailed description of the circuit:

1. **Power Supply:**
   - The circuit is powered by a voltage source labeled \( V_{CC} \) at the top, which is the positive supply voltage.
   - The ground (GND) is at the bottom, providing the reference point for the circuit.

2. **Transistors:**
   - There are two NPN transistors in the circuit, each represented by the standard transistor symbol with the emitter, base, and collector terminals.
   - The left transistor has its base connected to the input labeled "IN -".
   - The right transistor has its base connected to the input labeled "IN +".

3. **Biasing:**
   - A current source labeled \( V_{Bias} \) is connected between \( V_{CC} \) and the common point of the collectors of the two transistors. This current source provides the necessary bias current for the transistors.
   - The emitters of both transistors are connected together and then to ground through a pair of resistors. These resistors help in setting the emitter current and stabilizing the operating point of the transistors.

4. **Input Signals:**
   - The input signal "IN -" is applied to the base of the left transistor.
   - The input signal "IN +" is applied to the base of the right transistor.
   - The voltage difference between "IN +" and "IN -" determines the differential input voltage \( V_{BE} \).

5. **Output:**
   - The output of the differential amplifier is typically taken from the collectors of the transistors. However, the exact output configuration is not shown in the image.

6. **Operation:**
   - The differential amplifier amplifies the difference between the input signals "IN +" and "IN -".
   - The transistors share a common emitter current, which is split between them based on the input voltage difference.
   - The circuit is designed to provide high gain and common-mode rejection, making it useful in various analog signal processing applications.

Overall, this is a classic differential amplifier circuit used in analog electronics for amplifying the difference between two input signals while rejecting any common-mode signals.
```

Figure 18–3. Input Circuit of a NonRRI Op Amp

An op amp with a NPN input stage works in a similar way around the positive supply rail. It can sense voltages close to VCC and maybe slightly above VCC, but it won't work when it is within 1.5 V of ground. The solution for this problem is to include parallel input circuits as shown in Figure 18–4.

Here is the image describtion:
```
The image shows two different types of input stages for operational amplifiers or similar analog circuits. The left side of the image is labeled "Bipolar Input," and the right side is labeled "CMOS Input." Both diagrams illustrate the internal circuitry used to process differential input signals (IN+ and IN-) but use different types of transistors.

### Bipolar Input (Left Side):
- **Transistors**: The circuit uses bipolar junction transistors (BJTs). There are four transistors arranged in a differential pair configuration.
- **Power Supply**: The circuit is powered by a positive supply voltage (V_CC) and a ground (GND).
- **Resistors**: There are resistors connected to the V_CC and GND, which are likely used for biasing the transistors.
- **Current Sources**: There are two current sources depicted, one connected to the V_CC and another to the GND, which help in setting the operating point of the transistors.
- **Connections**: The IN+ and IN- signals are connected to the bases of the transistors, forming a differential pair. The emitters of the transistors are connected together and to the current source at the bottom, while the collectors are connected to the current source at the top.

### CMOS Input (Right Side):
- **Transistors**: The circuit uses complementary metal-oxide-semiconductor (CMOS) transistors. There are four MOSFETs arranged in a differential pair configuration.
- **Power Supply**: Similar to the bipolar input, the circuit is powered by a positive supply voltage (V_CC) and a ground (GND).
- **Resistors**: There are resistors connected to the V_CC and GND, likely for biasing purposes.
- **Current Sources**: Two current sources are shown, one connected to the V_CC and another to the GND, to set the operating point of the MOSFETs.
- **Connections**: The IN+ and IN- signals are connected to the gates of the MOSFETs, forming a differential pair. The sources of the MOSFETs are connected together and to the current source at the bottom, while the drains are connected to the current source at the top.

### Common Features:
- Both circuits are designed to amplify the difference between the IN+ and IN- signals.
- Both use current sources to set the operating points of the transistors.
- Both have resistors connected to the power supply and ground for biasing.

### Differences:
- The bipolar input stage uses BJTs, while the CMOS input stage uses MOSFETs.
- The symbols for the transistors are different, reflecting the different types of transistors used in each circuit.

These input stages are fundamental building blocks in analog circuit design, particularly in operational amplifiers, where they determine the input characteristics such as input impedance, noise performance, and offset voltage.
```

Figure 18–4. Input Circuit of an RRI Op Amp

The RRI op amps have parallel input stages. There are both PNP and NPN differential amplifiers used in the input stages of the RRI op amp, thus the RRI op amp can operate above and below the power supply voltage. As Figure 18–4 shows, the parallel input stages can be made in bipolar or MOS technology.

The input stages operate in three different ranges. When the input voltage ranges from about –0.2 V to 1 V, the PNP differential amplifier is active and the NPN differential amplifier is cutoff. When the input voltage ranges from about 1 V to (VCC –1 V), both the NPN and PNP differential amplifiers are active. When the input voltage ranges from about (VCC –1 V) to (VCC + 0.2 V), the NPN differential amplifier is active and the PNP differential amplifier is cut off. Inclusion of complementary differential input amplifiers achieves VICR exceeding the power supply limits, but there is a penalty to pay in input bias current, input offset voltage, and distortion. Figures 18–5 and 18–6 show the input bias current and input offset voltage as a function of the input common-mode voltage.

Here is the image describtion:
```
The image is a graph depicting the relationship between the input bias current (I_IB) and the common-mode input voltage (V_IC) for the TLV245X operational amplifier. The graph is plotted with the following conditions: V_DD = 5 V and T_A = 25°C.

- The x-axis represents the common-mode input voltage (V_IC) in volts, ranging from 0 to 5 V.
- The y-axis represents the input bias current (I_IB) in nanoamperes (nA), ranging from -4 nA to 4 nA.

The curve on the graph shows how the input bias current changes with varying common-mode input voltage. The key observations from the graph are:

1. At V_IC = 0 V, the input bias current is approximately -3 nA.
2. As V_IC increases from 0 V to around 1 V, the input bias current rises sharply to about -1 nA.
3. Between V_IC = 1 V and V_IC = 3.5 V, the input bias current remains relatively stable, fluctuating slightly around -1 nA.
4. At V_IC = 3.5 V, the input bias current starts to increase more noticeably.
5. As V_IC approaches 5 V, the input bias current reaches approximately 3 nA.

The graph indicates that the input bias current is relatively stable over a wide range of common-mode input voltages but shows significant changes at the lower and upper ends of the voltage range.
```

Figure 18–5. Input Bias Current Changes with Input Common-Mode Voltage

Here is the image describtion:
```
The image is a graph that shows the relationship between the input offset voltage (V_IO) and the common-mode input voltage (V_IC) for a TLV245X operational amplifier. The graph is plotted with the following parameters:

- The x-axis represents the common-mode input voltage (V_IC) in volts (V), ranging from 0 to 5 V.
- The y-axis represents the input offset voltage (V_IO) in microvolts (µV), ranging from -100 µV to 100 µV.

The graph is labeled with the following conditions:
- V_CC = 5 V (the supply voltage is 5 volts)
- T_A = 25°C (the ambient temperature is 25 degrees Celsius)

The curve on the graph shows how the input offset voltage varies with the common-mode input voltage. The curve starts at around 80 µV when V_IC is 0 V. As V_IC increases, the input offset voltage decreases sharply to around 20 µV at approximately 0.5 V. The curve then gradually decreases to 0 µV as V_IC approaches 2.5 V. After 2.5 V, the input offset voltage remains relatively stable around 0 µV until V_IC reaches approximately 4 V. Beyond 4 V, the input offset voltage decreases sharply again, reaching around -80 µV at V_IC = 5 V.

The graph provides a visual representation of how the input offset voltage of the TLV245X operational amplifier changes with varying common-mode input voltages under the specified conditions.
```

Figure 18–6. Input Offset Voltage Changes with Input Common-Mode Voltage

When both transistors are conducting current the input bias currents have a tendency to cancel, so in the range of ±1 V, the bias current is extremely low even when bipolar transistors are used to make the op amp. Above this range, the PNP differential amplifier cuts off so the full bias current requirement of the NPN transistor becomes apparent. The same action happens below this range when the NPN differential amplifier cuts off. Notice that the PNP bias current is significantly larger than the NPN bias current; this is expected because NPN transistors have better gain characteristics than PNP transistors. The baseemitter voltage of the NPN and PNP transistors is well matched because the magnitude of the input offset voltage at the extremes is almost equal.

The bias current and offset voltage variation with input signal amplitude cause errors and distortion of the input signal. Inserting a resistance equal to the parallel combination of RF and RG into the positive op amp lead minimizes the effect of input bias current. The resistor, RP, has the same voltage drop across it that the parallel combination of RF and RG has, hence the bias current is converted to a common-mode voltage. The commonmode voltage is normally in the µV-range because IIB is in the fractional nA range and RP is in the tens of KΩ. The CMMR is approximately 60 dB, so the input bias current effect is reduced to the nV range where it is insignificant compared to the offset voltage. The input offset current is multiplied by RP, and it shows up as an input error. If the design can't tolerate these errors it is wise to switch to a CMOS op amp because its input currents are in the pA range.

Another type of error creeps in when complementary differential amplifiers are used to obtain DR, and this error is results from the different gain of the PNP and NPN transistors. Op amps always suffer to a limited extent from distortion introduced by different gains when operating in different quadrants The positive quadrant is above VCC/2 where NPN transistors operate, and the negative quadrant is below VCC/2 where the PNP transistors operate. Normally, this is a very minor effect because only the gain of the output stage changes with quadrant, but with complementary input stages the input and output gains change with quadrant. These errors are small, and they are accepted as the sacrifice required for obtaining RRI operation.

# **18.5 Output Voltage Swing**

Rail-to-rail output voltage swing (RRO) is desirable for at least two reasons. First, the DR can achieve the maximum obtainable value if the op amp is RRO. Second RRO op amps can drive any converter connected to the same power supply if the impedance is compatible. The schematic of a RRO op amp output stage, part of the TLC227X, is shown in Figure 18–7.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit, specifically a push-pull amplifier configuration using MOSFETs. Here is a detailed description of the components and connections:

1. **Input Stage**: 
   - The left side of the diagram shows a block labeled "Input stage," which is responsible for processing the input signal. It has two input terminals marked with "+" and "-".

2. **Power Supply**:
   - The top horizontal line is labeled "VCC," indicating the positive power supply voltage.
   - The bottom horizontal line is labeled "Ground," indicating the reference voltage or zero potential.

3. **MOSFETs**:
   - There are two MOSFETs in the circuit, one N-channel and one P-channel, arranged in a push-pull configuration.
   - The MOSFET at the top is a P-channel MOSFET. Its source (S) is connected to VCC, its gate (G) is connected to the output of the input stage, and its drain (D) is connected to the output node.
   - The MOSFET at the bottom is an N-channel MOSFET. Its source (S) is connected to ground, its gate (G) is connected to the output of the input stage, and its drain (D) is connected to the output node.

4. **Resistors**:
   - There are two resistors in the circuit. One resistor is connected between the gate of the P-channel MOSFET and the output node. The other resistor is connected between the gate of the N-channel MOSFET and ground.

5. **Output**:
   - The output node is located at the junction where the drains of both MOSFETs meet. This node provides the amplified output signal.

The circuit operates by using the input stage to drive the gates of the MOSFETs, which in turn control the current flow through the MOSFETs. The push-pull configuration allows for efficient amplification of the input signal, with the P-channel MOSFET conducting during the positive half-cycle and the N-channel MOSFET conducting during the negative half-cycle of the input signal.
```

# Figure 18–7. RRO Output Stage

The RRO characteristic is achieved in the construction of the op amp output stage. A totem pole design that has upper and lower output transistors is used, and the output transistors are a complimentary pair. Each transistor in the pair is a "self-locking" type of transistor operating in the common-source mode. Consider the p-channel output transistor; as long as this transistor has a drain-source resistance it forms a voltage divider with the load resistance. When the load is a very large resistor or if the output current flow is very small, the voltage drop across the output transistor can be neglected. Output current flows through the output transistor, and because current drops a voltage (VDS) across the drainsource resistor, the output voltage swing is reduced. The voltage drop subtracts from the power supply voltage, reducing the output voltage to less than RRO.

RRO op amps can't drive heavy loads and maintain their RRO capability because of the voltage dropped across the output transistors. Load resistance or output current is a test condition when the measurement of an op amp's output voltage swing is made. The size of the load resistor or output current is a measure of the op amp's ability to retain its RRO capability while sourcing or sinking an output current. When selecting a RRO op amp, the designer must consider the load resistance or output current required because these conditions control the output voltage swing.

When an op amp is made that has RRI and RRO capability, it is called a rail-to-rail input/ output op amp. This long name is shortened to RRIO.

# **18.6 Shutdown and Low Current Drain**

Low voltage design often is accompanied by a requirement that the power supply current drain be low. The power supply current drain is kept low to decrease battery size and prolong battery charge so recharging can be put off as long as possible. Many methods are employed to keep the current drain low including using high-value resistors, low bias current regulators/references, slow speed logic, keeping logic transitions to a minimum, low voltage power supplies, selecting op amps for low current drain, and shutting off unused ICs.

High-value resistors have less current flowing through them than low value resistors do, and they can be used effectively in ratio applications, but there are some downsides to using high-value resistors. When resistor values exceed 2 MΩ to 10 MΩ, depending on the type of resistor, the temperature drift, vibration, and time-induced drift increases rapidly compared to that of lower value resistors. The input resistor to an op amp, RG, works with the stray capacitance from the input node to ground to form a pole in the loop gain. As the resistance increases, the pole moves towards the zero frequency intercept and the circuit overshoots, rings, or becomes unstable. The feedback resistor, RF, works with stray capacitance in parallel with RF to form a low-pass filter. Sometimes this filter action is desirable, but the filter often distorts the signal.

Very often, low bias current regulators and references are just standard ICs specified at a lower current. These devices generally do not have the same small tolerances at low bias currents that they had at high bias currents. Although they are more often costly, redesigned low bias current regulators and references are becoming available. Ensure that the reference or regulator bias current used in the application is the same as that used to specify the device, because sometimes the error curves for references are nonlinear. Also, investigate the reference noise voltage to ensure that low bias current has not moved the device to a noisy portion of its operating curve.

Saturated logic is the choice for low current drain applications because nonsaturated logic stays in the active region and has a higher current drain. Always pick the slowest logic gates that you can get away with. Speed in saturated logic requires enough current to drive low impedance loads, and that means high power supply currents coupled with logic-generated noise. High-speed logic has a low impedance totem pole output stage, and every time the output is switched, both totem pole transistors are on causing a current spike through the power supply. Large decoupling capacitors are required to localize the current spike at the logic IC, thus preventing noise propagation. CMOS logic draws the least quiescent current, and if the logic transitions are kept at a minimum, the current drain stays small. One method of minimizing logic transitions is to use asynchronous logic.

The op amp should be selected with current drain in mind. Three rail-to-rail op amps have widely differing current drains because they are designed for different applications. The TLV240X is designed for micropower applications, and its current drain is 1.29 µA. The TLV411X is designed high output drive, and its current drain is 800 µA. The TLV287X is designed for high speed, and its current drain is 820 µA. These three op amps are low-voltage op amps, but they each serve a different application.

The best method of conserving current is to shut the op amp down if you are not using it. Most op amps designed for low voltage applications have shutdown pins. A typical op amp that draws 820 µA when operating, draws 1.7 µA when it is shut down. The problem with shutdown is the time that it takes to wake the op amp up and knowing when to wake the op amp up. A typical low-voltage op amp turns on in less that 1 µs, but the system designer usually has to choose the variable that eventually wakes the op amp up.

# **18.7 Single-Supply Circuit Design**

The op amp is a linear device, so it follows the equation of a straight line. The equation of a straight line has four forms as shown in Equation 18–8.

$$\mathbf{y} = \pm \,\,\mathsf{m}\mathbf{x} \pm \mathsf{b} \tag{18-8}$$

These four forms can be implemented with four single supply circuits. When the designer discovers the form of Equation 18–8 that yields the transform function required, it is a small task to find the corresponding circuit. Once the circuit and transfer function are established, the task reduces to matching coefficients between the transfer function and the circuit equation, and then calculating the resistor values. The key required to unlock the puzzle is to determine the form of Equation 18–8 that yields the required transfer function. This key is found in simultaneous equations because they define the equation of a straight line. Several examples of using simultaneous equations to determine the required form of the op amp transfer function are given in the next two sections.

# **18.8 Transducer to ADC Analog Interface**

An example is a transducer that needs to be interfaced to an ADC. The transducer specifications are VMIN = 0.2 V, VMAX = 0.5 V, and ROUT = 600 Ω. The ADC specifications are VIN(LOW) = 1.5 V, VIN(HIGH) = 4.5 V, and RIN = 20 kΩ. The system specifies a 5-V power supply and 5% tolerance resistors. The transducer is connected to input of the amplifier (see Figure 18–8), so its output voltage swing is renamed VIN, and the ADC is connected to the output of the amplifier, so its input voltage range is renamed VOUT. Now, two data points are constructed as VIN1 = 0.2 V @ VOUT1 = 1.5 V and VIN2 = 0.5 V @ VOUT2 = 4.5 V. The data points are substituted into the equation Y = mX + b; m is named the slope and b is named the X axis intercept or just the intercept for short. Don't worry about the sign of m or b because it is determined by the math, and it is substituted into the equation that determines the transfer equation. The simultaneous equations are given below.

Here is the image describtion:
```
The image depicts a block diagram of a signal processing system. The system consists of three main components arranged in series: a Transducer, an Amplifier, and an ADC (Analog-to-Digital Converter). Here is a detailed description of each component and their connections:

1. **Transducer**: 
   - The first block on the left is labeled "Transducer."
   - The transducer is responsible for converting a physical quantity (such as temperature, pressure, or sound) into an electrical signal.

2. **Amplifier**:
   - The second block in the middle is labeled "Amplifier."
   - The amplifier receives the electrical signal from the transducer and increases its amplitude to a suitable level for further processing.
   - There is a ground symbol connected to the input of the amplifier, indicating that the signal is referenced to ground.

3. **ADC (Analog-to-Digital Converter)**:
   - The third block on the right is labeled "ADC."
   - The ADC receives the amplified analog signal and converts it into a digital signal.
   - There is a ground symbol connected to the input of the ADC, indicating that the signal is referenced to ground.

4. **Digital Output**:
   - The output of the ADC is labeled "Digital Output."
   - This represents the final digital signal that can be used for further digital processing or analysis.

**Connections**:
- The transducer is connected to the amplifier with a single arrow indicating the direction of the signal flow.
- The amplifier is connected to the ADC with a single arrow indicating the direction of the signal flow.
- The ADC outputs the digital signal, represented by an arrow pointing to the right labeled "Digital Output."

Overall, the diagram illustrates the process of converting a physical quantity into a digital signal through the stages of transduction, amplification, and analog-to-digital conversion.
```

Figure 18–8. Data Acquisition System

$$\mathbf{1.5} = \mathbf{0.2m} + \mathbf{b} \tag{18-9}$$

$$\mathbf{4.5} = \mathbf{0.5m} + \mathbf{b} \tag{18-10}$$

From these equations we find that b = –0.5 and m = 10. The slope and intercept values are substituted into Equation 18–8 to get Equation 8–11.

$$\mathbf{Y} = \mathbf{1} \mathbf{0} \mathbf{X} - \mathbf{0}.\mathbf{5} \tag{18-\text{7}}$$

The mathematical terminology in Equation 18–11 is replaced by electronics terminology in Equation 18–12, and this is the transfer function required for the amplifier. The next step is to select the op amp, and this isn't a hard task because there are many candidates that could do the job with these undemanding specifications, so let us not dwell on the selection process. Assume that the selected op amp operates on a 5-V power supply, can drive the ADC input resistance of 20 kΩ with no voltage divider action, and that the op amp input impedance is so big that it doesn't load the transducer.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{T}\mathsf{OV}\_{\mathsf{N}} - \mathsf{O}.\mathsf{5} \tag{78-72}$$

The circuit that produces the desired transfer function is given in Figure 18–9.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with various components connected to it. Here is a detailed description of the circuit:

1. **Voltage Sources:**
   - There are two voltage sources in the circuit:
     - \( V_{REF} \): This voltage source is connected to the leftmost part of the circuit.
     - \( V_{IN} \): This voltage source is connected to the non-inverting input (marked with a "+") of the op-amp.

2. **Resistors:**
   - \( R_1 \): This resistor is connected in series with \( V_{REF} \).
   - \( R_2 \): This resistor is connected between the node where \( R_1 \) and \( R_G \) meet and ground.
   - \( R_G \): This resistor is connected in series with \( R_1 \) and \( R_2 \), and it connects to the inverting input (marked with a "-") of the op-amp.
   - \( R_F \): This resistor is connected between the output of the op-amp and the inverting input, forming a feedback loop.
   - \( R_L \): This resistor is connected between the output of the op-amp and ground.

3. **Capacitor:**
   - A capacitor with a value of 0.01 µF is connected between the power supply \( V_{CC} \) and ground. This capacitor is likely used for power supply decoupling to filter out noise.

4. **Operational Amplifier (Op-Amp):**
   - The op-amp has three main connections:
     - The non-inverting input ("+") is connected to \( V_{IN} \).
     - The inverting input ("-") is connected to the node where \( R_G \) and \( R_F \) meet.
     - The output is connected to \( R_F \) and \( R_L \), and it provides the output voltage \( V_{OUT} \).

5. **Power Supply:**
   - The op-amp is powered by a voltage supply \( V_{CC} \), which is connected to the positive power supply pin of the op-amp.

6. **Ground Connections:**
   - Several components are connected to the ground, including \( V_{REF} \), \( V_{IN} \), \( R_2 \), \( R_L \), and the capacitor.

Overall, this circuit appears to be a configuration of an op-amp with feedback, possibly a differential amplifier or an instrumentation amplifier, depending on the specific values and purposes of the resistors and voltage sources. The feedback resistor \( R_F \) and the resistors \( R_1 \), \( R_2 \), and \( R_G \) play crucial roles in determining the gain and behavior of the circuit.
```

Figure 18–9. Schematic for the Transducer to ADC Interface Circuit

The circuit equation is obtained with the aid of superposition.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{T}} \, \|\, \mathsf{R}\_{2} \right) - \mathbb{V}\_{\mathsf{R} \to \mathsf{F}} \left( \frac{\mathsf{R}\_{2}}{\mathsf{R}\_{\mathsf{T}} + \mathsf{R}\_{2}} \right) \bigg( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{T}} \, \|\, \mathsf{R}\_{2} \right) \tag{18-13}$$

Comparing terms between Equations 18–12 and 18–13 enables the extraction of m and b.

$$\mathfrak{M} = \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{1}} \parallel \mathsf{R}\_{\mathsf{2}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_{\mathsf{1}} \parallel \mathsf{R}\_{\mathsf{2}}} \right) \tag{18-14}$$

$$\left| \mathbf{b} \right| = \mathbb{V}\_{\mathbb{R} \to \mathbb{F}} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}} + \mathsf{R}\_1 \parallel \mathsf{R}\_2} \right) \tag{18-15}$$

Making the assumption that R1||R2<<RG simplifies the calculations.

$$\mathbf{m} = \mathbf{10} = \frac{\mathbf{R\_{F}} + \mathbf{R\_{G}}}{\mathbf{R\_{F}}} \tag{18-16}$$

$$
\mathsf{R}\_{\mathsf{F}} = \mathsf{GR}\_{\mathsf{G}} \tag{18-17}
$$

Let RG = 20 kΩ, and then RF = 180 kΩ, add, and let VREF = VCC.

$$|\mathbf{b}| = \mathsf{V}\_{\mathsf{CC}} \begin{pmatrix} \mathsf{R}\_{\mathsf{F}} \\ \overline{\mathsf{R}}\_{\mathsf{G}} \end{pmatrix} \begin{pmatrix} \mathsf{R}\_{2} \\ \overline{\mathsf{R}}\_{1} + \mathsf{R}\_{2} \end{pmatrix} \tag{18-18}$$

$$\mathbf{R}\_1 = \frac{\mathbf{1} - \mathbf{0}.01111}{\mathbf{0}.01111} \mathbf{R}\_2 = \mathbf{89R}\_2 \tag{18-19}$$

Select R2 = 0.82 kΩ and R1 = 72.98 kΩ. Since 72.98 kΩ is not a standard 5% resistor value, R1 is selected as 75 kΩ. The difference between the selected and calculated value

Designing Low-Voltage Op Amp Circuits 18-15

of R1 introduces about 3% error in the b coefficient, and this error shows up in the transfer function as an intercept rather than a slope error. The parallel resistance of R1 and R2 is approximately 0.82 kΩ and this is much less than RG which is 20 kΩ, thus the earlier assumption that R1||R2<<RG is justified. R2 could have been selected as a smaller value, but the smaller values yielded poor standard 5% values for R1. The final circuit is shown in Figure 18–10.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit configured as a non-inverting amplifier with additional components for biasing and filtering. Here is a detailed description of the circuit:

1. **Power Supply:**
   - The op-amp is powered by a +5V supply connected to its positive power supply pin.

2. **Input Stage:**
   - The input signal \( V_{IN} \) is provided by a voltage source symbolized by a circle with a sine wave inside it, indicating an AC signal.
   - The input signal is connected to a voltage divider formed by resistors \( R_1 \) (75 kΩ) and \( R_2 \) (820 Ω). This voltage divider is used to set a bias point for the input signal.
   - A capacitor (0.01 µF) is connected in parallel with \( R_2 \) to ground, which acts as a decoupling capacitor to filter out any noise or AC components from the bias voltage.

3. **Non-Inverting Input:**
   - The non-inverting input (+) of the op-amp is connected to the junction of \( R_1 \) and \( R_2 \), which provides the biased input signal.

4. **Feedback Network:**
   - The feedback network consists of a resistor \( R_F \) (180 kΩ) connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
   - Another resistor \( R_G \) (20 kΩ) is connected between the inverting input (-) and ground.
   - This configuration sets the gain of the amplifier. The gain \( A_v \) of a non-inverting amplifier is given by \( A_v = 1 + \frac{R_F}{R_G} \).

5. **Output Stage:**
   - The output \( V_{OUT} \) is taken from the output pin of the op-amp.
   - A capacitor (0.01 µF) is connected between the output and ground, which acts as a decoupling capacitor to filter out high-frequency noise from the output signal.

Overall, this circuit is designed to amplify the input signal \( V_{IN} \) with a specific gain determined by the feedback resistors \( R_F \) and \( R_G \), while also providing biasing and filtering to ensure stable and clean operation.
```

Figure 18–10. Final Schematic for the Transducer to ADC Interface Circuit

# **18.9 DAC to Actuator Analog Interface**

An amplifier is also used to interface a DAC with an actuator (see Figure 18–11).

Here is the image describtion:
```
The image depicts a block diagram of a system that converts digital signals into physical motion. The system consists of three main components arranged in sequence:

1. **DAC (Digital-to-Analog Converter)**: This is the first block in the diagram. It converts digital signals into analog signals. The output of the DAC is connected to the input of the next block, the Amplifier.

2. **Amplifier**: This is the second block in the diagram. It takes the analog signal from the DAC and amplifies it. The amplifier has two outputs, both of which are connected to the inputs of the next block, the Actuator. Additionally, there is a ground connection shown at the input of the amplifier.

3. **Actuator**: This is the third block in the diagram. It receives the amplified analog signals from the Amplifier and converts them into physical motion. The output of the Actuator is labeled "Physical Motion Out," indicating that the final output of the system is a physical movement.

The flow of the signal is from left to right, starting from the DAC, passing through the Amplifier, and finally reaching the Actuator, which produces the physical motion.
```

Figure 18–11. Digital Control System

The interface is different from the ADC interface because the DAC output signal is usually current rather than voltage. The first inclination is to stuff the DAC output into a current-tovoltage converter like we have always done with split power supplies. This doesn't always work because the DAC current can be sinked or sourced from ground or the power supply. If a current sourced from the positive power supply is put into a standard current-to-voltage circuit, it wants to drive the op amp output negative, and you need a negative resistor to counter this. The alternate solution for a sourced current from the positive power supply is to terminate the DAC output in a resistor that converts current into voltage, and then level shift and amplify the terminated voltage. The circuit that performs this function is shown in Figure 18–12.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with a positive (+) and negative (-) input terminal.
   - The positive input terminal is connected to a voltage source labeled +Vcc.
   - The negative input terminal is connected to a node that is part of the feedback loop.

2. **Current Source (I)**:
   - There is a current source labeled "I" connected to a resistor labeled RT.
   - The current source is connected to the positive supply voltage +Vcc.
   - The other end of the resistor RT is connected to ground.

3. **Resistors**:
   - There are three resistors in the circuit: RT, RG, and RF.
   - RT is connected between the current source and ground.
   - RG is connected between a reference voltage source (VREF) and the node that connects to the negative input terminal of the op-amp.
   - RF is connected between the output of the op-amp (VOUT) and the node that connects to the negative input terminal of the op-amp.

4. **Voltage Sources**:
   - There is a reference voltage source labeled VREF connected to one end of resistor RG.
   - The op-amp is powered by a positive supply voltage +Vcc.

5. **Connections**:
   - The node where RG and RF meet is connected to the negative input terminal of the op-amp.
   - The output of the op-amp (VOUT) is connected to one end of resistor RF.
   - The positive input terminal of the op-amp is connected to the positive supply voltage +Vcc.

The circuit appears to be a type of feedback amplifier, where the output voltage (VOUT) is influenced by the reference voltage (VREF), the current source (I), and the resistors (RT, RG, and RF). The feedback loop formed by RF and the connection to the negative input terminal of the op-amp helps to stabilize and control the output voltage.
```

Figure 18–12. DAC Current Source to Actuator Interface Circuit

The DAC output current sources from IOUT(ZEROS) = 1 mA to IOUT(ONES) = 2 mA at an output compliance of 4.33 V. The actuator requires an input voltage swing of VIN1 = 1 V to VIN2 = 4 V to drive it, and its input resistance is 100 kΩ. The system specifications include one 5-V power supply and 5% resistors. The DAC is connected to input of the amplifier (see Figure 18–11), so its output current swing is renamed IIN, and the actuator is connected to the output of the amplifier, so its input voltage range is renamed VOUT. Now, two data points are constructed as IIN1 = 1 mA @ VOUT1 = 1 V and IIN2 = 2 mA @ VOUT2 = 4 V. The data points are substituted into the Equation 18–20. Don't worry about the sign of m or b because it is determined by the math, and it is substituted into the equation that determines the transfer equation. The simultaneous equations are given below.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{m}|\_{\mathsf{IN}} + \mathsf{b} \tag{18-20}$$

$$\mathfrak{A} = \mathfrak{m} + \mathfrak{b} \tag{18-27}$$

$$\mathbf{4} = 2\mathbf{m} + \mathbf{b} \tag{18-22}$$

From these equations we find that b = –2 and m = 3. The slope and intercept values are substituted into Equation 18–20 to get Equation 18–23.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{3}|\_{\mathsf{N}} - 2 \tag{18-23}$$

The equation for the circuit shown in Figure 18–12 is derived with the aid of superposition, and it is given below in Equation 18–24.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\_{\mathsf{IN}} \mathsf{R}\_{\mathsf{T}} \left( \mathsf{I} + \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \right) - \mathsf{V}\_{\mathsf{R} \mathsf{EF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{18-24}$$

Comparing terms between Equations 18–20 and 18–24 enables the extraction of m and b.

Designing Low-Voltage Op Amp Circuits 18-17

$$|\mathbf{b}| = \mathsf{V}\_{\mathsf{REF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{18-25}$$

$$\mathbf{m} = \mathbf{R}\_{\sf T} \left( \mathbf{1} + \frac{\mathbf{R}\_{\sf F}}{\mathbf{R}\_{\sf G}} \right) \tag{18-26}$$

$$\frac{\mathcal{R}\_{\text{F}}}{\mathcal{R}\_{\text{G}}} = \frac{2}{5} \tag{18-27}$$

$$\mathcal{R}\_{\mathsf{T}} = \frac{\mathsf{5}\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} + \mathsf{1}}{\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} + \mathsf{1}} = \text{2.14} \tag{18-28}$$

These equations are written in terms of mA and kΩ, so RT = 2.14 kΩ. There is no 2.14-kΩ resistor in the 5% standard values; thus, RT is split into 1.8-kΩ and 0.33-kΩ resistors. RG is selected as 51 kΩ, so RF = 20 kΩ. When IIN = 2 mA VRT = 4.28 V, so the compliance of the DAC is not violated. You might find that standard DACs are not so generous with their compliance specifications.

When the current is sinked from the power supply by the DAC its sign reverses and the previous circuit is not usable. Consider these specifications: the DAC output sinks current from the power supply IOUT(ZEROS) = –1 mA to IOUT(ONES) = –2 mA at an output compliance of 4.33 V. The actuator requires an input voltage swing of VIN1 = 1 V to VIN2 = 4 V to drive it, and its input resistance is 100 kΩ. The system specifications include one 5-V power supply and 5% resistors. The DAC is connected to input of the amplifier (see Figure 18–11), so its output current swing is renamed IIN, and the actuator is connected to the output of the amplifier, so its input voltage range is renamed VOUT. Now, two data points are constructed as IIN1 = –1 mA @ VOUT1 = 1 V and IIN2 = –2 mA @ VOUT2 = 4 V. The data points are substituted into the Equation 18–20. Don't worry about the sign of m or b because it is determined by the math, and it is substituted into the equation that determines the transfer equation. The transfer function for the current sink DAC is given in Equation 18–29.

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\_{\mathsf{N}} \mathsf{m} + \mathsf{b} \tag{18-29}$$

The simultaneous equations are given below.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a comparator configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with two input terminals and one output terminal.
   - The non-inverting input (+) is connected to the ground.
   - The inverting input (-) is connected to a node where two resistors meet.
   - The op-amp is powered by a dual power supply, with +V connected to the positive power rail and -V connected to the negative power rail.

2. **Resistors (RF)**:
   - There are two resistors labeled RF.
   - One RF resistor is connected between the output of the op-amp (Vo) and the inverting input (-).
   - The other RF resistor is connected between the inverting input (-) and a node that connects to a voltage source (VREF).

3. **Voltage Sources**:
   - There is a triangular symbol representing an AC voltage source connected to the top of the circuit, providing a varying voltage signal.
   - A DC voltage source labeled VREF is connected to the node between the two RF resistors, providing a reference voltage.

4. **Connections**:
   - The AC voltage source is connected to the top of the first RF resistor.
   - The other end of the first RF resistor is connected to the inverting input (-) of the op-amp and to one end of the second RF resistor.
   - The other end of the second RF resistor is connected to the VREF voltage source.
   - The output of the op-amp (Vo) is connected to the right end of the first RF resistor.

In summary, this circuit is a comparator with hysteresis, where the op-amp compares the input AC signal with the reference voltage (VREF). The feedback provided by the resistors RF creates hysteresis, which helps to stabilize the output and prevent rapid switching due to noise or small fluctuations in the input signal.
```

Figure 18–13. DAC Current Sink to Actuator Interface Circuit

$$\mathbf{M} = -\mathbf{m} + \mathbf{b} \tag{18-30}$$

$$\mathbf{4} = -\mathbf{2} + \mathbf{b} \tag{18-34}$$

From these equations we find that b = –2 and m = –3. The slope and intercept values are substituted into Equation 18–28 to get Equation 18–32.

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{I}\_{\mathsf{IN}} \text{ (--m)} - \mathsf{D} = \mathsf{MI}\_{\mathsf{IN}} - \mathsf{D} \tag{18-32}$$

The current equation for the circuit shown in Figure 18–13 is given below as Equation 18–33, and after algebraic manipulation it becomes Equation 18–34.

$$\frac{\mathsf{V\_{OUT}}}{\mathsf{R\_{F}}} = \mathsf{l\_{IN}} - \frac{\mathsf{V\_{REF}}}{\mathsf{R\_{G}}} \tag{18-33}$$

$$\mathsf{V}\_{\mathsf{OUT}} = \mathsf{I}\_{\mathsf{IN}} \mathsf{R}\_{\mathsf{F}} - \mathsf{V}\_{\mathsf{REF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{18-34}$$

Comparing terms between Equations 18–29 and 18–34 enables the extraction of m and b.

$$\mathcal{R}\_{\mathbb{F}} = |\mathfrak{m}| = \mathfrak{3} \tag{18-35}$$

$$\left|\mathbf{b}\right| = \mathbb{V}\_{\mathbb{R}\mathbb{E}\mathbb{F}} \frac{\mathbf{R}\_{\mathbb{F}}}{\mathbf{R}\_{\mathbb{G}}} \tag{18-36}$$

$$\frac{\mathbf{R\_{F}}}{\mathbf{R\_{G}}} = \frac{2}{5} \tag{18-37}$$

These equations are written in terms of mA and kΩ. RG is selected as 51 kΩ, so RF = 20 kΩ. When IIN = 2 mA, the compliance of the DAC is 0.0 V.

Designing Low-Voltage Op Amp Circuits 18-19

When DAC interface circuits are designed, two parameters that have not been considered in detail can control the design. The DAC has a compliance voltage requirement, and that requirement must be met regardless of the circuit demands. If the DAC compliance requirements are not met, the DAC saturates or is starved for current, and either of these situations introduces considerable error. The actuators driven in these examples are quite benign because most actuators require considerably more current or voltage than is available from an op amp. This fact does not negate the analysis given here. Regardless of the actuator current or voltage requirements, the design procedure is similar. Very often the low voltage device is plugged into a booster that supplies power to the actuator.

One last item to consider is the output capacitance of DACs. The DAC output can have large amounts of stray capacitance that shows up as a capacitor across the op amp inverting input node when the DAC is interfaced into circuits as shown in Figure 18–13. The DAC capacitance from the inverting node to ground acts with RG to form a pole in the op amp loop gain. Adding a pole to the op amp loop gain leads to overshoot, then ringing, and finally oscillation. The effect that the DAC capacitance has on stability must be investigated. Also, the DAC output capacitance is a function of the digital number addressing the DAC. This capacitance can range from near zero to hundreds of pF, thus the op amp must be compensated for the worst case which is the largest capacitance.

Compensation schemes include connecting a capacitor across the feedback resistor. This compensation scheme is called a compensated attenuator, and if the RC time constants are equal, there will excellent performance at that DAC output capacitance. Alas, the circuit can only be ideally compensated at one point, and this point is normally chosen as the highest DAC output capacitance. The remainder of the DAC range suffers from poor bandwidth because of overcompensation.

# **18.10 Comparison of Op Amps**

Since the author is only familiar with Texas Instruments op amps, a comparison involving actual op amp parameters would be unfair to other op amp manufacturers. Also, any comparison using today's production op amps becomes invalid in a short period of time. I write about Texas Instruments op amps, so I get plenty of samples, and the new product introductions come so fast that I have a hard time keeping up with them. The other point to consider is that teaching how to make the op amp comparison is a much more powerful tool, thus a table containing the op amp parameters is established, and each of the parameters is discussed only in terms of low-voltage design.

| PARAMETER | RANGE OF VALUES                | UNITS            | DISCUSSION                                                                                           |
|-----------|--------------------------------|------------------|------------------------------------------------------------------------------------------------------|
| VIO       | 25 to 8000                     | mV               | DC parameter that can be adjusted out.                                                               |
| α VIO     | 3 to 1000                      | oC<br>µV/        | Drift parameter that ends up as an error.                                                            |
| IIB       | 0.1 to 9999                    | pA               | Input bias current that can be cancelled out.                                                        |
| IIO       | 0.1 to 9999                    | pA               | Input offset current that can be adjusted out.                                                       |
| RIN       | 0.0002 to 1                    | GΩ               | Acts as a voltage divider with driving circuit.                                                      |
| CMRR      | 0 to 90                        | dB               | Common-mode voltage is a nonlinear error.                                                            |
| AVD       | 20 to 140                      | dB               | Determines high-frequency errors.                                                                    |
| VICR      | VCC<br>–1.5 V to VCC<br>+0.5 V | V                | Input voltage range over which op amp works correctly with spe<br>cified error.                      |
| VOH       | VCC<br>–1.5 V to VCC<br>+0.5 V | V                | Maximum high output voltage swing. Load resistance or current<br>is important. Limits dynamic range. |
| VOL       | 0 + 1.5 V to 0 – 1.5 V         | v                | Minimum low output voltage swing. Load resistance or current is<br>important. Limits dynamic range.  |
| IO        | 1 to 100                       | mA               | Current available to drive loads.                                                                    |
| ICC       | 0.1 to 10000                   | µA               | Power supply current.                                                                                |
| kSVR      | 20 to 120                      | dB               | Power supply noise rejection.                                                                        |
| ICC(SHDN) | 0.01 to 100                    | µA               | Power supply current in shutdown mode.                                                               |
| Vn        | 1 to 1000                      | nV<br>12<br>(Hz) | Noise voltage limits dynamic range.                                                                  |
| In        | 0.01 to 100                    | fA<br>12<br>(Hz) | Noise current limits dynamic range.                                                                  |
| t(ON)     | 0.5 to 10                      | µs               | Op amp wake up time.                                                                                 |
| t(OFF)    | 0.1 to 5                       | µs               | Time until power supply current reaches ICC(SHDN).                                                   |

#### Table 18–2. Op Amp Parameters

As the table shows, there are a lot of parameters to be considered in the selection of a low voltage op amp. The application weeds out some of these parameters thus easing the selection process. If the application is measuring the output from a low-bandwidth transducer such as a thermocouple, bandwidth is not a parameter of interest, so speed can immediately be sacrificed for power supply current.

When the maximum supply voltage available is 3 V, rafts of op amps requiring more than 3 V operating voltage are eliminated. Taking this concept further, if dynamic range is an important specification in the 3-V design, those op amps that operate on 3 V without RRIO specifications can be eliminated. Because dynamic range is important, the noise voltage and current that detract from dynamic range are important parameters. If this 3-V application requires very low power supply current, the choice is narrowed down to a few candidates. The application selects the op amp, and if this application puts a few more requirements on the 3-V op amp, we may have to design a new IC.

Always start the selection process with the parameter that absolutely can't be wavered. The next parameter considered in the selection process should be the next most important parameter, and this process is continued parameter by parameter until all requirements are exhausted. Sometimes the supply of op amp candidates runs out before the parameter requirements do. When you reach this point, it is time to renegotiate the design specifications, find a new op amp, negotiate with op amp manufacturers, or announce that you won't meet specifications. These designs are hard to work because the low power supply voltage requirement and the specifications usually leave very little room to work. As time marches on, more low power supply voltage op amps will come on the market, and these designs will get easier to work.

# **18.11 Summary**

It is extremely hard to achieve large dynamic range when the application is limited to a low power supply voltage. In an attempt to approach the dynamic range obtained by ± 30-V power supply designs, the new op amp designs put increased emphasis on the output voltage swing. The ratio of output voltage swing to power supply voltage was 0.8 for ± 30-V powered op amps, 0.7 for the first 5-V powered op amps, and it has risen to 0.9 for the newest family of 1.8-V powered op amps. The ratio output voltage swing to power supply voltage has increased with each new generation of low power supply voltage op amps, but this improvement has reached the point of diminishing returns.

The op amp's dc offset diminishes the output voltage swing, but in most cases the offsets are adjusted out, so they have less importance in the design. New op amp technology is not being pushed hard to improve in this area because the passive components continue to require the adjustments. Drift and noise continue to decrease the dynamic range. Op amp noise has decreased in new-generation op amps, and another decrease should put noise in the category of "don't care" parameters.

The signal-to-noise ratio has several components that have to be analyzed. The signal comes to the op amp with a noise burden caused by the transducer, cabling, and connections. Making the op amp a filter/amplifier combination eliminates some of this noise. The biggest drawback to making the op amp a filter is the time required to charge the ADC input capacitance. ADC charging has not been investigated here because of scope limitations, but suffice it to say that filters slow down op amps. The internally-generated op amp noise is multiplied by the closed loop gain, and the SNR should be established in the front end, so the closed loop gain hurts one way and helps the other way. There is always system noise, and a portion of this noise propagates through the op amp into the signal. The system noise is minimized by extensive use of decoupling capacitors and a high power supply rejection ratio. In higher voltage systems, a resistor is placed in series with the power supply, thus making the decoupling capacitors more effective; low power supply voltage designs usually can't afford that trick.

RRI op amps are able to work with transducers connected to the power supply rails. As long as the ac component of the transducer output voltage does not exceed the input common-mode range of the op amp, the design is reliable. RRI op amps are troubled by distortion introduced by the change in bias current, input offset voltage, and gain, but their contribution to the system's signal handling capability is invaluable. RRO op amps yield the highest output voltage swing of any series of op amps. Beware: RRO op amps are specified at a load resistance or current, and the output voltage swing decreases dramatically when the load resistance or current is increased. RRIO op amps contain the input and output features of RRI and RRO op amps. They also contain the drawbacks of both features.

Shutdown is a current-saving feature that is becoming standard on RRIO op amps. When you are working off a battery, there is no reason to waste power when the electronics is not busy, and the shutdown feature accomplishes the power savings by turning the op amp off when it is not needed. The shutdown feature has a disadvantage in that it has a finite wakeup time that the designer must allow for. Don't just depend on shutdown to reduce current drain because there are other ways to reduce current drain, and some of these ways are using high value resistors, low speed logic, fewer logic transitions, and using low bias current regulators/references.

The final thing to be considered is that low power supply voltage invariably means singlesupply design, and single-supply design is tougher than split-supply design. Remember to get the two sets of data points, put them in simultaneous equations, solve for the slope and intercept, select the circuit configuration, and calculate the component values. DACs are a little different because you have to account for the polarity of the current, but their design generally follows the same procedure. A good reference for single supply design is the Texas Instruments application report Single Supply Op Amp Design Techniques (TI literature number SLOA030).

#### **Appendix A Appendix A**

# **Single-Supply Circuit Collection**

Ron Mancini and Richard Palmer

# **A.1 Introduction**

**VIN**

Portable and single-supply electronic equipment is becoming more popular each day. The demand for single-supply op amp circuits increases with the demand for portable electronic equipment because most portable systems have one battery. Split- or dual-supply op amp circuit design is straightforward because op amp inputs and outputs are referenced to the normally grounded center tap of the supplies. In the majority of split-supply applications, signal sources driving the op amp inputs are referenced to ground, thus with one input of the op amp referenced to ground, as shown in Figure A–1, there is no need to consider input common-mode voltage problems.

**VOUT**

$$
\lambda\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{IV}} \,\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}}
$$

**\_ +**

**+VCC**

**–VCC**

**RF**

Here is the image describtion:
```
The image is a graph depicting the relationship between the input voltage (V_IN) and the output voltage (V_OUT) of an operational amplifier (op-amp) circuit. The graph is a straight line with a negative slope, indicating an inverting configuration of the op-amp.

Here are the details of the graph and the circuit parameters:

1. **Axes:**
   - The horizontal axis (X-axis) represents the input voltage (V_IN) and is labeled "V_IN — 1 V/Div." It ranges from -5 V to +5 V.
   - The vertical axis (Y-axis) represents the output voltage (V_OUT) and is labeled "V_OUT — 1 V/Div." It also ranges from -5 V to +5 V.

2. **Line:**
   - The graph shows a straight line with a negative slope, indicating that as the input voltage increases, the output voltage decreases proportionally. This is characteristic of an inverting amplifier.

3. **Circuit Parameters:**
   - The input voltage (V_IN) is specified as 10 V peak-to-peak (Vp-p).
   - The positive supply voltage (+V_CC) is +5 V.
   - The negative supply voltage (-V_CC) is -5 V.
   - The feedback resistor (R_F) and the gain resistor (R_G) are both 10 kΩ.
   - The operational amplifier used is a TLC071.

4. **Graph Characteristics:**
   - The graph shows a linear relationship between V_IN and V_OUT, with the output voltage ranging from +5 V to -5 V as the input voltage ranges from -5 V to +5 V.
   - The slope of the line is -1, indicating a gain of -1 for the inverting amplifier configuration.

In summary, the image illustrates the behavior of an inverting op-amp circuit with a gain of -1, using a TLC071 op-amp, with specified supply voltages and resistor values. The graph shows a linear, negative relationship between the input and output voltages.
```

Here is the image describtion:
```
The image contains a text label that reads "Figure A-1. Split-Supply Op Amp Circuit." The text is in a standard font and appears to be a caption or title for a figure, likely from a technical document or textbook related to electronics or electrical engineering. The text indicates that the figure is the first in a series (A-1) and pertains to an operational amplifier (op amp) circuit that uses a split power supply.
```

**RG**

A–1A

When the signal source is not referenced to ground (see Figure A–2 and Equation A–1B), the voltage difference between ground and the reference voltage shows up amplified in the output voltage. Sometimes this situation is OK, but other times the difference voltage must be stripped out of the output voltage.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right. 

### Circuit Diagram:
- **Components:**
  - An operational amplifier (op-amp) with its inverting input (-) connected to a resistor \( R_G \) and its non-inverting input (+) connected to the ground.
  - The inverting input is also connected to a voltage source \( V_{IN} \) through the resistor \( R_G \).
  - A feedback resistor \( R_F \) connects the output of the op-amp to the inverting input.
  - The op-amp is powered by a dual power supply, with \( +V_{CC} \) and \( -V_{CC} \) connected to the positive and negative power supply pins, respectively.
  - A reference voltage \( V_{REF} \) is connected to the non-inverting input (+) of the op-amp.

- **Equation:**
  - The output voltage \( V_{OUT} \) is given by the equation:
    \[
    V_{OUT} = - \left( V_{IN} + V_{REF} \right) \frac{R_F}{R_G}
    \]

### Graph:
- **Axes:**
  - The horizontal axis represents the input voltage \( V_{IN} \) ranging from -5V to +5V, with a scale of 1V per division.
  - The vertical axis represents the output voltage \( V_{OUT} \) ranging from -5V to +5V, with a scale of 1V per division.

- **Plot:**
  - The graph shows a straight line with a negative slope, indicating an inverse relationship between \( V_{IN} \) and \( V_{OUT} \). As \( V_{IN} \) increases from -5V to +5V, \( V_{OUT} \) decreases from +5V to -5V.

### Additional Information:
- **Parameters:**
  - \( V_{IN} = 10 \) V peak-to-peak (Vp-p)
  - \( V_{REF} = 1 \) V
  - \( +V_{CC} = 5 \) V
  - \( R_G = R_F = 10 \) kΩ

This image illustrates the behavior of an inverting summing amplifier, where the output voltage is the inverted sum of the input voltage and a reference voltage, scaled by the ratio of the feedback resistor to the input resistor.
```

#### Figure A–2. Split-Supply Op Amp Circuit With Reference Voltage Input

An input bias voltage is used to eliminate the difference voltage when it must not appear in the output voltage (see Figure A–3 and Equation A–1C). The voltage, VREF, is in both input circuits, hence it is named a common-mode voltage. Voltage-feedback op amps, like those used in this document, reject common-mode voltages because their input circuit is constructed with a differential amplifier (chosen because it has natural common-mode voltage rejection capabilities).

**Op Amp = TLC071**

**–VCC = –5 V**

$$\mathbb{V}\_{\mathsf{OUT}} = -\left(\mathbb{V}\_{\mathsf{IN}} + \mathbb{V}\_{\mathsf{REF}}\right) \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} + \mathbb{V}\_{\mathsf{REF}} \left(\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}\right) \left(\frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}}\right) = -\mathsf{V}\_{\mathsf{IN}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \qquad \mathsf{A-tC}$$

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
- The circuit is centered around an operational amplifier (op-amp).
- The op-amp has two power supply connections: +Vcc (positive voltage supply) and -Vcc (negative voltage supply).
- The non-inverting input (+) of the op-amp is connected to a voltage reference (VREF).
- The inverting input (-) of the op-amp is connected to a network of resistors and the input voltage (VIN).
- There are two resistors labeled RF and RG. RF is connected between the output of the op-amp (VOUT) and the inverting input (-). RG is connected between the inverting input (-) and the input voltage (VIN).
- Another pair of resistors, also labeled RF and RG, are connected in a similar manner but to the voltage reference (VREF) instead of the input voltage (VIN).

**Graph:**
- The graph plots VOUT (output voltage) against VIN (input voltage).
- The x-axis represents VIN, ranging from -5V to +5V, with 1V per division.
- The y-axis represents VOUT, ranging from -5V to +5V, with 1V per division.
- The plot shows a linear relationship between VIN and VOUT, with a negative slope, indicating that as VIN increases, VOUT decreases.

**Text Information:**
- The text below the graph provides specific values for the components and conditions used in the circuit:
  - VIN = 10 Vp-p (peak-to-peak voltage)
  - +VCC = 5V (positive voltage supply)
  - -VCC = -5V (negative voltage supply)
  - VREF = 1V (reference voltage)
  - RG = RF = 10kΩ (resistor values)
  - Op Amp = TLC071 (model of the operational amplifier)

Overall, the image illustrates a circuit involving an op-amp configured with resistors to produce a specific output voltage (VOUT) based on the input voltage (VIN) and reference voltage (VREF), along with a graph showing the relationship between VIN and VOUT.
```

Figure A–3. Split-Supply Op Amp Circuit With Common-Mode Voltage

When signal sources are referenced to ground, single-supply op amp circuits always have a large input common-mode voltage. Figure A–4 shows a single-supply op amp circuit that has its input voltage referenced to ground. The input voltage is not referenced to the midpoint of the supplies like it would be in a split-supply application, rather it is referenced to the lower power supply rail. This circuit malfunctions when the input voltage is positive because the output voltage would have to go negative — hard to do with a positive supply. It operates marginally with small negative input voltages because most op amps do not function well when the inputs are connected to the supply rails.

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
- The circuit is a standard inverting operational amplifier (op-amp) configuration.
- The input voltage \( V_{IN} \) is connected to a resistor \( R_G \).
- The other end of \( R_G \) is connected to the inverting input (-) of the op-amp.
- The non-inverting input (+) of the op-amp is connected to the ground.
- A feedback resistor \( R_F \) is connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
- The op-amp is powered by a positive voltage supply \( +V_{CC} \) and a negative voltage supply (ground in this case).
- The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

**Graph:**
- The graph shows the relationship between the input voltage \( V_{IN} \) and the output voltage \( V_{OUT} \).
- The x-axis represents the input voltage \( V_{IN} \) ranging from -5V to +5V, with a scale of 1V per division.
- The y-axis represents the output voltage \( V_{OUT} \) ranging from -5V to +5V, with a scale of 1V per division.
- The graph shows a straight line with a negative slope, indicating an inverting relationship between \( V_{IN} \) and \( V_{OUT} \).
- The line passes through the origin (0,0), indicating that when \( V_{IN} \) is 0V, \( V_{OUT} \) is also 0V.
- The slope of the line suggests that the gain of the amplifier is -1, meaning \( V_{OUT} = -V_{IN} \).

**Additional Information:**
- The input voltage \( V_{IN} \) is specified as 10V peak-to-peak (Vp-p).
- The power supply voltage \( V_{CC} \) is 5V.
- The resistors \( R_G \) and \( R_F \) are both 10kΩ.
- The operational amplifier used is a TLV247x series op-amp.
```

Figure A–4. Single-Supply Op Amp Circuit

The constant requirement to account for inputs connected to ground or other reference voltages makes it difficult to design single-supply op amp circuits. This appendix presents a collection of single-supply op amp circuits, including their description and transfer equation. Those without a good working knowledge of op amp equations should reference the Understanding Basic Analog series of application notes available from Texas Instruments. Application note SLAA068, Understanding Basic Analog — Ideal Op Amps develops the ideal op amp equations. Circuit equations in this appendix are written with the ideal op amp assumptions as specified in Understanding Basic Analog — Ideal Op Amps. The assumptions appear in Table A–1 for easy reference.

### Table A–1. Ideal Op Amp Assumptions

| PARAMETER NAME       | PARAMETER SYMBOL | VALUE |
|----------------------|------------------|-------|
| Input current        | IIN              | 0     |
| Input offset voltage | VOS              | 0     |
| Input impedance      | ZIN              | ∞     |
| Output impedance     | ZOUT             | 0     |
| Op amp gain          | a                | ∞     |
|                      |                  |       |

Detailed information about designing single-supply op amp circuits appears in application note SLOA030, Single-Supply Op Amp Design Techniques. Unless otherwise specified, all op amp circuits shown here are single-supply circuits. The single supply may be wired with the negative or positive lead connected to ground, but as long as the supply polarity is correct, the wiring does not affect circuit operation.

# **A.2 Boundary Conditions**

All op amps are constrained to output voltage swings less than or equal to their power supply. Use of a single supply limits the output voltage to the range of the supply voltage. For example, when the supply voltage VCC equals +10 V, the output voltage is limited to the range 0 ≤ VOUT ≤ 10. This limitation precludes negative output voltages when the circuit has a positive supply voltage, but it does not preclude negative input voltages. As long as the voltage on the op amp input leads does not become negative, the circuit can handle negative voltages applied to the input resistors.

Beware of working with negative (positive) input voltages when the op amp is powered from a positive (negative) supply because op amp inputs are highly susceptible to reverse-voltage breakdown. Also, ensure that no start-up condition reverse biases the op amp inputs when the input and supply voltage are opposite polarity. It may be advisable to protect the op amp inputs with a diode (Schottky or germanium) connected anode to ground and cathode to the op amp input.

# **A.3 Amplifiers**

Many types of amplifiers can be created using op amps. This section consists of a selection of some basic, single-supply op amp circuits that are available to the designer during the concept stage of a design. The circuit configuration and correct single-supply dc biasing techniques are presented for the following cases: inverting, noninverting, differential, T-network, buffer and ac-coupled amplifiers.

#### **A.3.1 Inverting Op Amp with Noninverting Positive Reference**

The ideal transfer equation is given in Equation A–1.

$$
\lambda\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{IN}} \,\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} + \mathsf{V}\_{\mathsf{R}\mathsf{EF}} \left(\frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}}\right) \tag{4-1}
$$

The transfer equation for this circuit (Figure A–5) takes the form of Y = –mX + b. The transfer function slope is negative, and the dc intercept is positive. RF and RG are contained in both halves of the equation, thus it is hard to obtain the desired slope and dc intercept without modifying VREF. This is the minimum component count configuration for this transfer function. When the reference voltage is 0, the input voltage is constrained to negative voltages because positive input voltages would cause the output voltage to saturate at ground.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
- The circuit is an operational amplifier (op-amp) configuration.
- The op-amp has a positive power supply labeled +Vcc.
- The non-inverting input (marked with a "+") is connected to a reference voltage source labeled VREF, which is grounded.
- The inverting input (marked with a "-") is connected to a resistor labeled RG, which is connected to the input voltage source labeled VIN.
- The inverting input is also connected to another resistor labeled RF, which is connected to the output of the op-amp labeled VOUT.
- The input voltage source VIN is grounded on one side.

**Graph:**
- The graph is a plot of VOUT versus VIN.
- The vertical axis represents VOUT, ranging from -5V to +5V, with 1V per division.
- The horizontal axis represents VIN, ranging from -5V to +5V, with 1V per division.
- The plot shows a linear relationship between VOUT and VIN, with a negative slope, indicating an inverting amplifier configuration.
- The plot intersects the vertical axis at +1V when VIN is 0V, suggesting that VREF is 1V.

**Text Information:**
- The text below the graph provides specific values for the components and conditions:
  - VIN = 10 Vp-p (peak-to-peak voltage)
  - VCC = 5V (power supply voltage)
  - VREF = 1V (reference voltage)
  - RG = RF = 10kΩ (resistor values)
  - Op Amp = TLV247x (model of the operational amplifier)

Overall, the image depicts an inverting amplifier circuit with a reference voltage, and the graph shows the output voltage response to varying input voltages.
```

Figure A–5. Inverting Op Amp with Noninverting Positive Reference

Single-Supply Circuit Collection A-5

# **A.3.2 Inverting Op Amp with Inverting Negative Reference**

The transfer equation takes the form of Y = –mX + b and is given in Equation A–2.

$$
\mathbb{V}\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{IN}} \,\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}}} + \mathsf{V}\_{\mathsf{R}\mathsf{EF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G2}}} \tag{4-2}
$$

The transfer function slope is negative, and the dc intercept is positive (Figure A–6). RG1 and RG2 are contained in the equation, thus it is easy to obtain the desired slope and dc intercept by adjusting the value of both resistors. Because of the virtual ground at the inverting input, RG2 is the terminating impedance for VREF. When the reference voltage is 0, the input voltage is constrained to negative voltages because positive input voltages would cause the output voltage to saturate at ground.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, depicted with the standard triangular symbol. It has a non-inverting input (+), an inverting input (-), and an output.
   - **Resistors**: Three resistors labeled \( R_{G1} \), \( R_{G2} \), and \( R_F \), each with a resistance value of 10 kΩ.
   - **Voltage Source**: A voltage source labeled \( V_{IN} \) connected to \( R_{G1} \).
   - **Reference Voltage**: A reference voltage source labeled \( V_{REF} \) connected to \( R_{G2} \).
   - **Power Supply**: The op-amp is powered by a positive voltage supply labeled \( +V_{CC} \).

2. **Connections**:
   - The voltage source \( V_{IN} \) is connected to one end of \( R_{G1} \).
   - The other end of \( R_{G1} \) is connected to the junction of \( R_{G2} \) and the inverting input (-) of the op-amp.
   - \( R_{G2} \) is connected to the reference voltage \( V_{REF} \) and ground.
   - The feedback resistor \( R_F \) is connected between the output of the op-amp and the inverting input (-).
   - The non-inverting input (+) of the op-amp is connected to ground.
   - The output of the op-amp is labeled \( V_{OUT} \).

### Graph (Right Side):
1. **Axes**:
   - The horizontal axis represents the input voltage \( V_{IN} \) ranging from -5 V to +5 V, with a scale of 1 V per division.
   - The vertical axis represents the output voltage \( V_{OUT} \) ranging from -5 V to +5 V, with a scale of 1 V per division.

2. **Plot**:
   - The graph shows a linear relationship between \( V_{IN} \) and \( V_{OUT} \), with a negative slope.
   - The line passes through the origin, indicating that the output voltage is inversely proportional to the input voltage.

### Additional Information (Below the Graph):
- **Input Voltage**: \( V_{IN} = 10 \text{ V peak-to-peak} \)
- **Reference Voltage**: \( V_{REF} = -1 \text{ V} \)
- **Power Supply Voltage**: \( V_{CC} = 5 \text{ V} \)
- **Resistor Values**: \( R_{G1} = R_{G2} = R_F = 10 \text{ kΩ} \)
- **Operational Amplifier Model**: TLV247x

### Summary:
The circuit is a configuration of an operational amplifier with a feedback resistor and two resistors connected to the inverting input. The graph illustrates the output voltage \( V_{OUT} \) as a function of the input voltage \( V_{IN} \), showing a linear inverse relationship. The additional information provides specific values for the components and parameters used in the circuit.
```

Figure A–6. Inverting Op Amp with Inverting Negative Reference

## **A.3.3 Inverting Op Amp with Noninverting Negative Reference**

The transfer equation takes the form of Y = –mX – b and is given in Equation A–3.

$$
\lambda\_{\rm OUT} = -\,\lambda\_{\rm IN} \,\frac{\mathcal{R}\_{\rm F}}{\mathcal{R}\_{\rm G}} - \lambda\_{\rm REF} \left(\frac{\mathcal{R}\_{\rm F} + \mathcal{R}\_{\rm G}}{\mathcal{R}\_{\rm G}}\right) \tag{4-3}
$$

The transfer function slope is negative, and the dc intercept is negative. RF and RG are contained in both halves of the equation, thus it is hard to obtain the desired slope and dc intercept without modifying VREF. This is the minimum component count configuration for this transfer function. The slope and dc intercept terms in Equation A–3 are both negative, hence, unless the correct input voltage range is selected, the output voltage will saturate at ground. The negative input voltage must be limited to less than –400 mV because op amp inputs either break down or have protection circuits that forward bias when large negative voltages are applied to the inputs.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component is an operational amplifier with the standard triangular symbol. The non-inverting input (+) is connected to a reference voltage \( V_{REF} \), and the inverting input (-) is connected to a resistor network.
   - **Resistors**: There are two resistors, \( R_G \) and \( R_F \), connected in a feedback configuration.
     - \( R_G \) is connected between the input voltage \( V_{IN} \) and the inverting input (-) of the op-amp.
     - \( R_F \) is connected between the output \( V_{OUT} \) and the inverting input (-) of the op-amp.
   - **Power Supply**: The op-amp is powered by a positive voltage \( +V_{CC} \).

2. **Voltage Sources**:
   - **Input Voltage (\( V_{IN} \))**: This is the signal input to the circuit.
   - **Reference Voltage (\( V_{REF} \))**: This is connected to the non-inverting input (+) of the op-amp and is set to -0.25 V.

### Graph (Right Side):
1. **Axes**:
   - **X-Axis (Horizontal)**: Represents the input voltage \( V_{IN} \) ranging from -5 V to +5 V, with a scale of 1 V per division.
   - **Y-Axis (Vertical)**: Represents the output voltage \( V_{OUT} \) ranging from -5 V to +5 V, with a scale of 1 V per division.

2. **Plot**:
   - The graph shows a linear relationship between \( V_{IN} \) and \( V_{OUT} \). The line has a negative slope, indicating an inverting configuration.
   - The line crosses the Y-axis at approximately +0.25 V when \( V_{IN} \) is 0 V.

### Additional Information:
- **Input Voltage (\( V_{IN} \))**: The input voltage is specified as 10 V peak-to-peak (Vp-p).
- **Power Supply (\( V_{CC} \))**: The op-amp is powered by a 5 V supply.
- **Resistor Values**: Both \( R_G \) and \( R_F \) are 10 kΩ.
- **Op-Amp Model**: The operational amplifier used is a TLV247x series.

### Summary:
The circuit is an inverting amplifier with a reference voltage of -0.25 V applied to the non-inverting input. The graph shows the output voltage \( V_{OUT} \) as a function of the input voltage \( V_{IN} \), indicating a linear inverting relationship with a specific offset due to the reference voltage.
```

Figure A–7. Inverting Op Amp with Noninverting Negative Reference

### **A.3.4 Inverting Op Amp with Inverting Positive Reference**

The transfer equation takes the form of Y = –mX – b and is given in Equation A–4.

$$
\mathbb{V}\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{IN}} \,\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}1}} - \,\mathsf{V}\_{\mathsf{R}\mathsf{EF}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}2}} \tag{4-4}
$$

The transfer function slope is negative, and the dc intercept is negative. RG1 and RG2 are contained in the equation, thus it is easy to obtain the desired slope and dc intercept by adjusting the value of both resistors. Because of the virtual ground at the inverting input, RG2 is the terminating impedance for VREF. The slope and dc intercept terms in Equation A–4 are both negative, hence, unless the correct input voltage range is selected, the output voltage will saturate.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
- The circuit is an operational amplifier (op-amp) configuration.
- The input voltage \( V_{IN} \) is connected to a resistor \( R_{G1} \).
- The resistor \( R_{G1} \) is connected to a node that splits into two paths: one path goes to another resistor \( R_{G2} \) which is connected to a reference voltage \( V_{REF} \), and the other path goes to a resistor \( R_{F} \) which is connected to the inverting input of the op-amp.
- The non-inverting input of the op-amp is connected to ground.
- The output of the op-amp is labeled \( V_{OUT} \).
- The op-amp is powered by a positive voltage \( +V_{CC} \).

**Graph:**
- The graph plots \( V_{OUT} \) versus \( V_{IN} \).
- The x-axis represents \( V_{IN} \) with a range from -5V to +5V, marked in 1V/division increments.
- The y-axis represents \( V_{OUT} \) with a range from -5V to +5V, also marked in 1V/division increments.
- The plot shows a linear relationship with a negative slope, indicating that \( V_{OUT} \) decreases as \( V_{IN} \) increases.
- The plot crosses the origin, suggesting that when \( V_{IN} \) is zero, \( V_{OUT} \) is also zero.

**Text Information:**
- The text below the graph provides specific values for the components and conditions:
  - \( V_{IN} = 10 \) V peak-to-peak
  - \( V_{REF} = 1 \) V
  - \( V_{CC} = 5 \) V
  - \( R_{G1} = R_{G2} = R_{F} = 10 \) kΩ
  - The operational amplifier used is TLV247x

Overall, the image illustrates an inverting op-amp configuration with specific component values and shows the resulting output voltage as a function of the input voltage.
```

Figure A–8. Inverting Op Amp with Inverting Positive Reference

### **A.3.5 Noninverting Op Amp with Inverting Positive Reference**

The transfer equation takes the form of Y = mX – b and is given in Equation A–5.

$$
\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} - \mathbb{V}\_{\mathsf{R} \boxplus \mathsf{F}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-5}
$$

The transfer function slope is positive, and the dc intercept is negative. This is the minimum component count configuration for this transfer function. The reference termination resistor is connected to a virtual ground, so RG is the load across VREF. RF and RG are contained in both halves of the equation, thus it is hard to obtain the desired slope and dc intercept without modifying VREF or placing an attenuator in series with VIN.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, depicted with the standard triangle symbol. The positive input is connected to ground, and the negative input is connected to a node between two resistors.
   - **Resistors**: Two resistors labeled \( R_G \) and \( R_F \). \( R_G \) is connected between the reference voltage \( V_{REF} \) and the negative input of the op-amp. \( R_F \) is connected between the output of the op-amp and the negative input.
   - **Voltage Sources**:
     - **\( V_{REF} \)**: A reference voltage source connected to \( R_G \).
     - **\( V_{IN} \)**: An input voltage source connected to the positive input of the op-amp.
     - **\( V_{CC} \)**: The power supply voltage for the op-amp, labeled as \( +V_{CC} \).

2. **Connections**:
   - The negative input of the op-amp is connected to the junction between \( R_G \) and \( R_F \).
   - The positive input of the op-amp is connected to ground.
   - The output of the op-amp is connected to one end of \( R_F \).

### Graph (Right Side):
1. **Axes**:
   - **X-Axis**: Represents the input voltage \( V_{IN} \) ranging from -5V to +5V.
   - **Y-Axis**: Represents the output voltage \( V_{OUT} \) ranging from -5V to +5V.

2. **Plot**:
   - A straight line graph showing the relationship between \( V_{IN} \) and \( V_{OUT} \). The line starts at the origin (0,0) and extends diagonally upwards, indicating a linear relationship.

3. **Annotations**:
   - **VIN = 10 Vp-p**: The peak-to-peak voltage of the input signal is 10V.
   - **VCC = 5V**: The power supply voltage for the op-amp is 5V.
   - **VREF = 1V**: The reference voltage is 1V.
   - **RG = RF = 10k**: Both resistors \( R_G \) and \( R_F \) have a resistance of 10k ohms.
   - **Op Amp = TLV247x**: The operational amplifier used in the circuit is from the TLV247x series.

### Summary:
The image illustrates a non-inverting amplifier circuit using an op-amp with a reference voltage \( V_{REF} \). The graph shows the linear relationship between the input voltage \( V_{IN} \) and the output voltage \( V_{OUT} \), indicating that the output voltage is directly proportional to the input voltage within the specified range. The annotations provide specific values for the components and voltages used in the circuit.
```

Figure A–9. Noninverting Op Amp with Inverting Positive Reference

### **A.3.6 Noninverting Op Amp with Noninverting Negative Reference**

The transfer equation takes the form of Y = mX – b and is given in Equation A–6.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} - \mathbb{V}\_{\mathsf{R} \to \mathsf{F}} \left( \frac{\mathsf{R}\_1}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \qquad \mathsf{A-6}$$

The transfer function slope is positive, and the dc intercept is negative. The reference is terminated in R1 and R2. R1 and R2 can be selected independent of RF and RG to obtain the desired slope and dc intercept. The price for the extra degree of freedom is two resistors.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, with its inverting input (-) and non-inverting input (+) clearly marked.
   - **Resistors**:
     - **RG**: Connected between the input voltage source (VIN) and the inverting input of the op-amp.
     - **RF**: Connected between the output of the op-amp (VOUT) and the inverting input.
     - **R1** and **R2**: Form a voltage divider network connected to the non-inverting input of the op-amp. R1 is connected to the non-inverting input and ground, while R2 is connected between the non-inverting input and a reference voltage (VREF).
   - **Voltage Sources**:
     - **VIN**: The input voltage source connected to the circuit.
     - **VREF**: A reference voltage connected to the voltage divider network.
     - **+VCC**: The positive power supply for the op-amp.

2. **Connections**:
   - The inverting input of the op-amp is connected to the junction of RG and RF.
   - The non-inverting input of the op-amp is connected to the junction of R1 and R2.
   - The output of the op-amp (VOUT) is connected to the junction of RF and the inverting input.

### Graph (Right Side):
1. **Axes**:
   - **X-Axis (Horizontal)**: Represents the input voltage (VIN) with a range from -5V to +5V, marked in 1V divisions.
   - **Y-Axis (Vertical)**: Represents the output voltage (VOUT) with a range from -5V to +5V, marked in 1V divisions.

2. **Plot**:
   - A straight line with a positive slope, indicating a linear relationship between VIN and VOUT. The line passes through the origin (0,0), suggesting that the output voltage is directly proportional to the input voltage.

### Annotations (Bottom Right):
1. **VIN = 10 Vp-p**: The peak-to-peak input voltage is 10V.
2. **VCC = 5V**: The positive power supply voltage for the op-amp is 5V.
3. **R1 = R2 = RG = RF = 10k**: All resistors in the circuit have a value of 10k ohms.
4. **VREF = -1V**: The reference voltage is -1V.
5. **Op Amp = TLV247x**: The operational amplifier used in the circuit is from the TLV247x series.

### Summary:
The image shows a non-inverting amplifier circuit with a voltage divider network providing a reference voltage to the non-inverting input. The graph illustrates the linear relationship between the input and output voltages, with specific component values and conditions provided in the annotations.
```

Figure A–10. Noninverting Op Amp with Noninverting Negative Reference

### **A.3.7 Noninverting Op Amp with Inverting Negative Reference**

The transfer equation takes the form of Y = mX + b and is given in Equation A–7.

$$
\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} + \mathbb{V}\_{\mathsf{R} \boxplus \mathsf{F}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-7}
$$

The transfer function slope is positive, and the dc intercept is positive. This is the minimum component count configuration for this transfer function. The reference termination resistor is connected to a virtual ground, so RG is the load across VREF. RF and RG are contained in both halves of the equation. Thus it is hard to obtain the desired slope and dc intercept without modifying VREF or placing an attenuator in series with VIN.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit.
   - **Resistors**: Two resistors, \( R_G \) and \( R_F \), are connected to the op-amp.
     - \( R_G \) is connected between the inverting input (-) of the op-amp and a reference voltage \( V_{REF} \).
     - \( R_F \) is connected between the output of the op-amp and the inverting input (-).
   - **Voltage Sources**:
     - \( V_{REF} \): A reference voltage connected to \( R_G \).
     - \( V_{IN} \): An input voltage connected to the non-inverting input (+) of the op-amp.
     - \( V_{CC} \): A positive supply voltage connected to the op-amp.
   - **Ground**: The non-inverting input (+) of the op-amp is also connected to ground.

2. **Labels**:
   - \( R_G \) and \( R_F \) are both labeled as 10 kΩ.
   - \( V_{REF} \) is labeled as -1 V.
   - \( V_{IN} \) is labeled as 10 V peak-to-peak (Vp-p).
   - \( V_{CC} \) is labeled as 5 V.
   - The op-amp is specified as TLV247x.

### Graph (Right Side):
1. **Axes**:
   - The horizontal axis represents the input voltage \( V_{IN} \) with a range from -5 V to +5 V, marked in 1 V/division.
   - The vertical axis represents the output voltage \( V_{OUT} \) with a range from -5 V to +5 V, marked in 1 V/division.

2. **Plot**:
   - A straight line is plotted, indicating a linear relationship between \( V_{IN} \) and \( V_{OUT} \).
   - The line passes through the origin (0,0) and extends from the bottom-left corner (-5 V, -5 V) to the top-right corner (+5 V, +5 V).

3. **Additional Information**:
   - The graph includes the following details:
     - \( V_{IN} = 10 \) V peak-to-peak (Vp-p)
     - \( V_{REF} = -1 \) V
     - \( V_{CC} = 5 \) V
     - \( R_G = R_F = 10 \) kΩ
     - The operational amplifier used is TLV247x.

### Summary:
The image shows a non-inverting amplifier circuit with an op-amp, resistors, and voltage sources. The graph illustrates the linear relationship between the input and output voltages, indicating the behavior of the amplifier. The specific values of the components and voltages are provided, along with the type of op-amp used.
```

Figure A–11. Noninverting Op Amp with Inverting Positive Reference

### **A.3.8 Noninverting Op Amp with Noninverting Positive Reference**

The transfer equation takes the form of Y = mX + b and is given in Equation A–8.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} + \mathbb{V}\_{\mathsf{R} \to \mathsf{F}} \left( \frac{\mathsf{R}\_1}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \qquad \mathsf{A} \mathsf{-8}$$

The transfer function slope is positive, and the dc intercept is positive. The reference is terminated in R1 and R2. R1 and R2 can be selected independent of RF and RG to obtain the desired slope and dc intercept. The price for the extra degree of freedom is two resistors.

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, depicted with the standard triangle symbol. The positive input is connected to a voltage divider, and the negative input is connected to a resistor network.
   - **Resistors**: Four resistors labeled \( R_G \), \( R_F \), \( R_1 \), and \( R_2 \). All resistors have a value of 10 kΩ.
   - **Voltage Source (\( V_{IN} \))**: Connected to the resistor \( R_G \) and the voltage divider.
   - **Reference Voltage (\( V_{REF} \))**: Connected to the voltage divider formed by \( R_1 \) and \( R_2 \).
   - **Power Supply (\( V_{CC} \))**: Provides a positive voltage to the Op-Amp.

2. **Connections**:
   - The negative input of the Op-Amp is connected to the junction of \( R_G \) and \( R_F \).
   - The positive input of the Op-Amp is connected to the junction of \( R_1 \) and \( R_2 \), which is also connected to \( V_{REF} \).
   - \( V_{IN} \) is connected to \( R_G \) and the junction of \( R_1 \) and \( R_2 \).
   - \( V_{OUT} \) is the output of the Op-Amp.

### Graph (Right Side):
1. **Axes**:
   - **X-Axis (Horizontal)**: Represents the input voltage (\( V_{IN} \)) ranging from -5 V to +5 V, with divisions marked at 1 V intervals.
   - **Y-Axis (Vertical)**: Represents the output voltage (\( V_{OUT} \)) ranging from -5 V to +5 V, with divisions marked at 1 V intervals.

2. **Plot**:
   - A straight line graph showing a linear relationship between \( V_{IN} \) and \( V_{OUT} \). The line passes through the origin and has a positive slope, indicating that \( V_{OUT} \) increases linearly with \( V_{IN} \).

### Additional Information:
- **Parameters**:
  - \( V_{IN} = 10 \) V peak-to-peak.
  - \( V_{CC} = 5 \) V.
  - \( V_{REF} = 1 \) V.
  - Op-Amp model: TLV247x.
  - Resistor values: \( R_1 = R_2 = R_G = R_F = 10 \) kΩ.

The circuit appears to be a differential amplifier with a reference voltage, and the graph shows the output voltage response to varying input voltage. The linear relationship suggests that the circuit is designed to amplify the input voltage with a certain gain, determined by the resistor values.
```

Figure A–12. Noninverting Op Amp with Noninverting Positive Reference

#### **A.3.9 Differential Amplifier**

When RF is set equal to R2 and RG is set equal to R1, Equation A–9 reduces to Equation A–10.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN2}} \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \left( \frac{\mathsf{R}\_{2}}{\mathsf{R}\_{1} + \mathsf{R}\_{2}} \right) - \mathsf{V}\_{\mathsf{IN1}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-9}$$

$$\mathsf{V}\_{\mathsf{OUT}} = (\mathsf{V}\_{\mathsf{IN2}} - \mathsf{V}\_{\mathsf{IN1}}) \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-10}$$

These resistors must be matched very closely to obtain good differential performance. The mismatch error in these resistors reduces the common-mode performance, and the mismatch shows up in the output as an amplified common-mode voltage.

Consider Equation A–10. Note that only the difference signal is amplified, thus this configuration is called a differential amplifier. The differential amplifier is a popular circuit in precision applications where it is used to amplify sensor outputs while rejecting commonmode noise.

The inverting input impedance is RG because of the virtual ground at the inverting op amp input. The noninverting input impedance is RF + RG because the noninverting op amp input impedance approaches infinity. The two input impedances are different, and this leads to two problems with this circuit.

First, mismatched input impedances preclude any attempts to cancel input bias currents through resistor matching. Often R2 is set equal to RF || RG so that the bias currents develop equal common-mode voltages which the op amp rejects. This is not possible when R2 = RF and R1 = RG unless the source impedances are matched. Second, high output impedance sensors are often used, and when high output sensors work into mismatched input impedances, errors occur.

Here is the image describtion:
```
The image depicts an operational amplifier (op-amp) circuit with two input voltages, \( V_{IN1} \) and \( V_{IN2} \). Here is a detailed description of the circuit:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle with two input terminals and one output terminal. The inverting input is marked with a minus sign (-), and the non-inverting input is marked with a plus sign (+).

2. **Power Supply**: The op-amp is powered by a positive voltage supply, \( +V_{CC} \), connected to the top of the triangle.

3. **Input Voltages**:
   - \( V_{IN1} \): This input voltage is connected to the inverting input (-) of the op-amp through a resistor \( R_G \).
   - \( V_{IN2} \): This input voltage is connected to the non-inverting input (+) of the op-amp through a resistor \( R_1 \).

4. **Feedback Resistor**: A resistor \( R_F \) is connected between the output of the op-amp and the inverting input (-). This forms a feedback loop.

5. **Ground Connections**:
   - Both \( V_{IN1} \) and \( V_{IN2} \) have their negative terminals connected to the ground.
   - The non-inverting input (+) of the op-amp is also connected to the ground through a resistor \( R_2 \).

6. **Output Voltage**: The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

In summary, this is a differential amplifier circuit where the op-amp amplifies the difference between the two input voltages \( V_{IN1} \) and \( V_{IN2} \). The resistors \( R_G \), \( R_F \), \( R_1 \), and \( R_2 \) set the gain and influence the behavior of the circuit.
```

Here is the image describtion:
```
The image is a graph that plots the output voltage (V_OUT) against the input voltage (V_IN2) for an operational amplifier (op-amp) circuit. The graph is a linear plot with the following details:

- The x-axis represents the input voltage (V_IN2) and ranges from -5 V to +5 V, with a scale of 1 V per division.
- The y-axis represents the output voltage (V_OUT) and ranges from -5 V to +5 V, with a scale of 1 V per division.
- The plot shows a straight line with a positive slope, indicating a linear relationship between V_IN2 and V_OUT.
- The line passes through the origin (0,0), suggesting that the output voltage is directly proportional to the input voltage.

Additional information provided in the image includes:
- V_IN2 = 10
- V_IN1 = 1 V
- V_CC = 5 V
- The op-amp used is a TLV247x.
- The resistors in the circuit have the following values: R1 = R2 = RG = RF = 10 kΩ.

This suggests that the circuit is likely a differential amplifier or a similar configuration where the output voltage is a function of the difference between two input voltages (V_IN1 and V_IN2). The specific values of the resistors and the op-amp model are given to provide context for the circuit's design and performance.
```

Figure A–13. Differential Amplifier

### **A.3.10 Differential Amplifier With Bias Correction**

When RF is set equal to R2 and RG is set equal to R1, Equation A–11 reduces to Equation A–12.

$$\mathbb{V}\_{\rm OUT} = \mathbb{V}\_{\rm IN2} \frac{\mathbf{R}\_{\rm F} + \mathbf{R}\_{\rm G}}{\mathbf{R}\_{\rm G}} \left( \frac{\mathbf{R}\_{2}}{\mathbf{R}\_{\uparrow} + \mathbf{R}\_{2}} \right) + \mathbb{V}\_{\rm REF} \frac{\mathbf{R}\_{\rm F} + \mathbf{R}\_{\rm G}}{\mathbf{R}\_{\rm G}} \left( \frac{\mathbf{R}\_{\uparrow}}{\mathbf{R}\_{\uparrow} + \mathbf{R}\_{2}} \right) - \mathbb{V}\_{\rm IN1} \frac{\mathbf{R}\_{\rm F}}{\mathbf{R}\_{\rm G}} \quad \text{A-11}$$

$$\mathbb{V}\_{\rm OUT} = (\mathbb{V}\_{\rm IN2} - \mathbb{V}\_{\rm IN1}) \frac{\mathbf{R}\_{\rm F}}{\mathbf{R}\_{\rm G}} + \mathbb{V}\_{\rm REF} \tag{4.12}$$

When an offset voltage must be eliminated from or added to the input signal, this differential amplifier circuit is employed. The reference voltage can be positive or negative depending upon the polarity offset required, but care must be taken to protect the op amp inputs and not exceed the output range.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component is an op-amp with its inverting input (-) and non-inverting input (+) clearly marked.
   - **Resistors**: There are five resistors labeled as \( R_G \), \( R_F \), \( R_1 \), and \( R_2 \), each with a value of 10 kΩ.
   - **Voltage Sources**:
     - \( V_{IN1} \): Connected to the inverting input (-) through resistor \( R_G \).
     - \( V_{IN2} \): Connected to the non-inverting input (+) through resistor \( R_1 \).
     - \( V_{REF} \): Connected to the non-inverting input (+) through resistor \( R_2 \).
   - **Power Supply**: The op-amp is powered by a positive voltage \( +V_{CC} \).

2. **Connections**:
   - The inverting input (-) of the op-amp is connected to \( V_{IN1} \) through resistor \( R_G \) and to the output \( V_{OUT} \) through resistor \( R_F \).
   - The non-inverting input (+) of the op-amp is connected to \( V_{IN2} \) through resistor \( R_1 \) and to \( V_{REF} \) through resistor \( R_2 \).
   - The output \( V_{OUT} \) is connected to the feedback resistor \( R_F \).

### Graph (Right Side):
1. **Axes**:
   - The horizontal axis represents \( V_{IN2} \) with a range from -5 V to +5 V, marked as 1 V/Div.
   - The vertical axis represents \( V_{OUT} \) with a range from -5 V to +5 V, marked as 1 V/Div.

2. **Plot**:
   - A straight line is plotted, indicating a linear relationship between \( V_{IN2} \) and \( V_{OUT} \).

3. **Annotations**:
   - \( V_{IN2} = 10 \) V peak-to-peak.
   - \( V_{IN1} = 1 \) V.
   - \( V_{CC} = 5 \) V.
   - \( V_{REF} = -1 \) V.
   - Resistor values: \( R_1 = R_2 = R_G = R_F = 10 \) kΩ.
   - The operational amplifier used is a TLV247x.

### Summary:
The image shows a detailed circuit diagram of an op-amp configuration with specific resistor values and voltage sources. The graph on the right illustrates the output voltage \( V_{OUT} \) as a function of the input voltage \( V_{IN2} \), showing a linear relationship. The annotations provide additional details about the voltage levels and component values used in the circuit.
```

Figure A–14. Differential Amplifier with Bias Correction

## **A.3.11 High Input Impedance Differential Amplifier**

When RF is set equal to R1 and RG is set equal to R2, Equation A–13 reduces to Equation A–14.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN1}} \frac{\mathsf{R}\_{\mathsf{1}} + \mathsf{R}\_{\mathsf{2}}}{\mathsf{R}\_{\mathsf{1}}} \left( -\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \right) + \mathbb{V}\_{\mathsf{IN2}} \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-13}$$

$$
\mathbb{V}\_{\mathsf{OUT}} = (\mathbb{V}\_{\mathsf{IN2}} - \mathbb{V}\_{\mathsf{IN1}}) \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \tag{4-14}
$$

Each input signal is connected to an op amp noninverting input that is very high impedance. The input impedance of the circuit is very high, and it is matched, so this circuit is often used to interface to high-impedance sensors. Each op amp has a signal propagation time, and VIN1 experiences two propagation delays versus VIN2's one propagation delay. At high frequencies, the propagation delay becomes a significant portion of the signal period, and this configuration is not usable at that frequency.

RF and R2, and RG and R1 should be matched to achieve good common-mode rejection capability. Bias current cancellation resistors equal to RF || RG should be connected in series with the input sources for precision applications.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - The circuit features two operational amplifiers (op-amps) connected in a specific configuration.
   - **Resistors**:
     - \( R_1 \), \( R_2 \), \( R_G \), and \( R_F \) are all resistors with a value of 10 kΩ each.
   - **Op-Amps**:
     - The op-amps are powered by a positive voltage supply \( +V_{CC} \) of 5V.
     - The op-amps are labeled as TLV247x.
   - **Voltage Sources**:
     - \( V_{IN1} \) is a voltage source connected to the inverting input of the first op-amp through resistor \( R_1 \). \( V_{IN1} \) is given as -1V.
     - \( V_{IN2} \) is another voltage source connected to the non-inverting input of the second op-amp. \( V_{IN2} \) is given as 10 V peak-to-peak (Vp-p).

2. **Configuration**:
   - The first op-amp is configured with \( R_1 \) and \( R_2 \) forming a voltage divider network.
   - The second op-amp is configured with \( R_G \) and \( R_F \) forming a feedback network.
   - The output of the first op-amp is connected to the inverting input of the second op-amp through resistor \( R_G \).

3. **Output**:
   - The output of the second op-amp is labeled as \( V_{OUT} \).

### Graph (Right Side):
1. **Axes**:
   - The x-axis represents \( V_{IN2} \) with a range from -5V to +5V, marked at 1V per division.
   - The y-axis represents \( V_{OUT} \) with a range from -5V to +5V, also marked at 1V per division.

2. **Plot**:
   - The graph shows a linear relationship between \( V_{IN2} \) and \( V_{OUT} \).
   - The line passes through the origin (0,0) and has a positive slope, indicating that as \( V_{IN2} \) increases, \( V_{OUT} \) also increases proportionally.

### Additional Information:
- The op-amp used is specified as TLV247x.
- The power supply voltage \( V_{CC} \) is 5V.
- The resistors \( R_1 \), \( R_2 \), \( R_G \), and \( R_F \) are all 10 kΩ.
- \( V_{IN1} \) is -1V.
- \( V_{IN2} \) is 10 V peak-to-peak.

### Summary:
The image illustrates a dual op-amp circuit with specific resistor values and input voltages, along with a graph showing the linear relationship between the input voltage \( V_{IN2} \) and the output voltage \( V_{OUT} \). The circuit is powered by a 5V supply and uses TLV247x op-amps.
```

Figure A–15. High Input Impedance Differential Amplifier

#### **A.3.12 High Common-Mode Range Differential Amplifier**

When all resistors are equal, Equation A–15 reduces to Equation A–16.

$$\begin{split} \mathsf{V}\_{\mathsf{OUT}} &= \mathsf{V}\_{\mathsf{IN2}} \left( -\frac{\mathsf{R}\_{2}}{\mathsf{R}\_{1}} \right) \Big( -\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}1}} \right) + \mathsf{V}\_{\mathsf{REF1}} \left( \frac{\mathsf{R}\_{1} + \mathsf{R}\_{2}}{\mathsf{R}\_{1}} \right) \Big( -\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}1}} \Big) + \\ &\qquad \mathsf{V}\_{\mathsf{IN1}} \left( -\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}2}} \right) + \mathsf{V}\_{\mathsf{REF2}} \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}1} \parallel \mathsf{R}\_{\mathsf{G}2}}{\mathsf{R}\_{\mathsf{G}1} \parallel \mathsf{R}\_{\mathsf{G}2}} \right) \\ &\qquad \mathsf{V}\_{\mathsf{OUT}} = \left( \mathsf{V}\_{\mathsf{IN2}} - \mathsf{V}\_{\mathsf{IN1}} \right) - 2\mathsf{V}\_{\mathsf{REF1}} + 3\mathsf{V}\_{\mathsf{REF2}} \Big) \end{split}$$

R1 and RG2 are equal-value resistors terminated into a virtual ground, hence, the input sources are equally terminated. This configuration has high common-mode capability because R1 and RG2 limit the current that can flow into or out of the op amp. Thus, the input voltage can rise to any value that does not exceed the op amp's drive capability. The voltage references, VREF1 and VREF2, are added for bias purposes. Without bias, the output voltage of the op amps would saturate at ground, and the bias voltages keep the output voltage of the op amp positive.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
The circuit diagram features a two-stage operational amplifier (op-amp) configuration with various components and voltage sources. Here is a detailed description of the components and their connections:

1. **Voltage Sources and Inputs:**
   - **VIN2:** This is an input voltage source connected to the leftmost part of the circuit.
   - **VREF1:** This is a reference voltage connected to the non-inverting input (+) of the first op-amp.
   - **VIN1:** This is another input voltage source connected to the inverting input (-) of the second op-amp.
   - **VREF2:** This is a reference voltage connected to the non-inverting input (+) of the second op-amp.
   - **VCC:** This is the positive supply voltage for both op-amps.

2. **Resistors:**
   - **R1 and R2:** These resistors are connected in series with the input voltage VIN2 and the inverting input (-) of the first op-amp.
   - **RG1 and RG2:** These resistors are connected in series between the output of the first op-amp and the inverting input (-) of the second op-amp.
   - **RF:** This resistor is connected in the feedback loop of the second op-amp, between its output and inverting input (-).

3. **Operational Amplifiers:**
   - **First Op-Amp:** The inverting input (-) is connected to the junction of R1 and R2, while the non-inverting input (+) is connected to VREF1. The output of this op-amp is connected to RG1.
   - **Second Op-Amp:** The inverting input (-) is connected to the junction of RG1 and RG2, while the non-inverting input (+) is connected to VREF2. The output of this op-amp is the final output voltage VOUT.

### Graph (Right Side):
The graph shows the relationship between the input voltage VIN2 and the output voltage VOUT. The axes and key points are as follows:

- **X-Axis (Horizontal):** Represents the input voltage VIN2, ranging from -2.5 V to +2.5 V, with divisions of 0.5 V.
- **Y-Axis (Vertical):** Represents the output voltage VOUT, ranging from 0 V to +5 V, with divisions of 0.5 V.
- **Line Plot:** A straight line indicates a linear relationship between VIN2 and VOUT, suggesting that the circuit is designed to provide a linear amplification or scaling of the input voltage.

### Additional Information (Bottom Right):
- **VIN1 = 1 V**
- **VIN2 = 5 Vp-p (peak-to-peak)**
- **VREF1 = 1.25 V**
- **VREF2 = 1.67 V**
- **VCC = 5 V**
- **Op Amp = TLV247x**
- **Resistor Values:**
  - **R1 = R2 = RF = RG1 = RG2 = 10 kΩ**

This information provides the specific values for the components and voltages used in the circuit, which are essential for understanding its operation and behavior.
```

Figure A–16. High Common-Mode Range Differential Amplifier

#### **A.3.13 High-Precision Differential Amplifier**

When R7 = R6, R5 = R2, R1 = R4, and VREF1=VREF2, Equation A–17 reduces to Equation A–18.

$$\begin{split} \mathsf{V}\_{\mathsf{OUT}} &= \left(\mathsf{V}\_{\mathsf{N2}} + \mathsf{V}\_{\mathsf{REF2}}\right) \bigg(\frac{2\mathsf{R}\_{4} + \mathsf{R}\_{3}}{\mathsf{R}\_{3}}\right) \bigg(\frac{\mathsf{R}\_{7}}{\mathsf{R}\_{5} + \mathsf{R}\_{7}}\bigg) \bigg(\frac{\mathsf{R}\_{6} + \mathsf{R}\_{2}}{\mathsf{R}\_{2}}\bigg) - \\ & \qquad \big(\mathsf{V}\_{\mathsf{IN1}} + \mathsf{V}\_{\mathsf{REF1}}\bigg) \bigg(\frac{2\mathsf{R}\_{1} + \mathsf{R}\_{3}}{\mathsf{R}\_{3}}\bigg) \frac{\mathsf{R}\_{6}}{\mathsf{R}\_{2}} + \mathsf{V}\_{\mathsf{REF3}} \bigg(\frac{\mathsf{R}\_{5}}{\mathsf{R}\_{5} + \mathsf{R}\_{7}}\bigg) \bigg(\frac{\mathsf{R}\_{6} + \mathsf{R}\_{2}}{\mathsf{R}\_{2}}\bigg)^{\mathsf{A} \dashv \mathsf{T}} \\ & \qquad \mathsf{V}\_{\mathsf{OUT}} = \left(\mathsf{V}\_{\mathsf{IN2}} - \mathsf{V}\_{\mathsf{IN1}}\right) \bigg(\frac{2\mathsf{R}\_{1}}{\mathsf{R}\_{3}} + \mathsf{I}\bigg) \bigg(\frac{\mathsf{R}\_{6}}{\mathsf{R}\_{2}}\bigg) + \mathsf{V}\_{\mathsf{REF3}} \bigg] \end{split}$$

In this circuit configuration, both sources work into the input impedance of a noninverting op amp. This impedance is very high, and if the op amps are identical, both impedances are very nearly equal. The propagation delay is still equal to two op amp propagation delays, but the propagation delay is very nearly equal, so any distortion resulting from unequal propagation delays is minimized.

The equal resistors should be matched with more precision than is expected from the circuit. Resistor matching eliminates distortion due to unequal gains, and it reduces the common-mode voltage feed through. Resistors equal to (R1 || R3)/2 may be placed in series with the sources to reduce errors resulting from bias currents. This differential amplifier has the unique feature that the gain can be changed with only one resistor, and if the gain setting resistor is R3, no resistor matching is required to change gain.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components**:
   - **Operational Amplifiers (Op-Amps)**: There are three op-amps in the circuit.
   - **Resistors**: Seven resistors labeled R1 to R7.
   - **Voltage Sources**: Three voltage sources labeled VIN1, VIN2, and VREF1, VREF2, VREF3.
   - **Power Supply**: The op-amps are powered by a positive voltage supply labeled +VCC.

2. **Connections**:
   - **First Op-Amp**:
     - Non-inverting input connected to VIN1.
     - Inverting input connected to VREF1.
     - Output connected to the junction of resistors R1 and R2.
   - **Second Op-Amp**:
     - Non-inverting input connected to VIN2.
     - Inverting input connected to VREF2.
     - Output connected to the junction of resistors R4 and R5.
   - **Third Op-Amp**:
     - Non-inverting input connected to the junction of resistors R6 and R7.
     - Inverting input connected to VREF3.
     - Output labeled as VOUT.
   - **Resistors**:
     - R1 connects the output of the first op-amp to the junction of R3 and R4.
     - R2 connects the junction of R1 and R3 to the junction of R6 and the non-inverting input of the third op-amp.
     - R3 connects the junction of R1 and R2 to ground.
     - R4 connects the output of the second op-amp to the junction of R1 and R3.
     - R5 connects the junction of R4 and R7 to ground.
     - R6 connects the junction of R2 and the non-inverting input of the third op-amp to the output of the third op-amp.
     - R7 connects the junction of R5 and the non-inverting input of the third op-amp to VREF3.

### Graph (Right Side):
1. **Axes**:
   - **X-Axis**: Represents VIN2 with a range from -2.5V to +2.5V, marked in 0.5V divisions.
   - **Y-Axis**: Represents VOUT with a range from 0V to +5V, marked in 0.5V divisions.

2. **Plot**:
   - A straight line indicating a linear relationship between VIN2 and VOUT.

3. **Text Information**:
   - **Voltage Values**:
     - VIN1 = 2.5V
     - VREF1 = 2.5V
     - VREF2 = 2.5V
     - VREF3 = 2.5V
     - VCC = 5V
   - **Resistor Values**:
     - R1 = R2 = R3 = R4 = R5 = R6 = R7 = 10kΩ
   - **Op-Amp Model**: TLV247x

### Summary:
The circuit diagram shows a configuration of three op-amps with specific resistor values and voltage sources. The graph illustrates the output voltage (VOUT) as a function of the input voltage (VIN2), showing a linear relationship. The text provides specific values for the voltages and resistors used in the circuit, as well as the model of the op-amps.
```

Figure A–17. High-Precision Differential Amplifier

### **A.3.14 Simplified High-Precision Differential Amplifier**

When RF is set equal to R2, RG is set equal to R1, and VREF1 = VREF2, Equation A–19 reduces to Equation A–20.

$$\begin{split} \mathbb{V}\_{\mathsf{OUT}} &= \left(\mathbb{V}\_{\mathsf{INZ}} + \mathbb{V}\_{\mathsf{REF}2}\right) \left(\frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}}\right) \left(\frac{\mathsf{R}\_{2}}{\mathsf{R}\_{1} + \mathsf{R}\_{2}}\right) - \left(\mathbb{V}\_{\mathsf{IN1}} + \mathbb{V}\_{\mathsf{REF}1}\right) \left(\frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}}\right) + \\ & \qquad \qquad \qquad \qquad \mathsf{V}\_{\mathsf{REF}3} \left(\frac{\mathsf{R}\_{1}}{\mathsf{R}\_{1} + \mathsf{R}\_{2}}\right) \left(\frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}}\right) \\ \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad \qquad$$

$$\mathbb{V}\_{\mathsf{OUT}} = (\mathbb{V}\_{\mathsf{IN2}} - \mathbb{V}\_{\mathsf{IN1}}) \Big( \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \Big) + \mathbb{V}\_{\mathsf{R}\mathsf{EF3}} \tag{4-20}$$

Both input sources are loaded equally with very high impedances in the simplified high precision differential amplifier. This configuration eliminates three resistors, two of which are matched, but it sacrifices flexibility in gain setting capability because the gain must be set with a matched pair of resistors.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - The circuit features three operational amplifiers (op-amps).
   - The first op-amp has its non-inverting input connected to a voltage source labeled \( V_{IN1} \) and a reference voltage \( V_{REF1} \). The inverting input is connected to the output through a resistor \( R_G \).
   - The output of the first op-amp is connected to a node that connects to the second op-amp through a resistor \( R_F \).
   - The second op-amp has its non-inverting input connected to a voltage source labeled \( V_{IN2} \) and a reference voltage \( V_{REF2} \). The inverting input is connected to the output through a resistor \( R_1 \).
   - The output of the second op-amp is connected to a node that connects to the third op-amp through a resistor \( R_2 \).
   - The third op-amp has its non-inverting input connected to a reference voltage \( V_{REF3} \). The inverting input is connected to the output through a resistor \( R_F \).
   - The output of the third op-amp is labeled \( V_{OUT} \).

2. **Power Supply**:
   - All three op-amps are powered by a positive voltage supply labeled \( +V_{CC} \).

3. **Resistor Values**:
   - The resistors \( R_1 \), \( R_2 \), \( R_F \), and \( R_G \) are all specified to be 10 kΩ.

### Graph (Right Side):
1. **Axes**:
   - The x-axis represents \( V_{IN2} \) with a range from -2.5 V to +2.5 V, marked at intervals of 0.5 V per division.
   - The y-axis represents \( V_{OUT} \) with a range from 0 V to +5 V, marked at intervals of 0.5 V per division.

2. **Plot**:
   - The graph shows a linear relationship between \( V_{IN2} \) and \( V_{OUT} \), indicating that \( V_{OUT} \) increases linearly with \( V_{IN2} \).

3. **Conditions**:
   - The conditions for the graph are specified:
     - \( V_{IN1} = 2.5 \) V
     - \( V_{REF1} = 2.5 \) V
     - \( V_{REF2} = 2.5 \) V
     - \( V_{REF3} = 2.5 \) V
     - \( V_{CC} = 5 \) V
     - \( V_{IN2} = 5 \) V peak-to-peak (Vp-p)
     - The operational amplifier used is a TLV247x.

### Summary:
The image illustrates a circuit with three op-amps configured with specific resistor values and reference voltages. The graph shows the output voltage \( V_{OUT} \) as a function of the input voltage \( V_{IN2} \), demonstrating a linear relationship under the given conditions.
```

Figure A–18. Simplified High-Precision Differential Amplifier

### **A.3.15 Variable Gain Differential Amplifier**

When R1 is set equal to R3 and R2 is set equal to R4, Equation A–21 reduces to Equation A–22.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN1}} \left( \frac{\mathsf{R}\_2}{\mathsf{R}\_1 + \mathsf{R}\_2} \right) \left( \frac{\mathsf{R}\_3 + \mathsf{R}\_4}{\mathsf{R}\_3} \right) \left( \frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{F}}} \right) - \mathbb{V}\_{\mathsf{IN2}} \left( \frac{\mathsf{R}\_4}{\mathsf{R}\_3} \right) \left( \frac{\mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{F}}} \right) \qquad \mathsf{A-21}$$

$$
\mathbb{V}\_{\mathsf{OUT}} = (\mathbb{V}\_{\mathsf{IN2}} - \mathbb{V}\_{\mathsf{IN1}}) \begin{pmatrix} \mathsf{R}\_4 \\ \overline{\mathsf{R}}\_3 \end{pmatrix} \begin{pmatrix} \mathsf{R}\_{\mathsf{F}} \\ \overline{\mathsf{R}}\_{\mathsf{G}} \end{pmatrix} \tag{4-22}
$$

When a function is enclosed in a feedback loop, the function acts inverted on the closed loop transfer function. Thus, the gain stage RF/RG ends up being an attenuator. The circuit shown in Figure A–19 can be used with any of the differential amplifiers to change gain without affecting matched resistors. R1, R3 and R2, R4 must be matched to reduce the common-mode voltage.

Here is the image describtion:
```
The image depicts a differential amplifier circuit with two operational amplifiers (op-amps) and several resistors. Here is a detailed description of the circuit:

1. **Inputs:**
   - There are two input voltage sources labeled \( V_{IN1} \) and \( V_{IN2} \).
   - \( V_{IN1} \) is connected to the non-inverting input of the first op-amp through resistor \( R_1 \).
   - \( V_{IN2} \) is connected to the non-inverting input of the second op-amp through resistor \( R_3 \).

2. **Operational Amplifiers:**
   - The circuit contains two op-amps, each powered by a positive supply voltage \( +V_{CC} \).
   - The first op-amp has its inverting input connected to the junction of resistors \( R_1 \) and \( R_2 \), and its non-inverting input connected to \( V_{IN1} \) through \( R_1 \).
   - The second op-amp has its inverting input connected to the junction of resistors \( R_F \) and \( R_G \), and its non-inverting input connected to \( V_{IN2} \) through \( R_3 \).

3. **Resistors:**
   - \( R_1 \) and \( R_2 \) form a voltage divider network connected to the inverting input of the first op-amp.
   - \( R_3 \) and \( R_4 \) form a voltage divider network connected to the non-inverting input of the second op-amp.
   - \( R_F \) is a feedback resistor connected between the output of the second op-amp and its inverting input.
   - \( R_G \) is connected between the output of the first op-amp and the inverting input of the second op-amp.

4. **Output:**
   - The output of the first op-amp is connected to the inverting input of the second op-amp through resistor \( R_G \).
   - The output of the second op-amp is labeled as \( V_{OUT} \).

5. **Reference Voltage:**
   - The non-inverting input of the second op-amp is connected to a reference voltage \( V_{REF} \), which is set to \( \frac{V_{CC}}{2} \).

6. **Power Supply:**
   - Both op-amps are powered by a positive supply voltage \( +V_{CC} \).

This circuit is designed to amplify the difference between the two input voltages \( V_{IN1} \) and \( V_{IN2} \), with the output voltage \( V_{OUT} \) being a function of this difference. The resistors \( R_1 \), \( R_2 \), \( R_3 \), \( R_4 \), \( R_F \), and \( R_G \) determine the gain and behavior of the differential amplifier.
```

Figure A–19. Variable Gain Differential Amplifier

### **A.3.16 T Network in the Feedback Loop**

Sometimes it is desirable to have a low-resistance path to ground in the feedback loop. Standard inverting op amps cannot do this when the driving circuit sets the input resistor value and the gain specification sets the feedback resistor value. Inserting a T network in the feedback loop yields a degree of freedom that enables both specifications to be met with a low dc resistance path to ground in the feedback loop.

Here is the image describtion:
```
The image consists of three main components: a mathematical equation, a circuit diagram, and a graph.

1. **Mathematical Equation:**
   - The equation is given as:
     \[
     V_{OUT} = -V_{IN} \left( \frac{R_2 + R_3 + \frac{R_2 R_3}{R_4}}{R_1} \right) + V_{REF} \left( 1 + \frac{R_2 + R_3 + \frac{R_2 R_3}{R_4}}{R_1} \right)
     \]
   - This equation appears to describe the output voltage (\(V_{OUT}\)) in terms of the input voltage (\(V_{IN}\)), a reference voltage (\(V_{REF}\)), and several resistors (\(R_1, R_2, R_3, R_4\)).

2. **Circuit Diagram:**
   - Below the equation, there is a simple circuit diagram consisting of three resistors (\(R_1, R_2, R_3\)) connected in series.
   - The resistors are labeled as \(R_1\), \(R_2\), and \(R_3\) from left to right.

3. **Graph:**
   - To the right of the circuit diagram, there is a graph with a vertical axis labeled "+5 V".
   - The graph appears to show a linear relationship, with a line that starts at the top left and slopes downward to the bottom right.
   - The graph is on a grid, suggesting it is used to plot voltage or some other electrical parameter over time or another variable.

Overall, the image seems to be related to an electrical engineering concept, possibly involving an operational amplifier or a similar circuit where the output voltage is a function of the input voltage, reference voltage, and the values of the resistors in the circuit.
```

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
- The circuit is an operational amplifier (op-amp) configuration.
- The input voltage \( V_{IN} \) is connected to a resistor \( R_1 \).
- \( R_1 \) is connected to another resistor \( R_2 \), which is connected to the inverting input (-) of the op-amp.
- The non-inverting input (+) of the op-amp is connected to a reference voltage \( V_{REF} \).
- The output of the op-amp \( V_{OUT} \) is connected to a resistor \( R_3 \), which is connected to the inverting input (-) of the op-amp.
- There is a resistor \( R_4 \) connected between the junction of \( R_3 \) and the inverting input (-) of the op-amp and ground.
- The op-amp is powered by a positive voltage supply \( V_{CC} \).

**Graph:**
- The graph plots \( V_{OUT} \) (vertical axis) against \( V_{IN} \) (horizontal axis).
- The vertical axis is labeled "V_{OUT} — 0.5 V/Div" and ranges from 0 V to -2.5 V.
- The horizontal axis is labeled "V_{IN} — 0.5 V/Div" and ranges from -2.5 V to +2.5 V.
- The graph shows a linear relationship between \( V_{OUT} \) and \( V_{IN} \), with a negative slope.

**Text Information:**
- \( V_{IN} = 250 \text{ mVp-p} \)
- \( V_{CC} = 5 \text{ V} \)
- \( V_{REF} = 114 \text{ mV} \)
- \( R_1 = R_3 = R_4 = 10 \text{ k} \)
- \( R_2 = 100 \text{ k} \)
- The op-amp used is TLV247x.

The circuit appears to be a differential amplifier or an inverting amplifier configuration, given the resistor values and the connection of the op-amp inputs. The graph indicates how the output voltage \( V_{OUT} \) changes with respect to the input voltage \( V_{IN} \).
```

Figure A–20. T Network in the Feedback Loop

#### **A.3.17 Buffer**

The buffer input signal polarity must be unipolar because the output voltage swing is unipolar. When this limitation precludes the buffer, a differential amplifier with the negative input correctly biased is used, or a reference voltage is added to the buffer to offset the output voltage. RF must be included when the op amp inputs are not rated for the full supply voltage. In that case, RF limits the current into the op amp inputs, thus preventing latch up. Most new op amp inputs can withstand the full supply voltage, so they often leave RF out as cost savings. The main attraction of the buffer is that it has very high input impedance and very low output impedance. The impedance transformation capability is why buffers are often added to the input of other circuits.

Here is the image describtion:
```
The image shows a mathematical equation written in a standard format. The equation is:

\[ V_{OUT} = V_{IN} + V_{REF} \]

Here, \( V_{OUT} \) represents the output voltage, \( V_{IN} \) represents the input voltage, and \( V_{REF} \) represents a reference voltage. The equation indicates that the output voltage is the sum of the input voltage and the reference voltage.

In the top right corner of the image, there is a label "A-24" which likely refers to a page number or a section identifier in a document or textbook. The equation and the label are both written in a clean, legible font.
```

Here is the image describtion:
```
The image depicts a simple operational amplifier (op-amp) circuit configured as a non-inverting amplifier. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp, represented by a triangle. The op-amp has two input terminals and one output terminal.
   - The non-inverting input (+) is connected to the input voltage source \( V_{IN} \).
   - The inverting input (-) is connected to a feedback resistor \( R_F \) and also to the ground through a reference voltage \( V_{REF} \).

2. **Power Supply**: The op-amp is powered by a positive voltage supply \( +V_{CC} \).

3. **Feedback Resistor (\( R_F \))**: A resistor \( R_F \) is connected between the output terminal \( V_{OUT} \) and the inverting input (-) of the op-amp. This resistor provides negative feedback, which stabilizes the gain of the amplifier.

4. **Input Voltage (\( V_{IN} \))**: The input voltage source \( V_{IN} \) is connected to the non-inverting input (+) of the op-amp.

5. **Reference Voltage (\( V_{REF} \))**: The reference voltage \( V_{REF} \) is connected to the ground, providing a common reference point for the circuit.

6. **Output Voltage (\( V_{OUT} \))**: The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

In this configuration, the op-amp amplifies the input voltage \( V_{IN} \) with a gain determined by the feedback resistor \( R_F \). The output voltage \( V_{OUT} \) is a function of the input voltage \( V_{IN} \) and the feedback network. The circuit is designed to provide a stable and amplified output signal based on the input signal.
```

Here is the image describtion:
```
The image is a graph that shows the relationship between the input voltage (V_IN) and the output voltage (V_OUT) of an operational amplifier (op-amp) circuit. The graph is a straight line, indicating a linear relationship between V_IN and V_OUT.

Here are the details of the graph:

1. **Axes:**
   - The horizontal axis (X-axis) represents the input voltage (V_IN) and is labeled with values ranging from -2.5 V to +2.5 V. The scale is 0.5 V per division.
   - The vertical axis (Y-axis) represents the output voltage (V_OUT) and is labeled with values ranging from 0 V to +5 V. The scale is 0.5 V per division.

2. **Line:**
   - The graph shows a straight line passing through the origin (0,0) and extending from the bottom left corner (-2.5 V, 0 V) to the top right corner (+2.5 V, +5 V). This indicates that the output voltage increases linearly with the input voltage.

3. **Annotations:**
   - The graph includes several annotations at the bottom:
     - \( V_{IN} = 5 \text{ Vp-p} \): This indicates that the peak-to-peak input voltage is 5 volts.
     - \( V_{CC} = 5 \text{ V} \): This indicates that the supply voltage for the op-amp is 5 volts.
     - \( V_{REF} = 2.5 \text{ V} \): This indicates that the reference voltage is 2.5 volts.
     - "Op Amp = TLV247x": This specifies that the operational amplifier used in the circuit is from the TLV247x series.

4. **Grid:**
   - The graph has a grid with both major and minor divisions, which helps in accurately reading the values of V_IN and V_OUT.

Overall, the graph illustrates the performance of the TLV247x op-amp in a configuration where the output voltage is directly proportional to the input voltage, with a reference voltage of 2.5 V and a supply voltage of 5 V.
```

Figure A–21. Buffer

### **A.3.18 Inverting AC Amplifier**

VCC and resistors R set a dc level of VCC/2 at the inverting input. RG is connected to ground through a capacitor, thus the circuit functions as a buffer for dc. This causes the dc output voltage to be VCC/2, so the quiescent output voltage is the middle of the supply voltage, and it is ready to swing to either rail as the input signal commands.

The ac gain is given in Equation A–25. RG and C form a coupling network for the ac signal. Good coupling networks should be constant low impedance at the signal frequencies, so Equation A–26 should be satisfied to get good low-frequency performance. The lowest frequency component of the input signal, fMIN, is determined by completing a Fourier series on the input signal. Then, setting fMIN = 100f in Equation A–26 ensures that the 3-dB breakpoint introduced by RG and C is two decades lower than fMAX.

$$
\mathbb{V}\_{\text{OUT}} = -\mathbb{V}\_{\text{IN}} \frac{\mathbf{R\_{F}}}{\mathbf{R\_{G}}} + \frac{\mathbb{V}\_{\text{CC}}}{2} \tag{4-25}
$$

$$\mathbf{f} = \frac{1}{200\pi \mathbf{R}\_{\mathbf{G}} \mathbf{C}} \tag{4-26}$$

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a non-inverting configuration. Here is a detailed description of the components and their connections:

1. **Input Signal (VIN)**: The circuit starts with an input signal source labeled as VIN, which is connected to the ground on one side.

2. **Capacitor (C)**: The input signal passes through a capacitor labeled as C. This capacitor is connected in series with the input signal, which suggests it is used for AC coupling, blocking any DC component of the input signal.

3. **Resistor (RG)**: After the capacitor, the signal passes through a resistor labeled RG. This resistor is connected in series with the capacitor and the non-inverting input of the op-amp.

4. **Operational Amplifier (Op-Amp)**: The op-amp is depicted with its standard triangular symbol. The non-inverting input (+) is connected to the junction of RG and the capacitor. The inverting input (-) is connected to the feedback network. The op-amp is powered by a positive voltage supply (+VCC) and a ground connection.

5. **Feedback Resistor (RF)**: A resistor labeled RF is connected between the output of the op-amp (VOUT) and the inverting input (-) of the op-amp. This resistor forms part of the feedback loop, which determines the gain of the amplifier.

6. **Voltage Divider Network**: The non-inverting input (+) of the op-amp is also connected to a voltage divider network formed by two resistors, both labeled R. One end of the first resistor is connected to a positive voltage supply (+VCC), and the other end is connected to the non-inverting input of the op-amp. The second resistor is connected between the non-inverting input and ground. This voltage divider sets a reference voltage at the non-inverting input.

7. **Output (VOUT)**: The output of the op-amp is labeled as VOUT, which is the amplified version of the input signal.

In summary, this circuit is a non-inverting amplifier with AC coupling at the input, a feedback resistor to set the gain, and a voltage divider to set the reference voltage at the non-inverting input. The op-amp amplifies the input signal, and the output is taken from the op-amp's output terminal.
```

Here is the image describtion:
```
The image is a Bode plot that shows the frequency response of an operational amplifier circuit. The plot has two y-axes: the left y-axis represents the output amplitude in decibels (dB), ranging from -20 dB to 0 dB, and the right y-axis represents the phase in degrees, ranging from 170 degrees to 270 degrees. The x-axis represents the frequency in Hertz (Hz), ranging from 10 Hz to 100 kHz on a logarithmic scale.

There are two curves on the plot:
1. The "VOUT" curve, which represents the output amplitude in dB. This curve starts near 0 dB at low frequencies and gradually decreases as the frequency increases, reaching around -18 dB at the highest frequencies.
2. The "Phase" curve, which represents the phase shift in degrees. This curve starts at around 270 degrees at low frequencies, decreases as the frequency increases, and approaches 180 degrees at the highest frequencies.

The plot also includes the following circuit parameters:
- \( V_{IN} = 1 \) Vp-p (peak-to-peak input voltage)
- \( V_{CC} = 5 \) V (supply voltage)
- \( C = 0.01 \) F (capacitance)
- \( R_G = R_F = R = 10 \) kΩ (resistances)
- The operational amplifier used is a TLV247x.

These parameters suggest that the plot is showing the frequency response of a specific configuration of an operational amplifier circuit, likely a filter or a similar frequency-dependent circuit.
```

Figure A–22. Inverting AC Amplifier

### **A.3.19 Noninverting AC Amplifier**

VCC and the resistors (R) set a dc level of VCC/2 at the inverting input. RG is connected to ground through a capacitor, thus the circuit functions as a buffer for dc. This causes the dc output voltage to be VCC/2, so the quiescent output voltage is the middle of the supply voltage, and it is ready to swing to either rail as the input signal commands.

The ac gain is given in Equation A–27. RG and C create a coupling network for the ac signal. Good coupling networks should be a constant low impedance at the signal frequencies, so Equation A–28 should be satisfied to get good low frequency performance. The lowest frequency component of the input signal, fMIN, is determined by completing a Fourier series on the input signal. Then, setting fMIN = 100f in Equation A–28 ensures that the 3-dB breakpoint introduced by RG and C is two decades lower than fMAX. The breakpoint for RG and C1 is set in a similar manner.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN}} \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} + \frac{\mathbb{V}\_{\mathsf{CC}}}{\mathsf{Z}} \left( \frac{\mathsf{R}\_{\mathsf{F}} + \mathsf{R}\_{\mathsf{G}}}{\mathsf{R}\_{\mathsf{G}}} \right) \tag{4-27}$$

$$\mathbf{f} = \frac{\mathbf{f}}{200\pi \mathbf{R}\_{\mathbf{G}} \mathbf{C}} \tag{4-28}$$

Here is the image describtion:
```
The image depicts a schematic diagram of an operational amplifier (op-amp) circuit. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangle with two input terminals and one output terminal.
   - The non-inverting input (+) is connected to ground.
   - The inverting input (-) is connected to a network of resistors and capacitors.

2. **Power Supply**:
   - The op-amp is powered by a positive voltage supply denoted as +Vcc.

3. **Input Signal (VIN)**:
   - The input signal, VIN, is provided by a voltage source symbolized by a circle with a sine wave inside, indicating an AC signal.
   - This input signal is connected to a capacitor (C) which is then connected to a node that splits into two paths.

4. **Resistors and Capacitors**:
   - There are two resistors (R) connected in series between the node (where the input capacitor connects) and ground.
   - Another capacitor (C) is connected in parallel with the second resistor (R) to ground.
   - The node between the two resistors is connected to the inverting input (-) of the op-amp.

5. **Feedback Network**:
   - A resistor (RG) is connected from the inverting input (-) of the op-amp to a node that connects to another capacitor (C) to ground.
   - Another resistor (RF) is connected from the output of the op-amp (VOUT) back to the inverting input (-), forming a feedback loop.

6. **Output (VOUT)**:
   - The output of the op-amp is labeled as VOUT.

This circuit appears to be a type of active filter or amplifier, utilizing the op-amp in a configuration that involves feedback and filtering components (resistors and capacitors). The exact function (e.g., low-pass filter, high-pass filter, amplifier) would depend on the values of the components and the specific configuration.
```

Here is the image describtion:
```
The image is a Bode plot, which is a graphical representation of a system's frequency response. It consists of two plots: one showing the output amplitude in decibels (dB) versus frequency in Hertz (Hz), and the other showing the phase shift in degrees versus frequency.

1. **Output Amplitude Plot**:
   - The vertical axis on the left side represents the output amplitude in decibels (dB), ranging from -30 dB to 10 dB.
   - The horizontal axis represents the frequency in Hertz (Hz), ranging from 10 Hz to 100 kHz on a logarithmic scale.
   - The curve labeled "VOUT" shows how the output amplitude changes with frequency. It starts at around 6 dB at low frequencies, decreases gradually, and drops sharply after around 1 kHz, reaching approximately -26 dB at 100 kHz.

2. **Phase Plot**:
   - The vertical axis on the right side represents the phase shift in degrees, ranging from -10 degrees to 90 degrees.
   - The same horizontal axis (frequency in Hz) is used for the phase plot.
   - The curve labeled "Phase" shows how the phase shift changes with frequency. It starts at 0 degrees at low frequencies, increases to around 45 degrees at approximately 1 kHz, and then decreases, reaching around -10 degrees at 100 kHz.

3. **Additional Information**:
   - The input voltage (VIN) is 1 V peak-to-peak (Vp-p).
   - The supply voltage (VCC) is 5 V.
   - The capacitance (C) is 0.01 F.
   - The resistances (RG, RF, and R) are all 10 kΩ.
   - The operational amplifier used is a TLV247x.

This Bode plot provides a comprehensive view of how the amplitude and phase of the output signal vary with frequency for the given circuit parameters.
```

Figure A–23. Noninverting AC Amplifier

# **A.4 Computing Circuits**

Four versions of the inverting op amp and four versions of the noninverting op amp were given in the previous section. During the concept stage of the design, one of these eight op amp circuits is selected. Specifications for the input and output voltage are the selection criteria that determines which circuit configuration is used.

There are four versions of most of the circuits given in this and following sections, but just the simplest version of any circuit is included in this appendix because of space limitations. Each circuit configuration can be modified as required to fit specific applications. Look back to the first section to determine what bias is required to fit the application, and adapt that bias to the new circuit.

### **A.4.1 Inverting Summer**

The three input voltages are inverted and added as Equation A–29 shows. RB should be made equal in value to the parallel combination of RF, RG1, RG2, and RG3 to convert the input bias current to a common-mode voltage so the op amp can reject it. VREF sets the output voltage somewhere between the supply limits, and this allows negative addition (subtraction) to take place.

$$\mathbb{V}\_{\mathsf{OUT}} = -\left(\mathbb{V}\_{\mathsf{IN1}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}}} + \mathbb{V}\_{\mathsf{IN2}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G2}}} + \mathbb{V}\_{\mathsf{IN3}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G3}}} + \dots \right) + \mathbb{V}\_{\mathsf{REF}} \left(\mathbb{1} + \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}} \parallel \mathsf{R}\_{\mathsf{G2}} \parallel \mathsf{R}\_{\mathsf{G3}}} \frac{\mathsf{b}\_{\mathsf{G2}}}{\mathsf{b}\_{\mathsf{G3}}}\dots\right) \mathsf{b}\_{\mathsf{G3}}$$

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram:
- **Components:**
  - **Operational Amplifier (Op-Amp):** The central component of the circuit, with its inverting input (-) connected to a network of resistors and its non-inverting input (+) connected to a reference voltage (V_REF) through a resistor (R_B).
  - **Resistors:**
    - **R_G1, R_G2, R_G3:** These resistors are connected to three different input voltages (V_IN1, V_IN2, V_IN3) respectively.
    - **R_F:** This resistor is connected between the inverting input of the op-amp and the output (V_OUT).
    - **R_B:** This resistor is connected between the non-inverting input of the op-amp and the reference voltage (V_REF).
  - **Voltage Sources:**
    - **V_IN1, V_IN2, V_IN3:** These are the input voltages connected to the resistors R_G1, R_G2, and R_G3 respectively.
    - **V_REF:** This is the reference voltage connected to the non-inverting input of the op-amp through resistor R_B.
    - **V_CC:** This is the positive supply voltage for the op-amp.

- **Connections:**
  - The inverting input of the op-amp is connected to the junction of resistors R_G1, R_G2, and R_G3, which are connected to the input voltages V_IN1, V_IN2, and V_IN3 respectively.
  - The non-inverting input of the op-amp is connected to the reference voltage V_REF through resistor R_B.
  - The output of the op-amp (V_OUT) is connected back to the inverting input through resistor R_F.

### Graph:
- **Axes:**
  - **X-Axis:** Represents the input voltage V_IN3, ranging from -2.5 V to +2.5 V.
  - **Y-Axis:** Represents the output voltage V_OUT, ranging from 0 V to +5 V.

- **Plot:**
  - The graph shows a linear relationship between V_IN3 and V_OUT, with a negative slope. As V_IN3 increases from -2.5 V to +2.5 V, V_OUT decreases from +5 V to 0 V.

### Additional Information:
- **Given Values:**
  - **V_IN1 = 1 V**
  - **V_IN2 = -1.5 V**
  - **V_IN3 = 5 V peak-to-peak (Vp-p)**
  - **V_CC = 5 V**
  - **V_REF = 0.625 V**
  - **Op Amp = TLV247x**
  - **R_G1 = R_G2 = R_G3 = R_F = 10 kΩ**

This circuit appears to be a summing amplifier with a reference voltage, where the output voltage (V_OUT) is a function of the input voltages (V_IN1, V_IN2, V_IN3) and the reference voltage (V_REF). The graph illustrates how the output voltage varies with changes in V_IN3, given the specified conditions.
```

Figure A–24. Inverting Summer

#### **A.4.2 Noninverting Summer**

This circuit adds the input voltages and multiplies them by the stage gain. RG1, RG2, and RG3 in parallel should be equal to RF in parallel with RG to cancel the input bias current using the common-mode input voltage rejection technique. VREF is added to the circuit to enable the addition of negative values.

$$\begin{split} \mathbb{V}\_{\text{OUT}} &= + \left( \frac{\mathbb{V}\_{\text{IN1}}(\mathbb{R}\_{\text{G2}} \parallel \mathbb{R}\_{\text{G3}})}{\mathbb{R}\_{\text{G1}} + \mathbb{R}\_{\text{G2}} \parallel \mathbb{R}\_{\text{G3}}} + \frac{\mathbb{V}\_{\text{IN2}}(\mathbb{R}\_{\text{G1}} \parallel \mathbb{R}\_{\text{G3}})}{\mathbb{R}\_{\text{G2}} + \mathbb{R}\_{\text{G1}} \parallel \mathbb{R}\_{\text{G3}}} + \frac{\mathbb{V}\_{\text{IN3}}(\mathbb{R}\_{\text{G2}} \parallel \mathbb{R}\_{\text{G1}})}{\mathbb{R}\_{\text{G3}} + \mathbb{R}\_{\text{G2}} \parallel \mathbb{R}\_{\text{G1}}} \right) \times \\ & \quad \left( \frac{\mathbb{R}\_{\text{F}} + \mathbb{R}\_{\text{G}}}{\mathbb{R}\_{\text{G}}} \right) - \mathbb{V}\_{\text{REF}} \frac{\mathbb{R}\_{\text{F}}}{\mathbb{R}\_{\text{G}}} \end{split}\_{\text{Q}}$$

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component is an op-amp with its non-inverting input (+) connected to a voltage reference (V_REF) through a resistor (R_G).
   - **Voltage Sources**: There are three voltage sources labeled V_IN1, V_IN2, and V_IN3.
     - V_IN1 is connected to the circuit through a resistor (R_G1).
     - V_IN2 is connected through another resistor (R_G2).
     - V_IN3 is connected through a third resistor (R_G3).
   - **Feedback Resistor (R_F)**: There is a feedback resistor (R_F) connected between the output (V_OUT) and the inverting input (-) of the op-amp.
   - **Power Supply**: The op-amp is powered by a positive voltage supply (+V_CC).

2. **Connections**:
   - The inverting input (-) of the op-amp is connected to the junction of the resistors R_G1, R_G2, and R_G3.
   - The non-inverting input (+) is connected to the voltage reference (V_REF) through the resistor (R_G).
   - The output (V_OUT) is taken from the output terminal of the op-amp.

### Graph (Right Side):
1. **Axes**:
   - The x-axis represents the input voltage V_IN3, ranging from -2.5 V to +2.5 V.
   - The y-axis represents the output voltage V_OUT, ranging from 0 V to +5 V.

2. **Plot**:
   - The graph shows a linear relationship between V_IN3 and V_OUT, indicating that as V_IN3 varies from -2.5 V to +2.5 V, V_OUT varies linearly from 0 V to +5 V.

3. **Annotations**:
   - The graph includes a grid with divisions marked at 0.5 V intervals for both V_IN3 and V_OUT.
   - The slope of the line is positive, indicating a direct proportionality between V_IN3 and V_OUT.

### Text Information (Bottom Right):
- **Given Values**:
  - V_IN1 = 1.5 V
  - V_IN2 = -1 V
  - V_IN3 = 5 V peak-to-peak (Vp-p)
  - V_CC = 5 V
  - V_REF = -1.25 V
  - R_F = 20 kΩ
  - Op Amp = TLV247x
  - R_G = R_G1 = R_G2 = R_G3 = 10 kΩ

### Summary:
The image depicts a summing amplifier circuit using an op-amp, with three input voltages (V_IN1, V_IN2, V_IN3) and a reference voltage (V_REF). The graph illustrates the linear relationship between one of the input voltages (V_IN3) and the output voltage (V_OUT), given specific component values and conditions.
```

Figure A–25. Noninverting Summer

#### **A.4.3 Noninverting Summer with Buffers**

VREF1 and VREF2 are added to enable the buffers to handle positive input voltages. Their output contribution to the last stage is cancelled out by VREF3. This configuration uses fewer resistors at the expense of two op amps. RG1, RG2, and RF in parallel should be made equal to RB to cancel the input bias current.

$$\mathbb{V}\_{\mathsf{OUT}} = \mathbb{V}\_{\mathsf{IN1}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}}} + \mathbb{V}\_{\mathsf{IN2}} \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G2}}} - \mathbb{V}\_{\mathsf{R}\mathsf{EF1}} \frac{2\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}}} - \mathbb{V}\_{\mathsf{R}\mathsf{EF2}} \frac{2\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G2}}} + \mathbb{V}\_{\mathsf{REF3}} \left(\mathsf{\mathsf{I}} + \frac{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G1}} \parallel \mathsf{R}\_{\mathsf{G2}}}\right) \mathsf{A} - 3\mathsf{M}$$

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

**Circuit Diagram:**
1. **Components:**
   - The circuit includes three operational amplifiers (op-amps) labeled with the positive power supply (+Vcc).
   - Resistors labeled R, R/2, RG1, RG2, RF, and RB.
   - Voltage sources labeled VREF1, VREF2, and VREF3.
   - Input voltage sources labeled VIN1 and VIN2.
   - Output voltage labeled VOUT.

2. **Connections:**
   - VIN1 is connected to a resistor R, which is then connected to the inverting input of the first op-amp.
   - The non-inverting input of the first op-amp is connected to VREF1 through a resistor R/2.
   - The output of the first op-amp is connected to RG1.
   - VIN2 is connected to a resistor R, which is then connected to the inverting input of the second op-amp.
   - The non-inverting input of the second op-amp is connected to VREF2 through a resistor R/2.
   - The output of the second op-amp is connected to RG2.
   - The outputs of the first and second op-amps are connected together and then to RF.
   - The combined output is connected to the inverting input of the third op-amp.
   - The non-inverting input of the third op-amp is connected to VREF3 through RB.
   - The output of the third op-amp is labeled VOUT.

**Graph:**
1. **Axes:**
   - The x-axis is labeled VIN3 with a scale of 0.5 V/Div ranging from -2.5 V to +2.5 V.
   - The y-axis is labeled VOUT with a scale of 0.5 V/Div ranging from 0 V to +5 V.

2. **Plot:**
   - The graph shows a linear relationship between VIN3 and VOUT, indicating that as VIN3 increases from -2.5 V to +2.5 V, VOUT increases from 0 V to +5 V.

**Text Information:**
1. **Parameters:**
   - VIN1 = 5 Vp-p (peak-to-peak voltage)
   - VIN2 = 0.5 V
   - VCC = 5 V
   - Op Amp = TLV247x
   - RG1 = RG2 = RF = R = 10 kΩ
   - VREF1 = 1.25 V
   - VREF2 = 1.25 V
   - VREF3 = 2.5 V

The image provides a detailed view of a circuit involving three op-amps, resistors, and reference voltages, along with a graph showing the output voltage as a function of an input voltage.
```

Figure A–26. Noninverting Summer with Buffers

#### **A.4.4 Inverting Integrator**

The Laplace operator, s= jω, is used in Equation A–32, and the mathematical operation 1/s constitutes an integration. Differentiation circuits are shown later, and the mathematical operation, s, constitutes a differentiation. The integration time constant is RC, thus the magnitude crosses 0 dB on a log plot when RC = 1. Also the phase is –45° when RC = 1.

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{V}\_{\mathsf{IN}} \frac{\mathsf{T}}{\mathsf{RCs}} \tag{4-32}$$

This integrator is not very practical because there is no method of discharging the capacitor; hence, any leakage current will eventually charge the capacitor until the circuit becomes saturated. The positive input of the integrator is biased at VCC / 2 to center the output voltage at VCC / 2; thus allowing for positive and negative voltage swings. The bias resistors are selected as 2R so that the parallel combination equals R. This offsets the input current drawn through R.

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
1. **Components and Connections**:
   - **Operational Amplifier (Op-Amp)**: The central component of the circuit, depicted with the standard triangle symbol. The non-inverting input (+) is connected to a voltage divider network, while the inverting input (-) is connected to the input signal through a resistor.
   - **Voltage Source (VIN)**: Connected to the inverting input of the op-amp through a resistor labeled \( R_F \).
   - **Resistors**:
     - \( R_F \): Connected between the input signal \( V_{IN} \) and the inverting input of the op-amp.
     - Two resistors labeled \( 2R \): One is connected between the non-inverting input (+) of the op-amp and a positive voltage source \( +V_{CC} \). The other is connected between the non-inverting input (+) and ground.
   - **Capacitor (C)**: Connected between the output of the op-amp and the inverting input (-).
   - **Power Supply**: The op-amp is powered by a positive voltage source \( +V_{CC} \).

2. **Functionality**:
   - The circuit appears to be a type of integrator or differentiator, given the presence of the capacitor in the feedback loop.
   - The voltage divider network at the non-inverting input sets a reference voltage for the op-amp.

### Graph (Right Side):
1. **Axes**:
   - **Y-Axis (Voltage)**: Labeled "Voltage — 1 V/Div", indicating that each vertical division represents 1 volt.
   - **X-Axis (Time)**: Labeled "Time — 100 s/Div", indicating that each horizontal division represents 100 seconds.

2. **Waveforms**:
   - **Input Voltage (VIN)**: Represented by a square wave with a peak-to-peak voltage of 2 V (as indicated by the label \( V_{IN} = 2 V_{p-p} \)).
   - **Output Voltage (VOUT)**: Represented by a triangular wave, indicating that the circuit is integrating the input square wave.

3. **Additional Information**:
   - **Component Values**:
     - \( R = 10 k \Omega \)
     - \( C = 10000 pF \)
   - **Power Supply**: \( V_{CC} = 5 V \)
   - **Operational Amplifier Model**: TLV247x

### Summary:
The image shows a circuit diagram of an op-amp integrator with a square wave input and a triangular wave output. The graph on the right illustrates the input and output waveforms, confirming the integrator behavior of the circuit. The circuit uses specific component values and is powered by a 5V supply, with the op-amp model specified as TLV247x.
```

Figure A–27. Inverting Integrator

# **A.4.5 Inverting Integrator with Input Current Compensation**

Functionally, this circuit is the same as that shown in Figure A–27, but a current compensation network has been added to offset the input current. VCC, R1, and R2 bias the positive input at VCC / 2 to center the output voltage at VCC / 2; thus allowing for positive and negative voltage swings.

R1 and R2 are selected as relatively small values because the current flowing through RA also flows through the parallel combination of R1 and R2. RA forward biases the diode with a constant current, thus the diode acts like a small voltage regulator. The diode voltage drop is temperature sensitive, and this factor works in our favor because the input transistors are temperature sensitive. The two temperature sensitivities cancel out if the diode current is selected correctly. RB is a large-value resistor that acts like a current source, so it is selected such that it supplies the input bias current. Selecting RB correctly ensures that no input current flows through the integration resistor, R.

This integrator is not very practical because there is no method of discharging the capacitor. Hence, any input current will eventually charge the capacitor until the circuit becomes saturated. The bias circuit drastically reduces the input current flowing through R, thus it extends the integration time. A reset circuit is needed to make the integrator more practical.

This bias compensation scheme is set up for an op amp that has NPN input transistors. The diode must be reversed and connected to ground for op amps with PNP input circuits.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in an inverting configuration. The circuit includes various components and connections, which are described as follows:

1. **Operational Amplifier (Op-Amp)**: The central component is an op-amp with its inverting input (-) and non-inverting input (+) clearly marked. The op-amp is powered by a positive voltage supply (+Vcc).

2. **Input Voltage (V_IN)**: There is a voltage source labeled V_IN connected to the circuit. This input voltage is applied through a resistor R to the inverting input of the op-amp.

3. **Resistors and Capacitor**:
   - **R**: A resistor connected between the input voltage source (V_IN) and the inverting input of the op-amp.
   - **C**: A capacitor connected between the inverting input of the op-amp and the output of the op-amp (V_OUT).
   - **R_A and R_B**: Resistors connected in series with a diode (D) and the non-inverting input of the op-amp. R_A is connected to the positive voltage supply (+Vcc), and R_B is connected to the junction between R_A and the diode (D).
   - **R1 and R2**: Resistors connected in series between the non-inverting input of the op-amp and the ground. R1 is connected to the non-inverting input, and R2 is connected to the ground.

4. **Diode (D)**: A diode is connected between the junction of R_A and R_B and the non-inverting input of the op-amp.

5. **Voltage Supply (+Vcc)**: The circuit is powered by a positive voltage supply labeled +Vcc, which is connected to various points in the circuit, including the op-amp, resistors, and the diode.

6. **Output Voltage (V_OUT)**: The output of the op-amp is labeled V_OUT, which is the output voltage of the circuit.

7. **Equation**: The equation provided at the top of the image describes the relationship between the output voltage (V_OUT) and the input voltage (V_IN1). The equation is:
   \[
   V_{OUT} = -V_{IN1} \frac{1}{RCS}
   \]
   This indicates that the output voltage is the negative of the input voltage multiplied by the reciprocal of the product of the resistor (R), capacitor (C), and the complex frequency variable (s).

The circuit appears to be a type of integrator circuit, where the output voltage is the integral of the input voltage over time, as indicated by the presence of the capacitor in the feedback loop and the given equation.
```

Figure A–28. Inverting Integrator with Input Current Compensation

### **A.4.6 Inverting Integrator with Drift Compensation**

Functionally, this circuit is the same as that shown in Figure A–27, but it uses an RC circuit in the positive lead to obtain drift compensation. The voltage divider is made from a series string of resistors (RA), and VCC biases the input in the center of the power supply.

Positive input current flows through R and C in parallel, so the positive input current drops the same voltage across the parallel RC combination as the negative input current drops across its series RC combination. The common-mode rejection capability of the op amp rejects the voltages caused by the input currents. Much longer integration times can be achieved with this circuit, but when the input signal does not center around VCC/2, the compensation is poor.

Here is the image describtion:
```
The image shows a circuit diagram of an operational amplifier (op-amp) configuration along with its corresponding transfer function equation. Here is a detailed description of the image:

1. **Transfer Function Equation**: 
   - The equation at the top of the image is \( V_{OUT} = -V_{IN1} \frac{1}{RCS} \). This indicates that the output voltage \( V_{OUT} \) is inversely proportional to the input voltage \( V_{IN1} \), the resistance \( R \), and the capacitance \( C \), and it includes a negative sign indicating an inversion.

2. **Circuit Components**:
   - **Input Voltage Source (\( V_{IN} \))**: On the left side of the circuit, there is a voltage source labeled \( V_{IN} \) with its negative terminal connected to the ground.
   - **Resistor (R)**: Connected in series with the input voltage source \( V_{IN} \).
   - **Capacitor (C)**: Connected in parallel with the feedback loop of the op-amp.
   - **Operational Amplifier (Op-Amp)**: The op-amp is depicted with its inverting input (-) connected to the junction of the resistor \( R \) and capacitor \( C \). The non-inverting input (+) is connected to a voltage divider network.
   - **Voltage Divider Network**: Consists of two resistors \( R_A \) connected in series between \( +V_{CC} \) and ground, with a capacitor \( C \) connected in parallel to the lower resistor \( R_A \).
   - **Power Supply**: The op-amp is powered by a positive voltage supply \( +V_{CC} \).

3. **Connections**:
   - The non-inverting input (+) of the op-amp is connected to the midpoint of the voltage divider network.
   - The output of the op-amp is connected back to the inverting input (-) through the capacitor \( C \).
   - The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

4. **Ground Connections**: The ground symbol is used at multiple points in the circuit, including the negative terminal of the input voltage source, the non-inverting input of the op-amp, and the lower end of the voltage divider network.

This circuit appears to be an integrator configuration of an op-amp, where the output voltage is the integral of the input voltage over time, scaled by the resistor \( R \) and capacitor \( C \). The negative sign in the transfer function indicates that the output is inverted relative to the input.
```

Figure A–29. Inverting Integrator with Drift Compensation

## **A.4.7 Inverting Integrator with Mechanical Reset**

Functionally, this circuit is the same as that shown in Figure A–27, but a method has been provided to discharge (reset) the capacitor. S1 is a mechanical switch or relay and when the contacts close, they short the integrating capacitor forcing it to discharge. Some capacitors are sensitive to fast discharge cycles, so RS is put in the discharge path to limit the initial discharge current. When RS is absent from the circuit, the impulse of current that occurs at the first instant of discharge causes considerable noise, so the selection of RS is also based on noise considerations. For all practical purposes, the time constant formed by RS and C determines the discharge rate.

One advantage of mechanical discharge methods is that they are isolated from the remainder of the circuit. Their size, weight, time delay, and uncertain actuating time offset this advantage. When the disadvantages of mechanical reset outweigh the advantages, circuit designers go to electronic reset circuits.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in an integrator configuration. Here is a detailed description of the components and their connections:

1. **Input Voltage Source (V_IN)**: The circuit has an input voltage source labeled as \( V_{IN} \), which is connected to the left side of the diagram.

2. **Resistor (R)**: The input voltage \( V_{IN} \) is connected to a resistor labeled \( R \). The other end of this resistor is connected to a node that branches out to other components.

3. **Switch (S1) and Resistor (R_S)**: From the node after the resistor \( R \), there is a branch that includes a series resistor labeled \( R_S \) and a switch labeled \( S1 \). The switch can either connect or disconnect the resistor \( R_S \) from the circuit.

4. **Capacitor (C)**: The node after the resistor \( R \) is also connected to a capacitor labeled \( C \). The other end of the capacitor is connected to the inverting input (−) of the operational amplifier.

5. **Operational Amplifier (Op-Amp)**: The op-amp has its inverting input (−) connected to the capacitor \( C \) and the non-inverting input (+) connected to a voltage divider network. The output of the op-amp is labeled \( V_{OUT} \).

6. **Voltage Divider Network**: The non-inverting input (+) of the op-amp is connected to a voltage divider made up of two resistors, each labeled \( 2R \). The top of the voltage divider is connected to a positive supply voltage \( +V_{CC} \), and the bottom is connected to the ground.

7. **Power Supply**: The op-amp is powered by a positive supply voltage \( +V_{CC} \) and a ground connection.

8. **Output Voltage (V_OUT)**: The output of the op-amp is labeled \( V_{OUT} \), which is the output voltage of the circuit.

9. **Equation**: The equation provided at the top of the image describes the relationship between the input voltage \( V_{IN} \) and the output voltage \( V_{OUT} \). It is given by:
   \[
   V_{OUT} = -V_{IN} \frac{1}{RCS}
   \]
   This equation indicates that the circuit is an integrator, where the output voltage is the integral of the input voltage over time, scaled by the resistor \( R \), the capacitor \( C \), and the switch \( S1 \).

Overall, the circuit is an integrator op-amp configuration with a switchable resistor \( R_S \) that can modify the integration behavior.
```

Figure A–30. Inverting Integrator with Mechanical Reset

### **A.4.8 Inverting Integrator with Electronic Reset**

Functionally, this circuit is the same as that shown in Figure A–27, but an electronic method has been provided to discharge (reset) the capacitor. Q1 is controlled by a gate drive signal that changes its state from on to off. When Q1 is on, the gate-source resistance is low, less than 100 Ω. Αnd when Q1 is off, the gate-source resistance is high — about several hundred MΩ.

The source of the FET is at the inverting lead that is at ground, so the Q1 gate-source bias is not affected by the input signal. Sometimes, the output signal can get large enough to cause leakage currents in Q1, so the designer must take care to bias Q1 correctly. Consult a transistor book for more detailed information on transistor reset circuits. A major problem with electronic reset is the charge injected through the transistor's stray capacitance. This charge can be large enough to cause integration errors.

$$
\mathbb{V}\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{W}\mathsf{tl}} \frac{\mathsf{T}}{\mathsf{R}\mathsf{Cs}} \tag{4-36}
$$

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) configured in a specific arrangement. Here is a detailed description of the components and their connections:

1. **Input Voltage Source (VIN)**: On the left side of the diagram, there is an AC voltage source labeled \( V_{IN} \) with its negative terminal connected to the ground.

2. **Resistor (R)**: The positive terminal of the voltage source \( V_{IN} \) is connected to a resistor labeled \( R \).

3. **Capacitor (C)**: The other end of the resistor \( R \) is connected to a node that also connects to one terminal of a capacitor labeled \( C \). The other terminal of the capacitor is connected to the positive power supply \( +V_{CC} \).

4. **Transistor (Q1)**: A transistor labeled \( Q1 \) is connected in parallel with the capacitor \( C \). The transistor has a label "Reset" indicating it can be used to reset the circuit by discharging the capacitor.

5. **Operational Amplifier (Op-Amp)**: The node where the resistor \( R \) and capacitor \( C \) meet is connected to the inverting input (marked with a minus sign) of an operational amplifier. The op-amp is powered by \( +V_{CC} \).

6. **Voltage Divider Network**: The non-inverting input (marked with a plus sign) of the op-amp is connected to a voltage divider network. This network consists of two resistors, each labeled \( 2R \), connected in series between the positive power supply \( +V_{CC} \) and the ground. The midpoint of these two resistors is connected to the non-inverting input of the op-amp.

7. **Output Voltage (VOUT)**: The output of the op-amp is labeled \( V_{OUT} \) and is available as the output of the circuit.

8. **Power Supply**: The op-amp is powered by a positive power supply \( +V_{CC} \).

In summary, the circuit appears to be a comparator with a reference voltage set by the voltage divider network. The capacitor \( C \) and the transistor \( Q1 \) suggest that the circuit might be used for timing or pulse generation applications, where the capacitor can be reset by the transistor to control the timing intervals.
```

Figure A–31. Inverting Integrator with Electronic Reset

#### **A.4.9 Inverting Integrator with Resistive Reset**

This circuit differs from that shown in Figure A–27 because it yields a breakpoint rather than a pure integration. On a log plot, the integrator slope is –6 dB per octave at the 0 frequency intercept, and the 0 dB intercept occurs when f = 1/2πRC. A breakpoint plots flat on a log plot until the breakpoint where it breaks down at –6 dB per octave. It is –3 dB when f = 1/2πRC.

RF is in parallel with the integrating capacitor, C, so it is continually discharging C. The low frequency attenuation that is the best attribute of the pure integrator is sacrificed for the reset circuit complexity

$$\mathsf{V}\_{\mathsf{OUT}} = -\mathsf{V}\_{\mathsf{IN1}} \binom{\mathsf{R}\_{\mathsf{F}}}{\mathsf{R}\_{\mathsf{G}}} \frac{\mathsf{1}}{\mathsf{R}\_{\mathsf{F}} \mathsf{C} + \mathsf{1}} \tag{4-37}$$

Here is the image describtion:
```
The image consists of two parts: a circuit diagram on the left and a frequency response graph on the right.

### Circuit Diagram (Left Side):
- **Components:**
  - **Operational Amplifier (Op-Amp):** The central component of the circuit.
  - **Resistors:**
    - **RG:** Connected between the input voltage source (VIN) and the inverting input (-) of the op-amp.
    - **RF:** Connected between the inverting input (-) of the op-amp and the output (VOUT).
    - **R:** Two resistors of equal value connected in series between the non-inverting input (+) of the op-amp and ground. The midpoint of these resistors is connected to a positive voltage supply (+VCC).
  - **Capacitor (C):** Connected in parallel with the feedback resistor (RF) between the inverting input (-) and the output (VOUT).
  - **Voltage Source (VIN):** The input signal applied to the circuit.
  - **Power Supply (+VCC):** Provides the necessary operating voltage for the op-amp.

### Frequency Response Graph (Right Side):
- **Axes:**
  - **X-Axis (Frequency - Hz):** Logarithmic scale ranging from 10 Hz to 100 kHz.
  - **Left Y-Axis (Output Amplitude - dB):** Ranges from -17 dB to 3 dB.
  - **Right Y-Axis (Phase - Degrees):** Ranges from 90 degrees to 190 degrees.
- **Curves:**
  - **Output Amplitude (VOUT):** Shows the gain of the circuit in dB across the frequency range.
  - **Phase:** Shows the phase shift in degrees across the frequency range.
- **Performance:**
  - The amplitude response is relatively flat at lower frequencies and starts to roll off around 1 kHz, indicating a decrease in gain at higher frequencies.
  - The phase response starts at around 180 degrees at low frequencies and decreases as the frequency increases, indicating a phase lag introduced by the circuit.
- **Conditions:**
  - **VIN = 1 Vp-p:** The input voltage is 1 volt peak-to-peak.
  - **VCC = 5 V:** The power supply voltage is 5 volts.
  - **RG = RF = R = 10 kΩ:** The resistors RG, RF, and R all have a value of 10 kilo-ohms.
  - **C = 0.01 F:** The capacitor has a value of 0.01 farads.
  - **Op Amp = TLV247x:** The operational amplifier used in the circuit is from the TLV247x series.

Overall, the image provides a detailed view of a specific op-amp circuit configuration and its frequency response characteristics.
```

Figure A–32. Inverting Integrator with Resistive Reset

# **A.4.10 Noninverting Integrator with Inverting Buffer**

This circuit is an inverting integrator preceded by an inverting buffer. Eliminating the signal inversion costs an op amp and four resistors, but this is the easiest way to get true noninverting integrator performance.

Here is the image describtion:
```
The image shows a circuit diagram and an associated equation for the output voltage \( V_{OUT} \). The circuit consists of two operational amplifiers (op-amps) and several resistors and a capacitor. Here is a detailed description:

1. **Equation**: The equation at the top of the image is:
   \[
   V_{OUT} = \frac{R_A}{R_A} \left( V_{IN} - V_{IN} \frac{1}{RCs} \right) = V_{IN} \frac{1}{RCs}
   \]
   This equation suggests that the output voltage \( V_{OUT} \) is a function of the input voltage \( V_{IN} \), the resistance \( R \), the capacitance \( C \), and the complex frequency variable \( s \).

2. **Circuit Components**:
   - **Resistors**: There are several resistors labeled \( R_A \), \( R \), and \( 2R \).
   - **Capacitor**: There is one capacitor labeled \( C \).
   - **Operational Amplifiers**: There are two op-amps in the circuit, each powered by a positive voltage supply \( +V_{CC} \).

3. **Connections**:
   - The input voltage \( V_{IN} \) is connected to the first resistor \( R_A \).
   - The first op-amp has its inverting input connected to the junction of two \( R_A \) resistors and its non-inverting input connected to ground through another \( R_A \) resistor.
   - The output of the first op-amp is connected to the second resistor \( R \).
   - The second op-amp has its inverting input connected to the junction of the resistor \( R \) and the capacitor \( C \), and its non-inverting input connected to ground through two resistors labeled \( 2R \).
   - The output of the second op-amp is the output voltage \( V_{OUT} \).

4. **Power Supply**: Both op-amps are powered by a positive voltage supply \( +V_{CC} \).

The circuit appears to be a type of filter or integrator, given the presence of the capacitor and the form of the equation, which involves the complex frequency variable \( s \). The exact function of the circuit would depend on the specific values of the components and the configuration of the op-amps.
```

Figure A–33. Noninverting Integrator with Inverting Buffer

### **A.4.11 Noninverting Integrator Approximation**

This circuit has fewer parts than the Noninverting Integrator With Inverting Buffer (Figure A–33), but it is not a true integrator because there is a zero in the transfer equation. The log plot starts rolling off at a –6 dB per octave rate at low frequencies, but when f = 1/2πRC, the zero cuts in. The zero causes the log plot to flatten out because the slope decreases to 0 db per decade.

This circuit functions as an integrator at very low frequencies, but at frequencies higher than f = 1/2πRC, it functions as a buffer.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a specific configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with two inputs and one output.
   - The non-inverting input (+) is connected to the ground.
   - The inverting input (-) is connected to a resistor (R) and a capacitor (C) in the feedback loop.
   - The output of the op-amp is labeled as \( V_{OUT} \).

2. **Power Supply**:
   - The op-amp is powered by a dual supply voltage, with \( +V_{CC} \) connected to the positive power supply pin and the ground connected to the negative power supply pin.

3. **Resistors and Capacitor**:
   - There are two resistors labeled \( R \) and \( R_A \).
   - The resistor \( R \) is connected in series with the capacitor \( C \) in the feedback loop of the op-amp.
   - Another resistor \( R \) is connected between the inverting input of the op-amp and the node where \( R_A \) and \( R \) meet.
   - The resistor \( R_A \) is connected in a voltage divider configuration with another \( R_A \) resistor, which is connected to the ground.

4. **Input Voltage Source**:
   - The input voltage source \( V_{IN} \) is connected to the node where the voltage divider (formed by the two \( R_A \) resistors) meets the resistor \( R \).

5. **Transfer Function**:
   - The transfer function of the circuit is given by the equation:
     \[
     V_{OUT} = \frac{RCs + 1}{RCs} V_{IN}
     \]
   - This indicates that the output voltage \( V_{OUT} \) is a function of the input voltage \( V_{IN} \), the resistance \( R \), the capacitance \( C \), and the complex frequency variable \( s \).

6. **Label**:
   - The diagram is labeled as "A-39" in the top right corner.

This circuit appears to be a type of active filter or frequency-dependent amplifier, where the output voltage depends on the frequency of the input signal due to the presence of the capacitor \( C \) and the resistors \( R \).
```

Figure A–34. Noninverting Integrator Approximation

#### **A.4.12 Inverting Differentiator**

The log plot of the differentiator is a positive slope of 6-dB per octave passing through 0 dB at f = 1/2πRC. At extremely high frequencies, the capacitive reactance goes to very low values, thus the circuit gain approaches the op amp open-loop gain. This performance emphasizes any system noise or noise generated by the op amp. The poor noise performance of this circuit limits its application to a very few specialized situations.

This configuration has a pole in the feedback loop. If the op amp has more than one pole, and most op amps have several poles, this configuration can become oscillatory. The VCC and RA circuit bias the output in the center of the power supplies. RA/2 should be selected equal to RG||RF so that input currents are canceled out.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a frequency response graph on the right.

### Circuit Diagram (Left Side):
- **Components:**
  - **VIN:** An input voltage source.
  - **C:** A capacitor connected in series with the input voltage source.
  - **R:** A resistor connected in series with the capacitor.
  - **Op-Amp:** An operational amplifier (Op-Amp) with its non-inverting input (+) connected to a voltage divider made of two resistors (each of value 2R) and a positive supply voltage (+Vcc).
  - **Voltage Divider:** Two resistors of value 2R each, connected in series between +Vcc and ground. The midpoint of these resistors is connected to the non-inverting input of the Op-Amp.
  - **VOUT:** The output voltage of the Op-Amp.

- **Connections:**
  - The input voltage (VIN) is applied to the series combination of the capacitor (C) and resistor (R).
  - The junction between the capacitor and resistor is connected to the inverting input (-) of the Op-Amp.
  - The non-inverting input (+) of the Op-Amp is connected to the midpoint of the voltage divider.
  - The output of the Op-Amp (VOUT) is taken from the output terminal of the Op-Amp.

### Frequency Response Graph (Right Side):
- **Axes:**
  - The x-axis represents the frequency (f) in Hertz (Hz) on a logarithmic scale ranging from 1 Hz to 1 kHz.
  - The left y-axis represents the output amplitude in decibels (dB), ranging from -25 dB to 25 dB.
  - The right y-axis represents the phase in degrees, ranging from -180 degrees to -80 degrees.

- **Curves:**
  - **Output Amplitude (VOUT):** A curve showing the output amplitude response of the circuit across the frequency range. The amplitude increases with frequency, starting from around -20 dB at 1 Hz and reaching around 20 dB at 1 kHz.
  - **Phase:** A curve showing the phase response of the circuit across the frequency range. The phase starts at around -180 degrees at 1 Hz and gradually increases, approaching -90 degrees as the frequency increases.

### Additional Information:
- **VIN = 50 mVp-p:** The input voltage is 50 millivolts peak-to-peak.
- **VCC = 5 V:** The supply voltage for the Op-Amp is 5 volts.
- **R = 10 kΩ:** The resistor value is 10 kilo-ohms.
- **C = 0.001 F:** The capacitor value is 0.001 farads.
- **Op Amp = TLV247x:** The operational amplifier used in the circuit is a TLV247x series Op-Amp.

This image provides a detailed view of a high-pass filter circuit using an Op-Amp and its frequency response characteristics.
```

$$
\mathbb{V}\_{\mathsf{OUT}} = -\,\mathsf{V}\_{\mathsf{IN}} \,\mathsf{RCs} \tag{4-40}
$$

Figure A–35. Inverting Differentiator

#### **A.4.13 Inverting Differentiator with Noise Filter**

This circuit has a pure differentiator that rises at a 6-dB per octave slope from zero frequency. At f = 1/2πRFCF, the pole kicks in and the slope is reduced to zero. The pole has two effects. First, it stabilizes the circuit by canceling zero's phase shift. Second, it limits the circuit gain to 1 at high frequencies, so it acts like a noise filter.

R/2 should equal RF for good input current cancellation, and VCC coupled with R centers the output voltage.

Here is the image describtion:
```
The image consists of two main parts: a circuit diagram on the left and a graph on the right.

### Circuit Diagram (Left Side):
- **Components:**
  - **Operational Amplifier (Op-Amp):** The central component of the circuit, depicted with the standard triangular symbol.
  - **Capacitors:**
    - **Cc:** Connected in series with the input voltage source (VIN).
    - **CF:** Connected in parallel with the feedback resistor (RF).
  - **Resistors:**
    - **RF:** Connected in the feedback loop of the op-amp.
    - **R:** Two resistors of equal value connected in series between the positive supply voltage (+Vcc) and ground, with their junction connected to the non-inverting input of the op-amp.
- **Connections:**
  - The input voltage (VIN) is applied through capacitor Cc to the inverting input of the op-amp.
  - The non-inverting input of the op-amp is connected to a voltage divider formed by two resistors (R) connected between +Vcc and ground.
  - The feedback loop consists of resistor RF and capacitor CF connected in parallel between the output (VOUT) and the inverting input of the op-amp.
  - The op-amp is powered by a positive supply voltage (+Vcc).

### Graph (Right Side):
- **Axes:**
  - **X-Axis (Horizontal):** Represents the frequency (f) in Hertz (Hz), ranging from 1 Hz to 1 kHz on a logarithmic scale.
  - **Y-Axis (Left Vertical):** Represents the output amplitude in decibels (dB), ranging from -25 dB to 25 dB.
  - **Y-Axis (Right Vertical):** Represents the phase in degrees, ranging from -180 degrees to -80 degrees.
- **Curves:**
  - **Output Amplitude (VOUT):** A curve showing the output amplitude response of the circuit across the frequency range.
  - **Phase:** A curve showing the phase response of the circuit across the frequency range.
- **Annotations:**
  - The graph includes specific values for the input voltage (VIN = 50 mVp-p), the supply voltage (VCC = 5 V), the feedback resistor (RF = 10 kΩ), the resistors (R = 10 kΩ), and the capacitor (C = 0.01 F).
  - The operational amplifier used in the circuit is specified as TLV247x.

### Summary:
The image illustrates a high-pass filter circuit using an operational amplifier, with a detailed frequency response graph showing both the amplitude and phase characteristics of the output signal. The circuit is designed with specific component values and powered by a 5V supply.
```

$$
\lambda\_{\rm OUT} = -\,\lambda\_{\rm IN} \,\frac{\mathbf{R}\_{\rm F} \mathbf{C} \mathbf{s}}{\mathbf{R} \cdot \mathbf{C} \cdot \mathbf{s} + \mathbf{1}} \tag{441}
$$

Figure A–36. Inverting Differentiator with Noise Filter

# **A.5 Oscillators**

This section describes some general op amp sinewave oscillator circuits that fall under three main categories: Wien bridge, phase shift, and quadrature. A brief description and of each type is provided, along with one or two variations. Op amp sinewave oscillators are used to create references in applications such as audio and function/waveform generators.

#### **A.5.1 Basic Wien Bridge Oscillator**

When ω = 2πf = 1/RC, the feedback is in phase (this is positive feedback), and the gain is 1/3, so oscillation requires an amplifier with a gain of 3. When RF = 2RG the amplifier gain is 3 and oscillation occurs at f = 1/2πRC. Normally, the gain is larger than 3 to ensure oscillation under worst case conditions.

VREF sets the output dc voltage in the center of the span.

The output sine wave is highly distorted because limiting by saturation and cutoff is controlling the output voltage excursion. The distortion decreases when the gain is decreased, but the circuit may not oscillate under worst-case low gain conditions.

Here is the image describtion:
```
The image shows a schematic diagram of an electronic circuit involving an operational amplifier (op-amp) configured with resistors and capacitors. The circuit appears to be a type of oscillator or filter circuit. Here is a detailed description:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is depicted with the standard triangular symbol.
   - The non-inverting input (+) is connected to a voltage reference \( V_{REF} \).
   - The inverting input (-) is connected to a feedback network.

2. **Feedback Network**:
   - A resistor \( R_F \) is connected between the output of the op-amp and the inverting input (-).
   - A resistor \( R_G \) is connected between the inverting input (-) and ground.

3. **Voltage Reference (\( V_{REF} \))**:
   - The voltage reference \( V_{REF} \) is given by the formula:
     \[
     V_{REF} = \frac{\frac{V_{CC}}{2}}{1 + \frac{R_F}{R_G}}
     \]
   - This formula indicates that \( V_{REF} \) is derived from the supply voltage \( V_{CC} \) and the resistors \( R_F \) and \( R_G \).

4. **Output and Additional Components**:
   - The output of the op-amp is labeled as \( V_{OUT} \).
   - There is a series combination of a resistor \( R \) and a capacitor \( C \) connected from the output \( V_{OUT} \) to a node.
   - This node is connected to another series combination of a resistor \( R \) and a capacitor \( C \), which then connects to the voltage reference \( V_{REF} \).

5. **Power Supply**:
   - The op-amp is powered by a positive supply voltage \( +V_{CC} \).

6. **Connections**:
   - The non-inverting input (+) of the op-amp is connected to the voltage reference \( V_{REF} \).
   - The inverting input (-) is connected to the junction of \( R_F \) and \( R_G \).
   - The output \( V_{OUT} \) is connected to the feedback network and the series RC network.

The circuit likely functions as an oscillator or a filter, given the presence of the capacitors and resistors in the configuration. The exact behavior would depend on the values of the components and the specific configuration of the op-amp.
```

Figure A–37. Basic Wien Bridge Oscillator

#### **A.5.2 Wien Bridge Oscillator with Nonlinear Feedback**

When the circuit gain is 3, RL = RF/2.

Substituting a lamp (RL) for the gain setting resistor reduces distortion because the non– linear lamp resistance adjusts the gain to keep the output voltage smaller than the power supply voltage. The output voltage never approaches the power supply rail, so distortion doesn't occur. RF and RL determine the lamp current (see Equations A–43 and A–44).

$$\left|\mathbf{I}\_{\text{LMP}} = \frac{\mathsf{V}\_{\text{OUT(RMS)}}}{\mathsf{R}\_{\text{F}} + \mathsf{R}\_{\text{L}}}\right. \tag{4-43}$$
 
$$\mathsf{R}\_{\text{F}} = \frac{\mathsf{Z}\Big(\mathsf{V}\_{\text{OUT(RMS)}}\Big)}{\mathsf{Z}\Big(\mathsf{I}\_{\text{OUT(RMS)}}\Big)} \tag{4-44}$$

The lamp is selected by examining lamp resistance curves until a lamp with a resistance approximately equal to RF/2 at IOUT(RMS) is found. The output voltage swing should be less than 75% of the maximum guaranteed voltage swing, and 3 RL must be greater than the load resistance specified for the voltage swing specification. VREF should be VCC/5.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is represented by a triangular symbol with two input terminals (one marked with a plus sign for the non-inverting input and one marked with a minus sign for the inverting input) and one output terminal.
   - The non-inverting input is connected to a reference voltage labeled as \( V_{REF} \).
   - The inverting input is connected to a node that is part of a feedback network.

2. **Feedback Network**:
   - A resistor \( R_F \) is connected between the output of the op-amp and the inverting input.
   - The inverting input is also connected to a node that connects to a lamp \( RL \) and a capacitor \( C \).

3. **Lamp \( RL \)**:
   - The lamp is connected between the node at the inverting input and ground.

4. **Capacitor \( C \)**:
   - One capacitor \( C \) is connected between the node at the inverting input and ground.
   - Another capacitor \( C \) is connected in parallel with a resistor \( R \) between the output of the op-amp and the node connected to \( V_{REF} \).

5. **Resistors \( R \)**:
   - One resistor \( R \) is connected in series with the capacitor \( C \) between the output of the op-amp and the node connected to \( V_{REF} \).

6. **Power Supply**:
   - The op-amp is powered by a positive voltage supply \( +V_{CC} \).

7. **Output Voltage \( V_{OUT} \)**:
   - The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

The circuit appears to be a feedback control system, possibly for regulating the brightness of the lamp \( RL \) based on the reference voltage \( V_{REF} \). The capacitors and resistors in the feedback network suggest that the circuit may have filtering or timing characteristics, influencing the response of the op-amp to changes in the input signals.
```

Figure A–38. Wien Bridge Oscillator with Nonlinear Feedback

### **A.5.3 Wien Bridge Oscillator with AGC**

The op amp is configured as an ac amplifier to ease biasing problems. The gain equation for the op amp is given below. RG1 or RG2, but not both resistors, is required depending on the selection of the Q1.

The diode, D1, half-wave rectifies the output voltage and applies it to the voltage divider formed by R1 and R2. The voltage divider biases Q1 in its linear region, and they eventually set the output voltage. C1 filters the rectified sine wave with a long time constant so that the output voltage stays constant. C2 must be selected large enough to act as a short at the oscillation frequency.

As the output voltage increases, the negative voltage across the gate of Q1 increases. The increased negative gate voltage causes Q1 to increase its drain-to-source resistance. This results in increased op amp gain and an output voltage decrease. When the voltage divider and FET are selected properly, the output voltage swing is less than the guaranteed maximum swing, so distortion doesn't occur.

Here is the image describtion:
```
The image depicts an electronic circuit diagram featuring an operational amplifier (op-amp) in a feedback configuration. Here is a detailed description of the components and their connections:

1. **Operational Amplifier (Op-Amp)**:
   - The op-amp is shown with its inverting input (-) connected to a feedback network and its non-inverting input (+) connected to a reference voltage \( V_{REF} \).

2. **Feedback Network**:
   - The feedback network consists of a resistor \( R_F \) and a diode \( D_1 \) (1N4148) connected in series. The anode of the diode is connected to the output of the op-amp, and the cathode is connected to the resistor \( R_F \).
   - The other end of \( R_F \) is connected to the inverting input of the op-amp.

3. **Voltage Divider and Capacitors**:
   - A voltage divider is formed by resistors \( R_1 \) and \( R_2 \). The junction of \( R_1 \) and \( R_2 \) is connected to the base of a transistor \( Q_1 \) through a capacitor \( C_1 \).
   - The emitter of \( Q_1 \) is connected to ground, and the collector is connected to \( R_{G1} \) and \( R_{G2} \) in series. The junction of \( R_{G1} \) and \( R_{G2} \) is connected to the inverting input of the op-amp through a capacitor \( C_2 \).

4. **Transistor \( Q_1 \)**:
   - The transistor \( Q_1 \) is an NPN transistor with its base connected to the voltage divider, its emitter grounded, and its collector connected to the resistors \( R_{G1} \) and \( R_{G2} \).

5. **Capacitors and Resistors**:
   - There are additional capacitors \( C \) and resistors \( R \) connected in a specific configuration around the op-amp. These components form a network that influences the behavior of the circuit.

6. **Equation**:
   - The gain \( G \) of the circuit is given by the equation:
     \[
     G = \frac{R_F}{R_{G1} + R_{G2} \parallel R_{FET}}
     \]
     where \( R_{G2} \parallel R_{FET} \) denotes the parallel combination of \( R_{G2} \) and \( R_{FET} \).

7. **Power Supply**:
   - The op-amp is powered by a positive voltage supply \( +V_{CC} \).

8. **Output**:
   - The output voltage \( V_{OUT} \) is taken from the output terminal of the op-amp.

This circuit appears to be a complex feedback amplifier with a gain determined by the resistors and the transistor network. The diode \( D_1 \) and the capacitors \( C_1 \) and \( C_2 \) likely play roles in shaping the response and stability of the circuit.
```

Figure A–39. Wien Bridge Oscillator with AGC

### **A.5.4 Quadrature Oscillator**

Quadrature oscillators produce sine waves 90° out of phase, so they output sine/cosine, or quadrature waves.

When R1C1 = R2C2 = R3C3, the circuit oscillates at ω = 2πf = 1/RC. Both op amps act as integrators causing two poles at 1/RC, thus the circuit oscillates when the loop gain crosses the 0-dB axis. The integrators ensure that gain is always sufficient for oscillation. There is a slight bit of distortion at the sine output, and it is very hard to eliminate this distortion.

Here is the image describtion:
```
The image depicts a circuit diagram of a phase-shift oscillator using operational amplifiers (op-amps). The circuit is designed to generate sine and cosine wave outputs. Here is a detailed description of the components and their connections:

1. **Operational Amplifiers (Op-Amps)**:
   - There are two op-amps in the circuit, each represented by a triangle with the standard op-amp symbol. The non-inverting input (+) of each op-amp is connected to a voltage source, while the inverting input (-) is connected to other components in the circuit.

2. **Resistors**:
   - **R1**: Connected between the input voltage source (Vcc/2) and the inverting input of the first op-amp.
   - **R2**: Connected between the output of the first op-amp and the inverting input of the second op-amp.
   - **R3**: Connected between the input voltage source (Vcc/2) and the inverting input of the second op-amp.

3. **Capacitors**:
   - **C1**: Connected between the output of the first op-amp and the inverting input of the same op-amp.
   - **C2**: Connected between the inverting input of the second op-amp and ground.
   - **C3**: Connected between the output of the second op-amp and the inverting input of the same op-amp.

4. **Voltage Source**:
   - The circuit is powered by a voltage source labeled as +Vcc. Additionally, there is a reference voltage labeled as Vcc/2, which is used to bias the op-amps.

5. **Outputs**:
   - **Vout(SINE)**: The output of the first op-amp, which provides a sine wave signal.
   - **Vout(COSINE)**: The output of the second op-amp, which provides a cosine wave signal.

6. **Ground Connections**:
   - The non-inverting inputs of both op-amps are connected to ground, providing a reference point for the circuit.

The circuit works by using the phase shift introduced by the capacitors and resistors to generate oscillations. The first op-amp generates a sine wave, and the second op-amp, which is connected in a similar configuration, generates a cosine wave. The phase shift between the two outputs is 90 degrees, which is characteristic of sine and cosine functions.
```

Figure A–40. Quadrature Oscillator

### **A.5.5 Classical Phase Shift Oscillator**

Theoretically, the three RC sections do not load each other, thus the loop gain has three identical poles multiplied by the op amp gain.

The loop phase shift is –180° when the phase shift of each section is –60°, and this occurs when ω = 2πf = 1.732/RC because the tangent of 60° = 1.73. The magnitude of β at this point is (1/2)3, so the gain, A = RF/RG, must be greater or equal to 8 for the system gain to be equal to 1.

The assumption that the RC sections do not load each other is not entirely valid, thus the circuit does not oscillate at the specified frequency, and the gain required for oscillation is more than 8. This circuit configuration was very popular when an active component was large and expensive, but now that op amps are inexpensive, small, and come quad packages, the classical phase shift oscillator is losing popularity.

The classical phase shift oscillator has an undistorted sine wave available at the output of the third RC section. This is not a low-impedance output, and the signal amplitude is smallest here, but these sacrifices have to be made to get away from distortion. An undistorted output can be obtained from the op amp if an AGC circuit similar to the one shown in Figure A–39 is employed. The reference voltage is set according to the equation VREF = VCC/ 2(1+RF/RG) to center the output voltage at VCC/2.

Here is the image describtion:
```
The image depicts a circuit diagram of a Wien bridge oscillator. The circuit includes an operational amplifier (op-amp) with feedback components and a series of resistors and capacitors forming a frequency-selective network.

1. **Operational Amplifier (Op-Amp):**
   - The op-amp is shown with its inverting input connected to ground and its non-inverting input connected to a voltage source labeled \( V_{CC} \) divided by 18.
   - The op-amp has a feedback resistor \( R_F \) connected between its output and its non-inverting input.
   - The non-inverting input also has a resistor \( R_G \) connected to the voltage source \( V_{CC} \).

2. **Feedback Network:**
   - The output of the op-amp is connected to a series of three resistors labeled \( R \).
   - Each resistor \( R \) is connected in series with a capacitor \( C \) to ground, forming three RC networks in series.
   - The output of the last RC network is labeled \( V_{OUT} \).

3. **Transfer Function:**
   - The transfer function of the feedback network is given by \( A\beta = \left( \frac{1}{RCs + 1} \right)^3 \), where \( s \) is the complex frequency variable in Laplace transform.

4. **Power Supply:**
   - The op-amp is powered by a positive voltage source labeled \( +V_{CC} \).

The circuit is designed to produce a stable oscillation at a frequency determined by the values of the resistors \( R \) and capacitors \( C \). The transfer function indicates that the feedback network has a frequency-dependent response, which is crucial for the oscillator's operation.
```

Figure A–41. Classical Phase Shift Oscillator

#### **A.5.6 Buffered Phase Shift Oscillator**

A noninverting op amp buffers each RC section in this oscillator. Equation A–46, repeated below, truly represents the transfer function of this circuit if RG >> R.

$$\mathsf{A}\clubsuit\ = \left(\frac{\mathsf{T}}{\mathsf{R}\mathsf{C}\mathsf{s}+\mathsf{T}}\right)^{3}\tag{4-47}$$

The loop phase shift is –180° when the phase shift of each section is –60°, and this occurs when ω = 2πf = 1.732/RC because the tangent 60° = 1.73. The magnitude of β at this point is (1/2)3, so the gain, A = RF/RG, must be greater or equal to 8 for the system gain to be equal to one.

The buffered phase shift oscillator has an undistorted sine wave available at the output of the third RC section. This is not a low-impedance output, and the signal amplitude is smallest here, but these sacrifices have to be made to get away from distortion. An undistorted output can be obtained from the op amp if an AGC circuit similar to the one shown in Figure A–39 is employed.

There are three op amps, so the gain can be distributed among the op amps at the expense of a few resistors, and the distortion is reduced. Another method of reducing distortion is to limit the output voltage swing softly with external components. The limiting technique does not yield as good results as the AGC technique does, but it is less expensive. The reference voltage is set according to the equation VREF = VCC/ 2(1+RF/RG) to center the output voltage at VCC/2.

Here is the image describtion:
```
The image depicts a multi-stage active filter circuit. Here is a detailed description of the components and their configuration:

1. **Operational Amplifiers (Op-Amps)**: There are four operational amplifiers in the circuit, each powered by a positive voltage supply denoted as +Vcc. The op-amps are configured in different stages to achieve the desired filtering effect.

2. **Resistors and Capacitors**: The circuit includes several resistors and capacitors:
   - **Resistors**: Denoted as \( R_G \), \( R_F \), and \( R \). \( R_G \) and \( R_F \) are part of the first op-amp stage, while \( R \) is used in the subsequent stages.
   - **Capacitors**: Denoted as \( C \). Each capacitor is connected to ground and is part of the RC (resistor-capacitor) network in each stage.

3. **Voltage Divider**: The input voltage is divided by 18 using a resistor network before being fed into the non-inverting input of the first op-amp.

4. **First Stage (Op-Amp Configuration)**:
   - The first op-amp is configured with a feedback resistor \( R_F \) and a gain resistor \( R_G \). The non-inverting input receives the divided input voltage \( \frac{V_{cc}}{18} \).
   - This stage likely serves as a buffer or amplifier.

5. **Subsequent Stages (RC Filter Stages)**:
   - After the first op-amp, the signal passes through a series of RC networks and op-amps.
   - Each stage consists of a resistor \( R \) in series with the signal path and a capacitor \( C \) connected to ground.
   - The op-amps in these stages are likely configured as voltage followers (buffers) to prevent loading effects and maintain signal integrity.

6. **Output**: The final output voltage \( V_{OUT} \) is taken after the last RC network and op-amp stage.

The overall configuration suggests that this circuit is designed to filter the input signal through multiple stages, possibly implementing a higher-order filter to achieve a specific frequency response. The use of multiple op-amps and RC networks indicates a complex filter design, potentially for applications requiring precise signal conditioning.
```

Figure A–42. Buffered Phase Shift Oscillator

#### **A.5.7 Bubba Oscillator**

The Bubba oscillator is another phase shift oscillator, but it takes advantage of the quad op amp package to yield some unique advantages. Each RC section is buffered by an op amp to prevent loading. When RG >> R there is no loading in the circuit, and the circuit yields theoretical performance.

Four RC sections require –45° phase shift per section to accumulate –180° phase shift. Each RC section contributes –45° phase shift when ω = 1/RC. The gain required for oscillation is G ≥ (1/0.707)4 = 4. Taking outputs from alternate sections yields low-impedance quadrature outputs. When an output is taken from each op amp, the circuit delivers four 45° phase-shifted sine waves.

The gain, A, must equal 4 for oscillation to occur. Very low distortion sine waves can be obtained from the junction of R and RG. When low-distortion sine waves are required at all outputs, the gain should be distributed among the op amps. Gain distribution requires biasing of the other op amps, but it has no effect on the oscillator frequency. This oscillator has the best dφ/df of the phase shift oscillators, so it has minimum frequency drift. The reference voltage is set according to the equation VREF = VCC/ 2(1+RF/RG) to center the output voltage at VCC/2.

Here is the image describtion:
```
The image depicts a circuit diagram of a phase-shift oscillator using operational amplifiers (op-amps). The circuit consists of four op-amps, resistors, and capacitors arranged to create a feedback loop that generates oscillations.

1. **Op-Amps**: There are four op-amps in the circuit, each powered by a positive voltage supply labeled +Vcc. The op-amps are configured in a way that they amplify and shift the phase of the signal.

2. **Resistors and Capacitors**: The circuit includes several resistors (R) and capacitors (C) connected in series and parallel configurations. These components form RC networks that determine the frequency of oscillation.

3. **Feedback Network**: The first op-amp has a feedback network consisting of a resistor RF and a resistor RG. The feedback network is crucial for setting the gain and ensuring the circuit oscillates.

4. **Voltage Supply**: The first op-amp has a voltage supply labeled Vcc/10, indicating it receives a fraction of the main supply voltage.

5. **Output**: The output of the circuit is labeled VOUT, which is the point where the oscillating signal is obtained.

6. **Equation**: The top left corner of the image shows an equation for the loop gain (Aβ) of the oscillator:
   \[
   Aβ = \left( \frac{1}{RCs + 1} \right)^4
   \]
   This equation indicates the relationship between the resistors, capacitors, and the frequency of oscillation.

7. **Connections**: The resistors and capacitors are connected in a manner that each op-amp stage shifts the phase of the signal by 45 degrees, resulting in a total phase shift of 180 degrees after four stages, which is necessary for sustained oscillations.

Overall, the image illustrates a phase-shift oscillator circuit designed to generate a stable oscillating signal using op-amps, resistors, and capacitors.
```

Figure A–43. Bubba Oscillator

#### **A.5.8 Triangle Oscillator**

The triangle oscillator produces triangle waves and square waves. The op amp functions as an integrator. When the output voltage of the comparator is low, the output of the op amp charges C until the output voltage exceeds the hysteresis voltage set by R1 and RF and the reference voltage (VCC/2). At this point, the comparator output switches to a high state and the op amp integrates the voltage in a negative direction. The triangle wave (op amp output voltage swing) is given in Equation A–49. The frequency of oscillation is given in Equation A–50.

$$\mathbb{V}\_{\text{OUT}} = \frac{\mathbb{V}\_{\text{CC}}}{2} \pm \frac{\mathbb{V}\_{\text{CC}} \mathbb{R}\_1}{2 \mathbb{R}\_{\text{F}}} \tag{4-49}$$

$$\mathbf{f} = \frac{\mathbf{R\_{\tilde{F}}}}{\mathbf{4C\mathbf{R}\mathbf{R\_{1}}}} \tag{4-50}$$

The op amp reference voltage can be adjusted to equalize the triangle rise and fall times.

Here is the image describtion:
```
The image depicts a schematic diagram of an electronic circuit involving operational amplifiers (op-amps). Here is a detailed description of the components and their connections:

1. **Operational Amplifiers (Op-Amps)**:
   - There are two op-amps in the circuit, each represented by a triangle with the pointed end indicating the output and the flat end indicating the inputs.
   - The positive power supply (+Vcc) is connected to the top of each op-amp, and the ground is connected to the bottom.

2. **Voltage Divider**:
   - Both op-amps have their non-inverting inputs (+) connected to a voltage divider that provides a reference voltage of \( \frac{V_{cc}}{2} \).

3. **First Op-Amp Configuration**:
   - The first op-amp is configured as a non-inverting amplifier.
   - The non-inverting input (+) is connected to \( \frac{V_{cc}}{2} \).
   - The inverting input (-) is connected to the output through a feedback resistor \( R_F \) and to the ground through another resistor.
   - The output of the first op-amp is connected to a resistor \( R \).

4. **Second Op-Amp Configuration**:
   - The second op-amp is configured as an integrator.
   - The non-inverting input (+) is connected to \( \frac{V_{cc}}{2} \).
   - The inverting input (-) is connected to the junction of resistor \( R \) and resistor \( R_1 \).
   - A capacitor \( C \) is connected between the output and the inverting input (-) of the second op-amp.

5. **Output**:
   - The output of the second op-amp is labeled as \( V_{OUT} \).

6. **Resistors and Capacitor**:
   - \( R_F \): Feedback resistor for the first op-amp.
   - \( R \): Resistor connecting the output of the first op-amp to the inverting input of the second op-amp.
   - \( R_1 \): Resistor connected to the inverting input of the second op-amp.
   - \( C \): Capacitor connected in the feedback loop of the second op-amp.

The circuit appears to be a combination of a non-inverting amplifier followed by an integrator, which could be used for various signal processing applications such as filtering or waveform generation.
```

Figure A–44. Triangle Oscillator

#### **Appendix A Appendix B**

# **Single-Supply Op Amp Selection Guide**

This appendix contains a selection guide for single-supply op amps and abstracts from the data sheets for the TLC080, TLV2401, TLV2470, and TLV2760 single-supply op amps.

| DEVICE<br>FAMILY†                      | AMPS<br>in                             | VDD<br>(V) |     | IDD<br>(µA/Ch) |      | VIO<br>(µV) |      | IIB<br>(pA) | GBW<br>(MHz) | SR<br>(V/µs) | CMRR<br>(dB) | Vn,<br>1kHz<br>(nV/√Hz) |
|----------------------------------------|----------------------------------------|------------|-----|----------------|------|-------------|------|-------------|--------------|--------------|--------------|-------------------------|
|                                        | PKG‡                                   | min        | max | typ            | max  | typ         | max  | typ         | typ          | typ          | typ          | typ                     |
| VDD (min) ≥ 1.8 V<br>VDD (min) ≥ 1.8 V |                                        |            |     |                |      |             |      |             |              |              |              |                         |
| TLV278x(A)                             | S/D/Q                                  | 1.8        | 3.6 | 650            | 770  | 250         | 3000 | 2.5         | 8            | 2.8          | 100          | 18                      |
| TLV276x                                | S*/D/Q*                                | 1.8        | 3.6 | 20             | 28   | 550         | 3500 | 3           | 0.5          | 0.2          | 70           | 95                      |
|                                        | VDD (min) ≥ 2.5 V<br>VDD (min) ≥ 2.5 V |            |     |                |      |             |      |             |              |              |              |                         |
| TLV277x(A)                             | S/D/Q                                  | 2.5        | 5.5 | 1000           | 2000 | 360         | 2500 | 2           | 5.1          | 10.5         | 96           | 17                      |
| TLV411x                                | S*/D                                   | 2.5        | 6   | 400            | 600  | 175         | 3500 | 0.3         | 2            | 1.57         | 63           | 26                      |
| TLV240x                                | S/D/Q                                  | 2.5        | 16  | 0.88           | 0.95 | 390         | 1200 | 100         | 0.0055       | 0.0025       | 120          | n/a                     |
| TLV224x                                | S/D/Q                                  | 2.5        | 12  | 1              | 1.2  | 600         | 3000 | 100         | 0.0055       | 0.002        | 100          | n/a                     |
| TLV246x(A)                             | S/D/Q                                  | 2.7        | 6   | 500            | 575  | 150         | 2000 | 1300        | 5.2          | 1.6          | 80           | 11                      |
| TLV247x(A)                             | S/D/Q                                  | 2.7        | 6   | 550            | 750  | 250         | 2200 | 2           | 2.8          | 1.4          | 78           | 15                      |
| TLV2231                                | S                                      | 2.7        | 10  | 750            | 1200 | 750         | 3000 | 1           | 1.9          | 1.25         | 70           | 16                      |
| TLV2731                                | S                                      | 2.7        | 10  | 750            | 1200 | 750         | 3000 | 1           | 1.9          | 1.25         | 70           | 16                      |
| TLV244x(A)                             | D/Q                                    | 2.7        | 10  | 725            | 1100 | 300         | 2000 | 1           | 1.75         | 1.3          | 75           | 18                      |
| LMV321#                                | S/D/Q                                  | 2.7        | 5.5 | 130            | 250  | 1700        | 7000 | 11000       | 1            | 1            | 65           | 39                      |
| TLV226x(A)                             | D/Q                                    | 2.7        | 8   | 200            | 250  | 300         | 2500 | 1           | 0.67         | 0.55         | 75           | 12                      |
| TLV243x(A)                             | D/Q                                    | 2.7        | 10  | 98             | 125  | 300         | 2000 | 1           | 0.5          | 0.25         | 83           | 22                      |
| TLV2221                                | S                                      | 2.7        | 10  | 100            | 150  | 610         | 3000 | 1           | 0.48         | 0.18         | 82           | 20                      |
| TLV2721                                | S                                      | 2.7        | 10  | 100            | 150  | 610         | 3000 | 1           | 0.48         | 0.18         | 82           | 20                      |
| TLV245x(A)                             | S/D/Q                                  | 2.7        | 6   | 23             | 35   | 20          | 1500 | 900         | 0.2          | 0.11         | 86           | 49                      |
| TLV225x(A)                             | D/Q                                    | 2.7        | 8   | 34             | 62   | 200         | 1500 | 1           | 0.187        | 0.1          | 75           | 19                      |
| TLV2211                                | S                                      | 2.7        | 10  | 11             | 25   | 470         | 3000 | 1           | 0.056        | 0.025        | 83           | 22                      |
| TLV2711                                | S                                      | 2.7        | 10  | 11             | 25   | 470         | 3000 | 1           | 0.056        | 0.025        | 83           | 22                      |
| TLV2422(A)                             | D                                      | 2.7        | 10  | 50             | 75   | 300         | 2000 | 0.5         | 0.046        | 0.02         | 83           | 23                      |
|                                        | VDD (min) ≥ 3.8 V                      |            |     |                |      |             |      |             |              |              |              | VDD (min) ≥ 3.8 V       |
| TLC2652(A)                             | S                                      | 3.8        | 16  | 1500           | 2400 | 0.6         | 3    | 4           | 1.9          | 2.8          | 140          | 23                      |
| TLC2654(A)                             | S                                      | 3.8        | 16  | 1500           | 2400 | 5           | 20   | 50          | 1.9          | 2            | 125          | 13                      |
| TLC450x(A)                             | S/D                                    | 4          | 6   | 1000           | 1500 | –           | 80   | 1           | 4.7          | 2.5          | 100          | 12                      |
| TLC227x(A)                             | D/Q                                    | 4.4        | 16  | 1100           | 1500 | 300         | 2500 | 1           | 2.18         | 3.6          | 75           | 9                       |
| TLC226x(A)                             | D/Q                                    | 4.4        | 16  | 200            | 250  | 300         | 2500 | 1           | 0.82         | 0.55         | 83           | 12                      |
| TLC225x(A)                             | D/Q                                    | 4.4        | 16  | 40             | 62   | 200         | 1500 | 1           | 0.21         | 0.12         | 88           | 19                      |
| TLC07x(A)                              | S/D/Q                                  | 4.5        | 16  | 1900           | 2500 | 60          | 1000 | 1.5         | 10           | 16           | 140          | 7                       |
| TLC08x(A)                              | S/D/Q                                  | 4.5        | 16  | 1800           | 2500 | 60          | 1000 | 3           | 10           | 16           | 140          | 8.5                     |
| TLC220x(A)                             | S/D                                    | 4.6        | 16  | 1000           | 1500 | 80          | 500  | 1           | 1.9          | 2.5          | 110          | 8                       |

Table B–1. Single-Supply Operational Amplifier Selection Guide

**Note:** Single-supply op amp selection guide parameters specified at TA = 25°C, VDD = 5 V, 2.7 V, and/or 1.8 V.

\* Devices in Product Preview stage of development at press time. Please contact TI or visit www.ti.com for current status.

† (A) refers to precision grades with lower VIO and are part of the device number, e.g. TLV2470A.

‡ S = single-channel amplifier, D = dual-channel amplifier, Q = quad-channel amplifier (in the device name, replace x with 1, 2, or 4 for S, D, or Q respectively).

§ Variants of family with shutdown (in the device name, replace x with 0, 3, or 5 for single, dual, or quad amplifiers with shutdown). ¶ Measured at VO = 0.5 V from rails, except TLC07x and TLC08x where VO = 0.5 V from negative rail. # Includes LMV358 and LMV324 devices.

| IO¶<br>(mA)<br>typ | SHUT<br>DOWN<br>§ | RAIL<br>to<br>RAIL | FEATURES          |  |  |  |
|--------------------|-------------------|--------------------|-------------------|--|--|--|
|                    |                   | VDD (min) ≥ 1.8 V  |                   |  |  |  |
| 10                 | Y                 | I/O                | WBW, LV           |  |  |  |
| 4.8                | Y                 | I/O                | µP, LV            |  |  |  |
|                    |                   | VDD (min) ≥ 2.5 V  |                   |  |  |  |
| 6                  | Y                 | O                  | VHSR, HD          |  |  |  |
| 220                | Y                 | O                  | VHD, SD           |  |  |  |
| 0.2                |                   | I/O                | nP, LV            |  |  |  |
| 0.2                |                   | I/O                | µP, LV            |  |  |  |
| 30                 | Y                 | I/O                | WBW, LN, VHD      |  |  |  |
| 22                 | Y                 | I/O                | WBW, LN, HD, LIBC |  |  |  |
| 2.5                |                   | O                  | WBW, LN           |  |  |  |
| 2.5                |                   | O                  | WBW               |  |  |  |
| 2.5                |                   | O                  | LV, 600Ω          |  |  |  |
| –                  |                   | O                  | SS                |  |  |  |
| 1.1                |                   | O                  | LP, LN            |  |  |  |
| 2.5                |                   | O                  | LP                |  |  |  |
| 1.8                |                   | O                  | LP, SOT           |  |  |  |
| 1.8                |                   | O                  | LP, SOT           |  |  |  |
| 4                  | Y                 | I/O                | µP, R-R I/O       |  |  |  |
| 0.25               |                   | O                  | µP, R-R O         |  |  |  |
| 0.38               |                   | O                  | µP, WVSR          |  |  |  |
| 0.38               |                   | O                  | µP, WVSR          |  |  |  |
| 2.5                |                   | O                  | LP, 600Ω          |  |  |  |
|                    |                   | VDD (min) ≥ 3.8 V  |                   |  |  |  |
| 1.4                |                   | O                  | PC                |  |  |  |
| 1.4                |                   | O                  | PC, LN            |  |  |  |
| 22                 |                   | O                  | WBW, P, LN, HD    |  |  |  |
| 2                  |                   | O                  | WBW, LN           |  |  |  |
| 1.3                |                   | O                  | LP, LN            |  |  |  |
| 0.3                |                   | O                  | µP                |  |  |  |
| 55                 | Y                 |                    | WBW, FSR, LN      |  |  |  |
| 55                 | Y                 |                    | WBW, FSR          |  |  |  |
| 1                  |                   | O                  | P, LN             |  |  |  |

Table B–1. Single-Supply Operational Amplifier Selection Guide (Continued)

#### **Single-Supply Operational Amplifier Selection Guide Features Key:**

| FSR  | fast slew rate         | nP  | nanopower           |
|------|------------------------|-----|---------------------|
| HD   | high drive             | P   | precision           |
| LIBC | low input bias current | PC  | precision (chopper) |
| LN   | low noise              | SOT | SOT–23 package      |
| LP   | low power              | SS  | second sourced      |
| µP   | micropower             | WBW | wide bandwith       |

# **A**

AC loads, DAC, 14-2 AC parameters, DAC, 14-14 to 14-18 ACG, See Automatic gain control Active filter, design techniques, 16-1 to 16-61 Actuator, analog interface to DAC, 18-16 to 18-21 Actuator interface from DAC current sink circuit, 18-19 from DAC current source circuit, 18-17 ADC analog interface from transducer, 18-13 to 18-14 characterization, 12-15 external ref circuits, 13-15 to 13-18 external voltage reference circuit, 13-17 input voltage, 12-15 selection, 13-6 to 13-10 single-ended input drive circuit, 13-20 ADC interface, from transducer circuit, 18-15, 18-16 Adder, 3-5 circuit, 3-5 Adjustable low-pass filter, circuit, 16-17 AIA circuit, 12-17 All-pass filter design, 16-41 to 16-47 first order, 16-44 first-order circuit, 16-44 high order, 16-45 to 16-47 second order, 16-44 to 16-46 second-order circuit, 16-44 seventh-order circuit, 16-46 Amplifier photodiode, 12-8 phototransistor, 12-9 transistor, 2-10 to 2-13 photovoltaic cell, 12-9 Analog input drive circuits, high-speed, 13-18 to 13-22 Analog interface circuit, 12-21 Analog plane placement, 17-8 Antenna, loop and slot PCB layout, 17-15 Anti-aliasing filter, 13-11 to 13-13 Automatic gain control, Wien bridge oscillator circuit, 15-13 Avalanche noise, 10-9 to 10-11

# **B**

Band-pass filter Butterworth gain response graph, 16-36 design, 16-27 to 16-37 gain response graph, 16-29 low-pass filter transition, 16-28, 16-37 Sallen-Key circuit, 16-30 second order, 16-29 to 16-39 Band-rejection filter, comparison graph active/passive, 16-41 Band-rejection filter active twin-T filter, 16-37 to 16-40 active Wien-Robinson filter, 16-39 to 16-42 design, 16-36 to 16-42 Bandwidth current feedback amp, 9-3 to 9-7 current feedback amp graph, 8-10 voltage feedback amp, 9-3 to 9-7 Bessel high-pass filter, circuit, 16-27 Bessel low-pass filter, 16-7 to 16-10 Bias circuit, 12-13 Binary bits, versus significant bits, 12-2 Black, Harry, Bell Labs, 1-1 Block diagram CDMA cellular base station, 13-5 cellular base station receiver, 13-2 dual IF receiver, 13-4 feedback system, 6-2 GSM cellular base station, 13-2 loop gain, 6-4 oscillator with positive feedback, 15-8 Block diagram math, 5-1 to 5-6 control system terms, 5-3 definition, 5-2 feedback circuit, 5-3 multiloop feedback system, 5-4 summary points, 5-3 transforms, 5-5 Blocks, block diagram math, 5-2 Bode analysis, feedback, 5-7 to 5-13 Bode plot compensated attenuator, 7-18 current feedback amp, 8-7 dominant-pole compensation circuit, 7-11 feedback capacitance, 8-13 lead compensation, 7-14 lead-lag compensation, 7-19 Bode, H. W, 1-2

Broadcasting, from PCB traces, 17-9 Bridge, wheatstone, 12-8 Broadband noise, 11-18 Brown noise, 10-12 Bubba oscillator, 15-17 to 15-19 circuit, 15-17 Burst noise, 10-9 to 10-11 Butterworth band-pass filter, gain response graph, 16-36 Butterworth low-pass filter, 16-6 amplitude response graph, 16-6 circuit with unity gain, 16-21 graph, 16-51 Tschebyscheff-type characteristic, 16-51

# **C**

Cable amplifier, 3-9 Canonical equations, 6-2 to 6-5 Canonical feedback, 15-2 Capacitance effect on inverting op amp, 17-18 trace to plane, 17-17 Capacitively-loaded loop-gain calculation circuit, 7-9 op amp circuit, 7-9 Capacitor, 3-9 to 3-11 high-frequency circuit, 17-12 self resonance, 17-22 Cascading filter stages, 16-12 CDMA cellular base station, transmitter block diagram, 13-5 Cellular base station receiver, block diagram, 13-2 CFA. See current feedback amplifier Characterization, transducer, 12-13 to 12-16 Circuit active full-wave rectifier and filter, 12-10 active Wien-Robinson filter circuit, 16-39 ADC singled-ended input drive, 13-20 adder, 3-5 AIA, 12-17 analog interface, 12-21 analysis done the hard way, 2-7 automatic gain control, 15-13 band reject filter, 5-9 Bessel high-pass filter, 16-27 bubba oscillator, 15-17

Butterworth low-pass filter circuit with unity gain, 16-21 canonical feedback, 5-6 capacitively-loaded op amp, 7-9 compensated attenuator, 7-17 complex feedback networks, 3-7 control canonical feedback, 5-6 current divider rule, 2-4 current feedback amplifier, 8-2 DAC current booster, 14-20 DAC current sink to actuator interface, 18-19 DAC current source to actuator interface, 18-17 DAC deglitch, 14-17 DAC voltage booster, 14-21, 14-22 differential amplifier, 3-6, 3-7 differential op amp, 6-8 dual-supply filter, 16-47 electronic canonical feedback, 5-6 feedback, 5-6 feedback loop broken, 6-7 first-order all-pass filter, 16-44 first-order high-pass filter, 16-23 first-order inverting high-pass filter, 16-23 first-order inverting low-pass filter, 16-13 first-order low-pass filter, 16-12 first-order noninverting low-pass filter, 16-14 first-order passive RC low pass filter, 16-2 fourth-order passive RC low pass filter, 16-3 high-frequency capacitor, 17-12 high-frequency inductor, 17-13 high-pass filter, 3-10 high-performance resistor, 17-11 high-speed analog input drive, 13-18 to 13-22 ideal current feedback amp, 9-3 ideal op amp, 3-2 input current, 11-10 input for an RRI op amp, 18-8 input for nonRRI op amp, 18-8 input offset voltage, 11-9 input offset voltage adjustment, 11-9 input parasitic elements, 11-13 inverting, 6-6, 6-7 inverting current feedback amp, 8-5 inverting op amp, 3-4 Kirchoff's current law, 2-3 Kirchoff's voltage law, 2-2 lead-lag compensation, 7-19 logic gate output, 17-21 long-tailed pair, 9-2 loop gain calculation, 7-9

low pass filter, 16-1 low-pass filter, 3-10, 5-8 low-pass filter circuit with unity gain, 16-19 maximum output voltage swing, 11-12 MFB band-pass filter, 16-31 MFB high-pass filter biasing, 16-50 MFB low-pass filter biasing, 16-49 Miller effect compensation, 7-2 noninverting current feedback amp, 8-4 noninverting op amp, 3-3, 18-7 nonlinear feedback, 15-12 Ohm's law, 2-2 op amp design, 12-16 to 12-23 op amp terminal model, 17-5 op amp with negative feedback, 15-8 op amp with positive feedback, 15-8 original amplifier, 2-5 passive twin-T filter, 16-37 passive Wien-Robinson bridge circuit, 16-39 phase shift oscillator, 15-14 phase shift oscillator, buffered, 15-16 photodiode amplifier, 12-8 phototransistor amplifier, 12-9 photovoltaic cell amplifier, 12-9 quadrature oscillator, 15-19 reference bias, 12-13 RRO output stage, 18-11 Sallen-Key band-pass filter, 16-30 Sallen-Key high-pass filter, 16-24 Sallen-Key high-pass filter biasing, 16-50 Sallen-Key low-pass filter, 16-15 Sallen-Key low-pass filter biasing, 16-48 Sallen-Key low-pass filter circuit, 16-20 saturated transistor, 2-9 second-order all-pass filter, 16-44 second-order low-pass filter, 16-17 second-order MFB high-pass filter, 16-25 second-order MFB low-pass filter, 16-18 second-order Tschebyscheff low-pass filter, 16-16 seventh-order all-pass filter, 16-46 simplified op amp, 11-17 simultaneous equation , 4-12, 4-15, 4-17, 4-20 single supply, 4-1, 4-3 common-mode voltage, 4-2 reference voltage input, 4-2 single supply inverting op amp, 4-4, 4-5 single supply noninverting, 4-7 single-ended to diff output, 13-18 single-pole reconstruction filter, 13-15 single-supply DAC, 14-23

single-supply filter, 16-47 slew rate, 11-16 split-supply op amp, 10-19 stability analysis, 8-2, 8-3 stray capacitance on inverting input, 7-16 superposition example, 2-8 T network, 3-8 Thevenim equivalent of the base circuit, 2-11 Thevenim's equivalent, 2-5, 2-6 TLC2201, 10-21, 10-23 traducer bias, 12-13 transducer to ADC interface, 18-15, 18-16 transistor, 2-10 video amplifier, 3-9 voltage divider rule, 2-3 voltage feedback amp, 9-2 voltage reference filter, 13-16 Wein bridge oscillator, 15-12 Wein bridge oscillator with AGC, 15-13 wheatstone bridge, 12-8 Wien bridge oscillator, 15-9, 15-11 Wien-Robinson bridge circuit, 16-39 Wien-Robinson circuit, 16-39 Circuit board layout, 17-1 to 17-30 component of op amp design, 17-1 noise sources, 17-2 prototype, 17-1 to 17-3 Circuit Theory, op amps, 2-1 to 2-13 Closed loop response, diff amp graph, 13-19 Colors, noise, 10-10 to 10-13 Common-mode range, op amp, 18-6 to 18-10 Common-mode rejection ratio, 11-15 Compensated attenuator, 7-16 to 7-19 circuit, 7-17 Compensation comparison of schemes, 7-20 to 7-22 DAC, 14-18 to 14-20 dominant pole graph, 7-11 dominant-pole, 7-9 to 7-13 external, 7-8 feedback capacitance, 8-13 to 8-15 gain, 7-12 to 7-14 gain capacitance, 8-13 graph, 7-12, 7-13 internal op amp, 7-2 to 7-9 inverting op amp, 7-15 lead, 7-13 to 7-17 lead-lag, 7-18 to 7-21 Miller effect, 7-2 to 7-4

Miller effect circuit, 7-2 noninverting op amp, 7-16 Complex feedback network, 3-7 to 3-9 Thevenin's theorem, 3-7 to 3-9 Control system terms, block diagram math, 5-3 Corner frequency, 10-13 to 10-15 Current booster circuit for DAC, 14-20 op amps, 14-20 Current divider rule, 2-4 Current drain, op amp, 18-12 to 18-14 Current feedback amplifier analysis, 8-1 to 8-15 bandwidth, 9-3 to 9-7 bandwidth graph, 8-10 Bode plot, 8-7 circuit, 8-2 compensation, 8-13 to 8-15 equation comparison, 9-8 to 9-10 feedback capacitance, 8-12 to 8-14 feedback capacitance Bode plot, 8-13 feedback capacitance compensation, 8-13 to 8-15 feedback resistor graph, 8-10 feedback resistor selection, 8-9 to 8-12 frequency graph, 9-5 gain capacitance compensation, 8-13 to 8-15 gain graph, 8-10, 9-5 ideal circuit, 9-3 impedance, 9-7 to 9-9 input capacitance, 8-11 to 8-13 inverting, 8-5 to 8-7 inverting circuit, 8-5 model, 8-1 to 8-3 nonnverting, 8-3 to 8-6 noninverting circuit, 8-4 precision, 9-2 to 9-4 stability, 8-11 to 8-14, 9-6 to 9-8 stability analysis, 8-7 to 8-10 stability analysis circuit, 8-2, 8-3 stability equation, 8-2 to 8-4 stray capacitance graph, 8-12 voltage feedback amp comparison, 9-1 to 9-10 Current source, 12-7 Curve band reject filter, 5-10 bode plot of low-pass filter, 5-9 Bode plot, no poles, 5-11 Bode plot, with single pole, 5-11

damping ratio vs overshoot, 5-16 damping ratio vs phase margin, 5-16 loop gain plot, 5-13, 5-14 low-pass filter, 5-9 overshoot vs damping ratio, 5-16 phase margin vs damping ratio, 5-16 single supply inverting op amp, 4-5 single supply noninverting op amp, 4-7 transfer, 4-12, 4-15, 4-18, 4-21

# **D**

DAC AC application error budget, 14-8 AC errors, 14-14 to 14-18 AC loads, 14-2 AC parameters, 14-14 to 14-18 accuracy vs resolution, 14-7 actuator analog interface, 18-16 to 18-21 compensation, 14-18 to 14-20 current booster circuit, 14-20 DC application error budget, 14-7 DC errors, 14-10 to 14-14 DC loads, 14-1 to 14-3 DC offsets, 14-22 DC parameters, 14-10 to 14-14 deglitch circuit, 14-17 differential nonlinearity error, 14-12 differential nonlinearity error graph, 14-13 dynamic range, 14-9 to 14-11 ENOB, 14-14 error budget, 14-6 to 14-11 errors, 14-10 to 14-16 external ref circuits, 13-15 to 13-18 external voltage reference circuit, 13-17 gain error, 14-11 to 14-13 gain error graph, 14-12 integral nonlinearity error, 14-13 to 14-15 intermodulation distortion, 14-15 to 14-17 interpolation filter, 13-5 nonlinearity error, 14-12 to 14-15 offset error, 14-10 to 14-12 offset error graph, 14-11 parameters, 14-10 to 14-16 power booster, 14-22 power supply rejection ratio, 14-14 R/2R, 14-4 to 14-6 R/2R circuit, 14-5 R/R2 resistor array, 14-4 reconstruction filter, 13-5, 13-13 to 13-16

Index-4

resistor ladder, 14-2 to 14-4 resistor ladder circuit, 14-2 RF application budget, 14-10 selection, 13-6 to 13-10 settling time, 14-16 to 14-18 sigma-delta , 14-5 to 14-7 SINAD, 14-14 single-supply operation, 14-22 specifications, 14-2 to 14-6 spurious free dynamic range, 14-15 THD, 14-8 to 14-10, 14-14 types, 14-2 voltage booster circuit, 14-21, 14-22 weighted resistor, 14-3 to 14-5 weighted resistor circuit, 14-3 DAC current sink, actuator interface circuit, 18-19 DAC current source, actuator interface circuit, 18-17 Damping ratio, graph, 7-4 DC loads, DAC, 14-1 to 14-3 DC offsets, DAC, 14-22 to 14-24 DC parameters, DAC, 14-10 to 14-14 Deglitch circuit, DAC, 14-17 Design, op amp circuit, 12-16 to 12-23 Design hints, 16-47 to 16-55 Design procedure, 12-11 to 12-13 Differential amp, closed loop response, 13-19 Differential input voltage range, parameter, 11-11 Differential nonlinearity error, 14-12 to 14-14 graph, 14-13 Differential op amp, 3-6 to 3-8, 6-8 to 6-10 circuit, 3-6, 6-8 common-mode input signal circuit, 3-7 noise, 10-18 Differential output drive, from single-ended circuit, 13-18 Differential voltage amplification, parameter, 11-13 Digital plane placement, 17-8 Distortion, total harmonic, 11-18 to 11-20 Dominant-pole compensation, 7-9 to 7-13 graph, 7-11 Dominant-pole compensation circuit, bode plot, 7-11 Dual IF receiver, block diagram, 13-4 Dual supply op amp, vs single supply, 4-1 to 4-4 Dual-supply filter, circuit, 16-47 Dynamic range DAC, 14-9 to 14-11

low-voltage op amp designs, 18-3 to 18-6

# **E**

Effective number of bits, DAC, 14-14 Elapsed time graph for TL07x, 7-5 graph for TL08x, 7-6 ENOB, DAC, 14-14 Equivalent input noise, parameter, 11-17 to 11-19 Error sources, op amp, 18-4 External compensation, 7-8

# **F**

Fairchild Robert J. Wilder, 1-3 uA709, 1-3 Feedback, 5-6 to 5-8 Bode analysis, 5-7 to 5-13 Wien bridge oscillator circuit, 15-12 Feedback capacitance Bode plot, 8-13 compensation, 8-13 to 8-15 current feedback amp, 8-12 to 8-14 Feedback circuit, block diagram math, 5-3 Feedback loop, broken circuit, 6-7 Feedback network, complex, 3-7 to 3-9 Feedback resistor graph, 8-10 selection, 8-9 to 8-12 Feedback system, block diagram, 6-2 Filter anti-aliasing, 13-11 to 13-13 band reject circuit, 5-9 band reject curve, 5-10 capacitor selection, 16-50 to 16-53 cascading filter stages, 16-12 characteristics of reconstruction, 13-14 coefficients, 16-55 to 16-63 component values, 16-52 DAC recontracting, 13-13 to 13-16 description, 16-1 to 16-3 dual-supply circuit, 16-47 low pass fundamentals, 16-2 to 16-11 low-pass design, 16-11 to 16-21 op amp selection, 16-53 to 16-55 quality factor, 16-9 to 16-11

Index-5

single-pole reconstruction circuit, 13-15 single-supply circuit, 16-47 voltage reference circuit, 13-16 Filter circuit biasing, 16-47 to 16-51 First-order all-pass filter, 16-44 First-order low-pass filter, 16-12 to 16-15 Flicker noise, 10-8 to 10-10 Flux residue resistance, 17-20 Fourth-order band-pass filter, 16-32 to 16-37 Frequency corner, 10-13 to 10-15 current feedback amp graph, 9-5 graph for TL07x, 7-5 graph for TL08x, 7-6 graph for TLV277x, 7-7 voltage feedback amp graph, 9-4 Full-wave rectifier, 12-10

# **G**

Gain current feedback amp, 9-5 current feedback amp graph, 8-10 oscillator, 15-4 to 15-6 voltage feedback amp, 9-4 Gain capacitance, compensation, 8-13 to 8-15 Gain compensation, 7-12 to 7-14 graph, 7-12 Gain error DAC, 14-11 to 14-13 graph, 14-12 Gain error budget, 12-19 Gate output, circuit, 17-21 Gaussian distribution, noise graph, 10-2 Glossary, parameter, 11-2 to 11-10 Graph band-rejection filter, 16-41 Bassel low-pass filter, 16-8, 16-9 Bode plot for dominant-pole compensation, 7-11 Bode plot for lead compensation, 7-14 Butterworth band-pass filter gain response, 16-36 amplitude of Butterworth low-pass filter, 16-6 Butterworth low-pass filter, 16-51 comparison of active/passive band-rejection filter, 16-41 comparison of normalized group delay graph, 16-8

current feedback amp, 8-10 current feedback amp bandwidth, 8-10 current feedback amp frequency, 9-5 current feedback amp gain, 8-10, 9-5 DAC gain error, 14-12 DAC offset error, 14-11 damping ratio, 7-4 diff amp closed loop response, 13-19 differential nonlinearity error, 14-13 dominant-pole compensation, 7-11 elapsed time for TL07x, 7-5 elapsed time for TL08x, 7-6 feedback resistor, 8-10 filter response, 16-53 frequency for TL07x, 7-5 frequency for TL08x, 7-6 frequency for TLV277x, 7-7 frequency response for group delay, 16-43 frequency response of low-pass filter, 16-4 gain compensation, 7-12 gain of Tschebyscheff low-pass filter, 16-7 gain response band-pass filter, 16-29 group delay frequency response, 16-43 high-pass filter gain response, 16-22 input bias current changes, 18-9 input common-mode voltage, 18-9, 18-10 input noise spectrum, 11-18 input output voltage changes, 18-10 integral nonlinearity error, 14-13 intermodulation distortion, 14-16 lead compensation, 7-13 lead-lag compensation, 7-20 low pass to band pass transition, 16-28 maximum output voltage swing, 11-12 noise energy, 10-2 op amp bandwidth, 15-7 op amp frequency response, 15-6 open loop response, 16-53 oscillator output, 15-7 output spectrum, 11-19 output voltage for TL07x, 7-5 output voltage for TL08x, 7-6 percent overshoot, 7-4 phase margin, 7-4 phase margin for TLV277x, 7-7 phase response of phase response of low-pass filter, 16-4 phase shift, 11-21 phase shift for RC, 15-3 phase shift for TL03x, 7-3

phase shift for TL07x, 7-5 phase shift for TL08x, 7-6 power spectral density, 13-14 pulse response for TL03x, 7-3 pulse response for TLV277x, 7-7 settling time, 11-22, 14-17 spurious free dynamic range, 14-15 stray capacitance, 8-12 time response for TL07x, 7-5 time response for TL08x, 7-6 TL03x, 7-3 TL07x, 7-5 TL08x, 7-6 TLC2201 noise, 10-20 TLV2772 noise, 10-13 Tschebyscheff low-pass filter quality factor, 16-10 voltage amplification, 11-21 voltage amplification for TL03x, 7-3 voltage amplification for TL07x, 7-5 voltage amplification for TL08x, 7-6 voltage amplification for TLV277x, 7-7 voltage feedback amp frequency, 9-4 voltage feedback amp gain, 9-4 voltage follower frequency, 13-17 Wein bridge oscillator, 15-11 Grounds, 17-8 Group delay, frequency response graph, 16-43 GSM cellular base station, block diagram, 13-2 GSM receiver block system budget, 13-3

# **H**

High-frequency capacitor, circuit, 17-12 High-frequency inductor, circuit, 17-13 High-frequency resistor, circuit, 17-11 High-pass filter Bessel circuit, 16-27 circuit, 3-10 design, 16-21 to 16-27 first order, 16-23 to 16-25 from a low-pass filter, 16-21 gain response graph, 16-22 higher order, 16-26 to 16-28 inverting circuit, 16-23 MFB circuit, 16-25 noninverting circuit, 16-23 Sallen-Key circuit, 16-24 Sallen-Key circuit with unity gain, 16-24 second order, 16-24 to 16-27

High-speed analog input drive circuits, 13-18 to 13-22

# **I**

Ideal op amp assumptions, 3-1 characteristics, 3-2 circuit, 3-2 IF receiver, block diagram, 13-4 Impedance current feedback amp, 9-7 to 9-9 voltage feedback amp, 9-7 to 9-9 Inductive vias, 17-19 to 17-21 Inductor, high-frequency circuit, 17-13 Input capacitance, 11-14 current feedback amp, 8-11 to 8-13 Input common-mode range, op amp, 18-6 to 18-8 Input common-mode voltage range, parameter, 11-11 Input current, 11-10 circuit, 11-10 Input noise spectrum, graph, 11-18 Input offset voltage adjust circuit, 11-9 circuit, 11-9 parameter, 11-8 to 11-10 Input parasitic elements, 11-13 to 11-15 circuit, 11-13 input capacitance, 11-14 input resistance, 11-14 output impedance, 11-14 output impedance circuit, 11-14 Input resistance, 11-14 Instrumentation amaplifiers, 12-1 to 12-24 Integral nonlinearity error, DAC, 14-13 Intermodulation distortion, DAC, 14-15 to 14-17 Internal compensation, op amp, 7-2 to 7-9 Inverting current feedback amp, 8-5 to 8-7 current feedback amp circuit, 8-5 Inverting high-pass filter, circuit, 16-23 Inverting input, stray capacitance circuit, 7-16 Inverting low-pass filter, circuit, 16-13 Inverting op amp, 3-4 to 3-6, 6-6 to 6-8 capacitance effect, 17-18 circuit, 3-4, 6-6

feedback back loop broken circuit, 6-7 noise, 10-16 to 10-18 single supply, 4-3 to 4-6 single supply circuit, 4-4, 4-5 transfer curve, 4-5 with lead compensation, 7-15

# **K**

Kirchoff's voltage law, 2-2 to 2-4

Here is the image describtion:
```
The image is a simple, black square with a white capital letter "L" centered within it. The letter "L" is in a bold, sans-serif font, and it stands out starkly against the black background due to the high contrast between the white letter and the black square. The overall design is minimalistic and straightforward.
```

Large signal differential voltage amplification, 11-13 Law, Ohm's, 2-1 to 2-3 Lead compensation, 7-13 to 7-17 Bode plot, 7-14 graph, 7-13 inverting op amp, 7-15 noninverting op amp, 7-16 Lead-lag compensation, 7-18 to 7-21 Bode plot, 7-19 circuit, 7-19 closed-loop plot, 7-20 Loading capacitance, making an op amp unstable, 7-4 Logic gate output, circuit, 17-21 Long-tailed pair, circuit, 9-2 Loop antenna, PCB layout, 17-15 Loop gain, block diagram, 6-4 Loop gain plots, 5-12 to 5-16 curve, 5-13, 5-14 Low-pass filter adjustable circuit, 16-17 band-pass filter transition, 16-28 band-pass transition, 16-37 Bessel, 16-7 to 16-10 Butterworth, 16-6 Butterworth amplitude response graph, 16-6 Butterworth circuit with unity gain, 16-21 circuit, 5-8 comparison of gain responses graph, 16-9 comparison of normalized group delay graph, 16-8 comparison of phase responses graph, 16-8 design, 16-11 to 16-21 first-order, 16-12 to 16-15

fourth-order RC circuit, 16-3 frequency graph, 16-4 fundamentals, 16-2 to 16-11 high order, 16-19 to 16-22 inverting circuit, 16-13 MFB circuit, 16-18 noninverting circuit, 16-12 Noninverting with unity gain circuit, 16-14 phase response graph, 16-4 RC first-order circuit, 16-2 Sallen-Key circuit, 16-15 Sallen-Key circuit with unity gain, 16-15 Sallen-Key circuit with unity gain circuit, 16-20 second-order, 16-14 to 16-20 second-order active, 16-1 second-order passive, 16-1 to 16-3 to a high-pass filter, 16-21 Tschebyscheff, 16-7 Tschebyscheff gain response graph, 16-7 Tschebyscheff unity gain circuit, 16-16 Tschebyscheff quality factor graph, 16-10 unity gain circuit, 16-19 Low-pass filter circuit, 3-10

# **M**

Math, block diagram, 5-1 to 5-6 Maximum output voltage swing graph, 11-12 parameter, 11-12 MFB band-pass filter, circuit, 16-31 MFB high-pass filter biasing circuit, 16-50 circuit, 16-25 MFB low-pass filter biasing circuit, 16-49 circuit, 16-18 Miller effect compensation, 7-2 to 7-4 circuit, 7-2 Multiloop feedback system, block diagram math, 5-4 Multiple feedback, low-pass filter circuit, 16-18 Multiple feedback band-pass filter, 16-31 to 16-33 circuit, 16-31 Multiple feedback high-pass filter biasing circuit, 16-50 circuit, 16-25 Multiple feedback low-pass filter, 16-18 to 16-20 biasing circuit, 16-49

# **N**

Noise, 10-8 to 10-10 avalanche, 10-9 to 10-11 broadband, 11-18 burst, 10-9 characterization, 10-1 colors, 10-10 to 10-13 corner, 10-12 to 10-14 differential op amp, 10-18 equivalent input, 11-17 to 11-19 floor, 10-3 Gaussian distribution graph, 10-2 graph, 11-18 inverting op amp, 10-16 multiple sources, 10-3 noninverting op amp, 10-17 op amp, 10-1 to 10-24 op amp model, 10-14 to 10-16 pink, 10-11 red/brown, 10-12 rms vs P-P, 10-1 to 10-3 shot, 10-5 to 10-8 spot, 11-17 to 11-19 thermal, 10-7 to 10-9 total, 10-12 to 10-14 types, 10-4 to 10-11 units, 10-4 white, 10-11 Noise corner, 10-12 to 10-14 Noise floor, 10-3 Noise model, op amp, 10-14 to 10-16 Noise sources, PCBs, 17-2 Noninverting, current feedback amplifier, 8-3 to 8-6 Noninverting high-pass filter, circuit, 16-23 Noninverting low-pass filter circuit, 16-12 circuit with unity gain, 16-14 Noninverting op amp, 3-3 to 3-5, 4-6 to 4-8, 6-5 to 6-7 circuit, 3-3, 18-7 noise, 10-17 open-loop, schematic, 6-6 schematic, 6-5 single supply circuit, 4-7 transfer curve, 4-7 with lead compensation, 7-16

Nonlinear feedback, Wien bridge oscillator circuit, 15-12 Nonlinearity error, 14-12 to 14-15 Nonrail to rail op amp, input circuit, 18-8 Norton's theorem, 2-5

# **O**

Offset budget, 12-19 Offset error DAC, 14-10 to 14-12 graph, 14-11 Ohm's Law, 2-1 to 2-3 applied to a component, 2-2 applied to the total circuit, 2-2 Open-loop noninverting op amp, schematic, 6-6 Operational amplifier cable, 3-9 canonical equations, 6-2 to 6-5 capacitively-loaded circuit, 7-9 circuit design, 12-16 to 12-23 circuit theory, 2-1 to 2-13 comparison, 18-20 to 18-23 compensated attenuator, 7-16 to 7-19 current booster, 14-20 current drain, 18-12 to 18-14 current feedback analysis, 8-1 to 8-15 designing low voltage, 18-1 to 18-24 differential, 3-6 to 3-8, 6-8 to 6-10 dominant-pole compensation, 7-9 to 7-13 dynamic range, 18-3 to 18-6 error sources, 18-4 external compensation, 7-8 frequency graph, 15-6 gain error budget, 12-19 gain compensation, 7-12 to 7-14 H. W. Bode, 1-2 Harry Black, Bell Labs, 1-1 history of, 1-1 to 1-5 impact on oscillator, 15-5 to 15-8 ideal, 3-1 increasing current, 14-19 to 14-24 input common-mode range, 18-6 to 18-10 internal compensation, 7-2 to 7-9 inverting, 3-4 to 3-6, 6-6 to 6-8, 7-15 inverting circuit, 6-6 lead compensation, 7-13 to 7-17 lead-lag compensation, 7-18 to 7-21 loading capacitance, 7-4 loop gain calculation circuit, 7-9

noise, 10-12 to 10-19 noise characterization, 10-1 noise model, 10-14 to 10-16 noise of differential, 10-18 noise of inverting, 10-16 to 10-18 noise of noninverting, 10-17 noise theory, 10-1 to 10-24 non-ideal, 6-1 to 6-11 noninverting, 3-3 to 3-5, 6-5 to 6-7, 7-16 noninverting circuit, 18-7 noninverting, schematic, 6-5 nonrail to rail input circuit, 18-8 offset budget, 12-19 open-loop noninverting, schematic, 6-6 output voltage swing, 18-11 to 18-13 parameter glossary, 11-2 to 11-10 parameters, 11-1 to 11-23 pinouts, 17-24 proper termination, 17-28 rail to rail input circuit, 18-8 rail to rail output circuit, 18-11 rms vs P-P noise, 10-1 to 10-3 selection, 12-15 to 12-17, 13-10 to 13-12 signal-to-noise ratio, 18-5 to 18-7 single-supply circuit design, 18-13 split-supply circuit, 10-19 terminal model circuit, 17-5 TL03x, 7-3 video, 3-9 uA709, 1-3 uA741, 1-3 voltage booster, 14-20 to 14-23 Oscillation, requirements, 15-1 to 15-3 Oscillator analysis of circuit, 15-7 to 15-9 bubba, 15-17 to 15-19 bubba circuit, 15-17 buffered phase shift circuit, 15-16 circuits for sine wave type, 15-9 to 15-21 description of sine wave, 15-1 gain, 15-4 to 15-6 impact of active element op amp, 15-5 to 15-8 output graph, 15-7 phase shift, 15-3 to 15-5, 15-14 to 15-17 phase shift circuit, 15-14 positive feedback diagram, 15-8 quadrature, 15-18 to 15-21 quadrature circuit, 15-19 sine wave, 15-1 to 15-21 Wein bridge, 15-9 to 15-15

Wien bridge circuit, 15-11, 15-12 Wien bridge graph, 15-11 Output impedance, 11-14 circuit, 11-14 Output spectrum, graph, 11-19 Output voltage graph for TL07x, 7-5 graph for TL08x, 7-6 Output voltage swing graph, 11-12 op amp, 18-11 to 18-13 parameter, 11-12 Overshoot predictions, 5-15 to 5-17

# **P**

P-P noise, vs rms noise, 10-1 to 10-3 Parameter broadband noise, 11-18 common-mode rejection ratio, 11-15 differential input voltage range, 11-11 equivalent input noise, 11-17 to 11-19 glossary, 11-2 to 11-10 input common-mode voltage range, 11-11 input current, 11-10 input offset voltage, 11-8 to 11-10 large signal differential voltage amplification, 11-13 maximum output voltage swing, 11-12 phase margin, 11-19 to 11-22 settling time, 11-22 slew rate, 11-16 to 11-18 spot noise, 11-17 to 11-19 supply current, 11-16 supply voltage rejection ratio, 11-15 total harmonic distortion, 11-18 to 11-20 understanding, 11-1 to 11-23 unity gain bandwidth, 11-19 to 11-22 Parameters, DAC, 14-10 to 14-16 Parasitic elements, 11-13 to 11-15 circuit, 11-13 PCB design capacitors, 17-12 to 17-14 decoupling, 17-20 to 17-24 grounding, 17-7 to 17-11 inductors, 17-13 input isolation, 17-23 to 17-25 ordering of layers, 17-6 to 17-8 output isolation, 17-23 to 17-25

packages, 17-24 to 17-27 parallel signal traces, 17-19 passive component characteristics, 17-11 to 17-21 resistors, 17-11 surface mount, 17-27 through-hole considerations, 17-26 to 17-29 trace antennas, 17-14 to 17-17 trace characteristics, 17-14 trace reflections, 17-16 to 17-21 PCB layout, 17-10 loop and slot antenna, 17-15 trace corners, 17-16 PCB mechanical conduction, 17-3 to 17-8 double sided, 17-5 layers, 17-4 to 17-7 materials, 17-3 to 17-5 multi-layer, 17-6 single layer, 17-4 to 17-6 PCB traces broadcasting from, 17-9 trace to plane capacitance, 17-17 Percent overshoot, graph, 7-4 Phase margin, 11-19 to 11-22 graph, 7-4 graph for TLV277x, 7-7 Phase shift buffered oscillator circuit, 15-16 graph, 11-21 graph for TL07x, 7-5 graph for TL08x, 7-6 oscillator, 15-3 to 15-5 Phase shift oscillator buffered, 15-15 to 15-17 circuit, 15-14 single amplifier, 15-14 to 15-16 Photodiode amplifier, 12-8 Phototransistor amplifier, 12-9 Photovoltaic cell amplifier, 12-9 Pin outs, op amp, 17-24 Pink noise, 10-11 Plane, to trace capacitance, 17-17 Plane placement, digital and analog, 17-8 Power booster, DAC, 14-22 Power supply rejection ratio, DAC, 14-14 Precision current feedback amp, 9-2 to 9-4 voltage feedback amp, 9-2 to 9-4

Precision current source, 12-7 Pulse response, graph for TLV277x, 7-7

# **Q**

Quadrature oscillator, 15-18 to 15-21 circuit, 15-19 Quality factor, filter, 16-9 to 16-11

# **R**

R/2R circuit for DAC, 14-5 DAC, 14-4 to 14-6 resistor array, 14-4 Rail-to-rail op amp, input circuit, 18-8 Rail-to-rail output op amp, output stage circuit, 18-11 RC first-order passive low pass circuit, 16-2 fourth-order pass low pass circuit, 16-3 low pass filter frequency graph, 16-4 low pass phase response graph, 16-4 RC , phase shift graph, 15-3 Reconstruction filter characteristics, 13-14 circuit for single pole, 13-15 DAC, 13-13 to 13-16 Red noise, 10-12 Reference bias circuit, 12-13 Reference circuit ADC, 13-15 to 13-18 DAC, 13-15 to 13-18 Reference voltage characterization, 12-12 to 12-14 Resistance, flux residue, 17-20 Resistor current feedback amp, 8-9 to 8-12 high-performance circuit, 17-11 Resistor ladder circuit for DAC, 14-2 DAC, 14-2 to 14-4 Resistive transducer, 12-6, 12-7 Resonance, capacitor, 17-22 Ringing predictions, 5-15 to 5-17 RMS noise, vs P-P noise, 10-1 to 10-3 Rule current divider, 2-4 voltage divider, 2-3

# **S**

Sallen-Key band-pass filter, circuit, 16-30 Sallen-Key high-pass filter biasing circuit, 16-50 circuit, 16-24 circuit with unity gain, 16-24 Sallen-Key low-pass filter biasing circuit, 16-48 circuit, 16-15 circuit with unity gain, 16-15, 16-20 Sallen-Key topology, 16-14 to 16-18, 16-24 to 16-26 band-pass filter, 16-30 to 16-32 Saturated transistor circuit, 2-9 to 2-11 Schematic, 6-5 simultaneous equation, 4-9, 4-13, 4-16, 4-19 Second order equation, 5-15 to 5-17 Second-order all-pass filter, 16-44 to 16-46 Second-order band-pass filter, 16-29 to 16-33 multiple feedback topology, 16-31 to 16-33 Sallen-Key topology, 16-30 to 16-32 Second-order high-pass filter, 16-24 to 16-27 multiple feedback topology, 16-25 to 16-27 Sallen-Key topology, 16-24 to 16-26 Second-order low-pass filter, 16-14 to 16-20 coefficients, 16-17 multiple feedback topology, 16-18 to 16-20 Sallen-Key topology, 16-14 to 16-18 Self resonance, capacitor, 17-22 Settling time, 11-22 DAC, 14-16 to 14-18 graph, 11-22 Shot noise, 10-5 to 10-8 Shutdown, op amp, 18-12 to 18-14 Sigma-delta, DAC, 14-5 to 14-7 Signal conditioning, for IF sampling, 13-1 to 13-23 Signal-to-noise and distortion, DAC, 14-14 Signal-to-noise ratio, 10-3 op amp, 18-5 to 18-7 Significant bits, versus binary bits, 12-2 Simultaneous equations, 4-8 to 4-19 SINAD, DAC, 14-14 Sine wave oscillator, 15-1 to 15-21 circuits, 15-9 to 15-21 description, 15-1 Single supply op amp, 4-1 to 4-23

circuit, 4-1 inverting circuit, 4-4, 4-5 circuit analysis, 4-3 to 4-8 inverting, 4-3 to 4-6 noninverting, 4-6 to 4-8 noninverting circuit, 4-7 transfer curve, 4-5, 4-7 vs dual supply, 4-1 to 4-4 Single-ended, to diff output drive circuit, 13-18 Single-ended input drive, circuit for ADC, 13-20 Single-supply circuit design, 18-13 Single-supply filter, circuit, 16-47 Single-supply operation, DAC, 14-22 to 14-24 Slew rate at unity gain, 11-16 circuit, 11-16 Slot antenna, PCB layout, 17-15 SNR. See signal-to-noise ratio Spans, requiring correction, 12-4 Spectral density, graph, 13-14 Split-supply op amp, circuit, 10-19 Spot noise, 11-17 to 11-19 Spurious free dynamic range, DAC, 14-15 Stability current feedback amp, 8-11 to 8-13, 9-6 to 9-8 feedback capacitance, 8-12 to 8-14 op amp loading capacitance, 7-4 voltage feedback amp, 9-6 to 9-8 Stability analysis circuit, 8-2, 8-3 current feedback amp, 8-7 to 8-10 Stability equation, 8-2 to 8-4 Stray capacitance graph for current feedback amp, 8-12 on inverting input circuit, 7-16 Summary points, block diagram math, 5-3 Superposition, 2-8 to 2-10 Supply current, 11-16 Supply voltage rejection ratio, 11-15

# **T**

T network circuit feedback loop, 3-7 Thevenim's theorem, 3-8 Termination, unused op amps, 17-28

System specifications, review, 12-12

Theorem Norton's, 2-5 Superposition, 2-8 to 2-10 Thevenin's, 2-5 to 2-8 Thermal noise, 10-7 to 10-9 Thevenin's theorem, 2-5 to 2-8 complex feedback networks, 3-7 to 3-9 THS3201 gain vs frequence graph, 13-21 phase vs frequency graph, 13-21 TL03x, 7-4 frequency response graph, 7-3 op amp, 7-3 phase shift graph, 7-3 small-signal pulse response graph, 7-3 voltage amplification graph, 7-3 voltage follower graph, 7-3 TL07x, 7-4 to 7-6 graph, 7-5 TL08x, 7-5 to 7-7 graph, 7-6 TLC2201, 10-19 to 10-24 circuit, 10-21, 10-23 noise graph, 10-20 TLE2027, 10-19 TLV227x, 7-6 to 7-9 graphs, 7-7 TLV2772, 10-12 to 10-14 noise graph, 10-13 typical noise, 10-14 Total harmonic distortion, 11-18 to 11-20 DAC, 14-8 to 14-10, 14-14 Total noise, 10-12 to 10-14 Trace length for inverting op amp, 17-25 length for quad op amp, 17-25 parallel signal coupling, 17-19 quad op amp with half-supply generator, 17-26 to plane capacitance, 17-17 Trace corners, PCB layout, 17-16 Transducer, 12-1 to 12-6 ADC analog interface, 18-13 to 18-17 ADC interface circuit, 18-15, 18-16 characterization, 12-13 to 12-16 measurement system, 12-1 output voltage, 12-14 resistive, 12-6, 12-7 types, 12-6 to 12-12

Transducer bias circuit, 12-13 Transforms, block diagram math, 5-5 Transistor amplifier, 2-10 to 2-13 Tschebyscheff low-pass filter, 16-7 Butterworth response graph, 16-51 gain response graph, 16-7 quality factor graph, 16-10 second order, 16-16 Twin-T filter active circuit, 16-38 passive circuit, 16-37

# **U**

uA709, op amp, 1-3 uA741, op amp, 1-3 Unity gain, 11-16 Unity gain bandwidth, 11-19 to 11-22

# **V**

VFA. See Voltage feedback amplifier; voltage feedback amplifier Vias, inductive, 17-19 to 17-21 Video amplifier, 3-9 Video amplifier circuit, 3-9 Voltage amplification graph, 11-21 graph for TL07x, 7-5 graph for TL08x, 7-6 graph for TLV277x, 7-7 parameter, 11-13 Voltage booster, op amp, 14-20 to 14-23 circuit for DAC, 14-21, 14-22 Voltage divider rule, 2-3 to 2-5 Voltage feedback amplifier, 7-1 to 7-23 bandwidth, 9-3 to 9-7 current feedback amp comparison, 9-1 to 9-10 equation comparison, 9-8 to 9-10 frequency graph, 9-4 gain graph, 9-4 impedance, 9-7 to 9-9 long-tailed pair circuit, 9-2 precision, 9-2 to 9-4 stability, 9-6 to 9-8 Voltage follower frequency, graph, 13-17 Voltage reference circuit

ADC, 13-17 DAC, 13-17 Voltage reference filter, circuit, 13-16

Here is the image describtion:
```
The image is a simple, black square with a white capital letter "W" centered within it. The "W" is bold and stands out prominently against the black background. The design is minimalistic, with no additional elements or decorations. The contrast between the black and white colors makes the letter highly visible and easy to read.
```

Weighted resistor circuit for DAC, 14-3 DAC, 14-3 to 14-5 Wein bridge oscillator, 15-9 to 15-15 circuit with AGC, 15-13 circuit with nonlinear feedback, 15-12

graph, 15-11 Wheatstone bridge, circuit, 12-8 White noise, 10-11 Wien bridge circuit, 15-9 oscillator circuit, 15-11 Wien-Robinson filter, 16-39 to 16-42 active circuit, 16-39 passive circuit, 16-39 Wilder, Robert J., Fairchild, 1-3 Wireless communication, 13-1 to 13-23 Wireless systems, 13-1 to 13-6